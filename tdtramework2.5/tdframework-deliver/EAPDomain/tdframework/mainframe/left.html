<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<base target="main"/>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
<title>菜单区</title>	
<link rel="stylesheet" href="../../tdframework/mainframe/css/td_style_left.css" type="text/css"/>
<script language="javascript" src="../../tdframework/mainframe/js/type.js" ></script>
<script language="javascript" src="../../tdframework/mainframe/js/common.js" ></script>
<script language="javascript" src="../../tdframework/mainframe/js/menutree.js" ></script>

<script language="JavaScript">

var APP_PATH='../..';

var FIRST_PAGE='System80';

if (top && (top.lastMenus==null || typeof(top.lastMenus)=="undefined" ) ){
	top.lastMenus=[];
}
if (top && (top.maxLastMenus==null || typeof(top.maxLastMenus)=="undefined" ) ){
	top.maxLastMenus=5;
}


window.currentNode=null;
window.currentLeaf=null;


function showHomePage(){
	if (top.DefaultHomePageId) {
		MenuTree.showNode(top.DefaultHomePageId);
	}

	if (top.top_page.MenuBar.getCurrentTopMenu()!=null && FIRST_PAGE==top.top_page.MenuBar.getCurrentTopMenu().id){
		MenuTree.showNode("080AA");
		//document.getElementById("myworkspace").style.display="block";
		//document.getElementById("mymenuspace").style.display="none";
		//document.getElementById("td_xs").innerHTML="首页";
		//document.getElementById("td_xs").title="首页";
	}else{
		//document.getElementById("myworkspace").style.display="none";
		//document.getElementById("mymenuspace").style.display="block";
	}
	
}


function dealNode(obj){
	var objDiv=document.getElementById("sub_"+obj.id);
	
	if (window.currentNode ==null){
		showElement(objDiv);
		obj.className=obj.className+"open";
		fireFirstChild(obj.id);
		window.currentNode=obj;
	}else if (window.currentNode.id!=obj.id){
		var oldObjDiv=document.getElementById("sub_"+window.currentNode.id);
		hideElement(oldObjDiv);
		window.currentNode.className=window.currentNode.className.replace("open","");
		showElement(objDiv);
		obj.className=obj.className+"open";
		fireFirstChild(obj.id);
		window.currentNode=obj;
	}else{
		hideElement(objDiv);
		obj.className=obj.className.replace("open","");
		window.currentNode=null;
	}
}


function dealLeaf(obj){

	if (window.currentLeaf!=null){
		window.currentLeaf.firstChild.style.color="";
	}
	window.currentLeaf=obj;
	window.currentLeaf.firstChild.style.color="red";

	addLastMenu(obj.id);

	var menuObj=MenuTree.allMenuNodes[obj.id];
	var pl=APP_PATH+"/blank.html";
	if (menuObj.pageLink!=null && menuObj.pageLink!=""){
		pl=menuObj.pageLink;
	}
	if(menuObj.openMethod=="0"){

		document.myform.favoriteName.value = menuObj.menuName;
		document.myform.currentLocation.value = pl;
		document.myform.menuId.value = menuObj.menuId;
		parent.main.location.href = pl;
	}else if(open_method==1){
		window.open(pl, "", "");
		return;
	}


	var subsystemname =MenuTree.allMenuNodes[menuObj.parentmenuId].menuName;
	parent.work_items.setNav(subsystemname, menuObj.menuName);

}


function dealLast(obj){

	if (window.currentLeaf!=null){
		window.currentLeaf.firstChild.style.color="";
	}
	window.currentLeaf=obj;
	window.currentLeaf.firstChild.style.color="red";

	var pageLink=obj.getAttribute("pagelink");
	var menuName=obj.getAttribute("menuname");
	document.myform.favoriteName.value = menuName;
	document.myform.currentLocation.value = pageLink;
	document.myform.menuId.value = obj.id;

	var subsystemname ="最近访问";

	parent.main.location.href = pageLink;
	parent.work_items.setNav(subsystemname, menuName);
}

function fireFirstChild(mid){
	var menuObj=MenuTree.allMenuNodes[mid];
	if (menuObj.SubNum==1){
		for(var k in menuObj.childrenMap){
			var cid=menuObj.childrenMap[k].menuId;
			document.getElementById(cid).fireEvent("onclick");
			break;
		}
	}
}



function addLastMenu(mid,mname,pageLink){
	var menu=MenuTree.allMenuNodes[mid];
	if (menu==null){
		var menu={
			menuId : mid,
			menuName : mname,
			pageLink : pageLink
		};
	}

	var lastNo=top.lastMenus.length;

	for (var i=0;i<lastNo;i++ ){
		if (top.lastMenus[i].menuId==menu.menuId){
			top.lastMenus=delArray(top.lastMenus,i);
			break;
		}
	}

	lastNo=top.lastMenus.length;
	if (lastNo<top.maxLastMenus){
		top.lastMenus[lastNo]=cloneObject(menu);
	}else{
		top.lastMenus=delArray(top.lastMenus,0);
		top.lastMenus[top.lastMenus.length]=cloneObject(menu);
	}

	buildLastMenu();

}


function buildLastMenu(){
	var rs="";
	var lastNo=top.lastMenus.length;
	for (var i=lastNo-1;i>=0;i-- ){
		var menu=top.lastMenus[i];
		rs+="<span onclick=\"dealLast(this);\" id=\""+menu.menuId+"\" class=\"mLevel2c\" ";
		rs+="menuname=\""+menu.menuName+"\" pagelink=\""+menu.pageLink+"\" >";
		rs+="<a href=\"#\" onclick=\"ignore();\">"+menu.menuName+"</a></span><br />\n";
	}

	document.getElementById("lastMenuDiv").innerHTML=rs;
}



function dealFav(obj){
	if (window.currentLeaf!=null){
		window.currentLeaf.firstChild.style.color="";
	}
	window.currentLeaf=obj;
	window.currentLeaf.firstChild.style.color="red";

	var pageLink=obj.getAttribute("pagelink");
	var menuName=obj.getAttribute("menuname");
	var sid=obj.getAttribute("sid");
	document.myform.favoriteName.value = menuName;
	document.myform.currentLocation.value = pageLink;
	document.myform.menuId.value = obj.id.substr(2);

	addLastMenu(obj.id.substr(2),menuName,pageLink);

	var subsystemname ="收藏夹";

	//parent.main.location.href = pageLink;
	//parent.work_items.setNav(subsystemname, menuName);


}


function showFavMenu(menuId,employeeId,menuName,systemId,order,pageLink){
	document.writeln(createFavMenu(menuId,employeeId,menuName,systemId,order,pageLink));
}
function createFavMenu(menuId,employeeId,menuName,systemId,order,pageLink){
	var rs=document.getElementById("favTemplate").value;
	rs=replaceAll(rs,"{menuId}","fav_"+menuId);
	rs=replaceAll(rs,"{menuName}",menuName);
	rs=replaceAll(rs,"{pageLink}",pageLink);
	rs=replaceAll(rs,"{order}",order);
	rs=replaceAll(rs,"{systemId}",systemId);
	return rs;
}

function addFavMenu(menuId,employeeId,menuName,systemId,order,pageLink){
	var divObj=document.getElementById("favMenu");
	if (divObj!=null) {
		divObj.innerHTML+=createFavMenu(menuId,employeeId,menuName,systemId,order,pageLink);
	}
}

function delFavMenu(menuId){
	var oo=document.getElementById("fav_"+menuId);
	if (oo!=null){
		oo.nextSibling.removeNode(true);
		oo.removeNode(true);
	}
}



function refreshFavorite(menuId,favoriteName,systemId,pageLink){
	addFavMenu(menuId,0,favoriteName,systemId,'0',pageLink);
	//alert("加入 "+fname+" , 刷新收藏夹脚本 comming soon....");
}

function init()
{
	var sysname="子系统标题信息";
	
	if (top.currentSysNameValue){
		sysname=top.currentSysNameValue;
		if (sysname.indexOf("◆")==0){
			sysname=sysname.substr(1);
		}
	}else{
		sysname="河北联通BSS"
	}

	document.getElementById("td_xs").innerHTML=sysname;
	document.getElementById("td_xs").title=sysname;

buildLastMenu();

//showHomePage();

}




MenuTree.createMenu('871','系统','','871','0','','0');
MenuTree.createMenu('871A','服务平台','','871','0','','1');
MenuTree.createMenu('871AA','任务查询','871A','871','0','retain/retaintaskmgr.do?operType=statTask','2');
MenuTree.createMenu('871AB','预警任务回访','871A','871','0','views/crmsystem/retain/noticemgr/smsend/SmSendMain.jsp','2');
MenuTree.createMenu('871AC','新入网客户回访','871A','871','0','views/crmsystem/retain/custcomplain/complainaccept/ComAcceptMain.jsp','2');
MenuTree.createMenu('871AD','集团客户回访','871A','871','0','retain/retainlogmgr.do','2');
MenuTree.createMenu('871AE','调查任务回访','871A','871','0','views/crmsystem/retain/activitymgr/retaincustrequest/RetainCustRequestMgrMain.jsp','2');
MenuTree.createMenu('871AF','人工催缴','871A','871','0','views/crmsystem/retain/custusearea/CustUseAreaMgrMain.jsp','2');
MenuTree.createMenu('871AG','短信维系','871A','871','0','retain/custinterestmgr.do','2');
MenuTree.createMenu('871AH','预约服务维护','871A','871','0','views/crmsystem/retain/custimpdatemgr/CustImpDateMgrMain.jsp','2');
MenuTree.createMenu('871AI','我的工作量','871A','871','0','views/crmsystem/retain/arrearnotice/ManualArrearNoticeMain.jsp','2');
MenuTree.createMenu('871AJ','回访历史查询','871A','871','0','views/crmsystem/retain/noticemgr/smsend/SmSendMain.jsp','2');
MenuTree.createMenu('871AK','服务经理查询','871A','871','0','retain/retaindetailplanmgr.do','2');
MenuTree.createMenu('871AL','短信维系历史查询','871A','871','0','views/crmsystem/retain/userchannelmgr/UserChannelMgrMain.jsp','2');
MenuTree.createMenu('871AM','投诉受理','871A','871','0','views/crmsystem/retain/custleavemgr/CustLeaveMgrMain.jsp','2');
MenuTree.createMenu('871AN','客户需求维护','871A','871','0','views/crmsystem/retain/custdetailmgr/indcustdetailmgr/IndCustDetailMgrMain.jsp','2');
MenuTree.createMenu('871B','服务策略','','871','0','','1');
MenuTree.createMenu('871BA','服务策略','871B','871','0','retain/retainstrategymgr.do','2');
MenuTree.createMenu('871BB','服务策略审批','871B','871','0','retain/retainstrategymgr.do?operType=initRatify','2');
MenuTree.createMenu('871BC','服务策略评估','871B','871','0','retainstrategyevaluate.do?method=init','2');
MenuTree.createMenu('871BD','服务主题管理','871B','871','0','retain/themeinfomgr.do','2');
MenuTree.createMenu('871BF','服务主题审批','871B','871','0','retain/themeinfomgr.do?operType=initRatify','2');
MenuTree.createMenu('871F','服务管理','','871','0','','1');
MenuTree.createMenu('871FA','客户分配','871F','871','0','retain/noticerulemgr.do','2');
MenuTree.createMenu('871FB','服务参数设置','871F','871','0','views/crmsystem/retain/noticemgr/commsmmgr/CommSMMgrMain.jsp?flag=getCommSM','2');
MenuTree.createMenu('871FC','常用短信维护','871F','871','0','retain/themeinfomgr.do','2');
MenuTree.createMenu('871FD','服务客户提取','871F','871','0','views/crmsystem/retain/activitymgr/retaincustpick/RetainCustPickMain.jsp','2');
MenuTree.createMenu('871FE','服务客户(细分)提取','871F','871','0','views/crmsystem/retain/salestaskmgr/SalesTaskMain.jsp','2');
MenuTree.createMenu('871FF','服务任务分配','871F','871','0','views/crmsystem/retain/activitymgr/retaintaskassign/RetainTaskBatchAssignMain.jsp','2');
MenuTree.createMenu('871FG','服务任务调配','871F','871','0','views/crmsystem/retain/activitymgr/retaintaskadjust/RetainTaskAdjustMain.jsp','2');
MenuTree.createMenu('871I','服务分析','','871','0','','1');
MenuTree.createMenu('871IA','维系与挽留效果分析','871I','871','0','views/crmsystem/retain/reportmgr/retainanalysis/RetainAnalysisMain.jsp','2');
MenuTree.createMenu('871J','脚本管理','','871','0','','1');
MenuTree.createMenu('871JA','脚本信息管理 ','871J','871','0','views/crmsystem/script/scriptmanage/ScriptInfoMain.jsp','2');
MenuTree.createMenu('871JB','脚本定制  ','871J','871','0','views/crmsystem/script/customize/ScriptInfoMain.jsp','2');

MenuTree.buildMenu();





//-->
</script>

<style>
</style>
</head>

<body onload="init();">
<form name="myform">
		<table align="left" width="100%" border="0" cellpadding="0" cellspacing="0" height="100%" >
		<tr><td height="36" width="100%" >
			<table border="0" cellpadding="0" cellspacing="0" class="menutitle">
			  <tr> 
				<td class="menutitle1_l"></td>
				 <td class="menutitle1_m" id="td_xs" title=""></td>
				  <td class="menutitle1_r"></td>
			  </tr>
			</table>
		</td>
		</tr>
		<tr> 
			<td width="100%" height="90%">
		<table width="100%" border="0" cellpadding="0" cellspacing="0" height="100%" bgcolor="#f6f6f6" >
		  <tr> 
			<td width="100%" >
		
			<div style="overflow-x:auto;overflow-y:auto;width:100%;height:100%;display:block;">

<span onclick="showOrHideElementById('mainMenu')"  
id="mainMenuTitle" class="topLevel"><b>主菜单区</b></span>

<div id="mainMenu" >
<script language="JavaScript">
MenuTree.showMenuTree();
</script>
</div>

<textarea style="display:none;" readonly="readonly" id="favTemplate">
	<span onclick="dealFav(this);" class="mLevel2c"  
	 id="{menuId}" menuname="{menuName}" pagelink="{pageLink}" order="{order}" sid="{systemId}" >
	<a href="#" onclick="ignore();">{menuName}</a>
	</span><br />
</textarea>

<span onclick="showOrHideElementById('favMenu')"  id="favMenuTitle" class="topLevel"><b>收藏夹</b></span>

<div id="favMenu" style="display:none;" >
<script language="JavaScript">

showFavMenu('871AC','120007','新入网客户回访','871','0','views/crmsystem/retain/custcomplain/complainaccept/ComAcceptMain.jsp');
showFavMenu('871AG','120007','短信维系','871','0','retain/custinterestmgr.do');
showFavMenu('871AI','120007','我的工作量','871','0','views/crmsystem/retain/arrearnotice/ManualArrearNoticeMain.jsp');
showFavMenu('871IA','120007','维系与挽留效果分析','871','0','views/crmsystem/retain/reportmgr/retainanalysis/RetainAnalysisMain.jsp');
</script>
</div>

 				</div>
			</td></tr>
			</table>
		<input type="hidden" name="systemId" value="{/root/SystemId}" />
		<input type="hidden" name="currentLocation" />	
		<input type="hidden" name="menuId" value=""/>
		<input type="hidden" name="favoriteName" />
		<input type="hidden" name="subSystemName" value="{/root/MainMenu/Level1/Sub1/Name}" />
	
				</td>

			</tr>
<tr >
<td onclick="showOrHideElementById('flist');" 
style="border-top:3px solid #D71920"
><span class="topLevel"><b>最近访问页面</b></span>
</td>
</tr>
<tr id="flist" style="display:none">
<td height="111">
<div id="lastMenuDiv" style="background-color:#f9f9f9;overflow-x:auto;overflow-y:auto;width:100%;height:100%;display:block;">
</div>
</td>
</tr>
	</table>

</form>



</body>
</html>
