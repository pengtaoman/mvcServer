defineModule("orderaccept.prodofferaccept.ProductDateBuilder",[],function(){Date.prototype.getMonthEnd=Date.prototype.getMonth;Date.prototype.setMonthEnd=function(c){this.setDate(1);this.setMonth(c);};
var a=function(m,j){if(!m){return null;}var n;if(typeof m=="number"){n=new Date(m);}else{var c=m.split(" ");var d=c[0].split("-");var k=parseInt(d[0],10);var i=parseInt(d[1],10)-1;var e=parseInt(d[2],10);
var f="";var g="";var h="";if(c[1]!=null&&c[1]!=undefined){var l=c[1].split(":");f=parseInt(l[0],10);g=parseInt(l[1],10);h=parseInt(l[2],10);}if(j&&j==1){n=new Date(k,i,e);}else{n=new Date(k,i,e,f,g,h);
}}return n;};var b=function(e){var j=e.getMonth()+1;var l=new String(j);if(l.length==1){l="0"+l;}var g=e.getDate();var k=new String(g);if(k.length==1){k="0"+k;}var h=e.getHours();var m=new String(h);if(m.length==1){m="0"+m;
}var c=e.getMinutes();var f=new String(c);if(f.length==1){f="0"+f;}var d=e.getSeconds();var i=new String(d);if(i.length==1){i="0"+i;}return e.getFullYear()+"-"+l+"-"+k+" "+m+":"+f+":"+i;};orderaccept.prodofferaccept.ProductDateBuilder=function(h){var k=this;
k.today=h.today;k.invalidDate="2037-01-01 00:00:00";k.changeKind=h.changeKind;k.delayUnit=h.delayUnit;k.delayTime=h.delayTime;k.validType=h.validType;k.validPeriod=h.validPeriod;k.isMainReserve=h.isMainReserve;
k.ifReserve=h.ifReserve;k.beginDate=h.beginDate;k.oEffectType=h.oEffectType;k.effectType=k.oEffectType?k.oEffectType.value:"0";k.endDate=h.endDate;var f=h.ifCombProd;var m=h.applyEvent;var i=h.ifChangeMainProduct;
var g=h.ifChangeMainFlag;k.delayUnorderUnit=h.delayUnorderUnit;k.delayUnorderTime=h.delayUnorderTime;k.dateTypeMap={"1":"setYear","2":"setMonth","3":"setMonthEnd","4":"setMonth","6":"setDate","7":"setHour"};
k.dateTypeMapGet={"1":"getFullYear","2":"getMonth","3":"getMonthEnd","4":"getMonth","6":"getDate","7":"getHour"};k.delayDateTypeMap={"1":"setYear","2":"setMonth","3":"setMonth","4":"setDate","5":"setHours"};
k.delayDateTypeMapGet={"1":"getFullYear","2":"getMonth","3":"getMonth","4":"getDate","5":"getHours"};k.getBeginDate=function(){if(dojo.some([0,2,3],function(q){return q==k.changeKind;})){return k.beginDate;
}var p=a(k.today);p=l(p);if(p==null){throw new Error("开始日期计算错误");}return b(p);};function l(q){if(k.changeKind==1&&g){return a(k.beginDate);}var p=m==302&&i==1&&k.isMainReserve;var s=false;if(k.delayUnit!=null&&k.delayTime!=null){s=k.delayUnit>0&&k.delayTime>0;
}var r=p||s;if(k.changeKind==1&&r){q=o(a(k.today,1),k.delayUnit,k.delayTime);}return q;}k.getEndDate=function(){var p=j();return b(p);};function j(){if(!k.endDate){k.endDate=k.invalidDate;}if(k.endDate.length<10){throw new Error("\u7ed3\u675f\u65e5\u671f\u6709\u8bef\uff1a"+k.endDate);
}var q=a(k.endDate);if(k.changeKind==1){var s=a(k.getBeginDate());var p=d(a(k.getBeginDate()),k.validType,k.validPeriod);p=c(p,a(k.invalidDate));if(p.getTime()==s.getTime()){q=a(k.invalidDate);}else{q=p;
}if(typeof k.dateTypeMap[k.validType]==="undefined"||typeof k.dateTypeMapGet[k.validType]==="undefined"||k.validPeriod==0){}else{q=a(b(q),1);}}else{if(k.changeKind==3){var r=a(k.today);if(k.ifReserve!=1){var p;
if(i==1){if(k.isMainReserve){p=n(a(k.today,1),2,1);}else{p=r;}}else{if(k.delayUnorderUnit&&(k.delayUnorderUnit==0||k.delayUnorderUnit=="0")){p=r;}else{if(k.delayUnorderUnit&&k.delayUnorderTime){p=o(a(k.today,1),k.delayUnorderUnit,k.delayUnorderTime);
}else{p=n(a(k.today,1),2,1);}}}q=c(p,a(k.invalidDate));}else{q=r;}}}return q;}function c(r,q){var p=Math.min(r.getTime(),q.getTime());return new Date(p);}function d(t,s,p){if(s==0){return a(k.invalidDate);
}var r=k.dateTypeMap[s];var q=k.dateTypeMapGet[s];if(typeof r==="undefined"||typeof q==="undefined"||p==0){return t;}t[r](t[q]()+parseInt(p,10));return t;}function n(r,q,p){if(q==0||p==0){return r;}r.setDate(1);
r=d(r,q,p);return r;}function o(p,q,r){if(q==2){p.setDate(1);}p=e(p,q,r);return p;}function e(r,s,t){var q=k.delayDateTypeMap[s];var p=k.delayDateTypeMapGet[s];if(typeof q==="undefined"||typeof p==="undefined"||t==0){return r;
}r[q](r[p]()+parseInt(t,10));return r;}};orderaccept.prodofferaccept.NewMainProductDateBuilder=function(c){var d=this;d.builder=new orderaccept.prodofferaccept.ProductDateBuilder(c);d.getBeginDate=function(){return d.builder.getBeginDate();
};d.getEndDate=function(){return d.builder.getEndDate();};};orderaccept.prodofferaccept.ProductDateBuilder.NewMainProductDateBuilder=orderaccept.prodofferaccept.NewMainProductDateBuilder;orderaccept.prodofferaccept.ProductDateBuilderFactoty={getBuilder:function(d,c){if(d==1){return new orderaccept.prodofferaccept.NewMainProductDateBuilder(c);
}else{return new orderaccept.prodofferaccept.ProductDateBuilder(c);}}};orderaccept.prodofferaccept.ProductDateBuilder.getDateFromString=a;orderaccept.prodofferaccept.ProductDateBuilder.getStringTimeFromDate=b;
});
defineModule("orderaccept.prodofferaccept.loader",[],function(){orderaccept.prodofferaccept.loader.loadProdOfferNewLoader=function(b){var a=dojo.getObject("orderaccept.prodofferaccept.loader.ProdOfferNewLoader",false);
BusCard.ScriptLoader.asynLoad(a?[]:[dojo.moduleUrl("orderaccept.prodofferaccept.loader","ProdOfferNewLoader.js").toString()],function(){try{dojo.global.prodOfferAcceptLoader=new orderaccept.prodofferaccept.loader.ProdOfferNewLoader(b);
}finally{BusCard.removeCoverLayer();}});};orderaccept.prodofferaccept.loader.loadProdOfferChangeLoader=function(b){var a=dojo.getObject("orderaccept.prodofferaccept.loader.ProdOfferChangeLoader",false);
BusCard.ScriptLoader.asynLoad(a?[]:[dojo.moduleUrl("orderaccept.prodofferaccept.loader","ProdOfferChangeLoader.js").toString()],function(){try{dojo.global.prodOfferAcceptLoader=new orderaccept.prodofferaccept.loader.ProdOfferChangeLoader(b);
}finally{}});};orderaccept.prodofferaccept.loader.loadMainProdOfferChangeLoader=function(b){var a=dojo.getObject("orderaccept.prodofferaccept.loader.MainProdOfferChangeLoader",false);BusCard.ScriptLoader.asynLoad(a?[]:[dojo.moduleUrl("orderaccept.prodofferaccept.loader","MainProdOfferChangeLoader.js").toString()],function(){try{dojo.global.prodOfferAcceptLoader=new orderaccept.prodofferaccept.loader.MainProdOfferChangeLoader(b);
}finally{BusCard.removeCoverLayer();}});};orderaccept.prodofferaccept.loader.loadProdOfferPreAcceptLoader=function(b){var a=dojo.getObject("orderaccept.prodofferaccept.loader.ProdOfferPreAcceptLoader",false);
BusCard.ScriptLoader.asynLoad(a?[]:[dojo.moduleUrl("orderaccept.prodofferaccept.loader","ProdOfferPreAcceptLoader.js").toString()],function(){try{dojo.global.prodOfferAcceptLoader=new orderaccept.prodofferaccept.loader.ProdOfferPreAcceptLoader(b);
}finally{BusCard.removeCoverLayer();}});};orderaccept.prodofferaccept.loader.loadProdOfferCancelLoader=function(b){var a=dojo.getObject("orderaccept.prodofferaccept.loader.ProdOfferCancelLoader",false);
BusCard.ScriptLoader.asynLoad(a?[]:[dojo.moduleUrl("orderaccept.prodofferaccept.loader","ProdOfferCancelLoader.js").toString()],function(){try{dojo.global.prodOfferAcceptLoader=new orderaccept.prodofferaccept.loader.ProdOfferCancelLoader(b);
}finally{BusCard.removeCoverLayer();}});};orderaccept.prodofferaccept.loader.loadProdOfferProtocolAcceptLoader=function(b){var a=dojo.getObject("orderaccept.prodofferaccept.loader.ProdOfferProtocolAcceptLoader",false);
BusCard.ScriptLoader.asynLoad(a?[]:[dojo.moduleUrl("orderaccept.prodofferaccept.loader","ProdOfferProtocolAcceptLoader.js").toString()],function(){try{dojo.global.prodOfferAcceptLoader=new orderaccept.prodofferaccept.loader.ProdOfferProtocolAcceptLoader(b);
}finally{BusCard.removeCoverLayer();}});};orderaccept.prodofferaccept.loader.loadShoppingCartNewLoader=function(b){var a=dojo.getObject("orderaccept.prodofferaccept.loader.ShoppingCartNewLoader",false);
BusCard.ScriptLoader.asynLoad(a?[]:[dojo.moduleUrl("orderaccept.prodofferaccept.loader","ShoppingCartNewLoader.js").toString()],function(){try{dojo.global.prodOfferAcceptLoader=new orderaccept.prodofferaccept.loader.ShoppingCartNewLoader(b);
}finally{BusCard.removeCoverLayer();}});};orderaccept.prodofferaccept.loader.loadProdAddLoader=function(b){var a=dojo.getObject("orderaccept.prodofferaccept.loader.ProdAddLoader",false);BusCard.ScriptLoader.asynLoad(a?[]:[dojo.moduleUrl("orderaccept.prodofferaccept.loader","ProdAddLoader.js").toString()],function(){try{dojo.global.prodOfferAcceptLoader=new orderaccept.prodofferaccept.loader.ProdAddLoader(b);
}finally{BusCard.removeCoverLayer();}});};orderaccept.prodofferaccept.loader.loadPreOrderBackLoader=function(b){var a=dojo.getObject("orderaccept.prodofferaccept.loader.PreOrderBackLoader",false);BusCard.ScriptLoader.asynLoad(a?[]:[dojo.moduleUrl("orderaccept.prodofferaccept.loader","PreOrderBackLoader.js").toString()],function(){try{dojo.global.prodOfferAcceptLoader=new orderaccept.prodofferaccept.loader.PreOrderBackLoader(b);
}finally{BusCard.removeCoverLayer();}});};orderaccept.prodofferaccept.loader.loadProdInterChangeLoader=function(b){var a=dojo.getObject("orderaccept.prodofferaccept.loader.ProdInterChangeLoader",false);
BusCard.ScriptLoader.asynLoad(a?[]:[dojo.moduleUrl("orderaccept.prodofferaccept.loader","ProdInterChangeLoader.js").toString()],function(){try{dojo.global.prodOfferAcceptLoader=new orderaccept.prodofferaccept.loader.ProdInterChangeLoader(b);
}finally{BusCard.removeCoverLayer();}});};orderaccept.prodofferaccept.loader.loadPromotionChangeLoader=function(b){var a=dojo.getObject("orderaccept.prodofferaccept.loader.PromotionChangeLoader",false);
BusCard.ScriptLoader.asynLoad(a?[]:[dojo.moduleUrl("orderaccept.prodofferaccept.loader","PromotionChangeLoader.js").toString()],function(){try{dojo.global.prodOfferAcceptLoader=new orderaccept.prodofferaccept.loader.PromotionChangeLoader(b);
}finally{BusCard.removeCoverLayer();}});};orderaccept.prodofferaccept.loader.loadMemberOfferChangeLoader=function(b){var a=dojo.getObject("orderaccept.prodofferaccept.loader.MemberProdOfferAcceptLoader",false);
BusCard.ScriptLoader.asynLoad(a?[]:[dojo.moduleUrl("orderaccept.prodofferaccept.loader","MemberProdOfferAcceptLoader.js").toString()],function(){try{dojo.global.prodOfferAcceptLoader=new orderaccept.prodofferaccept.loader.MemberProdOfferAcceptLoader(b);
}finally{}});};orderaccept.prodofferaccept.loader.loadProdChangeAcceptLoader=function(b){var a=dojo.getObject("orderaccept.prodofferaccept.loader.ProdChangeAcceptLoader",false);BusCard.ScriptLoader.asynLoad(a?[]:[dojo.moduleUrl("orderaccept.prodofferaccept.loader","ProdChangeAcceptLoader.js").toString()],function(){try{dojo.global.prodOfferAcceptLoader=new orderaccept.prodofferaccept.loader.ProdChangeAcceptLoader(b);
}finally{BusCard.removeCoverLayer();}});};orderaccept.prodofferaccept.loader.loadMemberOrderGroupProductLoader=function(b){var a=dojo.getObject("orderaccept.prodofferaccept.loader.MemberOrderGroupProductLoader",false);
BusCard.ScriptLoader.asynLoad(a?[]:[dojo.moduleUrl("orderaccept.prodofferaccept.loader","MemberOrderGroupProductLoader.js").toString()],function(){try{dojo.global.prodOfferAcceptLoader=new orderaccept.prodofferaccept.loader.MemberOrderGroupProductLoader(b);
}finally{BusCard.removeCoverLayer();}});};orderaccept.prodofferaccept.loader.loadProductChangeAcceptLoader=function(b){var a=dojo.getObject("orderaccept.prodofferaccept.loader.ProductChangeAcceptLoader",false);
BusCard.ScriptLoader.asynLoad(a?[]:[dojo.moduleUrl("orderaccept.prodofferaccept.loader","ProductChangeAcceptLoader.js").toString()],function(){try{dojo.global.prodOfferAcceptLoader=new orderaccept.prodofferaccept.loader.ProductChangeAcceptLoader(b);
}finally{BusCard.removeCoverLayer();}});};orderaccept.prodofferaccept.loader.loadOrderChangeLoader=function(b){var a=dojo.getObject("orderaccept.prodofferaccept.loader.OrderChangeLoader",false);BusCard.ScriptLoader.asynLoad(a?[]:[dojo.moduleUrl("orderaccept.prodofferaccept.loader","OrderChangeLoader.js").toString()],function(){try{dojo.global.prodOfferAcceptLoader=new orderaccept.prodofferaccept.loader.OrderChangeLoader(b);
}finally{BusCard.removeCoverLayer();}});};orderaccept.prodofferaccept.loader.loadPreAcceptOrderLoader=function(b){var a=dojo.getObject("orderaccept.prodofferaccept.loader.PreAcceptOrderLoader",false);BusCard.ScriptLoader.asynLoad(a?[]:[dojo.moduleUrl("orderaccept.prodofferaccept.loader","PreAcceptOrderLoader.js").toString()],function(){try{dojo.global.prodOfferAcceptLoader=new orderaccept.prodofferaccept.loader.PreAcceptOrderLoader(b);
}finally{BusCard.removeCoverLayer();}});};});
defineModule("orderaccept.base.Controller",[],function(){dojo.declare("orderaccept.base.Controller",null,{route:function(c){var o=Array.prototype.slice.apply(arguments);if(o.length==0){return;}else{var p=this.getRoutePath(c),g=[],d=Array.prototype.push,b=Array.prototype.slice;
o.shift();if(o.length==1&&dojo.isArray(o[0])){g=o[0];}else{dojo.forEach(o,function(r){g.push(r);});}var q=this._extractRoutePath(c);var l=q[0];if(l=="self"){var n=q[q.length-1],j=q.splice(2),f=dojo.getObject(q.slice(1,q.length-1).join("."),false,this);
if(f){return f[n].apply(f,g);}else{return this[n].apply(this,g);}}else{if(this[l]){var m=dojo.getObject(q.slice(0,q.length-1).join("."),false,this),a=q[q.length-1];return m[a].apply(m,g);}else{if(this._isSpringBeanInvokeRequest(c)){var i=/^spring:(.*?)\/?$/i.exec(c),h=i[1].split("/");
if(h.length==3){return BusCard.$remote(h[1],h[0])[h[2]].apply(null,g);}else{return BusCard.$remote(h[0])[h[1]].apply(null,g);}}else{if(this._isClassMethodInvokeRequest(c)){var i=/^class:(.*?)\/?$/i.exec(c),h=i[1].split("/");
return BusCard.$load(h[0])[h[1]].apply(null,g);}else{if(this.isUrlRequest(c)){var i=/^url:(.*?)$/i.exec(c),k=i[1],e=BusCard.path.contextPath;if(k.indexOf("/")!=0){k="/"+k;}if(k.indexOf(e)!=0){k=e+k;}return BusCard.doGet(k,{},g[0],g[1]||function(){});
}else{dojo.publish(p,g);}}}}}}},_isSpringBeanInvokeRequest:function(b){var a=/^spring:/i.test(b);return a;},_isClassMethodInvokeRequest:function(b){var a=/^class:/i.test(b);return a;},isUrlRequest:function(b){var a=/^url:/i.test(b);
return a;},_extractRoutePath:function(b){var a=/^(?:\/)*(.*?)(?:\/)*$/.exec(b)[1];return dojo.filter(b.split("/"),function(c){return dojo.trim(c)!="";});},getRoutePath:function(b){var a=/^route\:/.test(b)?b:("route:"+(/^\//.test(b)?b:("/"+b)));
return a;},addEventListener:function(b,a,c){this.eventListenerRegistry=this.eventListenerRegistry||{};if(b&&dojo.trim(b)){this.eventListenerRegistry[b]=this.eventListenerRegistry[b]||[];if(c){this.eventListenerRegistry[b].unshift(a);
}else{this.eventListenerRegistry[b].unshift(a);}}},fireEvent:function(b){if(this.eventListenerRegistry&&this.eventListenerRegistry[b]){var a=this;dojo.forEach(this.eventListenerRegistry[b],function(c){c.call(a);
});}},_filterLoadedModule:function(a){var a=a||[];return dojo.filter(a,function(b){if(!dojo.getObject(b)){return true;}});},asynExecute:function(d,a){var b=this.declaredClass;DependenceAnalyser.addDepModules(b,dojo.filter(d,function(f){var e=/^[^\/]*$/;
return e.test(f);}));var c=dojo.map(this._filterLoadedModule(d)||[],function(e){var g=/^([^\/]*)\.([^\.\/]*)$/.exec(e),f=g?dojo.moduleUrl(g[1],g[2]+".js").toString():(e.indexOf(BusCard.path.contextPath)==0?e:(function(){if(e.indexOf("/")==0){return BusCard.path.contextPath+e;
}else{return BusCard.path.contextPath+"/"+e;}}()));return f;});return BusCard.ScriptLoader.asynLoad(c,a);},beginRenderingLifeCycle:function(b){var a=b.pid||("pid_")+(new Date().getTime());b.pid=a;dojo.global.$appContext$.get("viewContextRegistry")[a]={context:b};
return this;},prepareViewTemplate:function(c,b){var a=dojo.global.$appContext$.get("viewContextRegistry")[c.pid];if(b.indexOf("<")>=0||b.indexOf(">")>=0){a.interpretedTemplate=BusCard.Template.create(b).apply(c);
}else{a.interpretedTemplate=BusCard.Template.create(dojo._getText(b)).apply(c);}return this;},renderView:function(b,c){var a=dojo.global.$appContext$.get("viewContextRegistry")[b.pid];c.innerHTML=a.interpretedTemplate;
a.domNode=c;return this;},bindViewListener:function(c,b){var a=dojo.global.$appContext$.get("viewContextRegistry")[c.pid],d=dojo.map(b||[],function(f){var e=BusCard.path.contextPath;if(f.indexOf(e)==0){f=f.substring(c.length);
}if(f.indexOf("/")>=0){var g=f.indexOf(".");if(g!=-1){f=f.substring(0,g);}f=f.replace(/\//g,".");f=/^\.?(.*?)\.?$/.exec(f)[1];}return f;});a.controller=this;this.asynExecute(b,function(){var f=dojo.global.$appContext$.get("listenerRegistry"),e=function(){};
dojo.forEach(d,function(g){(f[g]||e).apply(null,[a]);});});return this;},endRenderingLifeCycle:function(a){try{delete dojo.global.$appContext$.get("viewContextRegistry")[a.pid];}catch(b){}return this;}});
});
defineModule("orderaccept.custom.JsonTreeLoader",["unieap.tree.TreeLoader"],function(a){dojo.declare("orderaccept.custom.JsonTreeLoader",[a],{load:function(g,h){if(this.url||this.rpc){var c=this.onBeforeLoad(g),e=this;
if(c==false){h(null);return;}var d=function(i){if(true||i instanceof unieap.ds.DataCenter){e.onAfterLoad(i,g);h(i);}};var f=function(){h(null);};if(dojo.isFunction(this.rpc)){this.rpc(g,d,f);}else{unieap.Action.requestData({url:this.url,sync:this.sync,parameters:this.buliderParams(this.parameters,g),load:function(i){d(i);
},error:function(){f();}},this.getPostData(g),false);}}else{var b=this.getLocalData(g);h(b);}}});});
dojo.require("unieap.global");dojo.require("unieap.util.util");defineModule("orderaccept.common.dialog.MessageBox",["unieap.dialog.MessageBox"],function(a){orderaccept.common.dialog.MessageBox.oldGetHeight=a._getHeight;
orderaccept.common.dialog.MessageBox.getHeight=function(){return 0;};orderaccept.common.dialog.MessageBox.alert=function(b,c){orderaccept.common.dialog.MessageBox.handlePrompt(b,c);MessageBox._getHeight=orderaccept.common.dialog.MessageBox.getHeight;
MessageBox.alert(b,c);MessageBox._getHeight=orderaccept.common.dialog.MessageBox.oldGetHeight;};orderaccept.common.dialog.MessageBox.autoCloseAlert=function(b,c){orderaccept.common.dialog.MessageBox.handlePrompt(b,c);
MessageBox._getHeight=orderaccept.common.dialog.MessageBox.getHeight;MessageBox.autoCloseAlert(b,c);MessageBox._getHeight=orderaccept.common.dialog.MessageBox.oldGetHeight;};orderaccept.common.dialog.MessageBox.cancelConfirm=function(b,c){orderaccept.common.dialog.MessageBox.handlePrompt(b,c);
MessageBox._getHeight=orderaccept.common.dialog.MessageBox.getHeight;MessageBox.cancelConfirm(b,c);MessageBox._getHeight=orderaccept.common.dialog.MessageBox.oldGetHeight;};orderaccept.common.dialog.MessageBox.confirm=function(b,c){orderaccept.common.dialog.MessageBox.handlePrompt(b,c);
MessageBox._getHeight=orderaccept.common.dialog.MessageBox.getHeight;MessageBox.confirm(b,c);MessageBox._getHeight=orderaccept.common.dialog.MessageBox.oldGetHeight;};orderaccept.common.dialog.MessageBox.customerButtonConfirm=function(b,c){orderaccept.common.dialog.MessageBox.handlePrompt(b,c);
MessageBox._getHeight=orderaccept.common.dialog.MessageBox.getHeight;MessageBox.customerButtonConfirm(b,c);MessageBox._getHeight=orderaccept.common.dialog.MessageBox.oldGetHeight;};orderaccept.common.dialog.MessageBox.multiPrompt=function(b,c){orderaccept.common.dialog.MessageBox.handlePrompt(b,c);
MessageBox._getHeight=orderaccept.common.dialog.MessageBox.getHeight;MessageBox.multiPrompt(b,c);MessageBox._getHeight=orderaccept.common.dialog.MessageBox.oldGetHeight;};orderaccept.common.dialog.MessageBox.prompt=function(b,c){orderaccept.common.dialog.MessageBox.handlePrompt(b,c);
MessageBox._getHeight=orderaccept.common.dialog.MessageBox.getHeight;MessageBox.prompt(b,c);MessageBox._getHeight=orderaccept.common.dialog.MessageBox.oldGetHeight;};orderaccept.common.dialog.MessageBox.handlePrompt=function(m,e){var n=/unieap/i;
if(document.body){if(!n.test(document.body.className)){document.body.className=document.body.className+" unieap";}}if(m&&(m.busiCode)){var i=[];var h=orderaccept.common.dialog.MessageBox.getWebAppName();
i.push(h);i.push("/");i.push("promptInfoAction.do?method=getPromptInfo");if(m.busiCode){i.push("&busiCode="+m.busiCode);}var f=orderaccept.common.dialog.MessageBox.getAjaxJson(i.join(""));if(f.type){m.type=f.type;
}if(f.title){m.title=f.title;}if(f.message){m.message=f.message;}}if(m&&m.infoList){if(m.message){var g=m.message.split("$");var j="";var d=[];if(m.infoList.length){if(m.infoList[0]&&(m.infoList[0] instanceof Array)){for(var k=0,b=m.infoList[0].length;
k<b;k++){d.push(m.infoList[0][k]);}}else{d.push(m.infoList);}}for(var l=0,c=d.length;l<c;l++){for(var k=0,b=g.length;k<b;k++){j+=g[k];if(d[l]&&d[l][k]){j+=d[l][k];}else{if(k>g.length-1){j+=" ";}}}}m.message=j;
}}};orderaccept.common.dialog.MessageBox.getWebAppName=function(){var b=unieap.WEB_APP_NAME;if(!b){var d=document.location.pathname;var c=d.substr(1).indexOf("/");b=d.substr(0,c+1);}return b;};orderaccept.common.dialog.MessageBox.getAjaxJson=function(c,b){return(new Function("return "+orderaccept.common.dialog.MessageBox.getAjaxText(c,b))).apply(null,[]);
};orderaccept.common.dialog.MessageBox.getAjaxText=function(c,b){return dojo._getText(c,b);};});
defineModule("orderaccept.prodofferaccept.rule.ProdOfferNewRule",[],function(){});
window.ConstantsPool=function(){var b=[],a={},c=function(){var j=Array.prototype.slice,h=j.apply(arguments),i=[];if(arguments.length==0){alert("you must input the constant type you want to load");return;
}BusCard.each(h,function(k){i=i.concat(k);});var f=BusCard.findAll(i,function(k){if(BusCard.exist(b,function(l){return l==k;})){return false;}else{return true;}});b=b.concat(f);var e=BusCard.$load("com.neusoft.crm.ordermgr.common.util.consts.ConstantsPool"),d;
if(f.length!=0){d=e["export"](f);}for(var g in d){if(d.hasOwnProperty(g)){this[g]=d[g];}}return this;};a.load=c;return a;}();if(typeof dojo!="undefined"&&dojo.global.defineModule){defineModule("orderaccept.common.js.ConstantsPool",[],function(){orderaccept.common.js.ConstantsPool=window.ConstantsPool;
});}
defineModule("orderaccept.prodofferaccept.util",["orderaccept.prodofferaccept.ProductDateBuilder","unieap.tree.Tree","orderaccept.common.js.ConstantsPool","orderaccept.common.dialog.MessageBox"],function(z,s,a,k){var p={CUSTOMER_NEW:"101",CUSTOMER_MODIFY:"102",CUSTOMER_CANCEL:"103",CUSTOMER_AUDIT:"104",ACCOUNT_NEW:"201",ACCOUNT_MODIFY:"202",ACCOUNT_CANCEL:"203",CUSTOMER_ACCOUNT_RELATION_CHANGE:"204",OFFER_ORDER:"4001",OFFER_CANCEL:"4002",OFFER_MODIFY:"4003",OFFER_CONTINUE:"4004",PRODUCT_INSTALL:"301",PRODUCT_CHANGE:"302",PRODUCT_CHANGE_MAIN:"303",PRODUCT_CONTINUE_ORDER:"304",PRODUCT_QUIT:"3",MEMBER_OFFER_CHANGE:"309",NONE_CHANGE:"0",PRE_ACCEPT:"305",PRODOFFER_CANCEL_ACTION:"306",PROTOCOL_ACCEPT:"307",SHOPPING_CART_ACCEPT:"308",PROD_ADD:"333",PROD_SPLIT:"334",PROD_INTERCHANGE:"335",PRE_ORDER_BACK:"320",PROMOTION_CHANGE:"1000",CHANGE_ACCEPT:"93",PRODUCT_CHANGE_ACCEPT:"93",MEMBER_ORDER_GROUP_PRODUCT:"5000",ORDER_CHANGE_ACCEPT:"100"},E={CUSTOMER:"1000",ACCOUNT:"1100",PRODUCT:"1300",OFFER:"1200"},e={ACCESS_PROD_TYPE:"101"},t={DEFAULT_PRODUCT:"-10000",PRODUCT_RES_RELA:"1",PROD_OFFER_RES_RELA:"0",SUBSIDY_ACCEPT:"27",SUBSIDY_ATTR_CD:"840",RENT_ACCEPT:"20",RENT_ATTR_CD:"851",GIFT_ACCEPT:"36",INTERNET_CAT:"42",OTHER_RENT_ACCEPT:"21"},J={REL_TYPE:"3",EX_TYPE:"200000",DEPEND_TYPE:"100000",SUBORDINATE_TYPE:"100600",CONTAIN_TYPE:"17",MAIN_OFFER_TYPE:"1",MAIN_MEMBER_PRODUCT_FLAG:"1",OFFER_ORDER:"1",OFFER_CANCEL:"3",OFFER_CHANGE:"2",OFFER_PARAM_CHANGE:"4",PRODUCT_RELA:"5",PRODUCT_COMB_MEMBER:"6",OFFER_COMB_MEMBER:"3",OFFER_PRODUCT:"4",RECOMMEND_TYPE:"14"},N={yearType:1,halfYearType:2,quarterType:3},L={"0":"不区分业务","1":"客户信息","2":"帐户信息","3":"业务共性信息","8":"移动电话","10":"PSTN业务","11":"普通宽带产品","12":"集团业务","13":"超级无绳","14":"NGN业务","15":"CDMA1X业务","16":"WLAN业务","20":"虚拟用户","21":"数据固定业务","22":"售机售卡","23":"双模业务","24":"CDMA号码资源产品","33":"捆绑优惠组合","51":"SCDMA业务","52":"190业务","53":"17969业务","54":"专线业务","55":"宽带LAN业务","56":"4008业务","57":"800业务","58":"商务领航业务","59":"号码百事通业务","60":"超级一号通业务","61":"E视星空业务","62":"窄带数据业务","63":"网元出租业务","64":"11800业务","65":"IDC业务","66":"语音增值业务","67":"互联网增值业务","68":"行业应用业务","69":"小灵通","70":"M2M业务","98":"行业短信","99":"其他应用业务","820":"CDMA短信","913":"GPRS业务"},P={split:"\u6210\u5458\u62c6\u5206","new":"\u6210\u5458\u8ba2\u8d2d",quit:"\u6210\u5458\u9000\u7f51",change:"\u6210\u5458\u53d8\u66f4",nochange:"\u6210\u5458\u53d8\u66f4"},u=function(){var Z={};
var Y=function(aa){if(Z[aa]==null){Z[aa]=0;}Z[aa]=Z[aa]+1;return Z[aa];};return{get:Y};}(),D=function(){var aa={};var Y=function(ab){if(aa[ab]==null){aa[ab]=0;}aa[ab]=aa[ab]+1;return aa[ab];};var Z=function(){aa={};
};return{get:Y,reset:Z};}(),K={T2_PRDOFFER_TYPE:"9",VOICE_CARD:"100110",VOICE_CARD_SUB_PRODOFFER:"300614"},T={InterRoamProdConst:["486","8"],InlandRoamProdConst:["7"]},q={addOperKind:1,delOperKind:3,chgOperKind:2,noChgOperKind:0},U={portSpeedAttrCd:100081,serviceIdAttrCd:34,userTypeAttrCd:300000,cyclePriceAttrCd:300003,cyclePriceDateAttrCd:300075,oneCard2NumAttrCd:54,accessTypeAttrCd:100704,itemAttrCd:100401,balanceInetMethodAttrCd:100400,rateEffectDate:100538},h=["100340","100339","100081","100523","100524","100876"],n={timeAttrId:"300012",cycleUnit:"300010"},m={checkCount:3},y={MainCardRoleCd:50002,AuxiliaryCardRoleCd:50003},f={unitConst:"D8",minuteConst:"D12"},O={getProductTupleList:function(Y){var Z=Array.prototype.concat;
if(!Y){return;}else{var aa=dojo.map(Y.offerProdRelaList||[],function(ad){var ab=ad.roleInfoVO,ac=null;if(ab){ac=dojo.clone(ab);}return{roleInfoVO:ac,offerProdRelaVO:dojo.clone(ad)};});return aa;}},getProductDateBuilder:function(aa,Z){var Y=dojo.global.$appContext$.requestParam.today,Z=Z||{};
return new z.NewMainProductDateBuilder({changeKind:Z.changeKind||1,delayUnit:Z.delayUnit==0?0:aa.delayUnit,delayTime:Z.delayTime==0?0:aa.delayTime,validType:Z.validType||aa.effectType,validPeriod:Z.validPeriod||aa.maxEffect,today:Y,beginDate:Z.beginDate,endDate:Z.endDate,delayUnorderUnit:Z.delayUnorderUnit,delayUnorderTime:Z.delayUnorderTime,ifChangeMainFlag:Z.ifChangeMainFlag});
},getOfferDelayEndDateBuilder:function(Z){var Y=dojo.global.$appContext$.requestParam.today;return new z.NewMainProductDateBuilder({changeKind:3,today:Y,delayUnorderUnit:Z.delayUnorderUnit,delayUnorderTime:Z.delayUnorderTime});
},doGetAllProduct:function(Y){var Z=[];Array.prototype.push.apply(Z,BusCard.map(Y.offerProdRelaList||[],function(aa){return aa;}));return Z;},doGetRelaAccessProductIdList:function(ac){var af=this,Y=[],ab=af.doGetAllProduct(ac),aa=dojo.filter(ab,function(ag){return ag.productInfoVO.prodFuncType!="101";
}),Z=dojo.filter(ab,function(ag){return ag.productInfoVO.prodFuncType=="101";}),ae=af.getCurrentPageAccessProdIds(),ad=BusCard.findAll(ae,function(ag){if(!af.checkIsMainMemberProd(ag)){return;}return BusCard.exist(aa||[],function(aj){var ah=aj.productInfoVO,ai=ah.prodRelaList||[];
return BusCard.exist(ai,function(ak){return(ak.relaType==J.SUBORDINATE_TYPE)&&(ak.prodA==ag.productId);});});});Y=Y.concat(dojo.map(ad,function(ag){return ag.productId;}));Y=Y.concat(dojo.map(Z,function(ag){return ag.productId;
}));return Y;},getCurrentPageAccessProdIds:function(){var Z=[];var Y=$ac$.selectedMemberProdOfferList;dojo.forEach(Y||[],function(aa){if(aa.action!="quit"){Z.push(aa);}});return Z;},getMainProdOffer:function(Z){var Y=dojo.filter(Z,function(aa){return aa.bindType==2;
});if(Y&&Y.length){return Y;}else{return dojo.filter(Z,function(aa){return aa.prodOfferType==1;});}},getSubProdOfferList:function(Y){return dojo.filter(Y,function(Z){return Z.prodOfferType!=1;});},createProdOfferRowData:function(af){var aj=this,ac="",aa=dojo.global.$appContext$.requestParam.today,ag=this.toProductStartDateView(af,{key:"key"}),Z=this.toProductEndDateView(af,{key:"key"}),ae=this.prodOfferEndDateView(af,{key:"key"}),ai=this.IfShowProdOffer(af)?"1":"0",ah=this.getProductDateBuilder(af),Y=!!this.ifShowStartTime(af)?ah.getBeginDate():"",ad=!!this.ifShowEndTime(af)?ah.getEndDate():"",ak="";
ac="prod-offer-add";var ab=false;ab=g.checkIfNotNull(af.attrList);if(!ab){ab=dojo.some(af.offerProdRelaList,function(al){if(al.productInfoVO.prodFuncType==a.load("ProductFuncTypeConst").ProductFuncTypeConst.ACCESS){return false;
}return g.checkIfNotNull(al.productInfoVO.attrList);});if(!ab){ab=g.checkIfFavour(af);}}return{showData:{viewId:"key-"+af.parentProdOfferId+af.prodOfferId,prodOfferName:af.prodOfferName,startDate:Y,endDate:ad,delayEndDate:ak,orderStatus:"\u8ba2\u8d2d",prodOfferDetailFlag:ai,detailNotNull:ab?"":"hidden-elem",finishImg:!ab?"":"hidden-elem",subProdOfferInfo:af,checkedOption:checked="checked",disabledOption:"",disabledDelViewOption:"",prodOfferStyle:ac,dateStyle:{delayEndDateView:"display:none"},productStartDateHtml:ag,productEndDateHtml:Z,prodOfferEndDateView:ae},subProdOfferInfo:af,prodOfferInst:null};
},createKeepProdOfferRowDataForChg:function(ah,af){var aj=this,ae=dojo.filter(dojo.global.$appContext$.get("userHasProdOfferMetaInfoList"+af||""),function(al){return al.prodOfferId==ah.prodOfferId;})[0],ag=this.toProductStartDateView(ae,{key:"key"}),Z=this.toProductEndDateView(ae,{key:"key"}),ad=this.prodOfferEndDateView(ae,{key:"key"}),ai=this.IfShowProdOffer(ae)?"1":"0",Y=z.getStringTimeFromDate(z.getDateFromString(ah.effDate)),ac=z.getStringTimeFromDate(z.getDateFromString(ah.expDate)),ak=!!this.ifShowDelayEndTime(ae)?this.getOfferDelayEndDateBuilder(ae).getEndDate():"";
var aa=false;var ab="prod-offer-change";if(this.getIfReserveSubProdOffer(ah)){ab="prod-offer-reserve";}return{showData:{viewId:"key-"+ae.parentProdOfferId+ae.prodOfferId,prodOfferName:ae.prodOfferName,startDate:Y,endDate:ac,delayEndDate:ak,orderStatus:"用户已有",prodOfferDetailFlag:ai,detailNotNull:"hidden-elem",finishImg:"",subProdOfferInfo:ae,checkedOption:checked="checked",disabledOption:"",disabledDelViewOption:"disabled='disabled'",dateStyle:{startDateView:"display:none",endDateView:"display:none",delayEndDateView:"display:none"},prodOfferStyle:ab,productStartDateHtml:ag,productEndDateHtml:Z,prodOfferEndDateView:ad},subProdOfferInfo:ae,prodOfferInst:ah};
},createCancelProdOfferRowDataForChg:function(ag,ae){var ai=this,ad=dojo.filter(dojo.global.$appContext$.get("userHasProdOfferMetaInfoList"+ae||""),function(ak){return ak.prodOfferId==ag.prodOfferId;})[0],af=this.toProductStartDateView(ad,{key:"key"}),Z=this.toProductEndDateView(ad,{key:"key"}),ac=this.prodOfferEndDateView(ad,{key:"key"}),ah=this.IfShowProdOffer(ad)?"1":"0",Y=z.getStringTimeFromDate(z.getDateFromString(ag.effDate)),ab="",aj=!!this.ifShowDelayEndTime(ad)?this.getOfferDelayEndDateBuilder(ad).getEndDate():"";
var aa=false;return{showData:{viewId:"key-"+ad.parentProdOfferId+ad.prodOfferId,prodOfferName:ad.prodOfferName,startDate:Y,endDate:ab,delayEndDate:aj,orderStatus:"已退订",prodOfferDetailFlag:ah,detailNotNull:"hidden-elem",finishImg:"",subProdOfferInfo:ad,checkedOption:"",disabledOption:"disabled='disabled'",disabledDelViewOption:"disabled='disabled'",dateStyle:{startDateView:"display:none",endDateView:"display:none",delayEndDateView:""},prodOfferStyle:"prod-offer-del",productStartDateHtml:af,productEndDateHtml:Z,prodOfferEndDateView:ac},subProdOfferInfo:ad,prodOfferInst:ag};
},createProdOfferRowDataByOrderItem:function(ag,ac){var ai=this;var ae=null;var Y=dojo.filter(dojo.global.$appContext$.prodOfferList,function(aj){return aj.prodOfferId==ag.prodOfferId;});if(Y.length>0){ae=Y[0];
}else{ae=this.getProdOfferDetail(ag.prodOfferId);}var af=this.toProductStartDateView(ae,{key:"key"}),aa=this.toProductEndDateView(ae,{key:"key"}),ah=this.IfShowProdOffer(ae)?"1":"0",Z=z.getStringTimeFromDate(z.getDateFromString(ag.effDate)),ad=z.getStringTimeFromDate(z.getDateFromString(ag.expDate));
var ab=false;ab=g.checkIfNotNull(ae.attrList);if(!ab){ab=dojo.some(ae.offerProdRelaList,function(aj){if(aj.productInfoVO.prodFuncType==a.load("ProductFuncTypeConst").ProductFuncTypeConst.ACCESS){return false;
}return g.checkIfNotNull(aj.productInfoVO.attrList);});if(!ab){ab=g.checkIfFavour(ae);}}return{showData:{viewId:"key-"+ae.parentProdOfferId+ae.prodOfferId,prodOfferName:ae.prodOfferName,startDate:Z,endDate:ad,orderStatus:"订购",prodOfferDetailFlag:ah,detailNotNull:ab?"":"hidden-elem",finishImg:!ab?"":"hidden-elem",subProdOfferInfo:ae,checkedOption:checked="checked",disabledOption:"",dateStyle:{startDateView:"display:none",endDateView:"display:none"},prodOfferStyle:"prod-offer-add",productStartDateHtml:af,productEndDateHtml:aa},subProdOfferInfo:ae,prodOfferInst:null,offerItemData:ag,prodItemList:ac};
},getRelaAccessProductIdList:function(Z,aa){var ac=this;var Y=null;if(dojo.some(Z.offerProdRelaList,function(ae){return !!ae.roleInfoVO;})){Y=BusCard.findAll(ac.getProductList(true),function(ae){return BusCard.exist(aa,function(af){return af==ae.productId;
});});}else{Y=BusCard.findAll(Z.offerProdRelaList||[],function(ae){return ae.relaType==J.REL_TYPE;});}var ad=this.getProductListFromMainProdOfferList(this.getMainProdOffer(dojo.global.$appContext$.get("prodOfferList")));
var ab=BusCard.findAll(ad,function(ae){if(!ac.checkIsMainMemberProd(ae)){return;}var af=ae.prodRelaList||[];return BusCard.exist(af,function(ag){return(J.REL_TYPE==ag.relaType)&&(BusCard.exist(Y,function(ah){return ah.productId==ag.prodB||ah.productId==ag.prodA;
}));})||BusCard.exist(Y||[],function(ag){var ai=ag.productInfoVO;var ah=ai.prodRelaList||[];return BusCard.exist(ah,function(aj){return(aj.relaType==J.DEPEND_TYPE)&&(aj.prodB==ae.productId);});});});return dojo.map(ab,function(ae){return ae.productId;
});},checkIsMainMemberProd:function(Y){if(Y.productInfoVO){if(Y.productInfoVO.prodFuncType==orderaccept.prodofferaccept.util.ProductFuncTypeConst.ACCESS||Y.productInfoVO.prodBundleType!=orderaccept.prodofferaccept.util.ProductTypeConst.ATOM){return true;
}}else{var Z=Y.prodBundleType||Y.prodType;if(Y.prodFuncType==orderaccept.prodofferaccept.util.ProductFuncTypeConst.ACCESS||Z!=orderaccept.prodofferaccept.util.ProductTypeConst.ATOM){return true;}}return false;
},getProductListFromMainProdOfferList:function(Z){var Y=this;var aa=[];dojo.forEach(Z||[],function(ab){Array.prototype.push.apply(aa,Y.getProductList(false,ab));});return aa;},getProductById:function(aa,Z){var ab=aa,Y=null;
if(!dojo.isArrayLike(aa)){ab=[aa];}BusCard.each(ab,function(ad){var ac=ad.offerProdRelaList||[];BusCard.each(ac,function(ae){if(ae.productId==Z){Y=ae.productInfoVO;return false;}});if(Y){return false;}});
return Y;},IfShowProdOffer:function(Y){return this.ifHasOfferAttr(Y)||this.ifHasProdRoleAndAttr(Y)||this.ifHasRelaNum(Y)||this.ifHasAssureInfo(Y);},ifHasAssureInfo:function(Y){if(Y.prodOfferAssureDemandVO&&Y.prodOfferAssureDemandVO.length>0){return true;
}return false;},ifHasOfferAttr:function(Y){if(Y.attrList&&Y.attrList.length>0){for(var Z in Y.attrList){var aa=Y.attrList[Z];if(aa&&aa.ifDisplay&&aa.ifDisplay=="1"){return true;}}}return false;},ifHasProdRoleAndAttr:function(Z){if(Z.offerProdRelaList&&Z.offerProdRelaList.length==1){var Y=Z.offerProdRelaList[0];
if(Y.productInfoVO){if(Y.productInfoVO.prodFuncType=="101"){return false;}if(Y.productInfoVO.attrList&&Y.productInfoVO.attrList.length>0){var ab=Y.productInfoVO.attrList;for(var aa in ab){var ac=ab[aa];
if(ac&&ac.ifDisplay&&ac.ifDisplay=="1"){return true;}}}}}else{if(Z.offerProdRelaList&&Z.offerProdRelaList.length>1&&Z.offerProdRelaList[0].productInfoVO.prodFuncType!=101){return true;}}return false;},ifHasRelaNum:function(ab){if(ab.usageTypeList&&ab.usageTypeList.length>0){var Z=ab.usageTypeList;
for(var aa=0,Y=Z.length;aa<Y;aa++){if(Z[aa]=="1"||Z[aa]=="2"||Z[aa]=="126"){return true;}}}return false;},ifHasResRela:function(Y){if(Y.resRelaList&&Y.resRelaList.length>0){return true;}return false;},ifHasAgreement:function(Y){return !!(Y&&Y.offerAgreementVO&&Y.offerAgreementVO.length>0);
},prodOfferEndDateView:function(ae,Y){var ad=Y.key+"-"+ae.parentProdOfferId+ae.prodOfferId;var ag="";var af=ae.delayUnorderUnit?ae.delayUnorderUnit:"0";if(ae.permitUnorderTime==0){ag=" hiddenStyle";}var ac=ae.delayUnorderUnit;
var Z=ae.delayUnorderTime;var aa="<select class='endDateDelayUnit-class' id='endDateDelayUnit-"+ad+"' style='height:20px;'>";if(0==af||ae.permitUnorderTime==1){aa+="<option value='0' selected='selected'>立即生效</option>";
}if(1==af){aa+="<option value='1'>"+Z+"年后生效</option>";}if(2==af){aa+="<option value='2'>"+Z+"账期后生效</option>";}if(3==af){aa+="<option value='3'>"+Z+"月后生效</option>";}if(4==af){aa+="<option value='4'>"+Z+"天后生效</option>";
}if(5==af){aa+="<option value='5'>"+Z+"小时后生效</option>";}aa+="</select>";var ab={data:{prodOfferInfoVO:ae,delayUnitViewInstance:aa,time:Z},style:{hiddenStyleOption:ag},viewId:ad};return ab;},toProductStartDateView:function(ae,Y){var ad=Y.key+"-"+ae.parentProdOfferId+ae.prodOfferId;
var ag="";var af=ae.delayUnit?ae.delayUnit:"0";if(ae.permitInstantly==0){ag=" hiddenStyle";}var ac=ae.delayUnit;var Z=ae.delayTime;var aa="<select class='delayUnit-class' id='delayUnit-"+ad+"' style='height:20px;'>";
if(0==af||ae.permitInstantly==1){aa+="<option value='0' selected='selected'>立即生效</option>";}if(1==af){aa+="<option value='1'>"+Z+"年后生效</option>";}if(2==af){aa+="<option value='2'>"+Z+"账期后生效</option>";}if(3==af){aa+="<option value='3'>"+Z+"月后生效</option>";
}if(4==af){aa+="<option value='4'>"+Z+"天后生效</option>";}if(5==af){aa+="<option value='5'>"+Z+"小时后生效</option>";}aa+="</select>";var ab={data:{prodOfferInfoVO:ae,delayUnitViewInstance:aa,time:Z},style:{hiddenStyleOption:ag},viewId:ad};
return ab;},toProductEndDateView:function(ad,ao){var ak=ao.key+"-"+ad.parentProdOfferId+ad.prodOfferId;var aa="";var aq="";var ac=" hiddenStyle";var ab=" hiddenStyle";var am=ad.ifCycleOffer;var Y=ad.cycleEffectList;
var ai=ad.prodOfferTaste;var Z="";if(!!ai){ac="";ab=" hiddenStyle";var af=ai.effectType?ai.effectType:0;if(ai.maxEffectNmr==0){ac=" hiddenStyle";ab=" hiddenStyle";aa="<option value='"+ai.maxEffectNmr+"' selected='selected' >";
aa+=ai.maxEffectNmr;aa+="</option>";}else{var ah=ai.defaultEffectNmr;ah=(ah?ah:0);var ae=ai.minEffectNmr;var ag=ai.maxEffectNmr;for(var an=ae,aj=ag;an<=aj;an++){aa+="<option value='"+an+"'";if(an==ah){aa+=" selected='selected'";
}aa+=">";aa+=an;aa+="</option>";}}switch(af/1){case 4:aq+="<option value='4' selected='selected'>";aq+="月</option>";break;case 6:aq+="<option value='6' selected='selected'>";aq+="天</option>";break;case 1:aq+="<option value='1' selected='selected'>";
aq+="年</option>";break;case 3:aq+="<option value='3' selected='selected'>";aq+="账期</option>";break;default:aq+="<option value='4' selected='selected'>";aq+="月</option>";break;}}else{if(am==1&&Y.length>0){ac=" hiddenStyle";
ab="";dojo.forEach(Y,function(av){var at=av.effectType;var au=av.effectValue;var ar=av.isDefaultValue;switch(at/1){case 4:Z+="<option value='"+au+"~4' ";if(au==ar){Z+=" selected='selected'";}Z+=" >";Z+=au+"月</option>";
break;case 6:Z+="<option value='"+au+"~6' ";if(au==ar){Z+=" selected='selected'";}Z+=" >";Z+=au+"天</option>";break;case 1:Z+="<option value='"+au+"~1' ";if(au==ar){Z+=" selected='selected'";}Z+=" >";Z+=au+"年</option>";
break;case 3:Z+="<option value='"+au+"~3' ";if(au==ar){Z+=" selected='selected'";}Z+=" >";Z+=au+"账期</option>";break;case 7:Z+="<option value='"+au+"~7' ";if(au==ar){Z+=" selected='selected'";}Z+=" >";Z+=au+"小时</option>";
break;case 0:Z+="<option value='"+au+"~0' ";if(au==ar){Z+=" selected='selected'";}Z+=" >";Z+="长期</option>";break;default:Z+="<option value='"+au+"~4' ";if(au==ar){Z+=" selected='selected'";}Z+=" >";Z+=au+"月</option>";
break;}});}else{ac="";ab=" hiddenStyle";var af=ad.effectType?ad.effectType:0;if(ad.maxEffect==0){ac=" hiddenStyle";ab=" hiddenStyle";aa="<option value='"+ad.maxEffect+"' selected='selected' >";aa+=ad.maxEffect;
aa+="</option>";}else{var ah=ad.defaultTimePeriod;ah=(ah?ah:0);var ae=ad.minEffect;var ag=ad.maxEffect;for(var an=ae,aj=ag;an<=aj;an++){aa+="<option value='"+an+"'";if(an==ah){aa+=" selected='selected'";
}aa+=">";aa+=an;aa+="</option>";}}switch(af/1){case 4:aq+="<option value='4' selected='selected'>";aq+="月</option>";break;case 6:aq+="<option value='6' selected='selected'>";aq+="天</option>";break;case 1:aq+="<option value='1' selected='selected'>";
aq+="年</option>";break;case 3:aq+="<option value='3' selected='selected'>";aq+="账期</option>";break;default:aq+="<option value='4' selected='selected'>";aq+="月</option>";break;}}}var ap={validTypeOption:aq,validPeriodOption:aa,hiddenStyleOption:ac,cycleOption:Z};
var al={data:ap,style:{hiddenStyleOption:ac,cycleStyleOption:ab},viewId:ak};return al;},ifShowStartTime:function(Y){if(Y.permitInstantly==1){return false;}return true;},ifShowEndTime:function(Y){if(Y.maxEffect==0&&(Y.ifCycleOffer==0||Y.cycleEffectList.length==0)){return true;
}return false;},ifShowDelayEndTime:function(Y){if(Y.permitUnorderTime==1){return false;}return true;},IfShowMainOfferDetail:function(Y){return this.ifHasOfferAttr(Y)||this.ifHasRelaNum(Y)||this.ifHasResRela(Y)||this.ifHasAgreement(Y);
},getProdOfferDetail:function(ad,Y){var Y=Y||{},ab=Y.interfaceType||5,Z=function(){try{return prodOfferAcceptLoader.getBelongCode();}catch(ae){}}(),aa="&prodOfferId="+ad+"&interfaceType="+ab+"&belongCode="+(Z||""),ac=function(){return H.getService("url:orderDetailAction.do?method=getProdOfferDetail"+aa);
};return $ac$.cache("prodOfferId-"+ad,dojo.mixin({callback:ac},Y));},getInitSelectedProductIdList:function(Z,Y){var ac=this;var aa=[];if(Y){Array.prototype.push.apply(aa,BusCard.map(Y.prodInstList||[],function(ad){return ad.prodId;
}));return{selectedProductIdList:aa,productRelaInfoList:Y.prodInstList||[]};}var ab=BusCard.findAll(ac.getProductList(true,Z),function(ad){return ad.ifDefault==1;});Array.prototype.push.apply(aa,BusCard.map(ab||[],function(ad){return ad.productId;
}));return{selectedProductIdList:aa,productRelaInfoList:ab};},getProductList:function(Z,Y){var aa=[];if(Z){Array.prototype.push.apply(aa,BusCard.map(Y.offerProdRelaList||[],function(ab){return ab;}));return aa;
}Array.prototype.push.apply(aa,BusCard.map(Y.offerProdRelaList||[],function(ab){return ab.productInfoVO;}));return aa;},getProdOfferRelaList:function(Z){var Y=[];if(Z.prodOfferRelaList!=null&&Z.prodOfferRelaList.length>0){Y=Z.prodOfferRelaList;
}return Y;},getSelectProductIdList:function(aa){var Y=dojo.query(".main-product-basic",aa);var Z=dojo.filter(Y,function(ac){return dojo.query(".main-product-check",ac)[0].checked;});var ab=dojo.map(Z,function(ac){return dojo.attr(ac,"productId")||dojo.query("SELECT",ac)[0].value;
});return ab||[];},getSalesPromotionDetail:function(Y){var aa="&promotionId="+Y;var Z=H.getService("url:orderDetailAction.do?method=getSalesPromotionDetail"+aa);return Z;},getPromotionItemsAttr:function(Y){var aa="&promotionId="+Y;
var Z=H.getService("url:orderDetailAction.do?method=getPromotionItemsAttr"+aa);return Z;},createSalesPromotionRowData:function(Z){var ac=this.toProductStartDateView(Z.proodOfferInfo,{key:"key"}),ae=this.toProductEndDateView(Z.proodOfferInfo,{key:"key"}),aa=this.getProductDateBuilder(Z.proodOfferInfo),Y=!!this.ifShowStartTime(Z.proodOfferInfo)?aa.getBeginDate():"",ad=!!this.ifShowEndTime(Z.proodOfferInfo)?aa.getEndDate():"",ab=this.getPromotionTargetType(Z.promotionTargetObjectList);
return{showData:{viewId:"key-"+Z.proodOfferInfo.parentProdOfferId+Z.proodOfferInfo.prodOfferId,promotionName:Z.promotionName,promotionInfo:Z,startDate:Y,endDate:ad,promotionStartDate:ac,promotionEndDate:ae,disabledOption:"",dateStyle:"",checkedOption:checked="checked",promotionStatus:"\u8ba2\u8d2d",statusObj:ab?2:1,promotionStyle:"promotion-new"}};
},createSalesPromotionRowDataForChg:function(Z,ae){var ac=this.toProductStartDateView(Z.proodOfferInfo,{key:"key"}),af=this.toProductEndDateView(Z.proodOfferInfo,{key:"key"}),aa=this.getProductDateBuilder(Z.proodOfferInfo),Y=!!this.ifShowStartTime(Z.proodOfferInfo)?aa.getBeginDate():"",ad=!!this.ifShowEndTime(Z.proodOfferInfo)?aa.getEndDate():"",ab=this.getPromotionTargetType(Z.promotionTargetObjectList);
return{showData:{viewId:"key-"+Z.proodOfferInfo.parentProdOfferId+Z.proodOfferInfo.prodOfferId,promotionName:Z.promotionName,promotionInfo:Z,startDate:ae.effDate?ae.effDate:Y,endDate:ae.expDate?ae.expDate:"",promotionStartDate:ac,promotionEndDate:af,disabledOption:"",dateStyle:"",checkedOption:checked="checked",promotionStatus:"\u7528\u6237\u5df2\u6709",statusObj:ae.targetObjectType?ae.targetObjectType:(ab?2:1),promotionStyle:"promotion-change",promotionInstInfo:ae}};
},getPromotionTargetType:function(Y){return dojo.some(Y||[],function(Z){return Z.targetObjectType==2;});},getProductInfoByProdId:function(ac,ab){if(ac.offerProdRelaList&&ac.offerProdRelaList.length>0){for(var aa=0,Z=ac.offerProdRelaList.length;
aa<Z;aa++){var Y=ac.offerProdRelaList[aa];if(Y.productId==ab){return Y;}}}return null;},getRaiseSpeedObj:function(Z){for(var ad=0;ad<Z.attrList.length;ad++){var ae=Z.attrList[ad];var ab=BusCard.jsonPath(ae.attrRelaList||[],"$[?(@.attrRelaType==7)]");
if(ab.length>0){var Y=ae.attrValueList;if(Y.length>0){var ac=Y[0].attrValue;}var aa=ab[0].relatedAttrCD;return{attrValue:ac,relatedAttrCD:aa};}}return null;},getPromotionRaiseSpeedObj:function(ad){var ac=ad.salesPromotionItemList;
for(var Z=0;Z<ac.length;Z++){var af=ac[Z].attrSpec;var ab=BusCard.jsonPath(af.attrRelaList||[],"$[?(@.attrRelaType==7)]");if(ab.length>0){var ae="";var Y=af.attrValueList;if(ac[Z].attrValue){ae=ac[Z].attrValue;
}else{if(Y&&Y.length>0){ae=Y[0].attrValue;}}var aa=ab[0].relatedAttrCD;return{attrValue:ae,relatedAttrCD:aa};}}return null;},getRelaProdOfferObj:function(aa,Y){var Z=new Array();BusCard.each(Y,function(ac){var ab=[];
if(ac.subProdOfferInfo&&ac.subProdOfferInfo.offerProdRelaList&&ac.subProdOfferInfo.offerProdRelaList.length>0){ab=ac.subProdOfferInfo.offerProdRelaList;}else{return;}BusCard.each(ab,function(ad){if(ad.productInfoVO&&ad.productInfoVO.prodFuncType!=orderaccept.prodofferaccept.util.PRODUCTTYPE.ACCESS_PROD_TYPE&&ad.productInfoVO.productId==aa){var ae={};
ae.subProdOfferCartData=ac;ae.prodOfferInfoVO=ac.subProdOfferInfo;ae.productInfoVO=ad.productInfoVO;Z.push(ae);}else{return;}});});if(Z.length>0){return Z;}return null;},isT2ProdOffer:function(ad,ab,Z){var aa=dojo.global.$appContext$.get("requestParam");
var ac="&mainProdOfferId="+ad+"&memAccessProductId="+ab+"&cityCode="+aa.customerData.cityCode+"&serviceOfferId="+Z;var Y=H.getService("url:prodOfferSaleAjaxAction.do?method=doCheckT2ProdOffer"+ac);return Y;
},getT2MemProdOfferList:function(Y){},isStandardProdOffer:function(Y){return false;},loadAndSetProdOffer:function(ab,aa){aa=aa||{};var Z=aa.interfaceType||5;var Y=function(){try{return prodOfferAcceptLoader.getBelongCode();
}catch(ac){}}();return $ac$.cache("prodOfferId-"+ab,dojo.mixin({callback:function(){return H.getService("url:orderDetailAction.do?method=getProdOfferDetail&prodOfferId="+ab+"&interfaceType="+Z+"&belongCode="+(Y||""));
}},aa));},getManageAccNbrTemp:function(Y){if(Y==null||Y==""||Y==undefined){return null;}var Z=BusCard.$remote("acctNbrTempDAO").queryOne({custId:dojo.global.$appContext$.get("requestParam").customerData.custId,custOrderId:Y,operKind:1,accNbrType:2});
if(Z==null||Z=="null"){return null;}return{serviceId:Z.accNbr,prodInstId:Z.relaProdInstId};},getAllAccessProductIds:function(){var Y=dojo.query(".main-product-basic",prodOfferAcceptLoader.mainProdOfferWidget.domNode);
return dojo.map(Y||[],function(Z){return dojo.attr(Z,"productId")||dojo.query("SELECT",Z)[0].value;});},doCheckMainProdOfferReserve:function(ag){var ae=false;if(ag.contentPane){var ad=$ac$.selectedMemberProdOfferList;
var Z=dojo.filter(ad||[],function(ah){return ah.uniqueId==ag.uniqueId;});if(!!Z[0]){if(!!Z[0].offerInstVO){if(Z[0].offerInstVO.prodOfferId==Z[0].prodOfferId){var af=ag.contentPane.offerInstVO.prodOfferInstId;
var Y=ag.contentPane.prodOfferInfoVO;var ac="prodOfferInstId="+af+"&method=doCheckIfReserve";var aa=H.getService("url:orderDetailAction.do?"+ac);if(aa=="1"){ae=true;}}}}}else{if(!!$ac$.mainProdOfferInstVO){if($ac$.selectedMainProdOfferInfoVO.prodOfferId==$ac$.mainProdOfferInstVO.prodOfferId){var ab=$ac$.mainProdOfferInstVO.prodOfferInstId;
var ac="prodOfferInstId="+ab+"&method=doCheckIfReserve";var aa=H.getService("url:orderDetailAction.do?"+ac);if(aa=="1"){ae=true;}}}}return ae;},getAllAccessProdIds:function(aa){var Z=$ac$.selectedMainProdOfferInfoVO;
var Y=[];if(Z.bindType==2){Y=dojo.filter(selectedMemberProdOfferList||[],function(ab){if(ab.uniqueId==aa){return true;}else{return false;}});Y=dojo.map(Y||[],function(ab){return ab.productId;});}else{Y=dojo.map(selectedMemberProdOfferList||[],function(ab){return ab.productId;
});}return Y;},getIfMemberChg:function(){var Y=$ac$.selectedMemberProdOfferList;return dojo.some(Y||[],function(Z){return Z.action!="new";});},getIfAllQuit:function(){var Y=$ac$.selectedMemberProdOfferList;
return dojo.every(Y||[],function(Z){return Z.action=="quit";});},getIfChangeMainFlag:function(Y){var aa=$ac$.selectedMemberProdOfferList;if(Y.contentPane){var Z=dojo.filter(aa||[],function(ac){return ac.uniqueId==Y.uniqueId;
});if(Z.length>0){if(!!(Z[0].offerInstVO)){if(Z[0].offerInstVO.prodOfferId!=Z[0].prodOfferId){return 1;}}}}else{var ab=aa[0];if(!!(ab.offerInstVO)){if(ab.offerInstVO.prodOfferId!=ab.prodOfferId){return 1;
}}}return null;},judgeIfChgSubForBundle:function(aa){if($ac$.selectedMemberProdOfferList){var Z=$ac$.selectedMemberProdOfferList;var Y=dojo.filter(Z||[],function(ab){return ab.uniqueId==aa;});if(!!Y[0]){if(!!Y[0].offerInstVO){if(Y[0].offerInstVO.prodOfferId==Y[0].prodOfferId){return true;
}}}}return false;},judgeIfChgSubForSimple:function(){if(!!$ac$.mainProdOfferInstVO){if($ac$.selectedMainProdOfferInfoVO.prodOfferId==$ac$.mainProdOfferInstVO.prodOfferId){return true;}}return false;},getIfChgSub:function(Z){var aa=$ac$.selectedMainProdOfferInfoVO;
if(aa.bindType==2){var Y=orderaccept.prodofferaccept.util.DomHelper.getParentWidget(Z,"orderaccept.custom.TooltipDialog");var ab=Y.rowData.showData.chooseNumberObj.uniqueId;return this.judgeIfChgSubForBundle(ab);
}else{return this.judgeIfChgSubForSimple();}},getIfReserveSubProdOffer:function(ac){if(!!ac){var ab=ac.effDate;var Z=ac.expDate;var Y="2037-01-01 00:00:00";var aa=$ac$.requestParam.today;if(A.compareDateValue(A.format(ab),aa)||(A.compareDateValue(Y,A.format(Z))&&!!ac.oldExpDate)){return true;
}}return false;},getProdOfferStartDateStr:function(Y,Z){if(!Z||Z.length==0){return Y.startDate;}else{return Z[0].innerText;}},getProdOfferEndDateStr:function(Y,Z){if(!Z||Z.length==0){return Y.endDate;}else{return Z[0].innerText;
}},getOldMemberProdOfferIds:function(){var Y=$ac$.selectedMemberProdOfferList;var Z=dojo.filter(Y||[],function(aa){return !!aa.offerInstVO;});return dojo.toJson(dojo.map(Z||[],function(aa){return aa.offerInstVO.prodOfferId+"";
}));},getNewMemberProdOfferIds:function(){var Y=$ac$.selectedMemberProdOfferList;var Z=dojo.filter(Y||[],function(aa){return aa.action!="quit"&&aa.action!="split";});return dojo.toJson(dojo.map(Z||[],function(aa){return aa.prodOfferId+"";
}));},getAgreementOfferDateObj:function(ab){var ad=dojo.global.$appContext$.requestParam.today;var Y=ad.split(" ");var aa=Y[0].split("-");var ag=parseInt(aa[0],10);var af=parseInt(aa[1],10)-1;var ac=ab.split("-");
var ae=parseInt(ac[0],10);var Z=parseInt(ac[1],10)-1;if(ag==ae){if(af==Z){return{beginDate:ab,oldOfferEndDate:ab};}else{if(af<Z){return{beginDate:A.formatDate(A.getFirstDayAfterPeriod()),oldOfferEndDate:ab};
}else{if(af>Z){return{beginDate:A.formatDate(A.getFirstDayAfterPeriod()),oldOfferEndDate:ab};}}}}else{if(ag>ae){return{beginDate:A.formatDate(A.getFirstDayAfterPeriod()),oldOfferEndDate:ab};}else{if(ag<ae){return{beginDate:A.formatDate(A.getFirstDayAfterPeriod()),oldOfferEndDate:A.formatDate(A.getFirstDayAfterPeriod())};
}}}},getOfferStandardFee:function(aa){var Z=aa.offerAgreementVO;if(Z!=null&&Z.length>0){var Y=Z[0];var ab=BusCard.find(Y.itemList||[],function(ac){return ac.attrId=="300008";});return ab.attrValue;}return null;
},ifAgreementpRrodOffer:function(ac,aa){if((!aa)||aa==1){var ab=ac.offerAgreementVO;if(ab!=null&&ab.length>0){for(var ae=0;ae<ab.length;ae++){var Z=ab[ae];if(Z.templetId=="2"||Z.templetId==2){return true;
}}}return false;}else{if(aa==2){var Y=ac.offerStandardInstList;if(!Y||Y.length==0){return false;}return true;}else{if(aa==3){var ad=this.getProdOfferDetail(arguments[0]);var ab=ad.offerAgreementVO;if(ab!=null&&ab.length>0){for(var ae=0;
ae<ab.length;ae++){var Z=ab[ae];if(Z.templetId=="2"||Z.templetId==2){return true;}}}return false;}}}},judgeByWideAttrParamValue:function(aa,ab,Z){if(aa&&ab&&Z){var Y=orderaccept.prodofferaccept.util.wideAttrParamValue;
if(Y&&Y.length==0){return true;}return dojo.some(Y||[],function(ac){return ac.userType==aa.value&&ac.loadMode==ab.value&&ac.wideAttr==Z.value;});}return true;},getManageAccNbrInfo:function(){var ab=null;
var Y=BusCard.$remote("custAccnbrRelBO").getCustAccRelVO({custId:dojo.global.$appContext$.get("requestParam").customerData.custId,statusCd:a.load("ServingStatusConst").ServingStatusConst.ON_USING});if(Y==null||Y=="null"){ab=null;
}if(Y!=null&&Y!="null"){if(Y.prodInstAccNbrId!=""&&Y.prodInstAccNbrId!=null){var aa=BusCard.$remote("prodInstCommFacadeBO").queryProdInstAccNbrInfo({prodInstAccNbrId:Y.prodInstAccNbrId});if(aa&&aa.length>0){var Z=BusCard.$remote("serviceRelationDAO").query({userId:aa[0].prodInstId,ifValid:1});
if(Z.length==0){var ac=BusCard.$remote("accessProdItemInfoDAO").selectByProperties({userId:aa[0].prodInstId,ifValid:1});if(ac.length==0){ab=null;}else{ab=ac[0];}}else{ab=Z[0];}}}}if(ab==null){var Y=BusCard.$remote("acctNbrTempDAO").queryOne({custId:dojo.global.$appContext$.get("requestParam").customerData.custId,operKind:1,accNbrType:2});
if(Y==null||Y=="null"){ab==null;}else{ab={serviceId:Y.accNbr,prodInstId:Y.relaProdInstId};}}return ab;}},c={getProdOfferDataForChg:function(af){var af=af||"";var ab=dojo.global.$appContext$.get("userHasProdOfferInfoList"+af),ag=dojo.global.$appContext$.get("prodOfferList"+af),ac=O.getMainProdOffer(ag)[0],Y=[],ae=[],aa=[],ah=[],ad=dojo.filter(ab,function(ai){return ai.prodOfferId==ac.prodOfferId;
})[0],aa=ad.prodInstList;var Z=this.getCancelFavorableSubOffer(ab,[],af);var Y=Z.keepProdOfferInstList;var ae=Z.cancelProdOfferInstList;dojo.global.$appContext$.set("mainProdOfferInstVO"+af,ad);dojo.global.$appContext$.set("keepMainProdInstList"+af,aa);
dojo.global.$appContext$.set("cancelMainProdInstList"+af,null);dojo.global.$appContext$.set("keepProdOfferInstList"+af,Y);dojo.global.$appContext$.set("cancelProdOfferInstList"+af,ae);dojo.global.$appContext$.set("leftProdOfferList"+af,[]);
},getProdOfferDataForChgMain:function(ah,ag){var ah=ah||"";var ad=dojo.global.$appContext$.get("userHasProdOfferInfoList"+ah);var al=dojo.global.$appContext$.get("prodOfferList"+ah);var ai=dojo.global.$appContext$.get("userHasProdOfferMetaInfoList"+ah);
var ac=[];var ao=[];var ak=[];var aj=O.getMainProdOffer(ai)[0];var af=O.getMainProdOffer(al)[0];var aa=(ag&&ag.offerInstVO)||dojo.filter(ad,function(ap){return ap.prodOfferId==aj.prodOfferId;})[0];var an=aa.prodInstList;
var ab={newMainProdOfferInfo:af,prodOfferList:al,userHasProdOfferInfoList:ad,userHasProdOfferMetaInfoList:ai};var am=this.getKeepOrCancelProdOfferDataByPPM(ab);var Y=am.keepProdOfferInstList;var ae=am.cancelProdOfferInstList;
dojo.forEach(an,function(aq){var ap=dojo.some(af.offerProdRelaList||[],function(ar){return ar.productInfoVO.productId==aq.productId;});ap?ac.push(aq):ao.push(aq);});ak=dojo.filter(al||[],function(ap){return ap.prodOfferType!=1&&!(dojo.some(Y||[],function(aq){return aq.prodOfferId==ap.prodOfferId;
}));});var Z=this.getCancelFavorableSubOffer(Y,ae,ah);Y=Z.keepProdOfferInstList;ae=Z.cancelProdOfferInstList;dojo.global.$appContext$.set("mainProdOfferInstVO"+ah,aa);dojo.global.$appContext$.set("prodOfferList"+ah,al);
dojo.global.$appContext$.set("keepMainProdInstList"+ah,ac);dojo.global.$appContext$.set("cancelMainProdInstList"+ah,ao);dojo.global.$appContext$.set("keepProdOfferInstList"+ah,Y);dojo.global.$appContext$.set("cancelProdOfferInstList"+ah,ae);
dojo.global.$appContext$.set("leftProdOfferList"+ah,ak);},getKeepOrCancelProdOfferDataByPPM:function(aa){var Y=[];var ad=[];var ag=aa.addProdOfferCartData;var aj=aa.prodOfferList;var ac=aa.userHasProdOfferInfoList;
var ah=aa.userHasProdOfferMetaInfoList;var ae=aa.newMainProdOfferInfo;var ai=O.getMainProdOffer(ah)[0];var af=dojo.map(ac||[],function(ak){return ak.prodOfferId;});af=dojo.filter(af||[],function(ak){return ak!=ai.prodOfferId;
});var Z=function(){try{return prodOfferAcceptLoader.getBelongCode();}catch(ak){}}();var ab=H.getService("url:orderDetailAction.do?method=checkAutoSelectedSubOfferForChg",null,{method:"post",content:{commonRegionId:Z||"-1",prodOfferId:ae.prodOfferId,offerList:af}});
dojo.forEach(ac||[],function(ak){var al=dojo.some(ab||[],function(am){return am==ak.prodOfferId;});if(al){Y.push(ak);}else{ad.push(ak);}});return{keepProdOfferInstList:Y,cancelProdOfferInstList:ad};},getCancelFavorableSubOffer:function(Y,ae,ah){if((!$ac$.selectedMainProdOfferInfoVO)||$ac$.selectedMainProdOfferInfoVO.bindType!=2){return{keepProdOfferInstList:Y,cancelProdOfferInstList:ae};
}if(dojo.some($ac$.selectedMemberProdOfferList||[],function(ak){return ak.action=="split"||ak.action=="quit";})){var ad=O.getOldMemberProdOfferIds();var ag=O.getNewMemberProdOfferIds();var ai=dojo.filter($ac$.selectedMemberProdOfferList||[],function(ak){return ak.uniqueId==ah;
});if((!!ai)&&ai.length>0){if(ai[0].action=="split"||ai[0].action=="quit"){ag=dojo.toJson([]);}}var aj="&oldMemOfferList="+ad+"&newMemOfferList="+ag;var ac=H.getService("url:orderDetailAction.do?method=getKeepSubProdOffers"+aj);
var aa=ac.allFavorableOfferIds;var ab=ac.chgFavorableOfferIds;var Z=[];var af=[];dojo.forEach(Y||[],function(ak){if(dojo.some(aa||[],function(al){return al==ak.prodOfferId;})){Z.push(ak);}else{af.push(ak);
}});dojo.forEach(Z||[],function(ak){if(dojo.some(ab||[],function(al){return al==ak.prodOfferId;})){af.push(ak);}else{ae.push(ak);}});Y=af;return{keepProdOfferInstList:Y,cancelProdOfferInstList:ae};}return{keepProdOfferInstList:Y,cancelProdOfferInstList:ae};
},getKeepOrCancelProdOfferData:function(Z){var Y=[];var ag=[];var ab=[];var ad=Z.addProdOfferCartData;var af=Z.prodOfferList;var aa=Z.userHasProdOfferInfoList;var ae=Z.userHasProdOfferMetaInfoList;if(ad){dojo.forEach(aa,function(ai){var ah=dojo.some(ad,function(aj){return ai.prodOfferId==aj.subProdOfferInfo.prodOfferId;
});if(ah){Y.push(ai);}else{ag.push(ai);}});}else{dojo.forEach(aa,function(ai){var ah=dojo.some(af,function(aj){return aj.prodOfferId==ai.prodOfferId;});if(ah){Y.push(ai);}else{ag.push(ai);}});}var ac=O.getMainProdOffer(dojo.global.$appContext$.prodOfferList)[0];
dojo.forEach(ag,function(ai){var aj=dojo.filter(ae||[],function(ak){return ak.prodOfferId==ai.prodOfferId;})[0];if(!aj){return;}if(aj.prodOfferType==3){var ah=dojo.some(ac.prodOfferRelaList||[],function(ak){return ak.relationTypeCD==J.DEPEND_TYPE&&ak.offerZId==ai.prodOfferId;
});if(ah){Y.push(ai);}else{ab.push(ai);}}else{if(aj.prodOfferType==2){var ah=dojo.some(ac.prodOfferRelaList||[],function(ak){return(ak.relationTypeCD==J.EX_TYPE&&ak.offerZId==ai.prodOfferId)||(ak.relationTypeCD==J.EX_TYPE&&ak.offerAId==ai.prodOfferId);
});if(!ah){Y.push(ai);}else{ab.push(ai);}}}});return{keepProdOfferInstList:Y,cancelProdOfferInstList:ab};},getKeepProdAttrInst:function(Z){var Y=dojo.global.$appContext$.keepProdInstList;prodInstInfo=dojo.filter(Y,function(aa){return aa.prodInstId=Z;
})[0];return(!!prodInstInfo?prodInstInfo:{}).prodInstAttrList;},getKeepProdAttrInst:function(aa,Z){var Y=dojo.global.$appContext$.keepProdInstList;prodInstInfo=dojo.filter(Y,function(ab){return ab.serviceId=aa&&ab.productId==Z;
})[0];return(!!prodInstInfo?prodInstInfo:{}).prodInstAttrList;},_getAllProdOfferList:function(){var Z=[],ab=Array.prototype.push;dojo.forEach(dojo.query("TR[uniqueId]"),function(ac){var ad=dojo.attr(ac,"uniqueId");
ab.apply(Z,$ac$.get("prodOfferList"+ad)||[]);});ab.apply(Z,$ac$.get("prodOfferList")||[]);ab.apply(Z,$ac$.get("userHasProdOfferMetaInfoList")||[]);var Y=$ac$.get("_prodOfferInstMap")||{};for(var aa in Y){prodOfferData=Y[aa];
if(prodOfferData){ab.apply(Z,prodOfferData.userHasProdOfferMetaInfoList||[]);}}return Z;},_getAllOfferInstList:function(){var Z=[],ab=Array.prototype.push;$ac$.get("userHasProdOfferInfoList");ab.apply(Z,$ac$.get("userHasProdOfferInfoList")||[]);
var Y=$ac$.get("_prodOfferInstMap")||{};for(var aa in Y){prodOfferData=Y[aa];if(prodOfferData){ab.apply(Z,prodOfferData.userHasProdOfferInfoList||[]);}}return Z;},dealProdInstList:function(){},queryProdOfferInfoVO:function(Z){var Y=BusCard.jsonPath(this._getAllProdOfferList(),"$[?(@.prodOfferId=="+Z+")]");
if(Y){return Y[0];}},queryOfferProdRelaVO:function(Y){var Z=BusCard.jsonPath(this._getAllProdOfferList(),"$[*].offerProdRelaList[?(@.productId=="+Y+")]");if(Z){return Z[0];}},queryRelaProdInfoVO:function(Y){var Z=BusCard.jsonPath(this._getAllOfferInstList(),"$[*].prodInstList[?(@.prodInstId=="+Y+")]");
if(!Z){Z=BusCard.jsonPath(this._getAllOfferInstList(),"$[*].prodInstList[*].prodInstList[?(@.prodInstId=="+Y+")]");}return Z[0];},queryProdOfferAcceptInfoVO:function(Z){var Y=BusCard.jsonPath(this._getAllOfferInstList(),"$[?(@.prodOfferInstId=="+Z+")]");
if(Y){return Y[0];}},queryMemberProdOfferAndSub:function(ab,ac){var Z=[];var Y=dojo.filter($ac$.get("userHasProdOfferInfoList")||[],function(ad){return ad.prodOfferInstId==ab;})[0];var aa=Y.offerInstRelaList;
dojo.forEach(aa||[],function(ad){if(ad.relaProdOfferInstId==Y.prodOfferInstId){Z=Z.concat(dojo.filter($ac$.get("userHasProdOfferInfoList")||[],function(ae){return ae.prodOfferInstId==ad.relatedProdOfferInstId;
}));}});Z=Z.concat([Y]);dojo.global.$appContext$.set("userHasProdOfferInfoList"+ac,Z);},getOfferStandardStartDate:function(){if($ac$.currentProcessId=="single2single"){var ac=$ac$.mainProdOfferInstVO;var Y=ac.offerStandardInstList;
var ab=ac.salesPromotionInstList;var aa=null;if(Y&&Y.length>0){if(ab&&ab.length>0){var Z=dojo.map(ab,function(ad){return ad.expDate;});aa=Z.max();}else{var Z=dojo.map(Y,function(ad){return ad.expDate;});
aa=Z.max();}}if(aa!=null){$ac$.set("offerStandardStartDate_"+ac.prodOfferInstId,{beginDate:A.format(aa,false),timeString:z.getDateFromString(A.format(aa,false))});}}},getBeginAndEndDateForAgreeMentLN:function(Z){var Y=Z.offerStandardInstList;
var ab=null;if(Y&&Y.length>0){var aa=dojo.map(Y,function(ac){return ac.expDate;});ab=aa.max();$ac$.set("offerStandardStartDate_"+Z.prodOfferInstId,O.getAgreementOfferDateObj(ab));}},getOfferStandardStartDateForOldNum:function(ac){var Y=ac.offerStandardInstList;
var ab=ac.salesPromotionInstList;var aa=null;if(Y&&Y.length>0){if(ab&&ab.length>0){var Z=dojo.map(ab,function(ad){return ad.expDate;});aa=Z.max();}else{var Z=dojo.map(Y,function(ad){return ad.expDate;});
aa=Z.max();}}if(aa!=null){$ac$.set("offerStandardStartDate_"+ac.prodOfferInstId,{beginDate:A.format(aa,false),timeString:z.getDateFromString(A.format(aa,false))});}}},W={getProdOfferDataForChg:function(Y){},getProdOfferDataForChgMain:function(Y){}},Q={getAcessProdItem:function(){},getProdItemRelationList:function(Z,Y){return BusCard.jsonPath(currentProdOfferOrderItem.itemRelationInfoList||[],"$[?(@.orderRelType=="+Z+"&&@.aorderItemId=="+Y.orderItemId+")]");
},getSubProdOfferOrderItem:function(){}},o={getMainProdOfferTree:function(ac,ad,ag){var Z=ac.url,ah=ac.queryParam||{},aa=ac.id||"mainProdOfferTree",ag=ag||"mainProdOfferTree",ab=ac.builderParams||(function(aj,ai){aj=aj?aj:{};
aj.catalogId=this.widget.getBinding().getId(ai);aj.isCatalog=ai.data.isCatalog;aj.label=ai.data.label;aj.dojoType="1";return aj;}),ae={bindingClass:"unieap.tree.JsonTreeBinding",leaf:"leaf",label:"text",id:"id"},af={url:Z,parameters:ah,buliderParams:ab},Y={binding:ae,loader:af,treeLoaderClass:"orderaccept.custom.JsonTreeLoader",id:aa};
dojo.mixin(Y,ac.listeners||{onClick:function(){return dojo.publish("/"+ag+"/click",arguments);},onDblClick:function(){return dojo.publish("/"+ag+"/dblclick",arguments);},onContextMenu:function(){return dojo.publish("/"+ag+"/contextmenu",arguments);
},onMouseOver:function(){return dojo.publish("/"+ag+"/mouseover",arguments);},onMouseOut:function(){return dojo.publish("/"+ag+"/mouseout",arguments);}});return new s(Y,ad);},getSubProdOfferTree:function(Z,Y){return this.getMainProdOfferTree(Z,Y,"subProdOfferTree");
},getPromotionTree:function(Z,Y){return this.getMainProdOfferTree(Z,Y,"promotionTree");},getTree:function(Z,Y){return this.getMainProdOfferTree(Z,Y);}},H=function(){var aa=function(){return BusCard.$load(arguments[0]);
};var ab=function(){return BusCard.$remote(arguments[0]);};var Z=function(ad,ag,af){var ak=ad.replace(/^url\:/i,""),ae=BusCard.path.contextPath;if(ak.indexOf(ae)!=0){if(ak.indexOf("/")!=0){ak=ae+"/"+ak;
}else{ak=ae+ak;}}if(!af){if(!ag){var aj=dojo._getText(BusCard.util.bustCache(ak));try{return BusCard.parse(aj);}catch(ai){return aj;}}else{BusCard.doGet(ak,ah,true,ag);}}else{var ac=af.method||"get";var ah=af.content||{};
if(ac.toUpperCase()=="GET"){ac="doGet";}else{ac="doPost";}if(!ag){var aj=BusCard[ac](ak,ah);try{return aj;}catch(ai){return aj;}}else{BusCard[ac](ak,ah,true,ag);}}};var Y=function(){var ae=arguments[0]||"";
var ag=/^url\:/i.test(ae),ah=/^spring\:/i.test(ae),ad=/^class\:/i.test(ae);if(ad){var af=ae.replace(/^class\:/i,"");return aa(af);}else{if(ag){return Z(ae,arguments[1],arguments[2]);}else{if(ah){var ac=ae.replace(/^spring\:/i,"");
return ab(ac);}}}};return{getService:Y};}(),x={getSubProdOfferCartList:function(Y){return dojo.map(Y,function(Z){return Z.subProdOfferInfo;});},getCheckedSubProdOfferCartList:function(Y){},getUncheckedSubProdOfferCartList:function(Y){}},w={NUMBER_VALUE_CODE:"L1",TEXT_VALUE_CODE:"L2",PASSWORD_VALUE_CODE:"L4",RONDAM_PASSWORD_VALUE_CODE:"L5",TEXT_SHOW_TYPE:"text",SELECT_SHOW_TYPE:"select",CHECKBOX_SHOW_TYPE:"checkbox",RADIOBOX_SHOW_TYPE:"radiobox",DATE_SHOW_TYPE:"date",TEXTAREA_SHOW_TYPE:"textarea",PASSWORD_SHOW_TYPE:"pwd",ID_INDEX:0},g={getRandomPassword:function(){var Y=new Array(0,1,2,3,4,5,6,7,8,9);
var Z="";for(var aa=0;aa<6;aa++){Z+=""+Y[Math.floor(Math.random()*10)];}return Z;},accMul:function(ab,Z){var Y=0,ac=ab.toString(),aa=Z.toString();try{Y+=ac.split(".")[1].length;}catch(ad){}try{Y+=aa.split(".")[1].length;
}catch(ad){}return Number(ac.replace(".",""))*Number(aa.replace(".",""))/Math.pow(10,Y);},nas_email_check_sirp:function(ab,Y,af){var Z=ab+"必须是有效的邮件地址！";if(af==null||af==""){af=1;}var ad=/^[_\.0-9a-z-]+@([0-9a-z][0-9a-z-]+\.){1,4}[a-z]{2,3}$/i;
var aa=Y.value;var ac=aa.match(ad);var ae=new Array();if(aa.length!=0&&ac==null){if(af==1){if(typeof(window.orderaccept)!="undefined"){orderaccept.common.dialog.MessageBox.alert({busiCode:"08510164",infoList:[Z]});
}else{alert(Z);}Y.focus();}return false;}return true;},checkMinMaxValue:function(aa,ab){var Z=aa;if(Z.value==""){return;}var Y="输入的值应该在【"+ab.valueFrom+"】和【"+ab.valueTo+"】之间，请核查！";if(ab.valueFrom!=""&&ab.valueFrom!=null){if(Z.value*1<ab.valueFrom*1){if(typeof(window.orderaccept)!="undefined"){orderaccept.common.dialog.MessageBox.alert({busiCode:"08510164",infoList:[Y]});
}else{alert(Y);}Z.value="";Z.focus();return false;}}if(ab.valueTo!=""&&ab.valueTo!=null){if(Z.value*1>ab.valueTo*1){if(typeof(window.orderaccept)!="undefined"){orderaccept.common.dialog.MessageBox.alert({busiCode:"08510164",infoList:[Y]});
}else{alert(Y);}Z.value="";Z.focus();return false;}}},checkFloat:function(Z){var Y=/^(-?\d+)(\.\d+)?$/;if(!Y.exec(Z)){return false;}return true;},checkNumberValue:function(Z,aa){var Y=Z;if(Y.value==""){return;
}if(this.checkFloat(Z.value)===false){orderaccept.common.dialog.MessageBox.alert({busiCode:"08510164",infoList:["必须输入数字，请核查!"]});Y.value="";Y.focus();return false;}if(this.checkMinMaxValue(Z,aa)===false){return false;
}},checkIfNotNull:function(Z){if(!Z){return false;}var Y=dojo.some(Z,function(aa){return aa.nullable===false&&aa.ifDisplay=="1"&&!aa.defaultValue;});return Y;},checkIfFavour:function(ab){var Y=false;var aa=a.load("FavourKindConst").FavourKindConst;
if(ab.usageTypeList&&ab.usageTypeList.length>0){var Z=ab.usageTypeList;dojo.forEach(Z,function(ac){if(ac=="1"){Y=aa.SELF_FAVOUR;return true;}if(ac=="2"){Y=aa.COMMON_FAVOUR;return true;}if(ac=="126"){Y=aa.OCS_FAVOUR;
return true;}});}return Y;},checkedIfNeedShow:function(ab,Z){if(ab!=null&&ab.length>0){for(var aa=0,Y=ab.length;aa<Y;aa++){var ac=ab[aa];if(ac.nullable==false||ac.nullable=="false"){if(Z&&Z=="product"){if(ac.valueShowType==w.TEXT_SHOW_TYPE){if(ac.defaultValue==""){return true;
}}else{if(ac.valueShowType==w.SELECT_SHOW_TYPE){if(this.ifDefaultValueInValueList(ac)){if(changeValue.isChange=="0"){return false;}else{return true;}}else{if(changeValue.ifChanged=="0"){if(changeValue.isChange=="0"){return false;
}else{return true;}}return true;}}}}else{if(ac.valueShowType==w.SELECT_SHOW_TYPE){if(!this.ifDefaultValueInValueList(ac)){return true;}}else{if(ac.defaultValue==""){return true;}}}}}}return false;},getDefaultValueList:function(ad){var ab="";
if(ad!=null&&ad.length>0){for(var aa=0,Y=ad.length;aa<Y;aa++){var ae=ad[aa];var Z=_keepAttr_(ae.attrCd);if(Z||ae.defaultValue!=""){var ac={attrCd:ae.attrCd,attrValue:ae.defaultValue,operKind:1,attrInstId:-1,attrName:ae.attrName,valueExpressions:(ae.attrValueExpressionsVO&&ae.attrValueExpressionsVO.valueExpressions)?ae.attrValueExpressionsVO.valueExpressions:""};
ab+="<attrInfoVO>";ab+=new LeafList(ac).toString();ab+="</attrInfoVO>";}if(this.checkIfHasUpSpeed(ae)){var ac={attrCd:ae.attrCd,attrValue:"",operKind:1,attrInstId:-1,attrName:ae.attrName,valueExpressions:(ae.attrValueExpressionsVO&&ae.attrValueExpressionsVO.valueExpressions)?ae.attrValueExpressionsVO.valueExpressions:""};
ab+="<attrInfoVO>";ab+=new LeafList(ac).toString();ab+="</attrInfoVO>";}}}return ab;},getPromotionItemValue:function(Z){var Y={};dojo.forEach(Z||[],function(aa){var ab=aa.attrSpec;if(ab.isFeeAttr==1){if(ab.valueUnit=="D12"){Y[ab.attrCd]=aa.attrValue?aa.attrValue:"";
}else{if(ab.valueUnit=="D8"){Y[ab.attrCd]=aa.attrValue?aa.attrValue*100:"";}}}else{Y[ab.attrCd]=aa.attrValue?aa.attrValue:"";}});return Y;},getAttrDefaultValueList:function(ac){var aa={};if(!!ac){for(var Z in ac){if(!ac.hasOwnProperty(Z)){continue;
}var ad=ac[Z];if(ad.defaultValue!=""){var ab={attrCd:ad.attrCd,attrValue:ad.defaultValue,operKind:1,attrInstId:-1,attrName:ad.attrName,valueExpressions:(ad.attrValueExpressionsVO&&ad.attrValueExpressionsVO.valueExpressions)?ad.attrValueExpressionsVO.valueExpressions:""};
var Y=ad.defaultValue;if(!!Y&&!isNaN(Y)){if(ad.valueUnit==f.minuteConst){Y=parseFloat(Y+"")/100;}}aa[ad.attrCd]=ad.attrValue?ad.attrValue:Y;}else{if(ad.nullable==false&&!ad.defaultValue){return{};}}}}return aa;
},checkIfHasUpSpeed:function(ab){var aa=ab.attrRelaList;if(aa){for(var Y=0;Y<aa.length;Y++){var Z=aa[Y];if(Z.attrRelaType==7){return true;}}}return false;},ifDefaultValueInValueList:function(ac){if(!ac){return false;
}var Z=ac.defaultValue;var Y=ac.attrValueList;if(Y&&Y.length>0){for(var ab in Y){var aa=Y[ab];if(aa&&Z==aa){return true;}}}return false;}},B=1,C={generateUniqueId:function(){return B++;}},v=Object.prototype.toString,G={getValueIngnoreCase:function(aa,Z){for(var Y in Z){if(Y.toLowerCase()==aa.toLowerCase()){return Z[Y];
}}},toJavaString:function(Y){return this.convertValue("java.lang.String",Y);},toJavaInt:function(Y){return this.convertValue("int",Y);},toJavaLong:function(Y){return this.convertValue("long",Y);},toJavaChar:function(Y){return this.convertValue("char",Y);
},toJavaBoolean:function(Y){return this.convertValue("boolean",Y);},toJavaMap:function(Y){return this.convertValue("java.util.Map",Y);},toJavaList:function(Y){return this.convertValue("java.util.List",Y);
},toJavaDate:function(Y){return this.convertValue("java.util.Date",Y);},convertValue:function(ac,ab){var aa=v.apply(ab);if(ab===null||ab===undefined){return ab;}switch(ac){case"java.lang.String":if(dojo.isString(ab)){return ab;
}else{if(/Number/i.test(aa)||/Boolean/i.test(aa)){return ab.toString();}else{if(/Object/.test(aa)||/Array/.test(aa)){return dojo.toJson(ab);}}}break;case"java.lang.Integer":case"int":case"java.lang.Long":case"long":if(/Number/i.test(aa)){return ab;
}else{if(ab){try{return parseInt(ab);}catch(ae){}}}break;case"java.math.BigDecimal":case"java.lang.Double":case"double":case"java.lang.Float":case"float":if(/Number/i.test(aa)){return ab;}else{if(ab){try{return parseFloat(ab);
}catch(ae){}}}break;case"java.lang.Boolean":case"boolean":return !!ab;break;case"char":case"java.lang.Character":if(/String/i.test(aa)){return ab.substring(0,1);}break;case"java.util.Date":case"java.sql.Date":if(/String/i.test(aa)){return ab;
}else{if(/Number/i.test(aa)){var Z=new Date(ab),Y=Z.getFullYear(),ad=Z.getMonth()+1;Z=Z.getDate();return Y.toString()+ad.toString()+Z.toString();}}break;case"java.util.Map":if(/Object/.test(aa)){return ab;
}case"java.util.List":if(/Array/i.test(aa)){return ab;}}}};dojo.declare("orderaccept.prodofferaccept.util.BeanBuildFactoryProvider",[],{getPOBBFInstance:function(){var Z={},ac=[],Y=H.getService("class:com.neusoft.crm.ordermgr.business.common.util.BeanMap").getProdOfferOrderTypeMap();
dojo.mixin(Z,G);for(var aa in Y){var ab=/^com\.(?:.*?)\.(\w+)$/.exec(aa);if(ab){ac.push({simpleName:ab[1],name:ab[0]});}}Z.metaData=Y;dojo.forEach(ac,function(ad){Z["get"+ad.simpleName]=function(ai){var ag=dojo.clone(Y[ad.name]);
for(var af in ag){var ae=this.convertValue(ag[af],this.getValueIngnoreCase(af,ai));if(ae!=null&&!(typeof ae=="number"&&isNaN(ae))){ag[af]=ae;}else{try{delete ag[af];}catch(ah){}}}return ag;};});return Z;
},getInstance:function(){var Z={},ac=[],Y=H.getService("class:com.neusoft.crm.ordermgr.common.custorderacceptinfo.util.TypeInspector").inspectType("com.neusoft.crm.ordermgr.common.custorderacceptinfo.data.CustOrderAcceptInfoVO");
dojo.mixin(Z,G);for(var aa in Y){var ab=/^com\.(?:.*?)\.(\w+)$/.exec(aa);if(ab){ac.push({simpleName:ab[1],name:ab[0]});}}Z.metaData=Y;dojo.forEach(ac,function(ad){Z["get"+ad.simpleName]=function(ai){var ag=dojo.clone(Y[ad.name]);
for(var af in ag){var ae=this.convertValue(ag[af],this.getValueIngnoreCase(af,ai));if(ae!=null&&!(typeof ae=="number"&&isNaN(ae))){ag[af]=ae;}else{try{delete ag[af];}catch(ah){}}}return ag;};});return Z;
}});(function(){var aa=H.getService("url:prodOfferSaleAjaxAction.do?method=getAllConstValues");for(var Z in aa){orderaccept.prodofferaccept.util[Z]=aa[Z];}var Y=H.getService("url:prodOfferSaleAjaxAction.do?method=getUserTypeAndSpeedRelation");
orderaccept.prodofferaccept.util.wideAttrParamValue=Y;})();var j=function(Z,Y){if(Z){for(var aa in Z){var ab=Z[aa];if(ab.attrCd){if(ab.attrValue==undefined||ab.attrValue=="undefined"){if(Y.$(ab.attrCd)&&Y.$(ab.attrCd)!=null){Y.$(ab.attrCd).value="";
}}else{if(Y.$(ab.attrCd)&&Y.$(ab.attrCd)!=null){Y.$(ab.attrCd).value=ab.attrValue;}}}}}};var i=function(Z,Y){attrObj={};dojo.forEach(Z,function(aa){attrObj[aa.attrCd]=d(aa.attrValue)?aa.attrValue:"";});
Y.renderDefaultValue(attrObj);};var d=function(Y){return Y&&Y!="undefined"&&Y!="null";};var I={findParentNode:function(aa,Z){var Y=aa.parentNode;while(Y&&Y!=Y.parentNode){if(Z(Y)){return Y;}else{Y=Y.parentNode;
}}},getLeft:function(Z){var Y=dojo.position(Z,true).x;return Y;},getTop:function(Z){var Y=dojo.position(Z,true).y;return Y;},getWidth:function(Y){return Y.offsetWidth;},getHeight:function(Y){return Y.offsetHeight;
},getParentWidget:function(Y,aa){var ac=Y,Z=-1,ab=null;while(true){var ab=dijit.getEnclosingWidget(ac);if(!ab){return null;}if(ab.declaredClass===aa){break;}if(Z!=ab.id){ac=ab.domNode;}else{ac=ab.domNode.parentNode;
}Z=ab.id;}return ab;},enableTitle:function(Y){if(Y&&Y.tagName&&Y.tagName.toUpperCase()=="SELECT"){var Z=Y.options||[];dojo.forEach(Z,function(aa){aa.title=aa.text;});}}};var R=function(){var Y=dojo.declare("",[],{custOrderVO:null,constructor:function(Z){this.custOrderVO=Z;
},bind:function(Z){this.custOrderVO=Z;},getItemRelationList:function(){var aa=[],Z=Array.prototype.push;dojo.forEach(this.custOrderVO.serviceProdItemInfoList||[],function(ac){var ab=ac.itemRelationInfoList||[];
Z.apply(aa,ab);});dojo.forEach(this.custOrderVO.prodItemInfoList||[],function(ac){var ab=ac.itemRelationInfoList||[];Z.apply(aa,ab);});dojo.forEach(this.custOrderVO.accessProdItemInfoList||[],function(ac){var ab=ac.itemRelationInfoList||[];
Z.apply(aa,ab);});dojo.forEach(this.custOrderVO.offerItemInfoList||[],function(ac){var ab=ac.itemRelationInfoList||[];Z.apply(aa,ab);});return aa;},custOrder2pageSnapshot:function(){var ac=this.getIndependenceItemList();
var aa=this;var ab=this.getMainProdOfferItemList();var ae=this.getAccessProdItemList();var ah=a.load("ItemRelationTypeConst").ItemRelationTypeConst.OFFER_COMB_MEMBER;var ai=a.load("ItemRelationTypeConst").ItemRelationTypeConst.OFFER_PRODUCT;
var af=[];var ak=null;var Z="sharedProdOfferInstall";if(ac.length>0){Z="independenceProdOfferInstall";var ag=ak=ac[0];var ad=ag.itemRelationInfoList||[];var aj=BusCard.jsonPath(ad,"$[?(@.orderRelType=='"+ah+"')]")||[];
dojo.forEach(aj,function(ap){var an=aa.filterOrderItemList(function(aq){return aq.orderItemId==ap.zorderItemId;})[0];var al=dojo.filter(an.itemRelationInfoList||[],function(aq){return aq.orderRelType==ai;
});if(al.length==0){return;}var am=al[0].zorderItemId;var ao=aa.filterOrderItemList(function(aq){return aq.orderItemId==am&&aq.prodFuncType=="101";})[0];if(!ao){return;}af.push({productId:ao.productId,prodOfferId:an.prodOfferId,offerItemVO:an,prodItemVO:ao,action:"new"});
});}else{ak=ab[0];af=dojo.map(ae,function(al){return{productId:al.productId,prodOfferId:ab[0].prodOfferId,prodItemVO:al,offerItemVO:ab[0],action:"new"};});}return{processId:Z,mainOfferItemVO:ak,selectedMemberProdOfferList:af};
},getIndependenceItemList:function(){return BusCard.jsonPath(this.custOrderVO,"$.offerItemInfoList[?(@.bundleType==2)]")||[];},getAccessProdItemList:function(){return this.custOrderVO.accessProdItemInfoList||BusCard.jsonPath(this.custOrderVO,"$.prodItemInfoList[?(@.serviceId!=null)]")||[];
},getServiceProdItemList:function(){return this.custOrderVO.serviceProdItemInfoList||BusCard.jsonPath(this.custOrderVO,"$.prodItemInfoList[?(@.serviceId==null)]")||[];},filterOrderItemList:function(Z){var ac=this.custOrderVO.accessProdItemInfoList||[],aa=this.custOrderVO.serviceProdItemInfoList||[],ad=this.custOrderVO.prodItemInfoList||[],ab=this.custOrderVO.offerItemInfoList||[];
return dojo.filter([].concat(ac,ad,aa,ab),Z);},getMainProdOfferItemList:function(){var ab=this.getAccessProdItemList(),ac=this,ae=[],ad=Array.prototype.push,Z=this.getItemRelationList(),aa=a.load("ItemRelationTypeConst").ItemRelationTypeConst.OFFER_PRODUCT;
dojo.forEach(ab,function(ag){var af=ag.orderItemId;ad.apply(ae,dojo.map(dojo.filter(Z,function(ah){return ah.zorderItemId==af&&ah.orderRelType==aa;}),function(ah){return BusCard.jsonPath(ac.custOrderVO.offerItemInfoList,"$[?(@.orderItemId=="+ah.aorderItemId+")]")[0];
}));});return ae;},getSubProdOfferItemList:function(ab){var ae=this;var aa=a.load("ItemRelationTypeConst").ItemRelationTypeConst.OFFER_RELA;var Z=this.filterOrderItemList(function(af){return af.orderItemId==ab;
})[0];var ac=[];if(Z){var ad=Z.itemRelationInfoList||[];ac=dojo.map(dojo.filter(ad,function(af){return af.orderRelType==aa;}),function(af){return ae.filterOrderItemList(function(ag){return ag.orderItemId==af.zorderItemId;
})[0];});}return ac;},getAcessProdItem:function(ad){var ab=a.load("ItemRelationTypeConst").ItemRelationTypeConst.OFFER_PRODUCT;var ag=a.load("ItemRelationTypeConst").ItemRelationTypeConst.PRODUCT_RELA;
var ac=a.load("ItemRelationTypeConst").ItemRelationTypeConst.OPTIONAL_PACKAGE_ACCESS_PRODUCT;var af=this.getItemRelationList();var aa=BusCard.jsonPath(ad.itemRelationInfoList||[],"$[?(@.orderRelType=="+ab+"&&@.aorderItemId=="+ad.orderItemId+")]")||[];
var ae=BusCard.jsonPath(ad.itemRelationInfoList||[],"$[?(@.orderRelType=="+ac+"&&@.aorderItemId=="+ad.orderItemId+")]")||[];if(aa.length>0){var Z=BusCard.jsonPath(af||[],"$[?(@.orderRelType=="+ag+"&&@.zorderItemId=="+aa[0].zorderItemId+")]")[0];
return(Z&&BusCard.jsonPath(this.getAccessProdItemList()||[],"$[?(@.orderItemId=="+Z.aorderItemId+")]")[0]);}else{if(ae.length>0){return(BusCard.jsonPath(this.getAccessProdItemList()||[],"$[?(@.orderItemId=="+ae[0].zorderItemId+")]")[0]);
}else{return null;}}},getServiceProdItemListForOfferItem:function(ab){var ac=this;var aa=a.load("ItemRelationTypeConst").ItemRelationTypeConst.OFFER_PRODUCT;var Z=BusCard.jsonPath(ab.itemRelationInfoList||[],"$[?(@.orderRelType=="+aa+"&&@.aorderItemId=="+ab.orderItemId+")]");
return dojo.filter(ac.getServiceProdItemList()||[],function(ad){return dojo.some(Z,function(ae){return ad.orderItemId==ae.zorderItemId&&ae.orderRelType==aa;});});}});return{getInstance:function(Z){return new Y(Z);
}};}();var M=function(){var Y=dojo.declare("",[],{WaitingBarObj:null,default_msg:"系统运行中,请稍候...",msg:null,className_waitingBarBox:"waitingBarNewBox",className_waitingBar:"waitingBarNew",className_waitingBarTD:"waitingBarNewTD",isWaiting:false,constructor:function(){},isValid:function(Z){if(Z==null||typeof Z=="undefined"){return false;
}else{return true;}},initMe:function(){var aa=this;var Z=$("divWaitingBar");if(this.isValid(Z)){return;}this.msg=this.default_msg;this.WaitingBarObj=document.createElement("div");this.WaitingBarObj.id="divWaitingBar";
this.WaitingBarObj.style.display="none";this.WaitingBarObj.className=this.className_waitingBarBox;BusCard.addEventListener(aa.WaitingBarObj,"blur",function(){aa.alwaysFocus();});var ab="";ab+='<table onselectstart="return false;"  cellpadding="0" cellspacing="0" border="0" width="100%" valign="middle" height="100%"><tr><td align="center" valign="middle" >';
ab+='<table class="'+this.className_waitingBar+'" >';ab+='<tr><td align="center" id="divWaitingBar_Content" class="'+this.className_waitingBarTD+'"><b>&#160;&#160;&#160;&#160;';ab+='<span id="waitingBarMsg"></span></b></td></tr>';
ab+="</table>";ab+="</td></tr></table>";ab+='<iframe border="0" frameborder="0" style="position:absolute;top:0px;left:0px;width:100%;height:100%;z-index:-1;border:0px solid #ffffff" ></iframe>';this.WaitingBarObj.innerHTML=ab;
document.body.appendChild(this.WaitingBarObj);BusCard.addEventListener(document.body,"click",function(){aa.waiting();});},toggleWaitingLayer:function(Z){var aa='<iframe  id=\'waitingLayer\'  border="0" frameborder="0" style="filter:Alpha(opacity=75);opacity:0.5;position:absolute;top:0px;left:0px;width:100%;height:100%;z-index:10;background-color:silver;border:0px solid #ffffff" ></iframe>';
if(!dojo.byId("waitingLayer")){dojo.place(aa,document.body,"last");}dojo.byId("waitingLayer").style.height=Math.max(document.body.offsetHeight,document.body.scrollHeight)+"px";if(Z){dojo.byId("waitingLayer").style.display="block";
}else{dojo.byId("waitingLayer").style.display="none";}},alwaysFocus:function(){var Z=this;if(Z.WaitingBarObj.style.display!="none"){Z.WaitingBarObj.focus();}},showMe:function(Z){try{var ab=-10;if(!this.isValid(Z)||Z){$("waitingBarMsg").innerHTML=this.msg;
this.WaitingBarObj.style.display="block";this.WaitingBarObj.focus();this.toggleWaitingLayer(true);this.isWaiting=true;}else{this.WaitingBarObj.style.display="none";this.WaitingBarObj.blur();this.isWaiting=false;
this.toggleWaitingLayer(false);}}catch(aa){}},hideMe:function(){this.showMe(false);},waiting:function(){var Z=this;if(Z.isWaiting){event.cancelBubble=true;event.returnValue=false;return false;}}});return{getInstance:function(){return new Y();
}};}();var b={0:"single",1:"comb",2:"independence"};var S=dojo.declare("",[],{bindTypeMap:b,notSupportPrompt:"\u6682\u4e0d\u652f\u6301\u6b64\u7c7b\u53d8\u66f4,",prodOfferId:null,prodOfferInstId:null,offerInstVO:null,oldProdOfferInfoVO:null,newProdOfferInfoVO:null,cb:null,processId:null,constructor:function(Y){this.prodOfferId=Y.prodOfferId;
this.cb=Y.callback;},dispatch:function(){var Z=this;this.prodOfferInstId=$ac$.get("requestParam").prodOfferInstId;var aa=$ac$.get("userHasProdOfferInfoList");this.offerInstVO=BusCard.jsonPath(aa,"$[?(@.prodOfferInstId=="+this.prodOfferInstId+")]")[0];
this.oldProdOfferInfoVO=$ac$.cache("prodOfferId-"+this.offerInstVO.prodOfferId,{permitFromCache:true,permitCache:true,callback:function(){return H.getService("spring:innerInterfaceBO").getProdOfferInfo({prodOfferId:Z.offerInstVO.prodOfferId,interfaceType:1});
}});this.newProdOfferInfoVO=H.getService("spring:prodOfferSaleDataBO").getProdOfferInfo({prodOfferId:this.prodOfferId,interfaceType:1});this.currentProcessId=this.bindTypeMap[this.oldProdOfferInfoVO.bindType]+"2"+this.bindTypeMap[this.newProdOfferInfoVO.bindType];
var Y=V(this.newProdOfferInfoVO,this.oldProdOfferInfoVO,this.offerInstVO);if(Y.code<0){k.alert({busiCode:"08410161",infoList:[Y.message]});return false;}if((this.prodOfferId==this.oldProdOfferInfoVO.prodOfferId)&&this.needCheckSameOffer()){k.alert({busiCode:"08410162",infoList:[this.newProdOfferInfoVO.prodOfferName]});
return false;}else{$ac$.set("currentProcessId",this.currentProcessId);this[this.currentProcessId]();}},needCheckSameOffer:function(){return true;},asyncRequestData:function(Y){var aa=this;var Z=O.loadAndSetProdOffer(aa.prodOfferId,{interfaceType:4,permitCache:true});
$ac$.set("currentMainProdOfferInfoVO",Z);$ac$.set("prodOfferList",[Z]);Y(Z);},prompt:function(){var Y=this.oldProdOfferInfoVO.bindType;var Z=this.newProdOfferInfoVO.bindType;k.alert({busiCode:"08410163",infoList:[this.notSupportPrompt,Y,Z]});
return false;},single2single:function(){var Y=this;this.asyncRequestData(function(Z){Y.cb(Y.currentProcessId,Z);});},single2comb:function(){var Y=this;this.asyncRequestData(function(Z){Y.cb(Y.currentProcessId,Z);
});},single2independence:function(){var Y=this;this.asyncRequestData(function(Z){Y.cb(Y.currentProcessId,Z);});},comb2single:function(){var Y=this;return Y.prompt();this.asyncRequestData(function(Z){Y.cb(Y.currentProcessId,Z);
});},comb2comb:function(){var Y=this;return Y.prompt();this.asyncRequestData(function(Z){Y.cb(Y.currentProcessId,Z);});},comb2independence:function(){var Y=this;return Y.prompt();this.asyncRequestData(function(Z){Y.cb(Y.currentProcessId,Z);
});},independence2single:function(){var Y=this;return Y.prompt();this.asyncRequestData(function(Z){Y.cb(Y.currentProcessId,Z);});},independence2comb:function(){var Y=this;return Y.prompt();this.asyncRequestData(function(Z){Y.cb(Y.currentProcessId,Z);
});},independence2independence:function(){var Y=this;this.asyncRequestData(function(Z){Y.cb(Y.currentProcessId,Z);});}});S.getInstance=function(){return new this(arguments[0]);};var V=function(Z,ac,ae){var Y="";
var ad=orderaccept.prodofferaccept.util;var ab=dojo.global.$appContext$.get("requestParam");var ag=Z;var ah=ac;var af=a.load("PaymentModeConst").PaymentModeConst;if(!!ah){if((""+ah.feeType).substring(0,2)!=(""+ag.feeType).substring(0,2)){var aa="prodOfferInstId="+ae.prodOfferInstId;
Y=H.getService("url:prodOfferSaleAjaxAction.do?method=doPaymentChgCheck&"+aa);}}return Y;};var F=dojo.declare("",[],{});var l={independenceMemberChange:{}};$ac$.set("DataManager",{getInstance:function(){return l[$ac$.get("processId")];
}});var A=function(){var Y=function(aa){return aa.length==1?"0"+aa:aa;};var Z=function(ab,aa){var ag=Object.prototype.toString.apply(ab);if(/Number/i.test(ag)){ab=new Date(ab);}else{if(/String/i.test(ag)&&/^\d+$/.test(ab)){ab=new Date(parseInt(ab));
}else{if(/Date/i.test(ag)){ab=ab;}}}if(ab instanceof Date){var ah=""+ab.getFullYear(),ae=""+(ab.getMonth()+1),af=""+(ab.getDate()),ad=""+(ab.getHours()),ac=""+(ab.getMinutes()),ak=""+(ab.getSeconds()),ai=ah+"-"+Y(ae)+"-"+Y(af),aj=" "+Y(ad)+":"+Y(ac)+":"+Y(ak);
return aa?ai:(ai+aj);}else{return ab;}};return{format:Z,formatDate:function(ac){var ah=ac.getMonth()+1;var aj=new String(ah);if(aj.length==1){aj="0"+aj;}var ae=ac.getDate();var ai=new String(ae);if(ai.length==1){ai="0"+ai;
}var af=ac.getHours();var ak=new String(af);if(ak.length==1){ak="0"+ak;}var aa=ac.getMinutes();var ad=new String(aa);if(ad.length==1){ad="0"+ad;}var ab=ac.getSeconds();var ag=new String(ab);if(ag.length==1){ag="0"+ag;
}return ac.getFullYear()+"-"+aj+"-"+ai+" "+ak+":"+ad+":"+ag;},getDateFromString:function(ak,ah){if(!ak){return null;}var al;if(typeof ak=="number"){al=new Date(ak);}else{var aa=ak.split(" ");var ab=aa[0].split("-");
var ai=parseInt(ab[0],10);var ag=parseInt(ab[1],10)-1;var ac=parseInt(ab[2],10);var ad="";var ae="";var af="";if(aa[1]!=null&&aa[1]!=undefined){var aj=aa[1].split(":");ad=parseInt(aj[0],10);ae=parseInt(aj[1],10);
af=parseInt(aj[2],10);}if(ah&&ah==1){al=new Date(ai,ag,ac);}else{al=new Date(ai,ag,ac,ad,ae,af);}}return al;},getFirstDayAfterPeriod:function(){var ab=dojo.global.$appContext$.requestParam.today;var aa=this.getDateFromString(ab,1);
aa.setDate(1);return this.getDateFromString(this.format(aa.setMonth(aa.getMonth()+parseInt(1,10))));},getStringFirstDayOFNextMonth:function(){var ab=dojo.global.$appContext$.requestParam.today;var aa=this.getDateFromString(ab,1);
aa.setDate(1);return this.format(aa.setMonth(aa.getMonth()+parseInt(1,10)));},getPreTimeOfTargetTime:function(ae,ac){var aa=this.getDateFromString(ae);var ad=aa.getTime();var ab=parseInt(ac,10)*1000*3600*24;
return this.format(ad-ab);},compareDateValue:function(ab,aa){if(this.getDateFromString(ab,true)>this.getDateFromString(aa,true)){return true;}return false;},computationOfferStandardTime:function(ac,aa,ad){var ae=null;
ac=this.getDateFromString(ac);var ab=this.format(ac);if(aa==N.yearType){ae=ac.setYear(ac.getFullYear()+parseInt(ad,10));}else{if(aa==N.halfYearType){ae=ac.setMonth(ac.getMonth()+parseInt(ad*6,10));}else{if(aa==N.quarterType){ae=ac.setMonth(ac.getMonth()+parseInt(ad*3,10));
}else{throw new error("系统不支持当前的协议期类型");}}}return{currentTimeString:ab,timeString:this.format(ae)};}};}();var X=dojo.declare("",[],{pages:["mainProdOfferSelectPane","prodOfferAcceptPane"],currentPageId:null,enableFlag:true,disable:function(){this.enableFlag=false;
},enable:function(){this.enableFlag=true;},to:function(Z){var Y=this;if(!this.enableFlag){return BusCard.util.emptyFunction;}dojo.forEach(this.pages,function(ab){var ac=dojo.byId(ab);if(ac&&ac.style.display!="none"){ac.style.display="none";
}});var aa=dojo.byId(Z);this.currentPageId=Z;if(aa){aa.style.display="block";}return function(ab){if(Y.currentPageId=="mainProdOfferSelectPane"){dojo.byId("scrollController").style.display="none";changeStep(2);
}else{if(Y.currentPageId=="prodOfferAcceptPane"){dojo.byId("scrollController").style.display="block";changeStep(3);}}return ab.apply(this,[Y.currentPageId,aa]);};}});var r=function(){var Y=function(){dojo.require("unieap.dialog.Dialog");
var Z=unieap.dialog.Dialog.prototype._postCreate_ex;unieap.dialog.Dialog.prototype._postCreate_ex=function(){var aa=Z.apply(this,arguments);this.topContentNode.style.width="98%";this.topContentNode.style.styleFloat=this.topContentNode.style.cssFloat="right";
return aa;};return new unieap.dialog.Dialog(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);};return{createDialog:Y};}();orderaccept.prodofferaccept.util.ACTION_CD_CONST=p;
orderaccept.prodofferaccept.util.ProdOfferHelper=O;orderaccept.prodofferaccept.util.DateHelper=A;orderaccept.prodofferaccept.util.WidgetProvider=o;orderaccept.prodofferaccept.util.ServiceFactory=H;orderaccept.prodofferaccept.util.CommUtils=C;
orderaccept.prodofferaccept.util.ProdOfferInstProvider=c;orderaccept.prodofferaccept.util.RES_RELA_CONST=t;orderaccept.prodofferaccept.util.ServiceKindPrefixMap=L;orderaccept.prodofferaccept.util.ServiceKindCounter=u;
orderaccept.prodofferaccept.util.ProdOfferOrderCounter=D;orderaccept.prodofferaccept.util.PRODOFFERTYPE=J;orderaccept.prodofferaccept.util.orderTypeObj=E;orderaccept.prodofferaccept.util.AttrUtil=g;orderaccept.prodofferaccept.util.PRODUCTTYPE=e;
orderaccept.prodofferaccept.util.SetAttrInst=j;orderaccept.prodofferaccept.util.initProdAttrInst=i;orderaccept.prodofferaccept.util.DomHelper=I;orderaccept.prodofferaccept.util.OrderChangeProdvider=W;orderaccept.prodofferaccept.util.CustOrderVOHelper=R;
orderaccept.prodofferaccept.util.T2ProdOfferConst=K;orderaccept.prodofferaccept.util.RoamProdConst=T;orderaccept.prodofferaccept.util.MainProdOfferChangeHelper=S;orderaccept.prodofferaccept.util.bindTypeMap=b;
orderaccept.prodofferaccept.util.DateHelper=A;orderaccept.prodofferaccept.util.actionNameMap=P;orderaccept.prodofferaccept.util.OperKindConst=q;orderaccept.prodofferaccept.util.SpecAttrCdConst=U;orderaccept.prodofferaccept.util.OfferStandardAttrId=n;
orderaccept.prodofferaccept.util.WaitingBar=M;orderaccept.prodofferaccept.util.AcceptCheckCount=m;orderaccept.prodofferaccept.util.MainAuxiliaryCardRoleCDS=y;orderaccept.prodofferaccept.util.navigatorManager=new X();
orderaccept.prodofferaccept.util.WidgetHelper=r;orderaccept.prodofferaccept.util.AttrUnitConst=f;orderaccept.prodofferaccept.util.SpeedAttrArray=h;});
defineModule("orderaccept.prodofferaccept.builder.date.DateBuilderFactory",["../../util"],function(b){var d="orderaccept.prodofferaccept.builder.date.";dojo.declare(d+"sharedProdOfferInstallDateBuilder",[],{custOrderAcceptInfoVO:null,constructor:function(g){this.custOrderAcceptInfoVO=g;
},build:function(){f(this.custOrderAcceptInfoVO);}});dojo.declare(d+"independenceProdOfferInstallDateBuilder",[],{custOrderAcceptInfoVO:null,constructor:function(g){this.custOrderAcceptInfoVO=g;},build:function(){f(this.custOrderAcceptInfoVO);
}});dojo.declare(d+"subProdOfferChangeDateBuilder",[],{custOrderAcceptInfoVO:null,constructor:function(g){this.custOrderAcceptInfoVO=g;},build:function(){f(this.custOrderAcceptInfoVO);}});dojo.declare(d+"sharedMemberChangeDateBuilder",[],{custOrderAcceptInfoVO:null,constructor:function(g){this.custOrderAcceptInfoVO=g;
},build:function(){f(this.custOrderAcceptInfoVO);}});dojo.declare(d+"independenceMemberChangeDateBuilder",[],{custOrderAcceptInfoVO:null,constructor:function(g){this.custOrderAcceptInfoVO=g;},build:function(){f(this.custOrderAcceptInfoVO);
}});dojo.declare(d+"single2singleDateBuilder",[],{custOrderAcceptInfoVO:null,constructor:function(g){this.custOrderAcceptInfoVO=g;},build:function(){f(this.custOrderAcceptInfoVO);}});dojo.declare(d+"single2combDateBuilder",[],{custOrderAcceptInfoVO:null,constructor:function(g){this.custOrderAcceptInfoVO=g;
},build:function(){f(this.custOrderAcceptInfoVO);}});dojo.declare(d+"single2independenceDateBuilder",[],{custOrderAcceptInfoVO:null,constructor:function(g){this.custOrderAcceptInfoVO=g;},build:function(){f(this.custOrderAcceptInfoVO);
}});dojo.declare(d+"independence2independenceDateBuilder",[],{custOrderAcceptInfoVO:null,constructor:function(g){this.custOrderAcceptInfoVO=g;},build:function(){f(this.custOrderAcceptInfoVO);}});orderaccept.prodofferaccept.builder.date.DateBuilderFactory.getInstance=function(g){var h=$ac$.get("processId");
return new orderaccept.prodofferaccept.builder.date[h+"DateBuilder"](g);};var f=function(h){var g=[];dojo.forEach(h.orderAcceptInfoList||[],function(i){dojo.forEach(i.prodOfferAcceptInfoList||[],function(l){if(l.prodOfferType==1){var k=l.accessProdAcceptInfoList;
var j=[];dojo.forEach(k||[],function(m){var n=e(l,m);if(n!=null){g.push(n);j.push(n);}dojo.forEach(m.prodInstAttrList||[],function(o){if(m.operKind==b.OperKindConst.chgOperKind){if(o.operKind==b.OperKindConst.chgOperKind){o.effDate=dojo.global.$appContext$.requestParam.today;
}}});});if(j.length>0){if(l.operKind==b.OperKindConst.delOperKind){l.expDate=b.DateHelper.formatDate(j.max());}else{l.effDate=b.DateHelper.formatDate(j.max());}if(l.operKind!=b.OperKindConst.delOperKind){dojo.forEach(l.offerInstAttrList||[],function(m){m.effDate=b.DateHelper.formatDate(j.max());
});}dojo.forEach(l.accessProdAcceptInfoList||[],function(m){if(m.operKind==b.OperKindConst.delOperKind){m.expDate=b.DateHelper.formatDate(j.max());}else{if(m.operKind==b.OperKindConst.chgOperKind){}else{if(m.operKind==b.OperKindConst.addOperKind){m.effDate=b.DateHelper.formatDate(j.max());
}}}dojo.forEach(m.prodInstAttrList||[],function(n){if(m.operKind==b.OperKindConst.delOperKind){n.expDate=b.DateHelper.formatDate(j.max());}else{if(m.operKind==b.OperKindConst.chgOperKind){if(n.operKind==b.OperKindConst.chgOperKind){n.effDate=dojo.global.$appContext$.requestParam.today;
}}else{if(m.operKind==b.OperKindConst.addOperKind){n.effDate=b.DateHelper.formatDate(j.max());}}}});});dojo.forEach(l.serviceProdAcceptInfoList||[],function(m){c(l,m);dojo.forEach(m.prodInstAttrList||[],function(n){if(m.operKind==b.OperKindConst.delOperKind){n.expDate=m.expDate;
}else{if(m.operKind==b.OperKindConst.chgOperKind){if(n.operKind==b.OperKindConst.chgOperKind){n.effDate=dojo.global.$appContext$.requestParam.today;}}else{if(m.operKind==b.OperKindConst.addOperKind){n.effDate=m.effDate;
}}}});});}}});dojo.forEach(i.prodOfferAcceptInfoList||[],function(j){if(j.prodOfferType==1&&j.accessProdAcceptInfoList&&j.accessProdAcceptInfoList.length==0&&j.operKind==1){if(b.ProdOfferHelper.getIfMemberChg()){j.effDate=b.DateHelper.formatDate(b.DateHelper.getFirstDayAfterPeriod());
}g.push(b.DateHelper.getDateFromString(j.effDate));j.effDate=b.DateHelper.formatDate(g.max());dojo.forEach(j.offerInstAttrList||[],function(k){k.effDate=j.effDate;});dojo.forEach(j.accessProdAcceptInfoList||[],function(k){k.effDate=j.effDate;
dojo.forEach(k.prodInstAttrList||[],function(l){l.effDate=k.effDate;});});dojo.forEach(j.serviceProdAcceptInfoList||[],function(k){c(j,k);dojo.forEach(k.prodInstAttrList||[],function(l){l.effDate=k.effDate;
});});}if(j.prodOfferType==1&&j.accessProdAcceptInfoList&&j.accessProdAcceptInfoList.length==0&&j.operKind==3){if(b.ProdOfferHelper.getIfAllQuit()){j.expDate=dojo.global.$appContext$.requestParam.today;
}else{j.expDate=b.DateHelper.formatDate(b.DateHelper.getFirstDayAfterPeriod());}}});});a(h);};var c=function(h,g){if(h.operKind==2){if(g.operKind==1){g.effDate=dojo.global.$appContext$.requestParam.today;
g.expDate="2037-01-01 00:00:00";}else{if(g.operKind==3){g.expDate=dojo.global.$appContext$.requestParam.today;g.effDate=g.beginRentTime;}else{if(g.operKind==2){g.effDate=g.beginRentTime;g.expDate=g.stopRentTime;
}}}}else{if(h.operKind==1){if(g.operKind==2){g.effDate=g.beginRentTime;g.expDate=g.stopRentTime;}else{g.effDate=h.effDate;g.expDate=h.expDate;}}}};var e=function(j,g){var i=null;var h=dojo.global.$appContext$.requestParam.today;
if(g.operKind==b.OperKindConst.addOperKind){if(j.operKind==b.OperKindConst.addOperKind){i=b.DateHelper.getDateFromString(h);}else{if(j.operKind==b.OperKindConst.chgOperKind){i=b.DateHelper.getDateFromString(h);
}}}else{if(g.operKind==b.OperKindConst.delOperKind){if(j.operKind==b.OperKindConst.delOperKind){i=b.DateHelper.getDateFromString(h);}}else{if(g.operKind==b.OperKindConst.chgOperKind){if(j.operKind==b.OperKindConst.addOperKind){i=b.DateHelper.getFirstDayAfterPeriod();
}else{if(j.operKind==b.OperKindConst.chgOperKind){}else{if(j.operKind==b.OperKindConst.delOperKind){i=b.DateHelper.getFirstDayAfterPeriod();}}}}}}return i;};var a=function(i){var g=$ac$.get("selectedMemberProdOfferList");
var h=dojo.filter(g||[],function(l){return(!!l.offerInstVO)&&(l.offerInstVO.prodOfferId!=l.prodOfferId)&&(!!l.offerInstVO.offerStandardInstList&&l.offerInstVO.offerStandardInstList.length>0)&&(l.action!="quit");
});var k=i.orderAcceptInfoList;var j=k[0].prodOfferAcceptInfoList;dojo.forEach(h||[],function(l){var p=l.uniqueId;var n=BusCard.find(j||[],function(q){return q.uniqueId==p;});if(!!n){if($ac$.get("offerStandardStartDate_"+l.offerInstVO.prodOfferInstId)){var o=$ac$.get("offerStandardStartDate_"+l.offerInstVO.prodOfferInstId);
n.effDate=o.beginDate;dojo.forEach(n.offerInstAttrList||[],function(q){q.effDate=o.beginDate;});var m=BusCard.find(j||[],function(q){return q.prodOfferInstId==l.offerInstVO.prodOfferInstId;});(!!m)?(m.expDate=o.oldOfferEndDate):null;
}}});};});
defineModule("orderaccept.prodofferaccept.main",["orderaccept.prodofferaccept.util","orderaccept.prodofferaccept.loader"],function(c,a){var b=c.ACTION_CD_CONST,d={};d[b.PRODUCT_INSTALL]=a.loadProdOfferNewLoader;
d[b.PRODUCT_CHANGE]=a.loadProdOfferChangeLoader;d[b.PRODUCT_CHANGE_MAIN]=a.loadMainProdOfferChangeLoader;d[b.PRODOFFER_CANCEL_ACTION]=a.loadProdOfferCancelLoader;d[b.PROTOCOL_ACCEPT]=a.loadProdOfferProtocolAcceptLoader;
d[b.SHOPPING_CART_ACCEPT]=a.loadShoppingCartNewLoader;d[b.PROD_ADD]=a.loadProdAddLoader;d[b.PRE_ORDER_BACK]=a.loadPreOrderBackLoader;d[b.PROD_INTERCHANGE]=a.loadProdInterChangeLoader;d[b.PROMOTION_CHANGE]=a.loadPromotionChangeLoader;
d[b.MEMBER_OFFER_CHANGE]=a.loadMemberOfferChangeLoader;d[b.CHANGE_ACCEPT]=a.loadProdChangeAcceptLoader;d[b.MEMBER_ORDER_GROUP_PRODUCT]=a.loadMemberOrderGroupProductLoader;d[b.PRODUCT_CHANGE_ACCEPT]=a.loadProductChangeAcceptLoader;
d[b.ORDER_CHANGE_ACCEPT]=a.loadOrderChangeLoader;d[b.PRE_ACCEPT]=a.loadPreAcceptOrderLoader;var e=function(f){dojo.ready(function(){(d[f.actionCD](f));});};orderaccept.prodofferaccept.main.dispatch=e;});

defineModule("orderaccept.custom._BaseWidget",["dijit._Widget"],function(a){dojo.declare("orderaccept.custom._BaseWidget",[a],{delayRendering:false,cardCallbackList:null,templateInput:null,cardParam:null,delayCreateBeforeBindModel:false,modelData:null,busCardInstance:null,cardListenerRegistry:null,postscript:function(){this.cardListenerRegistry=[];
if(this.delayCreateBeforeBindModel){this.generateModelId();this.delayRendering=(arguments[1]==null);this.bindModel(arguments[0]);this.generateView(arguments[1]);}else{this.inherited(arguments);}},generateModelId:function(){var b=this.constructor.$modelIdSuffix$;
if(b==null){this.constructor.$modelIdSuffix$=0;}this.$modelId$=this.declaredClass+"_"+(this.constructor.$modelIdSuffix$++);},bindModel:function(b){dojo.global.$widgetModelContext$.set(this.$modelId$,b);
return this;},getModel:function(){return dojo.global.$widgetModelContext$.get(this.$modelId$);},generateView:function(b){this.create({},b);},query:function(){return dojo.query(arguments[0],this.domNode);
},getPageData:function(){if(this.busCardInstance){return this.busCardInstance.getData.apply(this.busCardInstance,arguments);}else{var b={},e=dojo._toArray(dojo.query("INPUT",this.domNode)),d=dojo._toArray(dojo.query("SELECT",this.domNode)),f=dojo._toArray(dojo.query("TEXTAREA",this.domNode));
var c=[].concat(e,d,f);dojo.forEach(c,function(i){var j=dojo.attr("id")||dojo.attr("name");if(j){var g=i.tagName.toUpperCase();switch(g){case"SELECT":case"TEXTARE":b[j]=i.value;break;case INPUT:var h=dojo.attr("type");
if(h.toUpperCase()=="TEXT"||h.toUpperCase()=="PASSWORD"){b[j]=i.value;}else{if(h.toUpperCase()=="CHECKBOX"||h.toUpperCase()=="RADIO"){if(i.checked){b[j]="1";}else{b[j]="0";}}}}}});return b;}},buildViewInitData:function(){},elementclick:function(){if(!BusCard.checkHaveOMRight(arguments[0].currentTarget)){dojo.require("orderaccept.common.dialog.MessageBox");
orderaccept.common.dialog.MessageBox.alert({message:BusCard.NO_OM_RIGHT_MSG});return false;}var b=Array.prototype.slice.apply(arguments);b.push("click");this._publishEventTopic.apply(this,b);},_publishEventTopic:function(){var e=arguments[0],b=arguments[arguments.length-1],d=e.currentTarget;
if(!d||d===window){return;}var f=(d.getAttribute("dojoAttachTopic")||(!!d.getAttribute("controlFieldName")?("/buscard/"+d.getAttribute("controlFieldName")):null))||"/"+d.tagName.toLowerCase(),c=f.lastIndexOf("/")==f.length-1?f+b:f+"/"+b;
dojo.publish(c,[e]);},elementfocus:function(){var b=Array.prototype.slice.apply(arguments);b.push("focus");this._publishEventTopic.apply(this,b);},elementblur:function(){var b=Array.prototype.slice.apply(arguments);
b.push("blur");this._publishEventTopic.apply(this,b);},elementmouseover:function(){var b=Array.prototype.slice.apply(arguments);b.push("mouseover");this._publishEventTopic.apply(this,b);},elementmouseout:function(){var b=Array.prototype.slice.apply(arguments);
b.push("mouseout");this._publishEventTopic.apply(this,b);},elementchange:function(){var b=Array.prototype.slice.apply(arguments);b.push("change");this._publishEventTopic.apply(this,b);},elementpropertychange:function(){var b=Array.prototype.slice.apply(arguments);
b.push("propertychange");var c=b[0];if(c&&c.propertyName!="value"){return false;}this._publishEventTopic.apply(this,b);},elementkeyup:function(){var b=Array.prototype.slice.apply(arguments);b.push("keyup");
this._publishEventTopic.apply(this,b);},elementdblclick:function(){var b=Array.prototype.slice.apply(arguments);b.push("dblclick");this._publishEventTopic.apply(this,b);},elementkeydown:function(){var b=Array.prototype.slice.apply(arguments);
b.push("keydown");this._publishEventTopic.apply(this,b);},enableEvtMsgPropagation:function(d){var b=this;if(d&&d.nodeType==1){var c=BusCard.query("[dojoAttachEvent]",d);dojo.forEach(c,function(f){var g=f.getAttribute("dojoAttachEvent");
if(g){var e=g.split(",");dojo.forEach(e,function(i){var h=i.split(":"),k=h[0],j=h[1];b.connect(f,k,j);});}});}},enableTitle:function(b){if(b&&b.tagName&&b.tagName.toUpperCase()=="SELECT"){var c=b.options||[];
dojo.forEach(c,function(d){d.title=d.text;});}},postRenderingHandle:function(){},postCreate:function(){var b=this;this.inherited(arguments);if(this.busCardInstance){this.busCardInstance.addEventListener("onrender",function(){b.postRenderingHandle.apply(b,arguments);
});}if(this.domNode&&!this.delayRendering){if(this.busCardInstance){this.busCardInstance.init(function(){var d=arguments,c=b;b._attachEventForCardElem(this.dom);b.execCQ(c,d);});}}dojo.forEach(dojo.query("select",this.domNode),function(c){b.enableTitle(c);
});},execCQ:function(b,c){dojo.forEach(this.cardCallbackList,function(d){d.apply(b,c);});},renderCard:function(d,c,e){var b=this;if(this.busCardInstance&&!this.busCardInstance.isLoaded()){dojo.place(this.domNode,d,c);
}this.busCardInstance.init(function(){var g=arguments,f=b;b._attachEventForCardElem(this.dom);b.execCQ(f,g);},null,e);},_attachEventForCardElem:function(d){var b=this;var c=[].concat(dojo._toArray(d.getElementsByTagName("SELECT"))).concat(dojo._toArray(d.getElementsByTagName("INPUT")));
dojo.forEach(c,function(g){var h=dojo.attr(g,"controlFieldName");if(!h){return;}var e=g.tagName.toUpperCase();var f=(g.type||"").toUpperCase();if(e=="INPUT"){b.cardListenerRegistry.push(b.connect(g,"onclick","elementclick"));
}if(e=="INPUT"&&(f=="TEXT"||f=="PASSWORD")){b.cardListenerRegistry.push(b.connect(g,"onblur","elementblur"));b.cardListenerRegistry.push(b.connect(g,"onchange","elementchange"));b.cardListenerRegistry.push(b.connect(g,"onpropertychange","elementpropertychange"));
}if(e=="SELECT"){b.cardListenerRegistry.push(b.connect(g,"onchange","elementchange"));}});},connect:function(){var c=dojo._toArray(arguments);c[2]=dojo.hitch(this,c[2]);var b=dojo.connect.apply(dojo,c);
return b;},addCardCallback:function(){if(this.cardCallbackList==null){this.cardCallbackList=[];}var c=Array.prototype,b=c.slice.apply(arguments),d=[];dojo.forEach(b,function(e){if(dojo.isFunction(e)){d.push(e);
}else{if(dojo.isArray(e)){c.push.apply(d,dojo.filter(e,function(f){return !!dojo.isFunction(f);}));}}});c.push.apply(this.cardCallbackList,d);},destroy:function(){if(this.busCardInstance&&this.busCardInstance.isLoaded()){try{this.busCardInstance.destroy();
delete this.busCardInstance();}catch(b){}}if(this.$modelId$){try{dojo.global.$widgetModelContext$.set(this.$modelId$,null);}catch(b){}}try{dojo.forEach(this.cardListenerRegistry,function(c){dojo.disconnect(c);
});}catch(b){}this.inherited(arguments);},toString:function(){return this.declaredClass;}});});
defineModule("orderaccept.custom._BusCardTemplated",["dijit._Widget","dojo.string","dojo.parser","dojo.cache"],function(){dojo.declare("orderaccept.custom._BusCardTemplated",null,{templateString:null,templatePath:null,widgetsInTemplate:false,_skipNodeCache:false,_earlyTemplatedStartup:false,_stringRepl:function(a){var b=this.declaredClass,c=this;
return BusCard.Template.create(a).apply(this.templateInput||this);},buildRendering:function(){this._attachPoints=[];var c=orderaccept.custom._BusCardTemplated.getCachedTemplate(this.templatePath,this.templateString,this._skipNodeCache);
var e;if(dojo.isString(c)){var f=this._stringRepl(c);if(/<card(.*?)<\/card>$/i.test(f)){e=dojo.create("div");this.busCardInstance=BusCard.createInstance(this.cardParam||{},e,{gType:3,xmlData:c});}else{if(/^buscard\:\/\/www\.crm1\.com$/i.test(f)){e=dojo.create("div");
this.busCardInstance=BusCard.createInstance(this.cardParam||{},e,(this.cardParam||{}).cardMetaData);}else{e=dojo._toDom(f);}}if(e.nodeType!=1){throw new Error("Invalid template: "+c);}}else{e=c.cloneNode(true);
}this.domNode=e;this._attachTemplateNodes(e);if(this.widgetsInTemplate){var g=dojo.parser,d,a;if(g._query!="[dojoType]"){d=g._query;a=g._attrName;g._query="[dojoType]";g._attrName="dojoType";}var b=(this._startupWidgets=dojo.parser.parse(e,{noStart:!this._earlyTemplatedStartup}));
if(d){g._query=d;g._attrName=a;}this._supportingWidgets=dijit.findWidgets(e);this._attachTemplateNodes(b,function(i,h){return i[h];});}this._fillContent(this.srcNodeRef);},_fillContent:function(b){var a=this.containerNode;
if(b&&a){while(b.hasChildNodes()){a.appendChild(b.firstChild);}}},_attachTemplateNodes:function(d,g){g=g||function(r,q){return r.getAttribute(q);};var b=dojo.isArray(d)?d:(d.all||d.getElementsByTagName("*"));
var k=dojo.isArray(d)?0:-1;for(;k<b.length;k++){var c=(k==-1)?d:b[k];if(this.widgetsInTemplate&&g(c,"dojoType")){continue;}var e=g(c,"dojoAttachPoint");if(e){var l,n=e.split(/\s*,\s*/);while((l=n.shift())){if(dojo.isArray(this[l])){this[l].push(c);
}else{this[l]=c;}this._attachPoints.push(l);}}var j=g(c,"dojoAttachEvent");if(j){var a,o=j.split(/\s*,\s*/);var f=dojo.trim;while((a=o.shift())){if(a){var h=null;if(a.indexOf(":")!=-1){var p=a.split(":");
a=f(p[0]);h=f(p[1]);}else{a=f(a);}if(!h){h=a;}this.connect(c,a,h);}}}var i=g(c,"waiRole");if(i){dijit.setWaiRole(c,i);}var m=g(c,"waiState");if(m){dojo.forEach(m.split(/\s*,\s*/),function(r){if(r.indexOf("-")!=-1){var q=r.split("-");
dijit.setWaiState(c,q[0],q[1]);}});}}},startup:function(){dojo.forEach(this._startupWidgets,function(a){if(a&&!a._started&&a.startup){a.startup();}});this.inherited(arguments);},destroyRendering:function(){dojo.forEach(this._attachPoints,function(a){delete this[a];
},this);this._attachPoints=[];this.inherited(arguments);}});orderaccept.custom._BusCardTemplated._templateCache={};orderaccept.custom._BusCardTemplated.getCachedTemplate=function(h,g,d){var j=orderaccept.custom._BusCardTemplated._templateCache;
var i=g||h;var c=j[i];if(c){try{if(!c.ownerDocument||c.ownerDocument==dojo.doc){return c;}}catch(f){}dojo.destroy(c);}if(!g){g=dojo.cache(h,{sanitize:true});}g=dojo.string.trim(g);var a=function(){var k=dojo.string.trim(g.replace(/\r|\n/g,""));
var e=/<card(.*?)<\/card>$/i.test(k)||/^buscard\:\/\/www\.crm1\.com$/i.test(k);if(e){g=k;}return e;};if(a()){return g;}if(d||g.match(/[#\$]?\{([^\}]+)\}/g)){return(j[i]=g);}else{var b=dojo._toDom(g);if(b.nodeType!=1){throw new Error("Invalid template: "+g);
}return(j[i]=b);}};if(dojo.isIE){dojo.addOnWindowUnload(function(){var a=dijit._Templated._templateCache;for(var b in a){var c=a[b];if(typeof c=="object"){dojo.destroy(c);}delete a[b];}});}dojo.extend(dijit._Widget,{dojoAttachEvent:"",dojoAttachPoint:"",waiRole:"",waiState:""});
});
defineModule("orderaccept.prodofferaccept.widget.servicecard.ServiceCardWidget",["../../../custom/_BaseWidget","../../../custom/_BusCardTemplated","dijit._Contained"],function(c,b,a){dojo.declare("orderaccept.prodofferaccept.widget.servicecard.ServiceCardWidget",[c,b,a],{delayCreateBeforeBindModel:true,templateString:"buscard://www.crm1.com",attrCardWidget:null,postMixInProperties:function(){var d=this.getModel();
this.cardParam=d.cardParam;this.metaData=d.metaData;this.id=this.metaData.id;},destroy:function(){if(this.attrCardWidget){this.attrCardWidget.destroy();}this.inherited(arguments);},completeRequiredState:function(){var l=this.busCardInstance,m=this.busCardInstance.getChildren()[0],h=dojo.query("[isnull=0]",l.dom)||[],i=[];
if(m){i=dojo.query("[isnull=0]",m.dom)||[];}var d=dojo.some([].concat(h).concat(i),function(p){var o=(p.type||"").toUpperCase();return !p.value&&!(o=="RADIO"||o=="CHECKBOX");});var g=l.getCardRelationInfo().uniqueId;
if(g){var j=dojo.query("TR[uniqueId="+g+"]")[0];var e=dojo.query(".complete-flag-div",j)[0];if(e){var f=dojo.query(".complete-init-flag",e)[0];var k=dojo.query(".complete-flag-span",e)[0];var n=dojo.query(".complete-flag-img",e)[0];
f&&(f.style.display="none");if(d){k.style.display="";n.style.display="none";}else{k.style.display="none";n.style.display="";}}}},getPageData:function(){var d=this.inherited(arguments),h=null,f=null;if(d===false){return false;
}if(this.attrCardWidget){h=this.attrCardWidget.getPageData.apply(this.attrCardWidget,arguments);}if(h===false){return false;}var i=dojo.query("[groupId=1002]",this.domNode);dojo.forEach(i,function(k){var j=k.getAttribute("controlfieldname");
if(j==null||j==""){return;}if(!!d&&!!d[j]){f=!!f?f:{};f[j]=d[j];delete d[j];return;}if(!!h&&!!h[j]){f=!!f?f:{};f[j]=h[j];delete h[j];return;}});var g=this.cardParam;for(var e in g){if(g.hasOwnProperty(e)){if(!d[e]){d[e]=g[e];
}}}return{serviceInfo:d,prodAttrInfo:h,assureInfo:f};}});});
defineModule("orderaccept.prodofferaccept.widget.resourcecard.ResourceCardWidget",["../../../custom/_BaseWidget","../../../custom/_BusCardTemplated"],function(b,a){dojo.declare("orderaccept.prodofferaccept.widget.resourcecard.ResourceCardWidget",[b,a],{delayCreateBeforeBindModel:true,templateString:"buscard://www.crm1.com",attrCardWidget:null,postMixInProperties:function(){var c=this.getModel();
this.cardParam=c;},destroy:function(){if(this.attrCardWidget){this.attrCardWidget.destroy();}this.inherited(arguments);}});});
defineModule("orderaccept.prodofferaccept.widget.attrcard.ProductAttrCardWidget",["../../../custom/_BaseWidget","../../../custom/_BusCardTemplated","dijit._Contained","orderaccept.prodofferaccept.util","orderaccept.common.js.ConstantsPool"],function(e,d,b,a,c){dojo.declare("orderaccept.prodofferaccept.widget.attrcard.ProductAttrCardWidget",[e,d,b],{delayCreateBeforeBindModel:true,needRendering:true,convertTemplate:"<tp:for ds=list><tp:if $$.valueShowType=='text'><attr colspan='1' id='#{$$.attrCd}' cType='1' label='#{$$.attrName}' isNull = '${$$.nullable?1:0}' title='#{$$.attrDesc}' disabled=\"#{$$.isReadOnly =='0'?0:1}\"/></tp:if><tp:if $$.valueShowType=='select'><attr colspan='1' id='#{$$.attrCd}' cType='2' label='#{$$.attrName}' isNull = '${$$.nullable?1:0}' title='#{$$.attrDesc}' disabled=\"#{$$.isReadOnly =='0'?0:1}\"/></tp:if><tp:if $$.valueShowType=='checkbox'><attr colspan='1' id='#{$$.attrCd}' cType='3' label='#{$$.attrName}' isNull = '${$$.nullable?1:0}' title='#{$$.attrDesc}' disabled=\"#{$$.isReadOnly =='0'?0:1}\"/></tp:if><tp:if $$.valueShowType=='radiobox'><attr colspan='1' id='#{$$.attrCd}' cType='13' label='#{$$.attrName}' isNull = '${$$.nullable?1:0}' title='#{$$.attrDesc}' disabled=\"#{$$.isReadOnly =='0'?0:1}\"/></tp:if><tp:if $$.valueShowType=='date'><attr colspan='1' id='#{$$.attrCd}' cType='4' label='#{$$.attrName}' isNull = '${$$.nullable?1:0}' title='#{$$.attrDesc}' disabled=\"#{$$.isReadOnly =='0'?0:1}\"/></tp:if><tp:if $$.valueShowType=='pwd'><attr colspan='1' id='#{$$.attrCd}' cType='8' label='#{$$.attrName}' isNull = '${$$.nullable?1:0}' title='#{$$.attrDesc}' disabled=\"#{$$.isReadOnly =='0'?0:1}\"/></tp:if><tp:if $$.valueShowType=='textarea'><attr colspan='4' id='#{$$.attrCd}' cType='14' label='#{$$.attrName}' isNull = '${$$.nullable?1:0}' title='#{$$.attrDesc}' disabled=\"#{$$.isReadOnly =='0'?0:1}\"/></tp:if><tp:if $$.valueShowType=='page'><attr colspan='1' id='#{$$.attrCd}' cType='10' label='#{$$.attrName}' isNull = '${$$.nullable?1:0}' title='#{$$.attrDesc}' disabled=\"#{$$.isReadOnly =='0'?0:1}\"/></tp:if><tp:if $$.valueShowType=='comboBox'><attr colspan='1' id='#{$$.attrCd}' cType='11' label='#{$$.attrName}' isNull = '${$$.nullable?1:0}' title='#{$$.attrDesc}' disabled=\"#{$$.isReadOnly =='0'?0:1}\"/></tp:if></tp:for>",NOOP:function(){},isAccessProduct:null,busCardInstance:null,productAttrLink:"<subGroup id='productAttr' name='产品基本属性'>",prodcutAttrMoreLink:"<subGroup id='productAttrMore' name='产品扩展属性'>",productServiceRelVO:null,attrUseConfigList:null,attrControlSpecialList:null,postMixInProperties:function(){var i=this.getModel(),l=this,g=2,h=c.load(["ProductFuncTypeConst"]).ProductFuncTypeConst.ACCESS;
l.productInfoVO=i.productInfoVO;l.prodOfferInfoVO=i.prodOfferInfoVO;l.prodInstVO=i.prodInstVO;if(l.productInfoVO.prodFuncType==h){this.isAccessProduct=true;g=4;this.findAndSetProdInstVO(i.uniqueId);}var k="<?xml version='1.0' encoding='UTF-8'?>								<card id='${cardId}'  cardType='0' name='属性信息' pageColumn='${$$.pageColumn?$$.pageColumn:2}' xmlns='http://www.crm1.com/buscard'><metaData>				             	 ${productAttrList}				             	 </metaData>${resource}</card>",m="prodAttr_"+l.productInfoVO.productId,f="";
if(this.checkIfNeedRendering(l.productInfoVO.attrList)){this.loadAndSetAttrConfigData();var j=this.prodAttrList2xml(l.productInfoVO.attrList,this.productAttrLink,this.prodcutAttrMoreLink);f=BusCard.Template.create(k).apply({cardId:m,pageColumn:g,productAttrList:j,resource:this.buildBusCardResource()});
this.templateString=f;}else{this.buildRendering=this.NOOP;this.postCreate=this.NOOP;}},postRenderingHandle:function(){var f=this;f.initProductAttr(this.busCardInstance);f.initProdSelect(this.busCardInstance);
f.initLength();f.initDisplayElement();f.initSpecialValueByAttrCode();f.renderDefaultValue();f.initAttrDisabled();f.initProdAttrInst();f.bindUpdateEventForExprAttr();this.busCardInstance.addEventListener("oncomplete",function(){f.completeRequiredState();
});if(f.isAccessProduct){f.executeSpecConfig(f.productServiceRelVO,f.attrControlSpecialList);}},findAndSetProdInstVO:function(h){var g=dojo.filter($ac$.get("selectedMemberProdOfferList"),function(i){return i.uniqueId==h;
})[0];var f=g?g.prodInstVO:null;if(!this.prodInstVO){this.prodInstVO=f;}},getCard:function(){return this.busCardInstance;},initProductAttr:function(l){var k=this;var j=function(n){return l.$(n);};var h=j("subgroup_productAttrMore");
if(h){l.hiddenSubGroup(h);var f=l.getHeader(),i=BusCard.path.contextPath+"/common/images/icon/arrow_title_up.png",m=BusCard.path.contextPath+"/common/images/icon/arrow_title_down.png",g="<img class='more-info-icon' src='#{src}' style='float:right'></img><a class='more-info-href' style='float:right' href = '#'  style='float:right'>更多信息</a>";
dojo.place(BusCard.Template.create(g).apply({src:m}),f,"last");dojo.connect(BusCard.query(".more-info-href",f)[0],"onclick",function(o){o.preventDefault();var n=BusCard.query(".more-info-icon",f)[0];if(/title_dow/.test(n.src)){n.src=i;
l.displaySubGroup(h);}else{n.src=m;l.hiddenSubGroup(h);}});}},completeRequiredState:function(){var n=this.busCardInstance.getParent();attrCard=this.busCardInstance;if(this.isAccessProduct&&n){var j=dojo.query("[isnull=0]",n.dom)||[];
var k=dojo.query("[isnull=0]",attrCard.dom)||[];var f=dojo.some([].concat(j).concat(k),function(q){var p=(q.type||"").toUpperCase();return !q.value&&!(p=="RADIO"||p=="CHECKBOX");});var h=n.getCardRelationInfo().uniqueId;
if(h){var l=dojo.query("TR[uniqueId="+h+"]")[0];var g=dojo.query(".complete-flag-div",l)[0];if(g){var i=dojo.query(".complete-init-flag",g)[0];var m=dojo.query(".complete-flag-span",g)[0];var o=dojo.query(".complete-flag-img",g)[0];
i&&(i.style.display="none");if(f){m.style.display="";o.style.display="none";}else{m.style.display="none";o.style.display="";}}}}},postCreate:function(){var f=this;this.inherited(arguments);},checkIfNeedRendering:function(f){return this.needRendering=!!(f!=null&&f.length>0);
},_sortAttrList:function(f){f=f||[];f.sort(function(h,g){var j=parseInt(""+(h.ifDisplay||0));var i=parseInt(""+(g.ifDisplay||0));if(j>i){return -1;}else{if(j<i){return 1;}else{if(h.nullable>g.nullable){return 1;
}else{if(h.nullable<g.nullable){return -1;}else{return 0;}}}}});},filterPricingParamAttr:function(h){var f=[],g=dojo.filter(h||[],function(i){var j=(i.pricingParamAttr&&i.pricingParamAttr!="0")||(i.isPricingParamAttr&&i.isPricingParamAttr!="0");
if(!j){f.push(i);}return j;});return{exclusiveList:f,includeList:g};},prodAttrList2xml:function(n,o,s){var l="",i=[],q=[],g=0,u=0;this._sortAttrList(n);if(n){if(n.length>8){for(var h in n){var r=n[h];if(!r.nullable||!!r.ifDirectlyDisplay){i[g]=r;
g++;}else{q[u]=r;u++;}}this._sortAttrList(i);this._sortAttrList(q);var w=this.convertTemplate,k=BusCard.Template.create(w),j="",m=this.convertTemplate,f=BusCard.Template.create(m);if(g>0){l="<attrList>"+o+k.apply({list:i})+"</subGroup>"+j+s+f.apply({list:q})+"</subGroup></attrList>";
}else{l="<attrList>"+s+f.apply({list:q})+"</subGroup></attrList>";}}else{var t=this.convertTemplate;var v=BusCard.Template.create(t);l="<attrList>"+v.apply({list:n})+"</attrList>";}}return l;},initProdSelect:function(){var f=this.getCard(),g=this.getModel().productInfoVO.attrList||[];
selectAttrList=BusCard.findAll(g,function(h){return(/select/i.test(h.valueShowType));});BusCard.each(selectAttrList,function(k){var i=k.attrValueList||[],j=BusCard.map(i,function(l){return{id:l.attrValue,name:l.attrValueName};
});var h=f.$(k.attrCd);if(j&&j.length>0){BusCard.$rs(h,j,true);}a.DomHelper.enableTitle(h);});},initLength:function(){var g=this.getCard(),f=this.getModel().productInfoVO.attrList||[];BusCard.each(f||[],function(i){var h=g.$(i.attrCd+"");
if(h&&i.attrLeng){h.maxLength=i.attrLeng;}});},initDisplayElement:function(g){var g=this.busCardInstance,j=this.getModel().productInfoVO.attrList||[];if(j!=null&&j.length>0){for(var h=0,f=j.length;h<f;
h++){var k=j[h];if(k.ifDisplay=="0"){g.hidden(k.attrCd+"");}}}},initSpecialValueByAttrCode:function(g){var g=this.busCardInstance,j=this.getModel().productInfoVO.attrList||[];if(j!=null&&j.length>0){for(var h=0,f=j.length;
h<f;h++){var k=j[h];if(k.attrValueCode=="L8"&&k.valueShowType=="text"){g.$(k.attrCd).value=a.AttrUtil.getRandomPassword();}if(k.attrValueCode=="E0"&&k.valueShowType=="text"){g.$(k.attrCd).onblur=function(){if(!a.AttrUtil.nas_email_check_sirp("【Email地址】",this,"")){this.value="";
this.focus();}};}if(k.attrValueCode=="L1"&&k.valueShowType=="text"){g.$(k.attrCd).onblur=function(){a.AttrUtil.checkNumberValue(this,k);};}}}},renderDefaultValue:function(){var f=this.getCard();f.renderDefaultValue(this.getDefaultValue());
},getDefaultValue:function(){var j=this.getModel().productInfoVO.attrList||[],h={};if(j!=null&&j.length>0){for(var g=0,f=j.length;g<f;g++){var k=j[g];if(k.defaultValue!=null){h[k.attrCd]=this.convertFeeAttrDefault(k);
}}}return h;},initAttrDisabled:function(){var i=this.getModel().productInfoVO.attrList||[],f=this.getCard();var g=this.getModel().productInfoVO.productId;var h=!!this.prodInstVO;BusCard.each(i,function(l){if(l.isReadOnly==1&&l.attrCd&&f.$(l.attrCd)){f.$(l.attrCd).disabled=true;
}if(h){if("100098"==l.attrCd||"100101"==l.attrCd){var j="&productId="+g+"&attrCd="+l.attrCd;var k=a.ServiceFactory.getService("url:prodOfferSaleAjaxAction.do?method=attrReadOnly"+j);if(k==1){f.$(l.attrCd).disabled=true;
}}}});},extractRelaAttrIdList:function(i){var f=[];var h=/\[(.*?)\]/g;var g=h.exec(i||"");while(g){f.push(g[1]);g=h.exec(i||"");}return f;},computeExpr:function(g,n){var l=/\[(.*?)\]/g;var j="NO_MATCH";
if(!n){return"";}else{var k=n.toString();var i=k.replace(l,function(o,m){var q=m;var p=g.$(q);if(p&&p.value){return p.value;}else{return j;}});if(i.indexOf(j)>=0){return"";}else{var h=BusCard.parse(i);
if(h){var f=/^(\d+)\.(\d+)$/.exec(h.toString());if(f){if(f[2].length>2){h=h.toFixed(2);}}}return h;}}},bindUpdateEventForExprAttr:function(){var h=this.getModel().productInfoVO.attrList||[],f=this,g=this.getCard();
BusCard.each(h,function(l){var j=g.$(l.attrCd+"");if(!j){return;}var k=l.attrValueExpressionsVO;if(k){var i=f.extractRelaAttrIdList(k.valueExpressions);BusCard.each(i,function(m){var n=g.$(m);if(n&&n.tagName=="INPUT"){BusCard.addEventListener(n,"blur",function(){j.value=f.computeExpr(g,k.valueExpressions);
});}else{if(n&&n.tagName=="SELECT"){BusCard.addEventListener(n,"change",function(){j.value=f.computeExpr(g,k.valueExpressions);});}}});}if(j.tagName=="SELECT"){BusCard.addEventListener(j,"change",function(){f.dealRelaAttrSet(l,g);
var m=BusCard.find(l.attrValueList||[],function(n){return n.attrValue==j.value;});if(!!m){if(m!=null&&m.attrValueRelaList!=null&&m.attrValueRelaList.length>0){dojo.forEach(m.attrValueRelaList||[],function(q){if(g.$(q.attrCd+"")){var o=g.$(q.attrCd+"");
var n=f.getAttrValueRelaValueList(q);var p=BusCard.map(n||[],function(r){return{id:r.attrValue,name:r.attrValueName};});BusCard.$rs(o,p,true);BusCard.dispatchEvent(o,"change");a.DomHelper.enableTitle(o);
}});}}});if(!f.prodInstVO){BusCard.dispatchEvent(j,"change");}}});},dealRelaAttrSet:function(h,g){var f=[];dojo.forEach(h.attrValueList||[],function(i){dojo.forEach(i.attrValueRelaList||[],function(j){if(!(dojo.some(f||[],function(k){return k==j.attrCd;
}))){f.push(j.attrCd+"");}});});dojo.forEach(f||[],function(j){if(g.$(j+"")){var i=g.$(j+"");BusCard.$rs(i,[],true);}});},getAttrValueRelaValueList:function(h){var f=h.attrValueRelaValueList||[];var g=h.attrCd;
return f;},validateValue:function(f){return f&&f!="undefined"&&f!="null";},initProdAttrInst:function(){var h=this.getCard(),j=this,i=this.prodInstVO,g=null,f={};if(i&&(g=i.prodInstAttrList)){dojo.forEach(g,function(k){f[k.attrCd]=j.validateValue(k.attrValue)?k.attrValue:"";
});dojo.forEach(j.productInfoVO.attrList,function(k){if(!!f[k.attrCd]){j.convertFeeAttrInst(k,f[k.attrCd]);}});j.busCardInstance.renderDefaultValue(f);}},getCardData:function(){return this.getCard().getData.apply(this.getCard(),arguments);
},asyncLoadConfigScript:function(k,j){var h=dojo.map(k||[],function(m){return""+(m.attrCd||m.attrId);}),f=this,g=function(q){var n=f.busCardInstance.getCardRelationInfo(),o=BusCard.computeCardCallbackId(q),m=BusCard.cache.callbackFactory[o];
if(m){try{m.apply(f.busCardInstance,[BusCard,n]);}catch(p){BusCard.showErrorStack(p);}}},i=a.ServiceFactory,l=function(m){var n=dojo.filter(m,function(p){var q=BusCard.computeCardCallbackId(p),o=BusCard.cache.callbackFactory[q];
if(o){g(p);}else{return true;}});BusCard.ScriptLoader.asynLoad(n,function(){dojo.forEach(n,function(o){g(o);});f.completeRequiredState();},true);};if(j){return l(k);}else{return i.getService("spring:attrUseConfigBO").getUseDataByAttrCds(h,function(m){l(m);
});}},hiddenAllAttrElem:function(){var f=this;dojo.forEach(f.productInfoVO.attrList||[],function(g){f.busCardInstance.hidden(g.attrCd+"");});},dealAttrIsInstance:function(){var g=this.getCard(),f=this.getModel().productInfoVO.attrList||[];
BusCard.each(f||[],function(i){var h=g.$(i.attrCd+"");if(i.isTemp=="0"||i.isTemp==0){h.removeAttribute("controlfieldname");}});},executeSpecConfig:function(){var l=this;var f=l.productInfoVO;var k=l.busCardInstance.getParent();
var i=function(n){if(n&&n.ifDisplay==0){l.hiddenAllAttrElem();}};var g=function(n){dojo.forEach(n||[],function(p){var o=l.busCardInstance.$(p.attrCd+"");p.ifDisplay==0?l.busCardInstance.hidden(p.attrCd+""):l.busCardInstance.display(p.attrCd+"");
if(o){p.isModify==0?(o.disabled=true):((o.disabled=false)||(o.readOnly=false));}});};if(this.isAccessProduct&&k){if(arguments.length>1){i(arguments[0]);g(arguments[1]);return true;}var m=k.getCardRelationInfo(),h=m.serviceOfferId,j=m.productId;
BusCard.$remote("productServiceRelDAO").query({serviceOfferId:h,productId:j},function(o){if(o&&o.length){var n=o[0];i(n);BusCard.$remote("attrControlSpecialDAO").query({attrObjType:1,serviceOfferId:h,attrObjId:j},function(p){g(p);
});}});}},_buildAsyncRequestParam:function(){var g=this,f=g.productInfoVO;return{productId:""+f.productId,serviceOfferId:""+g.getModel().serviceOfferId,attrList:dojo.map(f.attrList||[],function(h){return""+h.attrCd;
})};},asyncLoadAttrConfigData:function(h,f){var g=BusCard.path.contextPath+"/orderDetailAction.do?method=requestAttConfigData";BusCard.doPost(g,h,true,f);},convertFeeAttrDefault:function(g){var f=g.defaultValue;
if(!!g&&!!f&&!isNaN(f)){if(g.valueUnit==a.AttrUnitConst.minuteConst){f=parseFloat(f+"")/100;}}return f;},convertFeeAttrInst:function(h,g){var f=g;if(!!h&&!!f&&!isNaN(f)){if(h.valueUnit==a.AttrUnitConst.unitConst||h.valueUnit==a.AttrUnitConst.minuteConst){f=parseFloat(f+"")/100;
}}return f;},loadAndSetAttrConfigData:function(){if(this.isAccessProduct){var g=BusCard.path.contextPath+"/orderDetailAction.do?method=requestAttConfigData";var f=BusCard.doPost(g,this._buildAsyncRequestParam());
this.productServiceRelVO=f.productServiceRelVO;this.attrUseConfigList=f.attrUseConfigList||[];this.attrControlSpecialList=f.attrControlSpecialList||[];}else{var i=a.ServiceFactory;var h=dojo.map((this.productInfoVO||this.prodOfferInfoVO).attrList||[],function(j){return""+(j.attrCd||j.attrId);
});this.attrUseConfigList=i.getService("spring:attrUseConfigBO").getUseDataByAttrCds(h)||[];}},buildBusCardResource:function(){if(this.attrUseConfigList&&this.attrUseConfigList.length){return(this.attrUseConfigList||[]).inject("<resource>",function(f,g){return f+'<import type="1" uri="'+g+'"/>';
})+"</resource>";}else{return"";}}});});
defineModule("orderaccept.prodofferaccept.widget.attrcard.ProductOfferAttrCardWidget",["orderaccept.prodofferaccept.widget.attrcard.ProductAttrCardWidget","orderaccept.prodofferaccept.util"],function(b,a){dojo.declare("orderaccept.prodofferaccept.widget.attrcard.ProductOfferAttrCardWidget",[b],{delayCreateBeforeBindModel:true,needRendering:true,NOOP:function(){},productServiceRelVO:null,attrUseConfigList:null,attrControlSpecialList:null,postMixInProperties:function(){var m=this.getModel(),l=m.prodOfferInfoVO,e="<?xml version='1.0' encoding='UTF-8'?>								<card id='${cardId}' cardType='0' name='属性信息' pageColumn='2' xmlns='http://www.crm1.com/buscard'><metaData>				             	 ${productAttrList}				             	 </metaData>${resource}</card>",i="prodAttr_"+l.prodOfferId,h="<subGroup id='productAttr' name='销售品基本属性'>",d="<subGroup id='productAttrMore' name='销售品扩展属性'>",c="<subGroup id='productAttr' name='销售品基本属性'>",k="<subGroup id='productAttrMore' name='销售品扩展属性'>",j="",g=this;
this.prodOfferInfoVO=l;if(this.checkIfNeedRendering(l.attrList||[])){this.loadAndSetAttrConfigData();var f=this.filterResult=this.filterPricingParamAttr(l.attrList);var n=this.prodAttrList2xml(f.exclusiveList,c,k);
j=BusCard.Template.create(e).apply({cardId:i,productAttrList:n,resource:this.buildBusCardResource()});this.templateString=j;}else{this.buildRendering=this.NOOP;this.postCreate=this.NOOP;}},postRenderingHandle:function(){var c=this;
c.renderPricingParamTabPage();c.initProductAttr(this.busCardInstance);c.initProdSelect(this.busCardInstance);c.initLength();c.initDisplayElement();c.initSpecialValueByAttrCode();c.renderDefaultValue();
c.initAttrDisabled();c.initProdOfferAttrInst();c.bindUpdateEventForExprAttr();},_pricingParamCardCallback:function(){var c=this;var f="/common/images/icon/plus_icon.png";var d=dijit.byId(this.getCardRelationInfo().targetWidgetId);
var e=d.filterResult.includeList;dojo.forEach(dojo.query(".buscard-row",c.dom),function(g){return g.style.clear="both";});dojo.forEach(e,function(m){var l=""+(m.attrId||m.attrCd);var j=c.$(l),h=c.$("label_"+l);
if(j){var g=dojo.map(m.attrValueList,function(n){return{id:n.attrValue,name:n.attrValueName};});if(j.tagName.toUpperCase()=="INPUT"){j.onquery=function(n,o,p){return g;};}else{if(j.tagName.toUpperCase()=="SELECT"){BusCard.$rs(j,g);
}}j.parentNode.style.width="auto";dojo.style(h,{width:"auto",textAlign:"left"});if(!m.unique){var i=document.createElement("img");dojo.style(i,{width:"16px",height:"16px",cursor:"pointer",marginLeft:"5px"});
dojo.attr(i,{attrCd:l});i.src=BusCard.path.contextPath+f;j.parentNode.parentNode.appendChild(i);h.parentNode.style.borderBottom="1px silver dashed";var k="<div class='pricingParam-"+l+"' style='clear:both'><div style='width:30%;float:left' column='0'></div><div style='width:30%;float:left' column='1'></div><div style='width:30%;float:left' column='2'></div></div>";
dojo.place(k,h.parentNode,"after");dojo.connect(i,"onclick",function(){return d.onPricingParamAdd(d,c,this);});}}});},selectColumn:function(c){var f=dojo.query("[column=0]",c)[0];var e=dojo.query("[column=1]",c)[0];
var d=dojo.query("[column=2]",c)[0];var g=[f,e,d];g.sort(function(i,h){var k=i.getElementsByTagName("input").length;var j=h.getElementsByTagName("input").length;if(k>j){return 1;}else{if(k<j){return -1;
}else{return 0;}}});return g[0];},onPricingParamAdd:function(i,f,h){var k=dojo.attr(h,"attrCd");var d=f.$(k);var m=d.value;var j=d.options[d.selectedIndex].text;var n="<input type='checkbox'  style='margin-left:5px;margin-right:5px;vertical-align:baseline;' CHECKED class='pricing-city' value='${value}'><span name='text-${value}'>${text}</span>";
var c=dojo.query(".pricingParam-"+k,f.dom)[0];var g=this.selectColumn(c);var o=dojo.query("input[value="+m+"]",c)[0];if(o){alert("选择已存在");try{o.focus();}catch(l){}}else{dojo.place(BusCard.Template.create(n).apply({value:m,text:j}),g,"last");
}},renderPricingParamTabPage:function(h){var e=this;var j=e.filterResult.includeList;if(j&&j.length>0){var m=orderaccept.prodofferaccept.util.DomHelper.getParentWidget(e.domNode,"unieap.layout.TabContainer"),g=m.domNode.clientHeight,k=m.domNode.clientWidth,i=new unieap.layout.ContentPane({title:"定价参数"}),l=BusCard.Template.create(this.convertTemplate),f="<attrList>"+l.apply({list:j})+"</attrList>",d="<?xml version='1.0' encoding='UTF-8'?>										<card id='${cardId}'  cardType='0' name='定价参数' pageColumn='1' xmlns='http://www.crm1.com/buscard'><metaData>				             	 		${productAttrList}				             		 </metaData></card>",c=BusCard.Template.create(d).apply({productAttrList:f,cardId:"pricingParam"});
m.addChild(i);e.pricingParamCard=BusCard.createInstance({targetWidgetId:this.id},i.containerNode,{gType:3,xmlData:c});e.pricingParamCard.dom.style.width="400px";e.pricingParamCard.init(e._pricingParamCardCallback);
}},initProdOfferAttrInst:function(){var f=this.getCard(),g=this,c=this.getModel().offerInstVO,e=null,d={};if(c&&(e=c.offerInstAttrList)){dojo.forEach(e,function(h){d[h.attrCd]=g.validateValue(h.attrValue)?h.attrValue:"";
});dojo.forEach(g.prodOfferInfoVO.attrList,function(h){if(!!d[h.attrCd]){g.convertFeeAttrInst(h,d[h.attrCd]);}});g.busCardInstance.renderDefaultValue(d);}},dealAttrIsInstance:function(){var d=this.getCard(),c=this.getModel().prodOfferInfoVO.attrList||[];
BusCard.each(c||[],function(f){var e=d.$(f.attrCd+"");if(f.isTemp=="0"||f.isTemp==0){e.removeAttribute("controlfieldname");}});},bindUpdateEventForExprAttr:function(){var e=this.getModel().prodOfferInfoVO.attrList||[],c=this,d=this.getCard();
BusCard.each(e,function(i){var g=d.$(i.attrCd+"");if(!g){return;}var h=i.attrValueExpressionsVO;if(h){var f=c.extractRelaAttrIdList(h.valueExpressions);BusCard.each(f,function(j){var k=d.$(j);if(k&&k.tagName=="INPUT"){d.addElemEventListener(j,"blur",function(){g.value=c.computeExpr(d,h.valueExpressions);
});}else{if(k&&k.tagName=="SELECT"){d.addElemEventListener(j,"change",function(){g.value=c.computeExpr(d,h.valueExpressions);});}}});}});},initProdSelect:function(){var c=this.getCard(),d=this.getModel().prodOfferInfoVO.attrList||[];
selectAttrList=BusCard.findAll(d,function(e){return(/select/i.test(e.valueShowType));});BusCard.each(selectAttrList,function(h){var f=h.attrValueList||[],g=BusCard.map(f,function(i){return{id:i.attrValue,name:i.attrValueName};
});var e=c.$(h.attrCd);if(g&&g.length>0){BusCard.$rs(e,g,true);}a.DomHelper.enableTitle(e);});},initLength:function(){var d=this.getCard(),c=this.getModel().prodOfferInfoVO.attrList||[];BusCard.each(c||[],function(f){var e=d.$(f.attrCd+"");
if(e&&f.attrLeng){e.maxLength=f.attrLeng;}});},initSpecialValueByAttrCode:function(d){var d=this.busCardInstance,f=this.getModel().prodOfferInfoVO.attrList||[];if(f!=null&&f.length>0){for(var e=0,c=f.length;
e<c;e++){var g=f[e];if(g.attrValueCode=="L8"&&g.valueShowType=="text"){d.$(g.attrCd).value=a.AttrUtil.getRandomPassword();}if(g.attrValueCode=="E0"&&g.valueShowType=="text"){d.$(g.attrCd).onblur=function(){if(!a.AttrUtil.nas_email_check_sirp("【Email地址】",this,"")){this.value="";
this.focus();}};}if(g.attrValueCode=="L1"&&g.valueShowType=="text"){d.$(g.attrCd).onblur=function(){a.AttrUtil.checkNumberValue(this,g);};}}}},initDisplayElement:function(d){var d=this.busCardInstance,f=this.getModel().prodOfferInfoVO.attrList||[];
if(f!=null&&f.length>0){for(var e=0,c=f.length;e<c;e++){var g=f[e];if(g.ifDisplay=="0"){d.hidden(g.attrCd+"");}}}},getDefaultValue:function(){var f=this.getModel().prodOfferInfoVO.attrList||[],e={};if(f!=null&&f.length>0){for(var d=0,c=f.length;
d<c;d++){var g=f[d];if(g.defaultValue!=null){e[g.attrCd]=this.convertFeeAttrDefault(g);}}}return e;},initAttrDisabled:function(){var d=this.getModel().prodOfferInfoVO.attrList||[],c=this.getCard();BusCard.each(d,function(e){if(e.ifDisabled&&e.attrCd&&c.$(e.attrCd)){c.$(e.attrCd).disabled=true;
}});},getPageData:function(){var d=this.inherited(arguments);if(this.pricingParamCard){var g=this.pricingParamCard,c=dijit.byId(g.getCardRelationInfo().targetWidgetId);var f=c.filterResult.includeList;
var e={};dojo.forEach(f,function(k){var j=k.attrCd||k.attrId;if(k.unique){e[j]=g.$(j).value;}else{var i=dojo.query(".pricingParam-"+j,g.dom)[0];var h=dojo.query(":checked",i);e[j]=dojo.map(h,function(l){return l.value;
});}});dojo.mixin(d,e);}return d;}});});
defineModule("orderaccept.prodofferaccept.widget.serviceproduct.ServiceProductWidget",["orderaccept.custom._BaseWidget","orderaccept.custom._BusCardTemplated","dijit._Container","orderaccept.prodofferaccept.util","../attrcard/ProductAttrCardWidget","orderaccept.custom.TooltipDialog","orderaccept.common.js.ConstantsPool","orderaccept.custom.popup","orderaccept.common.dialog.MessageBox"],function(b,i,f,g,d,h,e,a,c){dojo.declare("orderaccept.prodofferaccept.widget.serviceproduct.ServiceProductWidget",[b,i,f],{templatePath:dojo.moduleUrl("orderaccept.prodofferaccept.widget.serviceproduct","template/serviceProductTpl.html"),constructor:function(){this.productId=arguments[0].productId;
this.prodOfferInfoVO=arguments[0].prodOfferInfoVO;this.serviceCardWidget=arguments[0].serviceCardWidget;this.serviceProdList=arguments[0].serviceProdList;this.prodOfferInst=arguments[0].prodOfferInst;this.rowSize=4;
this.serviceProdAttrList=[];this.orderedProdList={};this.unorderedProdList={};},postMixInProperties:function(){this.viewInitData=this.buildViewInitData();},destroyRecursive:function(){var j=this.serviceProdAttrList;
if(!!j){dojo.forEach(j,function(k){if(!!k){k.destroyRecursive();}});}this.inherited(arguments);},buildViewInitData:function(){var o=this;var n=this.serviceProdList;var l=this.rowSize;var p=0;var m=[];dojo.forEach(n,function(t){var v=!!t.productInfoVO?t.productInfoVO.attrList:[];
var q={};var s=o.prodOfferInst;var r=null;var x=!!o.serviceCardWidget.cardParam?o.serviceCardWidget.cardParam.userId:"";if(!!s){var u=dojo.filter(s.prodInstList,function(y){return y.prodInstId==x;})[0].prodInstList;
if(!!u&&u.length>0){r=dojo.filter(u,function(y){return y.productId==t.productInfoVO.productId&&y.prodFuncType!=e.load("ProductFuncTypeConst").ProductFuncTypeConst.ACCESS;})[0];}}t.prodInstInfo=r;t.rowIndex=p;
t.ifNextRow=false;t.ifShowAttr=!!g.AttrUtil.checkedIfNeedShow(v)?1:0;t.uniqueId=o.serviceCardWidget.metaData.uniqueId;t.ifNotNull="";t.notNull="display:none";if(!g.AttrUtil.checkIfNotNull(v)){t.ifNotNull="display:none";
t.notNull="";}if(t.ifShowAttr==1){q=o.initServiceProdAttr(o,t,r);}t.checkStr=o.checkProdSelectStatus(t,r);if(!!t.checkStr&&t.checkStr!=""){o.orderedProdList[""+t.productInfoVO.productId]=t;}else{o.unorderedProdList[""+t.productInfoVO.productId]=t;
}var w={rowIndex:p,productInfo:t,productAttrCard:q.needRendering?q:null};if(!!t.roleInfoVO){if(!!m[t.roleInfoVO.roleCD]){m[t.roleInfoVO.roleCD].push(w);}else{m[t.roleInfoVO.roleCD]=[];m[t.roleInfoVO.roleCD].push(w);
}}p++;});o.roleInfo=m;if(!!n&&n.length>0){totalRows=Math.ceil(n.length/l);for(var k=1;k<=totalRows;k++){var j=k*l-1;if(!!n[j]){n[j].ifNextRow=true;}}}tpContext={prodRowList:n};return{prodOfferViewData:tpContext};
},initServiceProdAttr:function(q,k,p){var o=new h({id:"serviceProdAttrWidget-"+q.serviceCardWidget.metaData.uniqueId+"-"+k.rowIndex});q.serviceProdAttrList[k.rowIndex]=o;o.startup();var n="<div style='text-align:center;vertical-align:middle'><a href='javascript:void(0);' dojoAttachEvent='onclick:elementclick' 					        		dojoAttachTopic='/prodOfferDetailBtn' style='text-align:center;vertical-align:middle;'>关闭</a></div>";
dojo.place(n,o.containerNode,"last");var l=new unieap.layout.TabContainer({height:"auto"});o.tabContainer=l;o.rowData={};o.rowData.prodOfferInst=!!p?{}:null;o.rowData.prodInst=p;l.startup();var j=new d({productInfoVO:k.productInfoVO,prodOfferInfoVO:q.prodOfferInfoVO});
if(j.needRendering){var m=new unieap.layout.ContentPane({title:"产品属性",detailWidgetId:o.id});j.busCardInstance.setParent(o);j.renderCard(m.domNode,"first");l.addChild(m);}if(!!p&&!!p.prodInstAttrList&&p.prodInstAttrList.length>0){g.SetAttrInst(p.prodInstAttrList,j.busCardInstance);
}o.enableEvtMsgPropagation(o.domNode);dojo.place(l.domNode,o.containerNode,"first");o.attrCardWidget=j;return j;},handleServiceProduct:function(o,m){var n=this,k=m.checked,l=n.filterServiceProdByRowIndex(o);
var j=n.checkProdRela(l,k);if(j.warnInfo!=""){if(j.flag=="-1"){c.alert({busiCode:"08410207",infoList:[j.warnInfo]});return false;}else{c.confirm({message:j.warnInfo,onComplete:function(u){if(u==true){var p=2000;
var t="#C0ECF6";var w="#FFD0D0";var r="";for(var v in j.deleteList){if(!j.deleteList.hasOwnProperty(v)){continue;}var s=j.deleteList[v];var q=s.productInfoVO.productId+"-"+s.rowIndex;dojo.byId("serviceProdCheck-"+q).checked=false;
n.handleOrderProdList(false,s);n.changeColor(dojo.byId("serviceProdName-"+q),w,r,p);}for(var v in j.addList){if(!j.addList.hasOwnProperty(v)){continue;}var s=j.addList[v];var q=s.productInfoVO.productId+"-"+s.rowIndex;
dojo.byId("serviceProdCheck-"+q).checked=true;n.handleOrderProdList(true,s);n.changeColor(dojo.byId("serviceProdName-"+q),t,r,p);}var x=l.productInfoVO.productId+"-"+o;n.changeColor(dojo.byId("serviceProdName-"+x),k==true?t:w,r,p);
}else{m.checked=k==true?false:true;}},iconCloseComplete:false},m);}}n.handleOrderProdList(k,l);},filterServiceProdByRowIndex:function(j){return dojo.filter(this.serviceProdList,function(k){return k.rowIndex==j;
})[0];},handleOrderProdList:function(j,k){var l=this;if(j==true){l.orderedProdList[""+k.productInfoVO.productId]=k;if(!!l.unorderedProdList[""+k.productInfoVO.productId]){delete l.unorderedProdList[""+k.productInfoVO.productId];
}}else{if(!!l.orderedProdList[""+k.productInfoVO.productId]){delete l.orderedProdList[""+k.productInfoVO.productId];}this.unorderedProdList[""+k.productInfoVO.productId]=k;}},getPageData:function(){var o=this,v=o.domNode.parentNode.parentNode.parentNode,r=this.serviceProdList,l=[],t=true;
Array.prototype.push.apply(l);if(o.checkRole()){return false;}for(var w in r){if(!r.hasOwnProperty(w)){continue;}var y=r[w],u=y.rowIndex,n=o.serviceProdAttrList[u],k=!!n?n.attrCardWidget:null;var s="serviceProdCheck-"+y.productInfoVO.productId+"-"+u;
var q=dojo.query("[id='"+s+"']",o.domNode)[0];var m=y.productInfoVO.productId+"-"+u;var x=dojo.query("[id='serviceProdOfferAttr-"+m+"']",o.domNode)[0];var p=q.checked;if(!!p||!!y.prodInstInfo){if(!!p&&!!k){if(!o.checkNotNull(k.domNode,k.domNode,v,x)){t=false;
return t;}}var j={prodBasicInfo:{productId:y.productInfoVO.productId,prodInstId:!!y.prodInstInfo?y.prodInstInfo.prodInstId:null,prodInstInfo:!!y.prodInstInfo?y.prodInstInfo:null,checkedStatus:p},prodAttrInfo:!!k?k.getCardData(null,null,true):null,productInfoVO:y.productInfoVO,uniqueId:o.serviceCardWidget.metaData.uniqueId};
l.push(j);}}if(!t){return t;}return l;},checkProdSelectStatus:function(j,k){var l="";if(j.productInfoVO.ifSelectAble=="1"||j.minCount>0){return l=" checked='true' disabled='true'";}if(!!k){l=" checked='true' ";
}else{if(j.ifDefault==1){l=" checked = 'true' ";}}return l;},checkRole:function(){var j=this;return BusCard.exist(j.roleInfo,function(k){var m=dojo.filter(k,function(p){return dojo.query("[id='serviceProdCheck-"+p.productInfo.productId+"-"+p.rowIndex+"']",j.domNode)[0].checked==true;
});var n=k[0].productInfo.roleInfoVO.roleNumMin,l=k[0].productInfo.roleInfoVO.roleNumMax;if(m.length<n||m.length>l){var o=[];dojo.forEach(k,function(p){o.push(p.productInfo.productInfoVO.productName);});
c.alert({busiCode:"08410160",infoList:[o.toString(),n,l]});return true;}return false;});},checkNotNull:function(B,p,m,E){var j=this;try{var k=B.childNodes;var z=k.length;for(var q=0;q<z;q++){var u=k[q].nodeType;
var x=k[q].nodeName;var D=k[q];if(u==1){if(x=="SELECT"||x=="INPUT"){if((D.getAttribute("isNull")||D.isNull)=="0"&&!BusCard.util.trim(D.value)){var r=!!p?dojo.query("[id='label_"+k[q].id+"']",p)[0]:dojo.byId("label_"+k[q].id);
var v=/<span(?:.*?)>(?:.*?)<\/span>(.+)(\：|\:)/i.exec(r.innerHTML)[1];var s=D.getAttribute("groupId")||D.groupId;if(s&&s!="0"){if(j.getTabPanel()){j.getTabPanel().active(s);}}try{var w=g.DomHelper.getParentWidget(p,"orderaccept.custom.TooltipDialog");
var o=/hidden\-elem/.test(m.className);if(o){dojo.toggleClass(m,"hidden-elem");}E.focus();c.alert({title:"\u63d0\u793a\u4fe1\u606f",message:"["+v+"]\u4e0d\u80fd\u4e3a\u7a7a"},E);orderaccept.custom.popup.open({widget:{popup:w,around:E}});
D.focus();}catch(C){c.alert({title:"\u63d0\u793a\u4fe1\u606f",message:C.message},E);}return false;}else{var A=arguments.callee.call(j,D,p,m,E);if(A===false){return false;}}}else{var y=arguments.callee.call(j,D,p,m,E);
if(y===false){return false;}}}}}catch(C){c.alert({title:"\u63d0\u793a\u4fe1\u606f",message:C.message},E);return false;}return true;},checkProdRela:function(s,j){var o=this,m="",n=o.orderedProdList,t=o.unorderedProdList,x=e.load("ProdRelaTypeConst").ProdRelaTypeConst.MUTEX,p=e.load("ProdRelaTypeConst").ProdRelaTypeConst.DEPEND,l=e.load("ProdRelaTypeConst").ProdRelaTypeConst.RELATION,v={},q={};
for(var u in s.productInfoVO.prodRelaList){if(!s.productInfoVO.prodRelaList.hasOwnProperty(u)){continue;}var r=s.productInfoVO.prodRelaList[u];if(r.relaType==p){if(j){if(!!t[""+r.prodB]&&r.prodB!=s.productInfoVO.productId){var w=t[""+r.prodB];
var k=w.productInfoVO;m+="产品["+k.productName+"]与当前订购产品存在依赖关系,需订购此产品\n";q[""+k.productId]=w;}}else{if(!!n[""+r.prodA]&&r.prodA!=s.productInfoVO.productId){var w=n[""+r.prodA];var k=w.productInfoVO;if(w.productInfoVO.ifSelectAble=="1"){m="产品["+k.productName+"]与当前订购产品存在依赖关系,且["+k.productName+"]为必选产品,不能退订当前产品";
return{flag:-1,warnInfo:m,deleteList:v,addList:q};}m+="产品["+k.productName+"]与当前订购产品存在依赖关系,需退订此产品\n";v[""+k.productId]=w;}}}else{if(r.relaType==x){if((!!n[""+r.prodA]&&r.prodA!=s.productInfoVO.productId)||(!!n[""+r.prodB]&&r.prodB!=s.productInfoVO.productId)){var w=n[""+r.prodA]||n[""+r.prodB];
var k=w.productInfoVO;v[""+k.productId]=w;m+="产品["+k.productName+"]与当前订购产品存在互斥关系,需退订此产品\n";if(w.productInfoVO.ifSelectAble=="1"){m="产品["+k.productName+"]与当前订购产品存在互斥关系,且["+k.productName+"]为必选产品,不能订购当前产品";
return{flag:-1,warnInfo:m,deleteList:v,addList:q};}}}}}return{flag:1,warnInfo:m.substring(0,m.length-1),deleteList:v,addList:q};},changeColor:function(k,l,j,m){dojo.animateProperty({node:k,properties:{backgroundColor:{start:l,end:!!j?j:""}},duration:m}).play();
}});});
defineModule("orderaccept.prodofferaccept.widget.prodoffersearchlist.SubProdOfferSearchListWidget",["orderaccept.custom._BaseWidget","orderaccept.custom._BusCardTemplated"],function(b,a){dojo.declare("orderaccept.prodofferaccept.widget.prodoffersearchlist.SubProdOfferSearchListWidget",[b,a],{templateString:"<div><ul class='favori_ul'>										<tp:for ds='prodOfferList'>										<li style='cursor:pointer;list-style-type:none;' prodOfferId='${prodOfferId}' class='prodoffer-search-item' dojoAttachEvent='ondblclick:elementdblclick,onmouseover:elementmouseover,onmouseout:elementmouseout' dojoAttachTopic='/searchSubProdOfferItem'>										<a href='javascript:void(0);'><span dojoAttachEvent='onmouseover:elementmouseover,onmouseout:elementmouseout' dojoAttachTopic='/searchProdItem-span'>${prodOfferName}</span></a></li></tp:for></ul></div>",postMixInProperties:function(){var c=this.params;
var d=c.uniqueId;this.prodOfferList=$ac$.get("_searchSubProdOfferList"+d);}});});
defineModule("orderaccept.prodofferaccept.widget.promotionsearchlist.PromotionSearchListWidget",["orderaccept.custom._BaseWidget","orderaccept.custom._BusCardTemplated"],function(b,a){dojo.declare("orderaccept.prodofferaccept.widget.promotionsearchlist.PromotionSearchListWidget",[b,a],{templateString:"<div><ul class='favori_ul'>										<tp:for ds='promotionList'>										<li style='cursor:pointer;list-style-type:none;' promotionId='${nodeId}' class='promotion-search-item' dojoAttachEvent='ondblclick:elementdblclick,onmouseover:elementmouseover,onmouseout:elementmouseout' dojoAttachTopic='/searchPromotionItem'>										<a href='javascript:void(0);'><span dojoAttachEvent='onmouseover:elementmouseover,onmouseout:elementmouseout' dojoAttachTopic='/searchPromotionItem-span'>${catalogItemName}</span></a></li></tp:for></ul></div>",postMixInProperties:function(){var c=this.params;
this.promotionList=$ac$.get("_promotionSearchList");}});});
defineModule("orderaccept.prodofferaccept.widget.attrcard.OfferAgreementCardWidget",["./ProductOfferAttrCardWidget"],function(a){dojo.declare("orderaccept.prodofferaccept.widget.attrcard.OfferAgreementCardWidget",[a],{delayCreateBeforeBindModel:true,needRendering:true,NOOP:function(){},computedAttrList:[],attrCdList:{effUnitAttrCd:300010,effValueAttrCd:300012},postMixInProperties:function(){var h=this.getModel(),g=h.prodOfferInfoVO,b="<?xml version='1.0' encoding='UTF-8'?>								<card id='${cardId}' cardType='0' name='销售品协议信息' pageColumn='2' xmlns='http://www.crm1.com/buscard'><metaData>				             	 ${productAttrList}				             	 </metaData></card>",d="offerAgreementAttr_"+g.productId,f="<subGroup id='productAttr' name='基本属性'>",i="<subGroup id='productAttrMore' name='更多属性'>",e="",c=this;
this.computedAttrList=this.convertAttrList(this.getSpecAttrList(g),this.getModel().config);if(this.checkIfNeedRendering(this.computedAttrList||[])){var j=this.prodAttrList2xml(this.computedAttrList,f,i);
e=BusCard.Template.create(b).apply({cardId:d,productAttrList:j});this.templateString=e;}else{this.buildRendering=this.NOOP;this.postCreate=this.NOOP;}this.addCardCallback(function(){});},postRenderingHandle:function(){var b=this;
b.initProductAttr(this.busCardInstance);b.initProdSelect(this.busCardInstance);b.renderDefaultValue();b.initAttrDisabled();b.initProdOfferAttrInst();b.asyncLoadConfigScript();},initProdSelect:function(){var b=this.getCard(),c=this.computedAttrList||[];
selectAttrList=BusCard.findAll(c,function(d){return(/select/i.test(d.valueShowType));});BusCard.each(selectAttrList,function(f){var d=f.attrValueList||[],e=BusCard.map(d,function(g){return{id:g.attrValue,name:g.attrValueName};
});BusCard.$rs(b.$(f.attrCd),e);});},getDefaultValue:function(){var e=this.computedAttrList||[],d={};if(e!=null&&e.length>0){for(var c=0,b=e.length;c<b;c++){var f=e[c];if(f.defaultValue!=""&&f.defaultValue!=null){d[f.attrCd]=this.convertFeeAttrDefault(f);
}}}return d;},asyncLoadConfigScript:function(){return false;},feeConfigScript:function(b){var d=b.$("300008");if(d!=null){var c=d.value;dojo.attr(d,{rvalue:c});d.value=parseInt(c+"")/100;}},convertAttrList:function(f,c){var e=BusCard.jsonPath(f,"$[?(@.attrCd=="+this.attrCdList.effUnitAttrCd+")]"),g=BusCard.jsonPath(f,"$[?(@.attrCd=="+this.attrCdList.effValueAttrCd+")]"),c=c||{},b=[];
if(e&&g){var d=c.beginDate;if(dojo.isString(d)){d=orderaccept.prodofferaccept.util.DateHelper.getDateFromString(d).getTime();}else{if(!d){d=$ac$.get("requestParam").today?$ac$.get("requestParam").today:orderaccept.prodofferaccept.util.DateHelper.format(new Date());
}}e=e[0];g=g[0];computedDateMap=orderaccept.prodofferaccept.util.DateHelper.computationOfferStandardTime(d,parseInt(""+(e.attrValue||1)),parseInt(""+(g.attrValue||1)));dojo.forEach(f,function(h){if(h===e||h===g){return;
}else{b.push(h);}});b.unshift({nullable:true,attrCd:"expDate",attrValue:computedDateMap.timeString,valueShowType:"text",attrName:"协议结束时间",defaultValue:computedDateMap.timeString});b.unshift({nullable:true,attrCd:"effDate",attrValue:computedDateMap.currentTimeString,valueShowType:"text",attrName:"协议开始时间",defaultValue:computedDateMap.currentTimeString});
return b;}return b;},getSpecAttrList:function(c){var e=c.offerAgreementVO||[],d=[];if(e[0]){var b=e[0].itemList||[];dojo.forEach(b,function(h){var g={},i=h.attrVO;for(var f in h){if(!(dojo.isObject(h[f])||dojo.isArray(h[f]))){g[f]=h[f];
}}dojo.mixin(i,g);dojo.mixin(i,{defaultValue:h.attrValue});d.push(i);});}return d;},initProdOfferAttrInst:function(){return false;},initAttrDisabled:function(){var c=this.computedAttrList||[],b=this.getCard();
BusCard.each(c,function(d){if(d.attrCd&&b.$(d.attrCd)){b.$(d.attrCd).disabled=true;}});},resetOfferStandardTime:function(c){var d=BusCard.jsonPath(this.getSpecAttrList(this.getModel().prodOfferInfoVO),"$[?(@.attrCd=="+this.attrCdList.effUnitAttrCd+")]"),e=BusCard.jsonPath(this.getSpecAttrList(this.getModel().prodOfferInfoVO),"$[?(@.attrCd=="+this.attrCdList.effValueAttrCd+")]");
if(d&&e){d=d[0];e=e[0];computedDateMap=orderaccept.prodofferaccept.util.DateHelper.computationOfferStandardTime(c,parseInt(""+(d.attrValue||1)),parseInt(""+(e.attrValue||1)));}var b=this.getCard();b.$("expDate").value=computedDateMap.timeString;
b.$("effDate").value=computedDateMap.currentTimeString;}});});
defineModule("orderaccept.custom.popup",["../prodofferaccept/util","dijit._base.popup"],function(a){var b=function(d){var f=d.widget.popup.domNode,e=d.widget.around;if(d.doCheck&&!d.doCheck()){return false;
}dijit.popup.open(d.widget);if(d.widget.pos=="R"){f.className="dijitTooltipDialog dijitTooltipRight";popNode=f.parentNode;popNode.style.left=a.DomHelper.getLeft(e)+a.DomHelper.getWidth(e)+"px";popNode.style.top=a.DomHelper.getTop(e)+a.DomHelper.getHeight(e)-a.DomHelper.getHeight(popNode)+"px";
}else{if(d.widget.pos=="L"){f.className="dijitTooltipDialog dijitTooltipLeft";popNode=f.parentNode;popNode.style.left=a.DomHelper.getLeft(e)-a.DomHelper.getWidth(popNode)+"px";popNode.style.top=a.DomHelper.getTop(e)+a.DomHelper.getHeight(e)-a.DomHelper.getHeight(popNode)+"px";
}}};var c=function(d){if(d.doCheck&&!d.doCheck()){return false;}if(d.widget&&d.widget.handlePageData&&!d.notHandleData){if(d.widget.handlePageData()===false){return false;}}dijit.popup.close(d.widget);
};orderaccept.custom.popup.open=b;orderaccept.custom.popup.close=c;});
defineModule("orderaccept.custom.TooltipDialog",["dijit.TooltipDialog","./_BaseWidget","orderaccept.custom.popup","dijit._Container"],function(d,c,a,b){dojo.declare("orderaccept.custom.TooltipDialog",[c,d,b],{constructor:function(){this.noCloseBtn=!!arguments[0]?arguments[0].noCloseBtn:false;
},postCreate:function(){this.inherited(arguments);var e=this;if(!!e){if(!e.noCloseBtn){loadCssModule("orderaccept.custom.resources.css.ToolTipCss");var f="<div class='closeBtn'></div>";dojo.place(f,e.containerNode.parentNode,"first");
dojo.connect(dojo.query(".closeBtn",e.domNode)[0],"onclick",function(){a.close({widget:unieap.byId(e.id),notHandleData:true});});}}},onClose:function(){var e=this;var k="orderaccept.prodofferaccept.builder.prodofferdetail.ProdOfferDetailBuilder";
var s="orderaccept.prodofferaccept.builder.prodofferdetail.MainProdOfferDetailBuilder";if(!!e.builder&&(e.builder.declaredClass==k||e.builder.declaredClass==s)){var f=dojo.query("[controlfieldname]",e.domNode);
var j=this.checkIsFinish(f);var p=this.builder.provider;var o=!!p?p.subProdOfferOrderGrid:null;var i=!!o?o.domNode:null;var m=null;if(!!i){m=dojo.query("[id=finishImg-"+this.rowIndex+"]",i)[0];}else{m=dojo.byId("finishImg-"+this.rowIndex);
}if(!!m){var r=dojo.query(".formRequested",m.parentNode)[0];var h=/hidden\-elem/.test(r.className);if(j==true){dojo.style(m,"display","");if(/hidden\-elem/.test(m.className)){dojo.toggleClass(m,"hidden-elem");
}if(!h){dojo.toggleClass(r,"hidden-elem");}}else{dojo.style(m,"display","none");if(h){dojo.toggleClass(r,"hidden-elem");}}}}if(!!e.id&&e.id.indexOf("serviceProdAttrWidget-")==0){var g=e.id.replace("serviceProdAttrWidget","serviceProdImg");
var l=dojo.query("[id="+g+"]")[0];var n=e.id.replace("serviceProdAttrWidget","serviceProdSpan");var q=dojo.query("[id="+n+"]")[0];var f=dojo.query("[controlfieldname]",e.domNode);var j=this.checkIsFinish(f);
if(j==true){!!q?dojo.style(q,"display","none"):null;!!l?dojo.style(l,"display",""):null;}else{!!l?dojo.style(l,"display","none"):null;!!q?dojo.style(q,"display",""):null;}}this.inherited(arguments);},checkIsFinish:function(f){var e=true;
dojo.forEach(f,function(g){if(!!g.getAttribute("isnull")&&g.getAttribute("isnull")=="0"){if(!g.value||BusCard.util.trim(g.value)==""){var h=dijit.getEnclosingWidget(g);if(!h||h.domNode.style.display!="none"){e=false;
}}}});return e;}});});
defineModule("orderaccept.prodofferaccept.widget.messagetips.CollectTipsWidget",["orderaccept.custom.TooltipDialog"],function(a){dojo.declare("orderaccept.prodofferaccept.widget.messagetips.CollectTipsWidget",[a],{constructor:function(){this.inherited(arguments);
},postscript:function(){this.inherited(arguments);var b="<div class='buscard-root' style='display:block; height:15px'>											<div style='padding:2px;width:175px'id='tip-info' > </div>									  	</div>";
dojo.place(b,this.containerNode,"first");}});});
defineModule("orderaccept.prodofferaccept.widget.messagetips.ProdOfferAcceptTipsWidget",["orderaccept.custom.TooltipDialog"],function(a){dojo.declare("orderaccept.prodofferaccept.widget.messagetips.ProdOfferAcceptTipsWidget",[a],{constructor:function(){this.inherited(arguments);
},postscript:function(){this.inherited(arguments);var b="<div class='buscard-root' style='display:block;width:350px'>										 <div class='buscard-legend'>											<span class='buscard-legend-img'></span>											<span class='buscard-legend-text' id='tips-name'>本次操作</span>										 </div>										 <div class='buscard-content' style='width:auto'>												<div class='buscard-row' style='clear:both'>													<div class='buscard-legend-text'>订购<span id='prod-offer-add-count'></span>个可选包</div>													<div id='prod-offer-add-detail'>&nbsp;</div>												</div>												<div class='buscard-row' style='clear:both'>													<div class='buscard-legend-text'>变更<span id='prod-offer-change-count'></span>个可选包</div>													<div id='prod-offer-change-detail'>&nbsp;</div>											 	</div>											 	<div class='buscard-row' style='clear:both'>													<div class='buscard-legend-text'>退订<span id='prod-offer-del-count'></span>个可选包</div>													<div id='prod-offer-del-detail'>&nbsp;</div>												</div>&nbsp;										</div>									  </div>";
dojo.place(b,this.containerNode,"first");}});});
defineModule("orderaccept.prodofferaccept.formatter.FormatterProvider",["orderaccept.custom._BusCardTemplated","../util"],function(c,b){var a={createSubProdOfferDetail:function(f,e){var d=BusCard.Template.create("<div class='subProdOfferDetail-#{rowIndex}'><input type='checkbox' #{disabledOption} #{checkedOption} rowIndex='#{rowIndex}' id='#{viewId}' name='prodOfferCheck' value='#{subProdOfferInfo.prodOfferId}' dojoAttachEvent='onclick:elementclick' dojoAttachTopic='/subProdOfferCheck'/>&nbsp;&nbsp;<span id='prodOfferName-#{viewId}' rowIndex='#{rowIndex}' style='color:red;cursor:pointer' dojoAttachEvent='onclick:elementclick,onmouseover:elementmouseover,onmouseout:elementmouseout' dojoAttachTopic='/prodOfferName'>#{subProdOfferInfo.prodOfferName}</span><tp:if $$.prodOfferDetailFlag==1><a href='javascript:void(0);' id='prodOfferLink-key-#{rowIndex}' class='sub-prodoffer-detail' rowIndex='#{rowIndex}' name='productLink' value='#{subProdOfferInfo.prodOfferId}' dojoAttachEvent='onclick:elementclick' dojoAttachTopic='/prodOfferLink'>[\u9500\u552e\u54c1\u8be6\u60c5<img id='finishImg-#{rowIndex}' class='#{finishImg}' src='"+BusCard.path.contextPath+"/common/images/icon/finish_icon.png'></img><span class='formRequested #{detailNotNull}'>*</span>]</a></tp:if></div>");
e.showData.rowIndex=f;return d.apply(e.showData);},createSubProdOfferStartDate:function(f,e){var d=BusCard.Template.create("<div class='subProdOfferStartDate-#{rowIndex}'><span class='start_date_class'>#{startDate}</span><div id='productStartDateView-#{viewId}' style='#{dateStyle.startDateView}'><span class='productStartDateStyle#{productStartDateHtml.style.hiddenStyleOption}'><input type='hidden' id='delayTime-#{viewId}' value = '#{productStartDateHtml.data.time}'/>#{productStartDateHtml.data.delayUnitViewInstance}</span></div></div>");
return d.apply(e.showData);},createSubProdOfferEndDate:function(g,f){var d="<span class='delay_date_class'>#{delayEndDate}</span><span class='prodDelayEndDateStyle#{prodOfferEndDateView.style.hiddenStyleOption}'><input type='hidden' id='delayEndTime-#{viewId}' value = '#{prodOfferEndDateView.data.time}'/>#{prodOfferEndDateView.data.delayUnitViewInstance}</span>";
var e=BusCard.Template.create("<div class='subProdOfferEndDate-#{rowIndex}'><span id='offerEndDateDisplay-#{viewId}' class='end_date_class'>#{endDate}</span><div id='productEndDateView-#{viewId}' style='#{dateStyle.endDateView}'><span class='productEndDateStyle#{productEndDateHtml.style.hiddenStyleOption}'>\u6709\u6548\u671f:<select id='validPeriod-#{viewId}' style='width:20%'> #{productEndDateHtml.data.validPeriodOption}</select><select id='validType-#{viewId}' style='width:25%'>#{productEndDateHtml.data.validTypeOption}</select> <input type='hidden' id='prodCycleSize-#{viewId}' value = '#{productEndDateHtml.data.prodCycleSize}'/></span><span class='offerEndDateCycleStyle#{productEndDateHtml.style.cycleStyleOption}'>\u6709\u6548\u671f:<select id='cyclePeriod-#{viewId}'> #{productEndDateHtml.data.cycleOption}</select></span></div><div id='offerDelayEndDateView-#{viewId}' style='#{dateStyle.delayEndDateView}'>"+d+"</div><div>");
return e.apply(f.showData);},createSubProdOfferStatus:function(f,e){var d=BusCard.Template.create("<div class='orderStatus_#{rowIndex}'>#{orderStatus}</div>");return d.apply(e.showData);},createSubProdOfferServiceIdList:function(f,e){var d=BusCard.Template.create("<div class ='choose_number_class_#{rowIndex}'><tp:if $$.chooseNumberObj!=null><span  serviceKind='#{chooseNumberObj.serviceKind}' serviceKindIndex='#{chooseNumberObj.serviceKindIndex}' name ='#{rowIndex}' id='selected_number_#{chooseNumberObj.serviceKind}_#{chooseNumberObj.serviceKindIndex}'>#{chooseNumberObj.serviceId}</span></tp:if><span>&nbsp;&nbsp;</span></div>");
return d.apply(e.showData);},createSubProdOfferCollect:function(h,g){var f=$ac$.selectedMainProdOfferInfoVO;if(f.bindType==2){var e=dojo.global.$appContext$.get("prodOfferList"+g.uniqueId),d=b.ProdOfferHelper.getMainProdOffer(e)[0];
g.showData.mainProdOfferId=d.prodOfferId;}else{var e=dojo.global.$appContext$.get("prodOfferList"),d=b.ProdOfferHelper.getMainProdOffer(e)[0];g.showData.mainProdOfferId=d.prodOfferId;}return BusCard.Template.create("<div class='collect_prodOffer_#{rowIndex}' style='text-align:center'><img class='collect-#{rowIndex}' name='collectProdOffer' src='"+BusCard.path.contextPath+"/common/images/button/button_addFav.png' value='#{subProdOfferInfo.prodOfferId}~#{subProdOfferInfo.prodOfferName}~#{subProdOfferInfo.prodOfferType}~#{mainProdOfferId}'style='cursor: pointer; width: 20px; height: 20px;margin-right:10px' dojoAttachEvent='onclick:elementclick' dojoAttachTopic='/prodOfferCollect' title='收藏'/>&nbsp;&nbsp;<img class='cancelCollect-#{rowIndex}' name='cancelCollectProdOffer' src='"+BusCard.path.contextPath+"/common/images/button/button_cancelFav.png' value='#{subProdOfferInfo.prodOfferId}~#{subProdOfferInfo.prodOfferType}~#{mainProdOfferId}'style='cursor: pointer; width: 20px; height: 20px;' dojoAttachEvent='onclick:elementclick' dojoAttachTopic='/prodOfferCancelCollect' title='取消收藏'/></div>").apply(g.showData);
},createSubProdOfferDelView:function(f,e){var d=BusCard.Template.create("<div class ='offer_del_class_#{rowIndex}'><img class='sub-prodoffer-del-img_#{rowIndex}' #{disabledDelViewOption} rowIndex='#{rowIndex}'src='"+BusCard.path.contextPath+"/common/images/button/reduce_button.png'style='cursor: pointer; width: 15px; height: 15px;'dojoAttachEvent='onclick:elementclick'dojoAttachTopic='/delSubProdOfferView' /></div>");
return d.apply(e.showData);}};orderaccept.prodofferaccept.formatter.FormatterProvider.SubProdOfferHelper=a;});
defineModule("orderaccept.prodofferaccept.builder.prodofferdetail.ResRelaBuilder",["../../util","../../widget/resourcecard/ResourceCardWidget","orderaccept.common.dialog.MessageBox"],function(a,c,b){dojo.declare("orderaccept.prodofferaccept.builder.prodofferdetail.ResRelaBuilder",[],{resourceCardWidgetClass:c,constructor:function(d){this.loader=d.loader,this.prodOfferDetailWidget=d.prodOfferDetailWidget,this.prodOfferInfo=d.prodOfferInfo,this.tabContainer=d.tabContainer,this.contentPane=d.contentPane,this.resRelaKind=d.resRelaKind,this.resRelaItemList=[],this.resourceCardList=[],this.couponsCardObj=null,this.couponsList=[],this.couponIndex=0;
},initResourceAttr:function(){var f=this,d=f.loader,h=f.resourceCardWidgetClass,j=this.prodOfferDetailWidget,i=this.prodOfferInfo,e=this.tabContainer,g=this.contentPane;if(i.resRelaList&&i.resRelaList.length>0){e.addChild(g);
}dojo.forEach(i.resRelaList,function(q){if(!q||!q.mktResCd){return;}var n={productId:a.RES_RELA_CONST.DEFAULT_PRODUCT,serviceOfferId:q.mktResCd/-1,cityCode:d.requestParam.customerData.cityCode};if(q.mktResCd==a.RES_RELA_CONST.SUBSIDY_ACCEPT){var k=i.attrList;
for(var l=0,m=k.length;l<m;l++){var r=k[l];if(r.attrCd==a.RES_RELA_CONST.SUBSIDY_ATTR_CD){n.subsidyFee=r.defaultValue;break;}}}if(q.mktResCd==a.RES_RELA_CONST.RENT_ACCEPT){var k=i.attrList;for(var l=0,m=k.length;
l<m;l++){var r=k[l];if(r.attrCd==a.RES_RELA_CONST.RENT_ATTR_CD){var o=r.defaultValue;var s=dojo.query("[id="+r.attrCd+"]",g.domNode)[0];if(s){o=s.value||"0";dojo.connect(s,"onblur",function(){var v=this.value;
if(!v){return;}if(dojo.query("[id=realFee]",g.domNode)[0]){dojo.query("[id=realFee]",g.domNode)[0].value=v;}});}n.realFee=o;n.mktResName=q.mktResName;break;}}}var t=new h(n);t.renderCard(g.domNode,"last");
f.resourceCardList.push(t);var u={prodOfferInfoVO:i,productInfoVO:"",resRelaInfo:q,itemIndex:q.mktResCd,acceptCardObj:t.busCardInstance};f.resRelaItemList[q.mktResCd]=u;if(q.mktResCd==a.RES_RELA_CONST.GIFT_ACCEPT){var p="<div id='showCoupons' style='margin-left:0px;margin-right:0px'>														<input type='hidden' id='couponsInfo' name='couponsInfo' value='' />														<table width='100%' border='1' cellspacing='0' cellpadding='0' 																bordercolor='#bce2f5' style='border-collapse: collapse;'> 															<tr> 																<td colspan='4' align='right'> 																	<input type='button' name='addRecord' id='addRecord' value='\u6dfb\u52a0'  																		dojoAttachEvent='onclick:elementclick' dojoAttachTopic='/couponsAdd'																		rowIndex="+j.rowIndex+"																		style='cursor:pointer;text-align:center;vertical-align:middle;' class='button_l'/> 																</td> 															</tr> 															<tr> 																<td align='center'>\u793c\u5238\u7f16\u53f7</td> 																<td align='center'>\u9884\u5b58\u6b3e</td> 																<td align='center'>\u9884\u5b58\u751f\u6548\u65f6\u95f4</td> 																<td align='center'>\u64cd\u4f5c</td> 															</tr> 															<tbody id='couponsData'></tbody> 														</table> 													</div>";
dojo.place(p,g.domNode,"last");var t=new h({productId:"-10000",serviceOfferId:"-1000",cityCode:d.requestParam.cityCode});t.renderCard(g.domNode,"last");t.busCardInstance.setParent(g);f.resourceCardList.push(t);
f.couponsCardObj=t.busCardInstance;j.enableEvtMsgPropagation(g.domNode);}});j.resourceCardList=f.resourceCardList;j.resRelaItemList=f.resRelaItemList;},addRecord:function(j,f){var i=this;if(!j){b.alert({busiCode:"08410119"});
return;}var l=j.split("~");var h=l[0];var g=l[1];var o=l[2];var e=false;dojo.forEach(this.couponsList,function(p){if(p.couponNo==h){e=true;}});if(e){b.alert({busiCode:"08410120"});return false;}var d="tr_"+this.couponIndex;
var m=dojo.query("[id=couponsData]",f)[0];var k=m.insertRow();k.setAttribute("id",d);myTd=k.insertCell(0);myTd.setAttribute("align","center");myTd.innerHTML=h;myTd=k.insertCell(1);myTd.setAttribute("align","center");
myTd.innerHTML=g;myTd=k.insertCell(2);myTd.setAttribute("align","center");myTd.innerHTML=o;myTd=k.insertCell(3);myTd.setAttribute("align","center");myTd.innerHTML="<a href='javascript:void(0);' id='href_"+this.couponIndex+"' trId='"+d+"'>\u5220\u9664</a>";
var n={couponNo:h,payMent:g,myTrId:d,rowIndex:this.couponIndex};this.couponsList.push(n);$("href_"+this.couponIndex);dojo.query("[id=href_"+this.couponIndex+"]",f)[0].onclick=function(){i.deleteRow(event.srcElement);
};this.couponIndex++;},deleteRow:function(n){var f=event.srcElement.getAttribute("trId");while(true){if(n&&(n.tagName||"").toUpperCase()=="TR"){n.parentNode.removeChild(n);break;}n=n.parentNode;}for(var g=0;
g<this.couponsList.length;g++){if(this.couponsList[g].myTrId==f){var m=this.couponsList[g].couponNo;var l=null;try{l=ordermgr.accept.compnew._coupon_no_list_;}catch(k){}if(l){for(var d=0;d<l.length;d++){var h=l[d].couponNO;
if(h.length>0&&h==m){ordermgr.accept.compnew._coupon_no_list_.splice(d,1);}}}this.couponsList.splice(g,1);}}},getPageData:function(){var h=this,i=this.prodOfferDetailWidget,k=i.prodOfferAttrCard;h.resRelaDataList=[];
for(var e in h.resRelaItemList){if(!h.resRelaItemList.hasOwnProperty(e)){continue;}var n=h.resRelaItemList[e];if(n.resRelaInfo.mktResCd==a.RES_RELA_CONST.GIFT_ACCEPT){var g=h.getAllMktResInstId();n.acceptCardObj.$("mktResInstId").value=g;
}var l=n.acceptCardObj.getData();if(l==false){if(n&&n.resRelaInfo&&n.resRelaInfo.mktResCd==a.RES_RELA_CONST.RENT_ACCEPT){n.acceptCardObj.$("deviceNo").focus();}h.resRelaDataList=[];return false;}n.acceptCardData=l;
var o={};o.mktResCd=n.resRelaInfo.mktResCd;if(l.mktResInstId.indexOf("~")==-1){o.mktResInstId=l.mktResInstId&&typeof(l.mktResInstId)!="undefined"?l.mktResInstId:"-1";}else{o.resinstIdStr=l.mktResInstId&&typeof(l.mktResInstId)!="undefined"?l.mktResInstId:"-1";
}if(n.resRelaInfo.mktResCd==a.RES_RELA_CONST.GIFT_ACCEPT){o.coupons=h.getAllMktCouponNo();}o.relaType=n.resRelaInfo.relaType;o.mktResTypeCd=n.resRelaInfo.mktResTypeCd;o.resRelaKind=h.resRelaKind;o.mktResId=l.mktResId&&typeof(l.mktResId)!="undefined"?l.mktResId:"-1";
o.verifyNo=l.verifyNo&&typeof(l.verifyNo)!="undefined"?l.verifyNo:"-1";if(n.resRelaInfo.mktResCd==a.RES_RELA_CONST.SUBSIDY_ACCEPT){var j={operKind:0,cardKind:1,cardValue:l.subFee&&typeof(l.subFee)!="undefined"?(l.subFee/1)*100+"":"0"};
o.modifyContent=dojo.toJson(j);}else{if(n.resRelaInfo.mktResCd==a.RES_RELA_CONST.RENT_ACCEPT){var j={updateStatus:"0",saleMobilePrice:l.realFee&&typeof(l.realFee)!="undefined"?(l.realFee/1)*100+"":"0"};
o.modifyContent=dojo.toJson(j);}else{if(n.resRelaInfo.mktResCd==a.RES_RELA_CONST.GIFT_ACCEPT){var j={updateStatus:"0"};o.modifyContent=dojo.toJson(j);var f="-1";var d="-1";if(h.couponsCardObj){var m=h.couponsCardObj.getData();
if(m==false){h.couponsCardObj.$("cdeviceNo").focus();h.resRelaDataList=[];return false;}f=m.cmktResInstId&&typeof(m.cmktResInstId)!="undefined"?m.cmktResInstId:"-1";d=m.cdeviceNo&&typeof(m.cdeviceNo)!="undefined"?m.cdeviceNo:"-1";
}o.deviceInstId=f;o.deviceNo=d;if(k&&k.busCardInstance&&k.busCardInstance.$("936")){h.countCouponValue();}}else{if(n.resRelaInfo.mktResCd==a.RES_RELA_CONST.INTERNET_CAT){var j={updateStatus:"0"};o.modifyContent=dojo.toJson(j);
}else{o.modifyContent="";}}}}h.resRelaDataList.push(o);}return h.resRelaDataList;},countCouponValue:function(){var g=0,d=null,m=this.prodOfferDetailWidget,h=m.prodOfferAttrCard;try{d=ordermgr.accept.compnew._coupon_no_list_;
}catch(l){}if(d){for(var f=0;f<d.length;f++){var k=d[f].payMent;g+=parseInt(k);}}var j=h.busCardInstance.$("936");if(j){j.value=g;}},getAllMktResInstId:function(){var h="";var d=null;try{d=ordermgr.accept.compnew._coupon_no_list_;
}catch(k){}if(d){for(var g=0;g<d.length;g++){var f=dojo.some(this.couponsList||[],function(e){return e.couponNo==d[g].couponNO;});if(f){var j=d[g].mktResInstId;h+=(j+"~");}}h=h.substring(0,h.length-1);
}return h;},getAllMktCouponNo:function(){var k="";var d=null;try{d=ordermgr.accept.compnew._coupon_no_list_;}catch(j){}if(d){for(var g=0;g<d.length;g++){var f=dojo.some(this.couponsList||[],function(e){return e.couponNo==d[g].couponNO;
});if(f){var h=d[g].couponNO;k+=(h+"~");}}k=k.substring(0,k.length-1);}return k;},setCheckedValue:function(e,d,f){if(e.$(d)){e.$(d).value=f;if(d=="cdeviceNo"){e.$("cdeviceNo").focus();}e.$(d).onblur();
}}});});
defineModule("orderaccept.prodofferaccept.widget.assurecard.AssureCardWidget",["../../../custom/_BaseWidget","../../../custom/_BusCardTemplated"],function(b,a){dojo.declare("orderaccept.prodofferaccept.widget.assurecard.AssureCardWidget",[b,a],{delayCreateBeforeBindModel:true,templateString:"buscard://www.crm1.com",attrCardWidget:null,postMixInProperties:function(){var c=this.getModel();
this.cardParam=c;},destroy:function(){if(this.attrCardWidget){this.attrCardWidget.destroy();}this.inherited(arguments);}});});
defineModule("orderaccept.custom.Grid",["unieap.grid.Grid","./_BaseWidget"],function(b,a){dojo.declare("orderaccept.custom.Grid",[b,a],{postMixInProperties:function(){var c=this;if(!this.height){this.height="100%";
}this.rows={onAfterRenderRow:function(d){c.managers.get("ViewManager").forEach(function(e){c.enableEvtMsgPropagation(e.getRowNode(d));});}};this.layout={structure:[{rows:[this.cm]}]};this.inherited(arguments);
},getScroller:function(){return this.managers.get("ViewManager").scroller;}});});
defineModule("orderaccept.custom.BusCardGrid",["./_BaseWidget","./_BusCardTemplated"],function(b,a){dojo.declare("orderaccept.custom.BusCardGrid",[b,a],{templateString:"<div></div>",_attachTemplateNodes:function(d,c){if(d){this._renderBusCardGrid(d);
}this.inherited(arguments);},_renderBusCardGrid:function(c){this.ds=this.ds||(new BusCard.widget.grid.DataSource([],this.cm));this.cssClass=this.cssClass||"grid-global";this.listeners=dojo.mixin({}||this.listeners,{rowmouseover:function(){},rowmouseout:function(){}});
this._grid=new BusCard.widget.grid.Grid(dojo.mixin(dojo.mixin({},this.params),{ds:this.ds,cssClass:this.cssClass,listeners:this.listeners}));this._grid.render(c);this.bindMessagePropagation(this._grid);
},bindMessagePropagation:function(d){var e=this;var f=d.getFooterElemMap();if(f){var c=function(){e.enableEvtMsgPropagation(d.getDomElement());};BusCard.each([f.first,f.prev,f.next,f.last,f.jump],function(g){BusCard.addEventListener(g,"click",c);
});}},remove:function(c){if(c==null){var d=this._grid.getDataSource();while(d.getCount()){d.deleteRecord(0);}this._grid.freshPage();}else{this._grid.getDataSource().deleteRecord(c);this._grid.freshPage();
}},getData:function(){return this._grid.getDataSource().getRawData();},add:function(c){this.enableEvtMsgPropagation(this._grid.addRecord(c));},query:function(c){return dojo.query(c,this.domNode);},setDataSource:function(){this._grid.setDataSource(arguments[0]);
this.enableEvtMsgPropagation(this.domNode);}});});
defineModule("orderaccept.prodofferaccept.builder.prodofferdetail.ProdOfferAssureBuilder",["../../util","../../widget/assurecard/AssureCardWidget","orderaccept.common.js.ConstantsPool","../../../custom/Grid","../../../custom/BusCardGrid","orderaccept.common.dialog.MessageBox","unieap.layout.ContentPane"],function(util,AssureCardWidget,ConstantsPool,Grid,BusCardGrid,messageBox){dojo.declare("orderaccept.prodofferaccept.builder.prodofferdetail.ProdOfferAssureBuilder",[],{assureCardWidgetClass:AssureCardWidget,constructor:function(args){this.detailBuild=args.detailBuilder,this.prodOfferDetailWidget=args.prodOfferDetailWidget,this.prodOfferInfo=args.prodOfferInfo,this.tabContainer=args.tabContainer;
},AssureMethodConst:ConstantsPool.load("AssureMethodConst").AssureMethodConst,initProdOfferAssure:function(){var builder=this,subRowIndex=builder.prodOfferDetailWidget.rowIndex,uniqueId=!!builder.detailBuild&&!!builder.detailBuild.provider?builder.detailBuild.provider.uniqueId:"",prodOfferAssureInfoList=builder.prodOfferInfo.prodOfferAssureDemandVO;
if(!prodOfferAssureInfoList||prodOfferAssureInfoList.length==0){return;}var assureView=builder.initAssureView(subRowIndex,uniqueId);contentPane=new unieap.layout.ContentPane({title:"担保信息",width:"600px"});
dojo.place(assureView,contentPane.domNode,"last");var assureAttrCardWidget=new builder.assureCardWidgetClass({level:4,cardMetaData:{gType:2,cardId:222}});assureAttrCardWidget.addCardCallback(function(){builder.displaySomeAttributes();
});assureAttrCardWidget.renderCard(dojo.query(".assureAttr"+subRowIndex,contentPane.domNode)[0],"last");builder.prodOfferDetailWidget.assureAttrCard=assureAttrCardWidget;var data=[];dojo.forEach(prodOfferAssureInfoList,function(assureInfo){var assureName="";
switch(assureInfo.securityMethodCD){case builder.AssureMethodConst.ASSURE_CASH:assureName="现金担保";break;case builder.AssureMethodConst.ASSURE_PRODUCT:assureName="产品担保";break;case builder.AssureMethodConst.ASSURE_ACCOUNT:assureName="账户担保";
break;case builder.AssureMethodConst.ASSURE_CUST:assureName="客户担保";break;case builder.AssureMethodConst.ASSURE_PROMOTION:assureName="租机担保";break;default:assureName="未知的担保类型";break;}data.push({assureName:assureName,assureDesc:assureInfo.securityDesc,assureValue:assureInfo.securityValue,assureDate:assureInfo.securityDur,assureMethodCD:assureInfo.securityMethodCD,pOfferAssureDmdID:assureInfo.pOfferAssureDmdID});
});var cm=new BusCard.widget.grid.ColumnModel({metaData:this.getOfferAssureColumns(subRowIndex)});var ds=new BusCard.widget.grid.DataSource(data,cm);var grid=new BusCardGrid({cm:cm,ds:ds},dojo.query(".assureInfo"+subRowIndex+"-"+uniqueId,contentPane.domNode)[0]);
builder.initEvent(subRowIndex,grid);builder.tabContainer.addChild(contentPane);builder.prodOfferDetailWidget.finalDataSource=ds;builder.prodOfferDetailWidget.assureInfoGrid=grid;},initEvent:function(subRowIndex,grid){var detailWidget=this.detailBuild.prodOfferDetailWidgetList[subRowIndex];
var assureDescList=dojo.query(".assureDescResult",grid.domNode);dojo.forEach(assureDescList,function(assureDescDom){dojo.connect(assureDescDom,"onblur",function(){var radio=dojo.query("#assureRadio"+assureDescDom.getAttribute("rindex"),grid.domNode)[0];
if(radio.checked==true&&!!detailWidget.assurePageData){detailWidget.assurePageData.securityDesc=assureDescDom.value;}});});var assureDateList=dojo.query(".assureDateResult",grid.domNode);dojo.forEach(assureDateList,function(assureDateDom){dojo.connect(assureDateDom,"onblur",function(){if(!!assureDateDom.value&&!/^\d+$/.test(assureDateDom.value)){messageBox.alert({title:"\u63d0\u793a\u4fe1\u606f",message:"[\u62c5\u4fdd\u65f6\u957f]\u5e94\u4e3a\u5927\u4e8e\u7b49\u4e8e0\u7684\u6570\u5b57"},assureDateDom);
assureDateDom.value="";return false;}var radio=dojo.query("#assureRadio"+assureDateDom.getAttribute("rindex"),grid.domNode)[0];if(radio.checked==true&&!!detailWidget.assurePageData){detailWidget.assurePageData.securityDur=assureDateDom.value;
}});});var assureValueList=dojo.query(".assureValueResult",grid.domNode);dojo.forEach(assureValueList,function(assureValueDom){dojo.connect(assureValueDom,"onblur",function(){if(!!assureValueDom.value&&!/^\d+(\.\d+)?$/.test(assureValueDom.value)){messageBox.alert({title:"\u63d0\u793a\u4fe1\u606f",message:"[\u62c5\u4fdd\u503c]\u5e94\u4e3a\u5927\u4e8e\u7b49\u4e8e0\u7684\u6570\u5b57"},assureValueDom);
assureValueDom.value="";return false;}var radio=dojo.query("#assureRadio"+assureValueDom.getAttribute("rindex"),grid.domNode)[0];if(radio.checked==true&&!!detailWidget.assurePageData){detailWidget.assurePageData.securityFee=assureValueDom.value;
}});});},displaySomeAttributes:function(){var assureAttrCard=this.prodOfferDetailWidget.assureAttrCard;assureAttrCard.busCardInstance.$("50034").style.display="none";assureAttrCard.busCardInstance.$("label_50034").style.display="none";
},initAssureView:function(rowIndex,uniqueId){return"<div id='assureAttr"+rowIndex+"' class='assureAttr"+rowIndex+"'></div><div id='assureInfo"+rowIndex+"-"+uniqueId+"' class='assureInfo"+rowIndex+"-"+uniqueId+"'></div><div id='assureQuery"+rowIndex+"' class='assureQuery"+rowIndex+"'></div><div id='asshowAssureQueryViewsureResult"+rowIndex+"'class='assureResult"+rowIndex+"'></div><div id='assureAcct"+rowIndex+"' class='assureAcct"+rowIndex+"'></div><div id='assureProd"+rowIndex+"' class='assureProd"+rowIndex+"'></div>";
},getOfferAssureColumns:function(subRowIndex){var assureSelectFormatter=function(value,index,record){var data=this.getDataSource().getRawData()[index];var assureSelectHtml="<div class='assureNameSelect"+index+"'><input type = 'radio' id ='assureRadio"+index+"' name = 'assureRadio"+subRowIndex+"' assureMethodCD='"+data.assureMethodCD+"' class='assureRadio"+subRowIndex+"' rowIndex = '"+index+"'  subRowIndex = '"+subRowIndex+"' dojoAttachEvent='onclick:elementclick' dojoAttachTopic='/assureSelect'></div>";
return assureSelectHtml;};var assureInfoFormatter=function(value,index){var assureInfoHtml="<div class='assureInfoDiv"+index+"'><span class = 'assureInfoResult"+index+"'></span>";"</div>";return assureInfoHtml;
};var assureObjFormatter=function(value,index){var assureInfoHtml="<div class='assureObjDiv"+index+"'><span class = 'assureObjResult"+index+"'></span>";"</div>";return assureInfoHtml;};var assureDateFormatter=function(value,index){var assureInfoHtml="<input type='text' style='width:90%;text-align:center;float:center' value='"+value+"'                                class='buscard-el buscard-input-line assureDateResult assureDateResult"+index+"' rindex='"+index+"'/>";
return assureInfoHtml;};var assureDescFormatter=function(value,index){var assureInfoHtml="<input type='text' style='width:90%;text-align:center;float:center' value='"+value+"'                                class='buscard-el buscard-input-line assureDescResult assureDescResult"+index+"' rindex='"+index+"'/>";
return assureInfoHtml;};var assureValueFormatter=function(value,index){var assureValue="";if(!isNaN(parseFloat(value))){assureValue=parseFloat(value)/100;}var assureInfoHtml="<input type='text' style='width:90%;text-align:center;float:center' value='"+assureValue+"'                                class='buscard-el buscard-input-line assureValueResult assureValueResult"+index+"' rindex='"+index+"'/>";
return assureInfoHtml;};return cm=[{width:"7%",name:"assureSelect",text:"选择",render:assureSelectFormatter},{width:"10%",name:"assureName",text:"担保方式",value:"assureMethodCD"},{width:"10%",name:"assureDesc",text:"担保内容",render:assureDescFormatter},{width:"10%",name:"assureValue",text:"担保值（元）",render:assureValueFormatter},{width:"10%",name:"assureDate",text:"担保时长(月)",render:assureDateFormatter},{width:"15%",name:"assureInfo",text:"担保对象类型",render:assureObjFormatter},{width:"20%",name:"assureInfo",text:"担保对象标识",render:assureInfoFormatter}];
},showAssureQueryView:function(rowIndex,subRowIndex,assureMethodCD){var builder=this,detailBuild=builder.detailBuild,detailWidget=detailBuild.prodOfferDetailWidgetList[subRowIndex];if(detailWidget.assureCardWidget){detailWidget.assureCardWidget.destroy();
}if(assureMethodCD==builder.AssureMethodConst.ASSURE_CASH){detailWidget.assureInfoGrid.setDataSource(detailWidget.finalDataSource);builder.initEvent(subRowIndex,detailWidget.assureInfoGrid);dojo.query("[id=assureRadio"+rowIndex+"]",detailWidget.domNode)[0].checked=true;
builder.onAssureCommitClick(rowIndex,subRowIndex);}else{var assureCardWidget=new builder.assureCardWidgetClass({productId:"-20000",serviceOfferId:"-223"});assureCardWidget.addCardCallback(function(){var busCardInst=this.busCardInstance;
if(!!busCardInst.$("assureQueryMethod")){busCardInst.$("assureQueryMethod").disabled=true;busCardInst.$("assureQueryMethod").value=assureMethodCD;busCardInst.displaySubGroupByIndex(0,0);if(assureMethodCD==builder.AssureMethodConst.ASSURE_CUST||busCardInst.$("assureQueryMethod").value==builder.AssureMethodConst.ASSURE_ACCOUNT){busCardInst.displaySubGroupByIndex(1,0);
busCardInst.hiddenSubGroupByIndex(2,0);}else{if(assureMethodCD==builder.AssureMethodConst.ASSURE_PRODUCT){busCardInst.hiddenSubGroupByIndex(1,0);busCardInst.displaySubGroupByIndex(2,0);var assureProductId=busCardInst.$("assureProductId");
var assureProdHTML=assureProductId.outerHTML;dojo.connect(busCardInst.$("assureServiceId"),"onblur",function(){var productIdSelect=assureProdHTML;if(busCardInst.$("assureServiceId").value!=""){var param="&serviceId="+busCardInst.$("assureServiceId").value+"&ifValid=1";
var productIdList=util.ServiceFactory.getService("url:custAcceptAjaxAction.do?method=getProductIdList"+param);if(productIdList!="-1"){productIdSelect=productIdList.replace(/productId/g,"assureProductId");
}}busCardInst.$("assureProductId").outerHTML=productIdSelect;});}}}});assureCardWidget.renderCard(dojo.byId("assureQuery"+subRowIndex),"last");builder.clearView(dojo.query(".assure-buttons"+subRowIndex)[0],true);
builder.clearView(dojo.query(".assureResult"+subRowIndex)[0]);builder.clearView(dojo.query(".assureAcct"+subRowIndex)[0]);builder.clearView(dojo.query(".assureProd"+subRowIndex)[0]);if(assureMethodCD!=builder.AssureMethodConst.ASSURE_CASH){var buttons="<div style='text-align:left;vertical-align:middle' class='assure-buttons"+subRowIndex+"'><a href='javascript:void(0);' id = 'query"+subRowIndex+"' dojoAttachEvent='onclick:elementclick'  subRowIndex="+subRowIndex+" rowIndex="+rowIndex+" dojoAttachTopic='/assureQuery' style='text-align:center;vertical-align:middle;color:red;'>&nbsp查询&nbsp</a></div>";
dojo.place(buttons,dojo.byId("assureQuery"+subRowIndex),"last");}detailWidget.enableEvtMsgPropagation(dojo.byId("assureQuery"+subRowIndex));detailWidget.assureCardWidget=assureCardWidget;}},clearView:function(node,flag){while(node&&node.hasChildNodes()){node.removeChild(node.firstChild);
}if(node&&flag){node.parentNode.removeChild(node);}},assureQuery:function(subRowIndex){var assureCardWidget=this.detailBuild.prodOfferDetailWidgetList[subRowIndex].assureCardWidget;if(assureCardWidget.busCardInstance.$("assureQueryMethod").value==this.AssureMethodConst.ASSURE_CUST||assureCardWidget.busCardInstance.$("assureQueryMethod").value==this.AssureMethodConst.ASSURE_ACCOUNT){if(!assureCardWidget.busCardInstance.$("identityCode")||assureCardWidget.busCardInstance.$("identityCode").value==""){messageBox.alert({busiCode:"08410113"},assureCardWidget.busCardInstance.$("identityCode"));
return false;}this.assureCustView(subRowIndex);}else{if(assureCardWidget.busCardInstance.$("assureQueryMethod").value==this.AssureMethodConst.ASSURE_PRODUCT){if(!assureCardWidget.busCardInstance.$("assureServiceId")||assureCardWidget.busCardInstance.$("assureServiceId").value==""){messageBox.alert({busiCode:"08410112"},assureCardWidget.busCardInstance.$("assureServiceId"));
return false;}this.assureProductView(subRowIndex);}}},assureCustView:function(subRowIndex){this.clearView(dojo.query(".assureResult"+subRowIndex)[0]);this.clearView(dojo.query(".assureAcct"+subRowIndex)[0]);
this.clearView(dojo.query(".assureProd"+subRowIndex)[0]);var assureCardWidget=this.detailBuild.prodOfferDetailWidgetList[subRowIndex].assureCardWidget;var cm=new BusCard.widget.grid.ColumnModel({metaData:this.getAssureCustColumns(subRowIndex)}),totalProperty=BusCard.$remote("custIdentBO").getCustIdentCount({identityCode:assureCardWidget.busCardInstance.$("identityCode").value,identityKind:assureCardWidget.busCardInstance.$("identityKind").value});
ds=new BusCard.widget.grid.JsonDataSource({loadData:function(param){var list=BusCard.$remote("custIdentBO").getCustIdentPartInfo({identityCode:assureCardWidget.busCardInstance.$("identityCode").value,identityKind:assureCardWidget.busCardInstance.$("identityKind").value,startRows:param.start+1,endRows:param.end+1});
return{totalProperty:totalProperty,root:list};}},cm);grid=new BusCardGrid({cm:cm,ds:ds,paging:true,pageSize:5});dojo.place(grid.domNode,dojo.query(".assureResult"+subRowIndex)[0],"last");this.detailBuild.prodOfferDetailWidgetList[subRowIndex].assureCustGrid=grid;
},getAssureCustColumns:function(subRowIndex){var assureCustFormatter=function(value,index){var assureCustHtml="<div class='assureCustSelect"+index+"'><input type = 'radio' id ='assureCustRadio"+index+"' name = 'assureCustRadio"+subRowIndex+"' rowIndex = '"+index+"'  subRowIndex = '"+subRowIndex+"' dojoAttachEvent='onclick:elementclick' dojoAttachTopic='/assureCustSelect'></div>";
return assureCustHtml;};return cm=[{width:"7%",name:"custSelect",text:"选择",render:assureCustFormatter},{width:"10%",name:"custId",text:"客户编号"},{width:"10%",name:"custName",text:"客户名称"},{width:"10%",name:"identityKind",text:"证件类型"},{width:"20%",name:"identityCode",text:"证件号码"},{width:"30%",name:"custAddr",text:"客户地址"},{width:"10%",name:"custStatus",text:"客户状态"}];
},assureAccountView:function(subRowIndex,custData){this.clearView(dojo.query(".assureAcct"+subRowIndex)[0]);var cm=new BusCard.widget.grid.ColumnModel({metaData:this.getAssureAccountColumns(subRowIndex)}),totalProperty=BusCard.$remote("prodOfferSaleDataBO").getAccountCountByCustId(custData.custId,"");
ds=new BusCard.widget.grid.JsonDataSource({loadData:function(param){var list=BusCard.$remote("prodOfferSaleDataBO").getAccountListByCustId(custData.custId,"",param.start,param.end);return{totalProperty:totalProperty,root:list};
}},cm);grid=new BusCardGrid({cm:cm,ds:ds,paging:true,pageSize:5});dojo.place(grid.domNode,dojo.query(".assureAcct"+subRowIndex)[0],"last");grid.custData=custData;this.detailBuild.prodOfferDetailWidgetList[subRowIndex].assureAccountGrid=grid;
},getAssureAccountColumns:function(subRowIndex){var assureAccountFormatter=function(value,index){var assureAccountHtml="<div class='assureAccountSelect"+index+"'><input type = 'radio' id ='assureAccountRadio"+index+"' name = 'assureAccountRadio"+subRowIndex+"' rowIndex = '"+index+"'  subRowIndex = '"+subRowIndex+"' dojoAttachEvent='onclick:elementclick' dojoAttachTopic='/assureAccountSelect'></div>";
return assureAccountHtml;};return cm=[{width:"7%",name:"accountSelect",text:"选择",render:assureAccountFormatter},{width:"10%",name:"accountId",text:"账户编号"},{width:"10%",name:"accountName",text:"账户名称"},{width:"10%",name:"stateDesc",text:"账户状态"},{width:"20%",name:"ifDefaultDesc",text:"是否默认帐户"},{width:"30%",name:"activeDate",text:"账户生效时间"},{width:"10%",name:"accountTel",text:"付费电话"}];
},assureProductView:function(subRowIndex){var assureCardWidget=this.detailBuild.prodOfferDetailWidgetList[subRowIndex].assureCardWidget;this.clearView(dojo.query(".assureProd"+subRowIndex)[0]);var cm=new BusCard.widget.grid.ColumnModel({metaData:this.getAssureProductColumns(subRowIndex)}),totalProperty=BusCard.$remote("prodInstCommFacadeBO").getServiceRelationCount({serviceId:assureCardWidget.busCardInstance.$("assureServiceId").value,productId:assureCardWidget.busCardInstance.$("assureProductId").value});
ds=new BusCard.widget.grid.JsonDataSource({loadData:function(param){var list=BusCard.$remote("prodInstCommFacadeBO").getServiceRelationByServiceIdPage({serviceId:assureCardWidget.busCardInstance.$("assureServiceId").value,productId:assureCardWidget.busCardInstance.$("assureProductId").value,startRows:param.start,endRows:param.end});
dojo.forEach(list,function(serviceRelationVO){var productName=BusCard.$remote("innerInterfaceBO").getProductName(serviceRelationVO.productId);serviceRelationVO.productName=eval("("+productName+")");});
return{totalProperty:totalProperty,root:list};}},cm);grid=new BusCardGrid({cm:cm,ds:ds,paging:true,pageSize:5});dojo.place(grid.domNode,dojo.query(".assureProd"+subRowIndex)[0],"last");this.detailBuild.prodOfferDetailWidgetList[subRowIndex].assureProductGrid=grid;
},getAssureProductColumns:function(subRowIndex){var assureProductFormatter=function(value,index){var assureProductHtml="<div class='assureProductSelect"+index+"'><input type = 'radio' id ='assureProductRadio"+index+"' name = 'assureProductRadio"+subRowIndex+"' rowIndex = '"+index+"'  subRowIndex = '"+subRowIndex+"' dojoAttachEvent='onclick:elementclick' dojoAttachTopic='/assureProductSelect'></div>";
return assureProductHtml;};return cm=[{width:"7%",name:"prodSelect",text:"选择",render:assureProductFormatter},{width:"10%",name:"userId",text:"产品实例编号"},{width:"10%",name:"serviceId",text:"业务号码"},{width:"10%",name:"productName",text:"产品名称"}];
},onAssureCustSelectClick:function(rowIndex,subRowIndex){var assureMethodCD=this.detailBuild.prodOfferDetailWidgetList[subRowIndex].assureCardWidget.busCardInstance.$("assureQueryMethod").value;var custData=this.detailBuild.prodOfferDetailWidgetList[subRowIndex].assureCustGrid.ds.getRawData()[rowIndex];
if(assureMethodCD==this.AssureMethodConst.ASSURE_CUST){this.detailBuild.prodOfferDetailWidgetList[subRowIndex].assureCustInfo=custData;this.onAssureCommitClick(rowIndex,subRowIndex);}else{if(assureMethodCD==this.AssureMethodConst.ASSURE_ACCOUNT){this.assureAccountView(subRowIndex,custData);
}}},onAssureAccountSelectClick:function(rowIndex,subRowIndex){var assureMethodCD=this.detailBuild.prodOfferDetailWidgetList[subRowIndex].assureCardWidget.busCardInstance.$("assureQueryMethod").value;var custData=this.detailBuild.prodOfferDetailWidgetList[subRowIndex].assureAccountGrid.custData;
var accountData=this.detailBuild.prodOfferDetailWidgetList[subRowIndex].assureAccountGrid.ds.getRawData()[rowIndex];this.detailBuild.prodOfferDetailWidgetList[subRowIndex].assureCustInfo=custData;this.detailBuild.prodOfferDetailWidgetList[subRowIndex].assureAccountInfo=accountData;
this.onAssureCommitClick(rowIndex,subRowIndex);},onAssureProductSelectClick:function(rowIndex,subRowIndex){var assureMethodCD=this.detailBuild.prodOfferDetailWidgetList[subRowIndex].assureCardWidget.busCardInstance.$("assureQueryMethod").value;
var productInfo=this.detailBuild.prodOfferDetailWidgetList[subRowIndex].assureProductGrid.ds.getRawData()[rowIndex];this.detailBuild.prodOfferDetailWidgetList[subRowIndex].assureProductInfo=productInfo;
this.onAssureCommitClick(rowIndex,subRowIndex);},onAssureCommitClick:function(rowIndex,subRowIndex){var builder=this,detailBuild=this.detailBuild,detailWidget=detailBuild.prodOfferDetailWidgetList[subRowIndex],radios=dojo.query(".assureRadio"+subRowIndex,detailWidget.domNode),radio=dojo.filter(radios,function(radio){return radio.checked==true;
})[0],rindex=radio.getAttribute("rowindex");detailWidget.assureInfoGrid.setDataSource(detailWidget.finalDataSource);builder.initEvent(subRowIndex,detailWidget.assureInfoGrid);var assureCardWidget=detailWidget.assureCardWidget,assureAttrCardWidget=detailWidget.assureAttrCard,assureCustData=detailWidget.assureCustInfo,assureAccountInfo=detailWidget.assureAccountInfo,assureProductInfo=detailWidget.assureProductInfo,assureInfoGrid=detailWidget.assureInfoGrid,assurePageData=assureInfoGrid.ds.getRawData()[rindex],assureInfoResult=dojo.query(".assureInfoResult"+rindex,detailWidget.domNode)[0],assureObjResult=dojo.query(".assureObjResult"+rindex,detailWidget.domNode)[0],securityObjId="";
if(assurePageData.assureMethodCD==builder.AssureMethodConst.ASSURE_CASH){assureCustData=null;assureAccountInfo=null;assureProductInfo=null;assureInfoResult.innerText="现金担保";assureObjResult.innerText="现金";
}else{if(assurePageData.assureMethodCD==builder.AssureMethodConst.ASSURE_CUST){assureAccountInfo=null;assureProductInfo=null;securityObjId=assureCustData.custId;assureInfoResult.innerText="客户编号:"+assureCustData.custId;
assureObjResult.innerText="客户";}else{if(assurePageData.assureMethodCD==builder.AssureMethodConst.ASSURE_ACCOUNT){assureProductInfo=null;securityObjId=assureAccountInfo.accountId;assureInfoResult.innerText="帐户编号:"+assureAccountInfo.accountId;
assureObjResult.innerText="帐户";}else{if(assurePageData.assureMethodCD==builder.AssureMethodConst.ASSURE_PRODUCT){assureCustData=null;assureAccountInfo=null;securityObjId=assureProductInfo.userId;assureInfoResult.innerText="产品实例编号:"+assureProductInfo.userId;
assureObjResult.innerText="产品实例";}}}}assureInfoResult.parentNode.style.backgroundColor="#cae3ff";assureObjResult.parentNode.style.backgroundColor="#cae3ff";dojo.query("[id=assureRadio"+rindex+"]",detailWidget.domNode)[0].checked=true;
this.clearView(dojo.query(".assureQuery"+subRowIndex)[0]);this.clearView(dojo.query(".assureResult"+subRowIndex)[0]);this.clearView(dojo.query(".assureAcct"+subRowIndex)[0]);this.clearView(dojo.query(".assureProd"+subRowIndex)[0]);
dojo.mixin(detailWidget,{assurePageData:{securityMethodCd:assurePageData.assureMethodCD,securityObjId:securityObjId,securityObjTypeCd:!!assureCardWidget?assureCardWidget.busCardInstance.$("assureQueryMethod").value:"",securityDesc:assurePageData.assureDesc,securityFee:assurePageData.assureValue,securityDur:assurePageData.assureDate,assureAttrCard:assureAttrCardWidget}});
}});});
defineModule("orderaccept.prodofferaccept.builder.promotiondetail.PromotionAssureBuilder",["../../util","../../widget/assurecard/AssureCardWidget","../prodofferdetail/ProdOfferAssureBuilder","orderaccept.common.js.ConstantsPool","../../../custom/Grid","../../../custom/BusCardGrid","unieap.layout.ContentPane"],function(b,d,c,f,a,e){dojo.declare("orderaccept.prodofferaccept.builder.promotiondetail.PromotionAssureBuilder",[c],{constructor:function(g){this.promotionInfo=g.promotionInfo;
this.inherited(arguments);},PromotionTypeConst:f.load("PromotionTypeConst").PromotionTypeConst,initProdOfferAssure:function(){var g=this;this.inherited(arguments);},displaySomeAttributes:function(){var g=this.prodOfferDetailWidget.assureAttrCard;
g.busCardInstance.$("50034").style.display="";g.busCardInstance.$("label_50034").style.display="";},showAssureQueryView:function(m,h,l){var k=this.promotionInfo;var g=this;if(k.promotionType==g.PromotionTypeConst.DEVICE_RENT||k.promotionType==g.PromotionTypeConst.TELCHARGE_COUPON){detailBuild=g.detailBuild,detailWidget=detailBuild.prodOfferDetailWidgetList[h];
if(detailWidget.assureCardWidget){detailWidget.assureCardWidget.destroy();}if(l==g.AssureMethodConst.ASSURE_CASH||l==g.AssureMethodConst.ASSURE_PROMOTION){detailWidget.assureInfoGrid.setDataSource(detailWidget.finalDataSource);
dojo.query("[id=assureRadio"+m+"]",detailWidget.domNode)[0].checked=true;g.onPromotionAssureCommitClick(m,h);}else{var j=new g.assureCardWidgetClass({productId:"-20000",serviceOfferId:"-223"});j.addCardCallback(function(){var n=this.busCardInstance;
if(!!n.$("assureQueryMethod")){n.$("assureQueryMethod").disabled=true;n.$("assureQueryMethod").value=l;n.displaySubGroupByIndex(0,0);if(l==g.AssureMethodConst.ASSURE_CUST||n.$("assureQueryMethod").value==g.AssureMethodConst.ASSURE_ACCOUNT){n.displaySubGroupByIndex(1,0);
n.hiddenSubGroupByIndex(2,0);}else{if(l==g.AssureMethodConst.ASSURE_PRODUCT){n.hiddenSubGroupByIndex(1,0);n.displaySubGroupByIndex(2,0);}}}});j.renderCard(dojo.byId("assureQuery"+h),"last");g.clearView(dojo.query(".assure-buttons"+h)[0],true);
g.clearView(dojo.query(".assureResult"+h)[0]);g.clearView(dojo.query(".assureAcct"+h)[0]);g.clearView(dojo.query(".assureProd"+h)[0]);if(l!=g.AssureMethodConst.ASSURE_CASH){var i="<div style='text-align:left;vertical-align:middle' class='assure-buttons"+h+"'><a href='javascript:void(0);' id = 'query"+h+"' dojoAttachEvent='onclick:elementclick'  subRowIndex="+h+" rowIndex="+m+" dojoAttachTopic='/assureQuery' style='text-align:center;vertical-align:middle;color:red;'>&nbsp查询&nbsp</a></div>";
dojo.place(i,dojo.byId("assureQuery"+h),"last");}detailWidget.enableEvtMsgPropagation(dojo.byId("assureQuery"+h));detailWidget.assureCardWidget=j;}}else{this.inherited(arguments);}},onPromotionAssureCommitClick:function(k,g){var r=this,p=this.detailBuild,v=p.prodOfferDetailWidgetList[g],h=dojo.query(".assureRadio"+g,v.domNode),m=dojo.filter(h,function(y){return y.checked==true;
})[0],j=m.getAttribute("rowindex");v.assureInfoGrid.setDataSource(v.finalDataSource);var l=v.assureCardWidget,q=v.assureAttrCard,i=v.assureCustInfo,n=v.assureAccountInfo,u=v.assureProductInfo,w=v.assureInfoGrid,s=w.ds.getRawData()[j],t=dojo.query(".assureInfoResult"+j,v.domNode)[0],x=dojo.query(".assureObjResult"+j,v.domNode)[0],o="";
if(s.assureMethodCD==r.AssureMethodConst.ASSURE_CASH){i=null;n=null;u=null;t.innerText="现金担保";x.innerText="现金";}else{if(s.assureMethodCD==r.AssureMethodConst.ASSURE_CUST){n=null;u=null;t.innerText="客户担保";
x.innerText="客户";}else{if(s.assureMethodCD==r.AssureMethodConst.ASSURE_PROMOTION){n=null;u=null;t.innerText="租机担保";x.innerText="租机担保";}}}t.parentNode.style.backgroundColor="#cae3ff";x.parentNode.style.backgroundColor="#cae3ff";
dojo.query("[id=assureRadio"+j+"]",v.domNode)[0].checked=true;this.clearView(dojo.query(".assureQuery"+g)[0]);this.clearView(dojo.query(".assureResult"+g)[0]);this.clearView(dojo.query(".assureAcct"+g)[0]);
this.clearView(dojo.query(".assureProd"+g)[0]);dojo.mixin(v,{assurePageData:{securityMethodCd:s.assureMethodCD,securityObjId:o,securityObjTypeCd:!!l?l.busCardInstance.$("assureQueryMethod").value:"",securityDesc:s.assureDesc,securityFee:s.assureValue,securityDur:s.assureDate,assureAttrCard:q}});
}});});
defineModule("orderaccept.prodofferaccept.builder.prodofferdetail.Favour",["../../util","orderaccept.common.js.ConstantsPool","orderaccept.common.dialog.MessageBox","unieap.form.DateTextBox"],function(a,d,c,b){dojo.declare("orderaccept.prodofferaccept.builder.prodofferdetail.Favour.FavourBuilder",[],{Me:this,constructor:function(e){this.prodOfferDetailWidget=e.prodOfferDetailWidget,this.rowData=e.rowData,this.showData=this.rowData.showData,this.prodOfferInfoVO=e.prodOfferInfoVO,this.container=e.container,this.favourRelaInstList=e.favourRelaInstList.Components,this.hasFavourItemList=e.hasFavourItemList,this.selfFavorLimitList=e.selfFavorLimitList,this.favourType=e.favourType,this.unitId="";
this.favourItemList=[],this.uncheckedFavourList={},this.favourReturnItem={},this.FavourKindConst=d.load("FavourKindConst").FavourKindConst;this.userId=e.userId;},init:function(){if(this.hasFavourItemList!=null){for(var e=0;
e<this.hasFavourItemList.length;e++){this.createFavourNumberHtmlByData(this.hasFavourItemList[e]);}}return true;},createFavourNumberHtml:function(j){var f=this.createFavourItem(j);var e=f.generateFavourNumberHtml();
dojo.place(e,this.container,"last");dojo.parser.parse(this.container);var k=this.rowData.rowIndex;var g=!!j.objServiceId?j.objServiceId:j.unitId;if(!!j.unitId&&!this.unitId){this.unitId=j.unitId;}var h=dijit.getEnclosingWidget(dojo.query("[id='beginDate-"+k+"-"+g+"']",this.container)[0]);
var i=dijit.getEnclosingWidget(dojo.query("[id='endDate-"+k+"-"+g+"']",this.container)[0]);h.onChange=function(){var n=a.DateHelper.getDateFromString(h.getValue());var m=a.DateHelper.getDateFromString(i.getValue());
var l=a.DateHelper.getDateFromString($ac$.requestParam.today);if(n<l){MessageBox.alert({busiCode:"08410201"},h.domNode);h.setValue($ac$.requestParam.today);return false;}if(m<n){MessageBox.alert({busiCode:"08410202"},h.domNode);
h.setValue($ac$.requestParam.today);return false;}};i.onChange=function(){var m=a.DateHelper.getDateFromString(h.getValue());var l=a.DateHelper.getDateFromString(i.getValue());if(l<m){MessageBox.alert({busiCode:"08410202"},i.domNode);
i.setValue("2037-01-01");return false;}};this.prodOfferDetailWidget.enableEvtMsgPropagation(dojo.query("[id='favour_div_"+f.getFavourNumber()+"']",this.container)[0]);},createFavourItem:function(g){var f={builder:this,prodOfferInfoVO:this.prodOfferInfoVO,favourNumberObj:g,addItemList:this.addItemList,favourType:this.favourType,removeItemList:this.removeItemList,hasFavourItemData:null};
var e=new orderaccept.prodofferaccept.builder.prodofferdetail.Favour.FavourItem(f);this.favourItemList.push(e);return e;},createFavourNumberHtmlByData:function(o){var n=this;var f={};var l="";var m="";
var q="";var h="";if(n.FavourKindConst.COMMON_FAVOUR==n.favourType){l=o.serviceId;m=o.serviceKind;q=o.beginValidDate;h=o.endValidDate;if(!!o.unitId&&!n.unitId){n.unitId=o.unitId;}}else{if(n.FavourKindConst.SELF_FAVOUR==n.favourType){l=o.objectServiceId;
m=o.objServiceKind;q=o.beginValidDate;h=o.endValidDate;}else{if(n.FavourKindConst.OCS_FAVOUR==n.favourType){l=o.objServiceId;m="";q=o.effectiveDate;h=o.expireDate;}}}f.objServiceId=l;f.objCityCode=o.cityCode;
f.objServiceKind=m;f.beginDate=q;f.endDate=h;f.netOwner=o.netOwner;f.unitId=o.unitId;if(!o.operKind){o.operKind=2;}f.operKind=o.operKind;if(!!o.subGroupType){var e=a.ServiceFactory.getService("url:prodOfferSaleAjaxAction.do?method=getSubGroupTypeDetailInfo&subgroupType="+o.subGroupType);
if(!!e){e.name=e.subgroupName;e.value=e.subgroupType;}f.subGroupType=e;}var p={builder:this,prodOfferInfoVO:this.prodOfferInfoVO,favourNumberObj:f,addItemList:this.addItemList,favourType:this.favourType,removeItemList:this.removeItemList,hasFavourItemData:o};
var g=new orderaccept.prodofferaccept.builder.prodofferdetail.Favour.FavourItem(p);this.favourItemList.push(g);var s=g.generateFavourNumberHtml();dojo.place(s,this.container,"last");dojo.parser.parse(this.container);
var r=this.rowData.rowIndex;var k=!!f.objServiceId?f.objServiceId:f.unitId;var j=dijit.getEnclosingWidget(dojo.query("[id='beginDate-"+r+"-"+k+"']",this.container)[0]);var i=dijit.getEnclosingWidget(dojo.query("[id='endDate-"+r+"-"+k+"']",this.container)[0]);
j.setReadOnly(true);j.changeIconState(false);i.setReadOnly(true);i.changeIconState(false);this.prodOfferDetailWidget.enableEvtMsgPropagation(dojo.query("[id='favour_div_"+g.getFavourNumber()+"']",this.container)[0]);
},getData:function(){var g=[];for(var e=0;e<this.favourItemList.length;e++){var f=this.favourItemList[e].createItemData();if(f.operKind==2){continue;}g.push(f);}return data;},getFavourItemList:function(){var f=[];
for(var g=0,e=this.favourItemList.length;g<e;g++){f.push(this.favourItemList[g].createItemData());}return Data;},addItemList:function(f){var e=f.getFavourNumber();if(!this.checkMaxNumber(e)){$("familyNumberCh-"+e).checked="";
return false;}this.favourItemList.push(f);if(this.uncheckedFavourList[e]){delete this.uncheckedFavourList[e];}return;},removeItemList:function(f){if(!this.favourItemList||this.favourItemList.length==0){return;
}var e=f.getFavourNumber();for(var h=0;h<this.favourItemList.length;h++){var g=this.favourItemList[h].createItemData();var j;if(this.FavourKindConst.COMMON_FAVOUR==g.favourKind){j=g.objServiceId;}else{if(this.FavourKindConst.SELF_FAVOUR==g.favourKind||this.FavourKindConst.OCS_FAVOUR==g.favourKind){j=g.objServiceId;
}}if(e==j){this.uncheckedFavourList[e]=this.favourItemList[h];this.favourItemList.splice(h,1);return;}}},doCheck:function(e,m){e=BusCard.util.trim(e);if(this.showData&&this.showData.chooseNumberObj){var l=this.showData.chooseNumberObj.serviceId;
if(e==l){c.alert({busiCode:"08410107"},$("familyNumber"));return false;}}for(var j=0;j<this.favourItemList.length;j++){var h=this.favourItemList[j].createItemData();if(this.FavourKindConst.COMMON_FAVOUR==h.favourKind){if(e==h.objServiceId){c.alert({busiCode:"08410109"},$("familyNumber"));
return false;}}else{if(this.FavourKindConst.SELF_FAVOUR==h.favourKind||this.FavourKindConst.OCS_FAVOUR==h.favourKind){if(e==h.objServiceId){c.alert({busiCode:"08410109"},$("familyNumber"));return false;
}}}}if(!this.checkMaxNumber(e,m)){return false;}else{for(var k in this.uncheckedFavourList){var h=this.uncheckedFavourList[k];var g=null;if(this.FavourKindConst.COMMON_FAVOUR==h.favourType){g=this.uncheckedFavourList[k].createItemData().objServiceId;
}else{if(this.FavourKindConst.SELF_FAVOUR==h.favourType||this.FavourKindConst.OCS_FAVOUR==h.favourType){g=this.uncheckedFavourList[k].createItemData().objServiceId;}}if(e==g){var f=this.createFavourItem(this.favourReturnItem);
$("familyNumberCh-"+e).checked="checked";return false;}}}return true;},checkMaxNumber:function(e,i){var g=dojo.toJson(this.getRelaLimitData());var h=dojo.toJson(this.getAllFavourData());var f="&favourNumber="+e;
f+="&favourRelaLimitXML="+g;f+="&relaNumberXML="+h;f+="&favourType="+this.favourType;f+="&unitId="+this.unitId;f+="&dojoType=1";var j=a.ServiceFactory.getService("url:prodOfferSaleAjaxAction.do?method=doCheckRelaNumber"+f);
if(!j){c.alert({busiCode:"08410110"},$("familyNumber"));$("familyNumber").value="";return false;}if(j.code/1<0&&j.message){c.alert({busiCode:"08410111",infoList:[j.message]},$("familyNumber"));$("familyNumber").value="";
return false;}else{this.favourReturnItem.objServiceId=(this.favourType==this.FavourKindConst.SELF_FAVOUR||this.favourType==this.FavourKindConst.COMMON_FAVOUR||this.favourType==this.FavourKindConst.OCS_FAVOUR?e:"");
this.favourReturnItem.objCityCode=(this.favourType==this.FavourKindConst.SELF_FAVOUR||this.favourType==this.FavourKindConst.COMMON_FAVOUR||this.favourType==this.FavourKindConst.OCS_FAVOUR?j.objCityCode:"");
this.favourReturnItem.objServiceKind=(this.favourType==this.FavourKindConst.SELF_FAVOUR||this.favourType==this.FavourKindConst.COMMON_FAVOUR||this.favourType==this.FavourKindConst.OCS_FAVOUR?j.objServiceKind:"");
this.favourReturnItem.netOwner=(this.favourType==this.FavourKindConst.SELF_FAVOUR||this.favourType==this.FavourKindConst.COMMON_FAVOUR||this.favourType==this.FavourKindConst.OCS_FAVOUR?j.netOwner:"");this.favourReturnItem.unitId="";
this.favourReturnItem.subGroupType=(this.favourType==this.FavourKindConst.OCS_FAVOUR?i:null);}return true;},getFavourReturnItem:function(){return this.favourReturnItem;},getRelaLimitData:function(){var e=[];
for(var g in this.selfFavorLimitList){if(typeof(this.selfFavorLimitList[g].maxOppositeNbr)=="undefined"){continue;}var f={maxOppositeNbr:this.selfFavorLimitList[g].maxOppositeNbr,netOwner:this.selfFavorLimitList[g].netOwner,ifLocal:this.selfFavorLimitList[g].ifLocal,ifMobile:this.selfFavorLimitList[g].ifMobile};
e.push(f);}return e;},getAllFavourData:function(){var g=[];for(var e=0;e<this.favourItemList.length;e++){var f=this.favourItemList[e].createItemData();g.push(f);}return g;}});dojo.declare("orderaccept.prodofferaccept.builder.prodofferdetail.Favour.FavourItem",[],{Me:this,constructor:function(e){this.builder=e.builder,this.favourType=e.builder.favourType,this.prodOfferInfoVO=e.builder.prodOfferInfoVO;
this.favourNumberObj=e.favourNumberObj,this.hasFavourItemData=e.hasFavourItemData,this.favourNumber=this.favourNumberObj.objServiceId,this.checkedOption=" checked='checked' ",this.operKind=this.hasFavourItemData?this.hasFavourItemData.operKind:1;
this.beginDate=!!this.favourNumberObj.beginDate?this.favourNumberObj.beginDate:$ac$.requestParam.today;this.endDate=!!this.favourNumberObj.endDate?this.favourNumberObj.endDate:"2037-01-01";},createItemData:function(){var j=this.favourNumberObj.objServiceKind;
if(!j||j/1<0){j=0;}var f=!!this.favourNumber?this.favourNumber:this.favourNumberObj.unitId;var l=this.builder.rowData.rowIndex;var i=dojo.query("[id='beginDate-"+l+"-"+f+"']",this.builder.container)[0];
var g=dijit.getEnclosingWidget(i).getValue();var e=dojo.query("[id='endDate-"+l+"-"+f+"']",this.builder.container)[0];var k=dijit.getEnclosingWidget(e).getValue();var h={cityCode:"",userId:!!this.builder.userId?this.builder.userId:"0",serviceId:"",serviceKind:"0",favourKind:this.favourType,unitId:this.builder.unitId,prodOfferId:this.prodOfferInfoVO.prodOfferId,operKind:!!this.operKind?this.operKind:1,objServiceId:!!this.favourNumber?this.favourNumber:"",objCityCode:!!this.favourNumberObj.objCityCode?this.favourNumberObj.objCityCode:"",objServiceKind:j,ifBind:"-1",netOwner:!!this.favourNumberObj.netOwner?this.favourNumberObj.netOwner:"",areaId:"",subGroupType:!!this.favourNumberObj.subGroupType?this.favourNumberObj.subGroupType.value:""};
return h;},generateFavourNumberHtml:function(){if(this.operKind==3){this.checkedOption="";}var e="";var g=this.builder.rowData.rowIndex;if(this.favourType==this.builder.FavourKindConst.SELF_FAVOUR||this.favourType==this.builder.FavourKindConst.OCS_FAVOUR||this.favourType==this.builder.FavourKindConst.COMMON_FAVOUR){var f=this.favourNumberObj.subGroupType;
e="<div class='buscard-row'> 							<div class='buscard-item-label' style='width:40%;' id='favour_div_"+this.favourNumber+"'>								<input type='checkbox' "+this.checkedOption+" id='familyNumberCh-"+this.favourNumber+"' 									dojoAttachEvent = 'onclick:elementclick' dojoAttachTopic = '/familyNumberCh'									rowIndex='"+this.builder.rowData.rowIndex+"' 									name='familyNumberCh-"+this.favourNumber+"' value='"+this.favourNumber+"' />:							</div>							<div class='buscard-item-el' style=\"width:50%\">								<input type='text' readonly='true' style='width:50%' id='familyNumberTe-"+this.favourNumber+"' name='familyNumberTe-"+this.favourNumber+"' value='"+this.favourNumber+(!!f?"/"+f.name:"")+"' /> 								<font style='display:none'>&nbsp;开始:</font><div dojoType=\"unieap.form.DateTextBox\" id=\"beginDate-"+g+"-"+this.favourNumber+"\" style='width:100px;display:none' 													value=\""+this.beginDate+'" displayFormatter="{dataFormat:\'yyyy-MM-dd\'}" valueFormatter="{dataFormat:\'yyyy-MM-dd\'}"></div> 								<font style=\'display:none\'>&nbsp;结束:</font><div dojoType="unieap.form.DateTextBox" id="endDate-'+g+"-"+this.favourNumber+"\" style='width:100px;display:none' 													value=\""+this.endDate+'" displayFormatter="{dataFormat:\'yyyy-MM-dd\'}" valueFormatter="{dataFormat:\'yyyy-MM-dd\'}"></div> 							</div></div> ';
}return e;},handleFavourNumber:function(){var e=this;var k=$("familyNumberCh-"+e.getFavourNumber());if(!k){return false;}if(k.checked==true){var h=dojo.toJson(e.builder.getRelaLimitData());var j=dojo.toJson(e.builder.getAllFavourData());
var g="&favourNumber="+e.favourNumber;g+="&favourRelaLimitXML="+h;g+="&relaNumberXML="+j;g+="&favourType="+e.builder.favourType;g+="&unitId="+e.builder.unitId;g+="&dojoType=1";var l=a.ServiceFactory.getService("url:prodOfferSaleAjaxAction.do?method=doCheckRelaNumber"+g);
if(!l){c.alert({busiCode:"08410110"},$("familyNumber"));$("familyNumberCh-"+e.getFavourNumber()).checked=false;return false;}if(l.code/1<0&&l.message){c.alert({busiCode:"08410111",infoList:[l.message]},$("familyNumber"));
$("familyNumberCh-"+e.getFavourNumber()).checked=false;return false;}if(e.hasFavourItemData!=null){e.operKind=2;}else{if(e.builder.addItemList){e.builder.addItemList(e);}}}else{if(e.hasFavourItemData!=null){if(e.hasFavourItemData.operKind==1){if(e.builder.removeItemList){e.builder.removeItemList(e);
}}else{e.operKind=3;}}else{if(e.builder.removeItemList){e.builder.removeItemList(e);}}}var f=this.builder.hasFavourItemList;if(!!f&&f.length>0&&this.favourType==this.builder.FavourKindConst.OCS_FAVOUR){var i=dojo.query("[id=addNumber]",this.builder.prodOfferDetailWidget.domNode)[0];
if(!!i){dojo.style(i,"display","none");}}},getFavourNumber:function(){var e;if(this.favourType==this.builder.FavourKindConst.SELF_FAVOUR||this.favourType==this.builder.FavourKindConst.OCS_FAVOUR){e=this.favourNumber;
}else{if(this.favourType==this.builder.FavourKindConst.COMMON_FAVOUR){e=this.favourNumber;}}return e;}});});
defineModule("orderaccept.prodofferaccept.builder.prodofferdetail.ProdOfferDetailBuilder",["../../util","../../../base/Controller","../../widget/attrcard/ProductAttrCardWidget","../../widget/attrcard/ProductOfferAttrCardWidget","./ProdOfferAssureBuilder","../../../custom/TooltipDialog","./Favour","orderaccept.common.js.ConstantsPool","orderaccept.common.dialog.MessageBox","unieap.layout.TabContainer","unieap.layout.ContentPane","orderaccept.custom.popup","unieap.form.ComboBox","unieap.ds.DataStore"],function(f,d,c,h,b,i,g,e,a){dojo.declare("orderaccept.prodofferaccept.builder.prodofferdetail.ProdOfferDetailBuilder",[],{ProductOfferAttrCardWidgetClass:h,ProductAttrCardWidgetClass:c,constructor:function(j){this.provider=j;
this.loader=this.provider.controller;this.prodOfferDetailWidgetList=[];},destroy:function(){dojo.forEach(this.prodOfferDetailWidgetList,function(j){if(j){if(!!j.prodOfferAttrCard){j.prodOfferAttrCard.destroyRecursive();
}j.destroyRecursive();}});},initProdOfferDetail:function(p){var m=this,r=this.loader,q=this.provider,k=dojo.filter(q.getSubGridBindingData(),function(t){return t.rowIndex==p;})[0],l=k.subProdOfferInfo,o=k.prodOfferInst;
var n=new i({id:"prodOfferDetailDialog-"+q.uniqueId+"-"+p});this.prodOfferDetailWidgetList[""+p]=n;n.rowData=k;n.rowIndex=p;n.builder=this;n.prodOfferAttrCard=null;n.favourBuilder=null;n.prodOfferAssureBuilder=null;
n.startup();n.setAttribute("rowIndex",p);n.domNode.setAttribute("dojoAttachEvent","onmouseout:elementmouseout");n.domNode.setAttribute("dojoAttachTopic","/prodOfferDetailDialog");var j="<div style='text-align:center;vertical-align:middle'><a href='javascript:void(0);' dojoAttachEvent='onclick:elementclick'  rowIndex="+p+"			        		dojoAttachTopic='/prodOfferDetailBtn' style='text-align:center;vertical-align:middle;'>关闭</a></div>";
dojo.place(j,n.containerNode,"last");n.enableEvtMsgPropagation(n.domNode);var s=new unieap.layout.TabContainer({height:"auto",uniqueId:q.uniqueId});n.tabContainer=s;s.startup();this.initProdOfferAttr(n,k,s);
this.initProductAttr(n,k,s);this.initFamilyInfo(n,k,s);if(!o||(!o.prodOfferInstAssureList||o.prodOfferInstAssureList.length==0)){this.initProdOfferAssure(n,k,s);}if(!!k.offerItemData){this.recoveryData(k);
}this.specialDealAttr(n,l,o);n.handlePageData=dojo.hitch(n,function(){var y=dojo.filter(q.getSubGridBindingData(),function(B){return B.rowIndex==p;})[0],A=this;if(!!A.prodOfferAttrCard){if(!m.checkNotNull(A.prodOfferAttrCard.domNode,A.prodOfferAttrCard.domNode)){return false;
}var z=A.prodOfferAttrCard.getCardData(null,null,true);if(z){dojo.mixin(y,{offerAttrPageInfoList:z});}else{return false;}var u=A.prodOfferAttrCard.getPageData();if(u){dojo.mixin(y,{offerAttrPageInfoList:u});
}}if(!!A.favourBuilder){dojo.mixin(y,{relaBusPageInfoList:A.favourBuilder.getAllFavourData()});}var v=m.getProductData(p);if(v){dojo.mixin(y,{relaProdPageInfoList:v});}else{return false;}if(!!A.assurePageData){var w=[];
var x=A.assureAttrCard.busCardInstance.getData();if(!x){return false;}for(var t in x){if(!x.hasOwnProperty(t)){continue;}w.push({attrId:t,attrValue:x[t]});}A.assurePageData.assureAttrList=w;}dojo.mixin(y,{prodOfferAssurePageInfoList:A.assurePageData});
});dojo.mixin(k,{handlePageData:n.handlePageData});dojo.place(s.domNode,n.containerNode,"first");this.specialDealPageDisplay(n,q,l,o,k);},initProdOfferAttr:function(q,p,k){var j=this.loader,o=p.subProdOfferInfo,n=p.prodOfferInst,m=new this.ProductOfferAttrCardWidgetClass({prodOfferInfoVO:o});
if(m.needRendering){var l=new unieap.layout.ContentPane({title:"销售品属性",width:"400px",uniqueId:k.uniqueId,prodOfferId:o.prodOfferId,detailWidgetId:q.id});k.addChild(l);m.renderCard(l.domNode,"first");m.busCardInstance.setParent(l);
q.prodOfferAttrCard=m;}if(q.prodOfferAttrCard&&!!n&&!!n.offerInstAttrList&&n.offerInstAttrList.length>0){f.SetAttrInst(n.offerInstAttrList,q.prodOfferAttrCard.busCardInstance);}this.initPricingParamAttr(m,n,o);
},initPricingParamAttr:function(l,k,n){var j=this,m=l,o=m.pricingParamCard;if(k&&o&&(attrInstList=k.offerInstAttrList)){BusCard.each(attrInstList,function(q){attrVO=dojo.filter(n.attrList||[],function(s){return s.attrCd==q.attrCd;
})[0];if(attrVO&&attrVO.pricingParamAttr==1){if(attrVO.unique==false){var r=dojo.query("[attrcd="+q.attrId+"]",o.dom)[0];if(/^\[.*\]$/i.test(q.attrValue)){var p=dojo.fromJson(q.attrValue);BusCard.each(p,function(s){j.initPricingParamAdd(m,o,r,s);
});}else{j.initPricingParamAdd(m,o,r,q.attrValue);}}else{o.$(q.attrCd).value=m.validateValue(q.attrValue)?q.attrValue:"";}}});}},initPricingParamAdd:function(k,m,o,t){var r=dojo.attr(o,"attrCd");var l=m.$(r);
var p=dojo.filter(l.options,function(u){return u.value==t;})[0];var q=p.text;var s="<input type='checkbox'  style='margin-left:5px;margin-right:5px;vertical-align:baseline;' CHECKED class='pricing-city' value='${value}'><span name='text-${value}'>${text}</span>";
var j=dojo.query(".pricingParam-"+r,m.dom)[0];var n=k.selectColumn(j);dojo.place(BusCard.Template.create(s).apply({value:t,text:q}),n,"last");},initProductAttr:function(q,k,r){var n=this,l=[],p={},o=false,m=new unieap.layout.ContentPane({title:"产品属性",uniqueId:r.uniqueId,detailWidgetId:q.id});
var j=this.filterRelaProdList(k);dojo.forEach(j,function(s){var v="<div class='title_top'><input type='checkBox' "+n.checkProdSelectStatus(s,k)+" id='sub-prod-"+s.productInfoVO.productId+"-"+k.rowIndex+"' dojoAttachEvent='onclick:elementclick' dojoAttachTopic='/subProdSelect' ><span style='vertical-align: middle; margin-right: 10px'>&nbsp产品名称&nbsp;&nbsp<span style='vertical-align: middle; margin-right: 30px'>"+s.productInfoVO.productName+"</span></div>";
dojo.place(v,m.domNode,"last");var u=new n.ProductAttrCardWidgetClass({productInfoVO:s.productInfoVO,prodOfferInfoVO:k.subProdOfferInfo});if(j.length>0){o=true;}if(u.needRendering&&BusCard.exist(s.productInfoVO.attrList,function(w){if(w.ifDisplay=="1"){return true;
}})){dojo.style(m.domNode,"width","400px");u.renderCard(m.domNode,"last");o=true;}if(o){var t={rowIndex:k.rowIndex,productInfo:s,productAttrCard:u.needRendering?u:null};l.push(t);if(!!s.roleInfoVO){if(!!p[s.roleInfoVO.roleCD]){p[s.roleInfoVO.roleCD].push(t);
}else{p[s.roleInfoVO.roleCD]=[];p[s.roleInfoVO.roleCD].push(t);}}}});if(o){r.addChild(m);}q.enableEvtMsgPropagation(m.domNode);q.productItemList=l;q.roleInfo=p;if(!!k.prodOfferInst&&k.prodOfferInst.prodInstList&&k.prodOfferInst.prodInstList.length>0){dojo.forEach(q.productItemList,function(u){var s=u.productInfo,v=u.productAttrCard,t=dojo.filter(k.prodOfferInst.prodInstList,function(w){return u.productInfo.productId==w.productId;
})[0];u.prodInstInfo=t;if(v&&!!t&&!!t.prodInstAttrList&&t.prodInstAttrList.length>0){f.initProdAttrInst(t.prodInstAttrList,v.getCard());}});}},filterRelaProdList:function(k){var j=dojo.filter(k.subProdOfferInfo.offerProdRelaList,function(l){return l.productInfoVO.prodFuncType!=e.load("ProductFuncTypeConst").ProductFuncTypeConst.ACCESS;
});return dojo.filter(j,function(l){return dojo.some(l.productInfoVO.prodRelaList,function(m){return(m.relaType==f.PRODOFFERTYPE.SUBORDINATE_TYPE)&&(m.prodA==k.showData.chooseNumberObj.productId);});});
},checkProdSelectStatus:function(j,k){var l="";if(!!k.prodOfferInst&&!!k.prodOfferInst.prodInstList&&k.prodOfferInst.prodInstList.length>0){if(dojo.some(k.prodOfferInst.prodInstList,function(m){return m.productId==j.productId;
})){return l=" checked='true' ";}}else{if(j.ifDefault==1){l=" checked = 'true' ";}if(j.productInfoVO.ifSelectAble=="1"){l+=" disabled='true'";}}return l;},initProdOfferAssure:function(n,m,k){var j=this,l=m.subProdOfferInfo;
n.prodOfferAssureBuilder=new b({detailBuilder:j,prodOfferDetailWidget:n,prodOfferInfo:l,tabContainer:k});n.prodOfferAssureBuilder.initProdOfferAssure();},getProductData:function(m){var j=this;if(j.checkRole(m)){return false;
}var l=j.prodOfferDetailWidgetList[m],k=[];Array.prototype.push.apply(k),flag=true;BusCard.each(l.productItemList,function(q){var n=q.productInfo;var p=dojo.query("[id='sub-prod-"+n.productInfoVO.productId+"-"+m+"']",l.domNode)[0].checked;
if(!!q.productAttrCard&&!!p&&!j.checkNotNull(q.productAttrCard.domNode,q.productAttrCard.domNode)){flag=false;return flag;}if(q.productAttrCard&&!q.productAttrCard.getCardData(null,null,true)){flag=false;
return flag;}var o={prodBasicInfo:{productId:n.productId,prodInstId:!!q.prodInstInfo?q.prodInstInfo.prodInstId:null,prodInstInfo:!!q.prodInstInfo?q.prodInstInfo:null,checkedStatus:p},prodAttrInfo:q.productAttrCard?q.productAttrCard.getCardData(null,null,true):null,productInfo:n};
k.push(o);});if(!flag){return flag;}return k;},checkRole:function(l){var j=this,k=j.prodOfferDetailWidgetList[l];return BusCard.exist(k.roleInfo,function(m){var o=dojo.filter(m,function(r){return dojo.query("[id='sub-prod-"+r.productInfo.productId+"-"+r.rowIndex+"']",k.domNode)[0].checked==true;
});var p=m[0].productInfo.roleInfoVO.roleNumMin,n=m[0].productInfo.roleInfoVO.roleNumMax;if(o.length<p||o.length>n){var q=[];dojo.forEach(m,function(r){q.push(r.productInfo.productInfoVO.productName);});
a.alert({busiCode:"08410114",infoList:[q.toString(),p,n]});return true;}return false;});},initFamilyInfo:function(B,s,E){var t=this.loader,F=e.load("FavourKindConst").FavourKindConst,n=s.subProdOfferInfo,z=s.prodOfferInst,v=!!s?s.showData:null,y=!!v?v.chooseNumberObj:null,D=!!z?z.selfFavourRelaList:null,C=!!z?z.favourRelaList:null,x=!!z?z.ocsSubseridInfoList:null,u=dojo.byId("webPath").value;
var p=this.checkIfShowFamily(n);if(p===F.COMMON_FAVOUR||p===F.SELF_FAVOUR||p===F.OCS_FAVOUR){familyHtml="<div class='buscard-root' style='display:block;'>										 <div class='buscard-legend'>											<span class='buscard-legend-img'></span>											<span class='buscard-legend-text' id='buscard-name'>亲情信息</span>										 </div>";
if(p==F.SELF_FAVOUR||p==F.OCS_FAVOUR||p===F.COMMON_FAVOUR){var l="";if(p==F.OCS_FAVOUR){var m=f.ServiceFactory.getService("url:prodOfferSaleAjaxAction.do?method=getOcsSubGroupType");var r=dojo.map(m,function(H){return{CODEVALUE:H.subgroupType,CODENAME:H.subgroupName,maxNumber:H.maxNumber};
});var q="subGroupType";var A=new unieap.ds.DataStore(q,r);dataCenter.addDataStore(A);l="<div class='buscard-row'> 												<div class='buscard-item-label' style='width:40%;'>													<span class='buscard-label'>OCS亲情群组:</span>												</div>												<div class='buscard-item-el' style='width:50%;'>													<div dojoType=\"unieap.form.ComboBox\" class=\"buscard-item-label\"  														id=\"subGroupType\"  textValidate=\"true\" 														dataProvider=\"{'store':'"+q+"'}\"														rowIndex='"+B.rowIndex+"' 														dataFilter=\"{searchAttr:['CODENAME'],spellAttr:'py'}\" width=\"60%\"></div>												</div>											 </div>";
}familyHtml+="<div class='buscard-content' style='border-bottom:1px silver dashed'>													"+l+" 													<div class='buscard-row'> 														<div class='buscard-item-label' style='width:40%;'>															<span class='buscard-label'>亲情号码:</span>														</div>														<div class='buscard-item-el' style='width:50%;'>															<input type='text' name='familyNumber' id='familyNumber'																	rowIndex='"+B.rowIndex+"' value='' style='width:50%;'/>															<img id='addNumber' name='addNumber'						                						dojoAttachEvent = 'onclick:elementclick'						                						dojoAttachTopic = '/familyNumber'																src='"+u+"/common/images/icon/plus_icon.png'																style='cursor: pointer; width: 15px; height: 15px;' />														</div>													</div>											</div>";
}familyHtml+="<div class='buscard-content' id='prodFavourDiv'>										</div>									</div> ";var G="亲情信息";if(p==F.SELF_FAVOUR){G="亲情自惠";}else{if(p==F.OCS_FAVOUR){G="OCS亲情";}else{if(p==F.COMMON_FAVOUR){G="亲情互惠";
}}}var o=new unieap.layout.ContentPane({title:G,width:"500px",uniqueId:E.uniqueId,detailWidgetId:B.id});dojo.place(familyHtml,o.domNode,"first");dojo.parser.parse(o.domNode);B.enableEvtMsgPropagation(o.domNode);
E.addChild(o);B.favourContentPane=o;var j=[];if(p==F.SELF_FAVOUR){j=D;}else{if(p==F.COMMON_FAVOUR){j=C;}else{if(p==F.OCS_FAVOUR){j=x;}}}var w=dojo.query(".main-product-basic",t.mainProdOfferWidget.domNode);
var k=0;if(!!y&&!!y.userId){k=y.userId;}B.favourBuilder=new g.FavourBuilder({prodOfferDetailWidget:B,rowData:s,prodOfferInfoVO:n,favourRelaInstList:"",selfFavorLimitList:n.selfFavorLimitList,container:dojo.query("[id=prodFavourDiv]",o.domNode)[0],favourType:p,hasFavourItemList:j,userId:k});
B.favourBuilder.init();}},checkIfShowFamily:function(n){var m=this;var j="";var l=e.load("FavourKindConst").FavourKindConst;if(n.usageTypeList&&n.usageTypeList.length>0){var k=n.usageTypeList;dojo.forEach(k,function(o){if(o=="1"){j=l.SELF_FAVOUR;
return true;}if(o=="2"){j=l.COMMON_FAVOUR;return true;}if(o=="126"){j=l.OCS_FAVOUR;return true;}});}return j;},onFamilyNumberClick:function(o){if(!!o){var q=o.value;var p=this.prodOfferDetailWidgetList[""+o.getAttribute("rowIndex")];
if(q==""||q==null){a.alert({busiCode:"08410115"},o);return false;}if(p.favourBuilder!=null){var m=null;var n=dojo.query("[id=subGroupType]",p.favourBuilder.container.parentNode)[0];var l=e.load("FavourKindConst").FavourKindConst;
if(!!n){var j=dijit.getEnclosingWidget(n);if(!j.getValue()||j.getValue()==""){a.alert({busiCode:"08410203"},n);return false;}m={};m.value=j.getValue();m.name=j.getText();}if(!p.favourBuilder.doCheck(q,m)){return false;
}p.favourBuilder.createFavourNumberHtml(p.favourBuilder.getFavourReturnItem());if(!!p.rowData&&!!p.rowData.prodOfferInst&&p.favourBuilder.favourType==l.OCS_FAVOUR){var k=dojo.query("[type=checkbox]",p.favourBuilder.container);
if(!!k){dojo.forEach(k,function(r){r.disabled=true;});}}}}},onFavourUnitClick:function(j){var j=f.DomHelper.getParentWidget(j,"unieap.form.ComboBox");if(!!j){var k=j.getValue();var l=f.DomHelper.getParentWidget(j.domNode,"orderaccept.custom.TooltipDialog");
if(k==""||k==null){a.alert({busiCode:"08410116"},j.domNode);return false;}if(l.favourBuilder!=null){if(!l.favourBuilder.doCheck(k)){return false;}l.favourBuilder.createFavourNumberHtml(l.favourBuilder.getFavourReturnItem());
}}},checkNotNull:function(E,p){var k=this;try{var m=E.childNodes;var C=m.length;for(var q=0;q<C;q++){var v=m[q].nodeType;var A=m[q].nodeName;var G=m[q];if(v==1){if(A=="SELECT"||A=="INPUT"){if((G.getAttribute("isNull")||G.isNull)=="0"&&!BusCard.util.trim(G.value)){var s=!!p?dojo.query("[id='label_"+m[q].id+"']",p)[0]:dojo.byId("label_"+m[q].id);
var w=/<span(?:.*?)>(?:.*?)<\/span>(.+)(\：|\:)/i.exec(s.innerHTML)[1];var u=G.getAttribute("groupId")||G.groupId;if(u&&u!="0"){if(k.getTabPanel()){k.getTabPanel().active(u);}}try{var x=f.DomHelper.getParentWidget(p,"orderaccept.custom.TooltipDialog");
var y=x.tabContainer;var r=f.DomHelper.getParentWidget(p,"unieap.layout.ContentPane");var o=null;if(x.id.indexOf("mainProdOfferDetailDialog")>=0||x.id.indexOf("multipleProdOfferDetailDialog")>=0){o=dojo.byId("productList-key-"+x.id.split("-")[1]);
}else{o=dojo.byId("prodOfferLink-key-"+x.rowIndex);}if(x.id.indexOf("multipleProdOfferDetailDialog")>=0){var z=f.DomHelper.getParentWidget(o,"unieap.layout.ContentPane");var j=z.parentContainer;j.selectChild(z);
}o.focus();orderaccept.custom.popup.open({widget:{popup:x,around:o}});y.selectChild(r);G.focus();a.alert({busiCode:"08410117",infoList:[w]},G);}catch(F){a.alert({busiCode:"08410118",infoList:[F.message]});
}return false;}else{var D=arguments.callee.call(k,G,p);if(D===false){return false;}}}else{var B=arguments.callee.call(k,G,p);if(B===false){return false;}}}}}catch(F){a.alert({busiCode:"08410118",infoList:[F.message]});
return false;}return true;},specialDealPageDisplay:function(u,x,q,v,n){var o=false;if(!!v){var y=v.effDate;var s=v.expDate;var j="2037-01-01 00:00:00";var m=$ac$.requestParam.today;if(f.DateHelper.compareDateValue(f.DateHelper.format(y),m)||(f.DateHelper.compareDateValue(j,f.DateHelper.format(s))&&!!v.oldExpDate)){o=true;
}}var t=false;if(x.contentPane){if(!!$ac$.get("reserveMain"+x.uniqueId)){t=$ac$.get("reserveMain"+x.uniqueId);}else{t=f.ProdOfferHelper.doCheckMainProdOfferReserve(x);$ac$.set("reserveMain"+x.uniqueId,t);
}}else{if(!!$ac$.get("reserveMain")){t=$ac$.get("reserveMain");}else{t=f.ProdOfferHelper.doCheckMainProdOfferReserve(x);$ac$.set("reserveMain",t);}}if((!!t&&(q.prodOfferType==3&&!!v))||(o&&!!v)){var w=n.rowIndex;
if(!!u.prodOfferAttrCard){var p=u.prodOfferAttrCard.busCardInstance;var l=q.attrList||[];BusCard.each(l,function(A){if(!!p.$(A.attrCd)){p.$(A.attrCd).disabled=true;}});if(!!u.prodOfferAttrCard.pricingParamCard){var z=u.prodOfferAttrCard.pricingParamCard;
var r=dojo.query("input",z.dom)[0];dojo.forEach(r||[],function(A){A.disabled=true;});}}BusCard.each(u.productItemList||[],function(C){var A=C.productInfo;dojo.query("[id='sub-prod-"+A.productInfoVO.productId+"-"+w+"']",u.domNode)[0].disabled=true;
if(!!C.productAttrCard){var D=C.productAttrCard.busCardInstance;var B=A.productInfoVO.attrList||[];BusCard.each(B,function(E){if(!!D.$(E.attrCd)){D.$(E.attrCd).disabled=true;}});}});if(!!u.favourContentPane){var k=dojo.query("input",u.favourContentPane.domNode);
dojo.forEach(k||[],function(A){A.disabled=true;});}}},recoveryData:function(k){var o=this,u=this.loader,s=this.provider,r=k.rowIndex,l=k.subProdOfferInfo,q=k.prodOfferInst,t=k.offerItemData,n=k.prodItemList,j=t.offerInstAttrList,v=t.relaBusInfoList,p=o.prodOfferDetailWidgetList[""+r];
if(p.prodOfferAttrCard&&t&&t.length>0){f.SetAttrInst(j,p.prodOfferAttrCard.busCardInstance);}if(!!p.favourBuilder){for(var m=0;m<v.length;m++){p.favourBuilder.favourItemList.push(v[m]);p.favourBuilder.createFavourNumberHtmlByData(v[m]);
}}if(!!t&&n&&n.length>0){dojo.forEach(p.productItemList,function(y){var w=y.productInfo,z=y.productAttrCard,x=dojo.filter(n,function(A){return y.productInfo.productId==A.productId;})[0];y.prodInstInfo=x;
if(z&&!!x.prodInstAttrList&&x.prodInstAttrList.length>0){dojo.forEach(x.prodInstAttrList,function(A){A.attrCd=!!A.attrCd?A.attrCd:A.attrId;});f.SetAttrInst(x.prodInstAttrList,z.getCard());}});}},specialDealAttr:function(m,l,k){if(!!k&&!!k.offerInstAttrList){if(!!m.prodOfferAttrCard){var j=m.prodOfferAttrCard.busCardInstance;
dojo.forEach(l.attrList,function(p){if(p.valueUnit==f.AttrUnitConst.unitConst||p.valueUnit==f.AttrUnitConst.minuteConst){if(!!j.$(""+p.attrCd)){var n=k.offerInstAttrList;var o=BusCard.jsonPath(n,"$[?(@.attrCd=="+p.attrCd+")]");
if(!!o){if(o[0].attrValue!=null&&o[0].attrValue!=""){j.$(""+p.attrCd).value=(o[0].attrValue)/100;}}}}});}}if(!!k){if(!!m.productItemList&&m.productItemList.length>0){dojo.forEach(m.productItemList,function(p){var o=p.productInfo;
var n=p.productAttrCard.busCardInstance;dojo.forEach(o.productInfoVO.attrList,function(s){if(s.valueUnit==f.AttrUnitConst.unitConst||s.valueUnit==f.AttrUnitConst.minuteConst){if(!!n.$(""+s.attrCd)){var q=p.prodInstInfo.prodInstAttrList;
var r=BusCard.jsonPath(q,"$[?(@.attrCd=="+s.attrCd+")]");if(!!r){if(r[0].attrValue!=null&&r[0].attrValue!=""){n.$(""+s.attrCd).value=(r[0].attrValue)/100;}}}}});});}}}});});
defineModule("orderaccept.prodofferaccept.widget.commcard.CommCardWidget",["../../../custom/_BaseWidget","../../../custom/_BusCardTemplated","dijit._Contained"],function(c,b,a){dojo.declare("orderaccept.prodofferaccept.widget.commcard.CommCardWidget",[c,b,a],{delayCreateBeforeBindModel:true,templateString:"buscard://www.crm1.com",postMixInProperties:function(){var d=this.getModel();
this.cardParam=d.cardParam;this.metaData=d.metaData||{};this.id=!!this.metaData.id?this.metaData.id:null;},destroy:function(){this.inherited(arguments);},getPageData:function(){var d=this.inherited(arguments),e=null;
if(d===false){return false;}return d;}});});
defineModule("orderaccept.prodofferaccept.builder.subprodoffergrid.SubProdOfferCartDataProvider",["../../util","orderaccept.common.js.ConstantsPool","../prodofferdetail.ProdOfferDetailBuilder"],function(a,c,b){dojo.declare("orderaccept.prodofferaccept.builder.subprodoffergrid.SubProdOfferCartDataProvider",[],{controller:null,subProdOfferOrderGrid:null,pageData:{},constructor:function(d,f,e){this.controller=d;
this.subProdOfferOrderGrid=unieap.byId("subProdOfferTreeContainer"+f).subProdOfferOrderGrid;this.uniqueId=f;this.contentPane=e;this.prodOfferDetailBuilder=new b(this);},addOneRow:function(d){var e=this;
d.uniqueId=e.uniqueId;e.subProdOfferOrderGrid.add(d);e.dealRaiseXDSLSpeed(d.subProdOfferInfo,d.showData.chooseNumberObj,true,d);e.setSubGridCssStyle(d.showData.prodOfferStyle,d.rowIndex);e.dealTimeDisplayByChgMain(d);
e.dealTimeDisplayByNew(d);e.setPortSpeedSubProdOfferTime(d);},setSubGridCssStyle:function(h,g){var e=this.subProdOfferOrderGrid.domNode;var f=dojo.query(".subProdOfferDetail-"+g,e)[0];var d=a.DomHelper.findParentNode(f,function(i){return i.tagName.toUpperCase()=="TR";
});dojo.attr(d,"class",h);},setSubOfferViewDisplay:function(h,e){var f=this.subProdOfferOrderGrid.domNode;var g=dojo.query(".subProdOfferDetail-"+h,f)[0];var d=a.DomHelper.findParentNode(g,function(i){return i.tagName.toUpperCase()=="TR";
});if(!!e){d.style.display="none";}else{d.style.display="";}},resetSubProdOfferCart:function(){var e=this;e.subProdOfferOrderGrid.remove();this.prodOfferDetailBuilder.destroy();this.prodOfferDetailBuilder.prodOfferDetailWidgetList=[];
if(e.uniqueId==null||e.uniqueId==""){if(!!$ac$.mainProdOfferInstVO){e.showOrderedProdOffer();}else{e.showSelectDefaultProdOffer();e.dealCoopNumOfferForReset();}}else{var d=$ac$.selectedMemberProdOfferList;
var f=dojo.filter(d||[],function(g){return g.uniqueId==e.uniqueId;});if(f.length>0){if(!!(f[0].offerInstVO)){e.showOrderedProdOffer();}else{e.showSelectDefaultProdOffer();e.dealCoopNumOfferForReset();}}}},showSelectDefaultProdOffer:function(){var k=this;
var l=[];k.subProdOfferOrderGrid.remove();if((!!$ac$.selectedMainProdOfferInfoVO)&&$ac$.selectedMainProdOfferInfoVO.bindType==2){var j=a.ProdOfferHelper.getMainProdOffer($ac$.get("prodOfferList"))[0];var g=a.ProdOfferHelper.getMainProdOffer($ac$.get("prodOfferList"+k.uniqueId))[0];
var d=dojo.filter(g.offerProdRelaList||[],function(m){return m.productInfoVO.prodFuncType=="101"&&m.productInfoVO.netType=="8";})[0];var h=this.controller.getServiceOfferConfigVO(a.ACTION_CD_CONST.PRODUCT_INSTALL).serviceOfferId;
var f="";if(d){f=a.ProdOfferHelper.isT2ProdOffer(j.prodOfferId,d.productInfoVO.productId,h);}if(f&&f.code=="1"){var i=g.prodOfferId;var e=a.ProdOfferHelper.getT2MemProdOfferList(i);var l=dojo.filter(e||[],function(m){return m.prodOfferId==a.T2ProdOfferConst.VOICE_CARD_SUB_PRODOFFER;
});}else{l=a.ProdOfferHelper.getSubProdOfferList(dojo.global.$appContext$.get("prodOfferList"+k.uniqueId));}}else{l=a.ProdOfferHelper.getSubProdOfferList(dojo.global.$appContext$.get("prodOfferList"+k.uniqueId));
}dojo.forEach(l,function(n){var o=a.ProdOfferHelper.createProdOfferRowData(n);var m=k.doGetChooseNumList(n);if(m.chooseNumberList.length>0){o.showData.chooseNumberObj=m.chooseNumberList[0];}else{o.showData.chooseNumberObj=null;
}k.addOneRow(o);});k.setSelectAbleSubProdOfferTime();k.setBacthPortSpeedSubProdOfferTime();},doGetChooseNumList:function(g){var f=this;var h=null;var j=a.ProdOfferHelper.doGetRelaAccessProductIdList(g);
var e=dojo.query(".main-product-basic",this.controller.mainProdOfferWidget.domNode);if(f.uniqueId==""||f.uniqueId==-1){h=dojo.filter(e||[],function(k){var l=dojo.attr(k,"productId")||dojo.query("SELECT",k)[0].value;
return dojo.some(j||[],function(m){return m==l;});});}else{h=dojo.filter(e||[],function(k){var l=dojo.attr(k,"productId")||dojo.query("SELECT",k)[0].value;return dojo.some(j||[],function(m){return m==l;
})&&dojo.attr(k,"uniqueId")==f.uniqueId;});}var i=dojo.filter(h,function(k){return dojo.query(".main-product-check",k)[0].checked;});var d=dojo.map(i||[],function(l){var k=dojo.attr(l,"viewId");return{serviceKind:dojo.attr(l,"serviceKind")||"-1",serviceKindIndex:dojo.attr(l,"serviceKindIndex")||"-1",serviceId:dojo.query(".serviceId-"+k,l)[0].value,productId:dojo.attr(l,"productId")||"-1",uniqueId:dojo.attr(l,"uniqueId")};
});return{chooseNumberList:d,allProdBasicList:h};},showOrderedProdOffer:function(){var e=this,d=dojo.global.$appContext$.get("keepProdOfferInstList"+e.uniqueId)||[],f=dojo.global.$appContext$.get("cancelProdOfferInstList"+e.uniqueId)||[],g={keepProdOfferInstList:d,cancelProdOfferInstList:f};
e.subProdOfferOrderGrid.remove();e.showChgOrderedProdOffer(g);e.showLeftSelectAbleProdOffer();e.setSelectAbleSubProdOfferTime(true);},showLeftSelectAbleProdOffer:function(){var e=this;var d=dojo.global.$appContext$.get("leftProdOfferList"+e.uniqueId)||[];
dojo.forEach(d||[],function(g){var h=a.ProdOfferHelper.createProdOfferRowData(g);var f=e.doGetChooseNumList(g);if(f.chooseNumberList.length>0){h.showData.chooseNumberObj=f.chooseNumberList[0];}else{h.showData.chooseNumberObj=null;
}e.addOneRow(h);});},showChgOrderedProdOffer:function(f){var k=this,d=f.keepProdOfferInstList,h=f.cancelProdOfferInstList,e=f.mainProdOfferInst,l=[],g=[];dojo.forEach(d||[],function(m){if((e||dojo.global.$appContext$.get("mainProdOfferInstVO"+k.uniqueId)).prodOfferId!=m.prodOfferId){l.push(m);
}});dojo.forEach(h||[],function(m){if((e||dojo.global.$appContext$.get("mainProdOfferInstVO"+k.uniqueId)).prodOfferId!=m.prodOfferId){g.push(m);}});var i=dojo.map(l,function(m){return a.ProdOfferHelper.createKeepProdOfferRowDataForChg(m,k.uniqueId||"");
}),j=dojo.map(g,function(m){return a.ProdOfferHelper.createCancelProdOfferRowDataForChg(m,k.uniqueId||"");});dojo.forEach([].concat(i,j),function(n){var m=k.selectOldUseNumber(n);if(m.length>0){n.showData.chooseNumberObj=m[0];
}else{n.showData.chooseNumberObj=null;}n.uniqueId=k.uniqueId;k.subProdOfferOrderGrid.add(n);k.dealRaiseXDSLSpeedForChg(n);k.setSubGridCssStyle(n.showData.prodOfferStyle,n.rowIndex);k.dealTimeDisplayByChgMain(n);
});},selectOldUseNumber:function(l){var i=dojo.query(".main-product-basic",this.controller.mainProdOfferWidget.domNode),j=[],d=l.prodOfferInst;if(!d){return j;}var f=d.prodInstList||[];BusCard.each(f,function(s){var o=s.prodInstRela;
for(var t in o){var n=o[t];var r=t,q=dojo.filter(i,function(p){return dojo.attr(p,"userId")==r&&dojo.query(".main-product-check",p)[0].checked;})[0],m=dojo.attr(q,"viewId");j.push({serviceKind:dojo.attr(q,"serviceKind")||"-1",serviceKindIndex:dojo.attr(q,"serviceKindIndex")||"-1",serviceId:dojo.query(".serviceId-"+m,q)[0].value,productId:dojo.attr(q,"productId")||"-1",uniqueId:dojo.attr(q,"uniqueId"),userId:r});
}});if(j.length==0){if(d.offerProdInstRelaList&&d.offerProdInstRelaList.length>0){var g=d.offerProdInstRelaList[0];var h=g.prodInstId;var e=dojo.filter(i,function(m){return dojo.attr(m,"userId")==h&&dojo.query(".main-product-check",m)[0].checked;
})[0];var k=dojo.attr(e,"viewId");j.push({serviceKind:dojo.attr(e,"serviceKind")||"-1",serviceKindIndex:dojo.attr(e,"serviceKindIndex")||"-1",serviceId:dojo.query(".serviceId-"+k,e)[0].value,productId:dojo.attr(e,"productId")||"-1",uniqueId:dojo.attr(e,"uniqueId"),userId:h});
}}return j;},showOneSubProdOffer:function(e,d){var f=a.ProdOfferHelper.createProdOfferRowData(e);f.showData.chooseNumberObj=d;this.addOneRow(f);},dealRaiseXDSLSpeed:function(g,d,f,i){var e=a.ProdOfferHelper.getRaiseSpeedObj(g);
if(e==null||d==null){return;}e.uniqueId=d.uniqueId;e.prodOfferId=g.prodOfferId;e.rowData=i;var h=new BusCard.messaging.Publisher();if(f&&i.prodOfferInst==null){i.rateFlag=d.uniqueId;h.publish("/message/raiseSpeed"+d.uniqueId,e);
}else{if((!f)&&i.prodOfferInst==null){h.publish("/message/decreaseSpeed"+d.uniqueId,e);}else{if((!f)&&i.prodOfferInst!=null){h.publish("/message/decreaseSpeedHandleByCancelOld"+d.uniqueId,e);}else{if(f&&i.prodOfferInst!=null){h.publish("/message/raiseSpeedHandleByCancelOld"+d.uniqueId,e);
}}}}},dealRaiseXDSLSpeedForChg:function(g){var f=new BusCard.messaging.Publisher();var e=a.ProdOfferHelper.getRaiseSpeedObj(g.subProdOfferInfo);var d=g.showData.chooseNumberObj;if(e==null||d==null){return;
}e.rowData=g;e.uniqueId=d.uniqueId;e.prodOfferId=g.subProdOfferInfo.prodOfferId;e.initStatus=true;if(g.showData.checkedOption==""){f.publish("/message/decreaseSpeedHandleByCancelOld"+d.uniqueId,e);}else{f.publish("/message/raiseSpeedHandleByCancelOld"+d.uniqueId,e);
}},recoveryTimeDisplayByChgMain:function(e){var n=this;var k=this.subProdOfferOrderGrid.domNode;var g=n.getIfChangeMainFlag();if(g==null){return;}else{if(g==1){var j=e.showData.rowIndex;var m=e.showData.viewId;
var d=dojo.query(".subProdOfferDetail-"+j,k)[0];var i=dojo.query(".subProdOfferStartDate-"+j,k)[0];var h=dojo.query(".productStartDateStyle",i)[0];var l=dojo.query(".subProdOfferEndDate-"+j,k)[0];if(d.childNodes[0].checked&&e.prodOfferInst!=null){var f=dojo.query("[id='offerDelayEndDateView-"+m+"']",l)[0];
if(f){dojo.query(".prodDelayEndDateStyle",f)[0].style.display="none";dojo.query(".delay_date_class",l)[0].innerHTML=a.DateHelper.formatDate(a.DateHelper.getFirstDayAfterPeriod());}}}}},dealTimeDisplayByNew:function(f){var i=this;
var d=this.subProdOfferOrderGrid.domNode;if(i.getIfProdInstallFlag()==true){var h=f.showData.rowIndex;var g=dojo.query(".subProdOfferStartDate-"+h,d)[0];var e=dojo.query(".productStartDateStyle",g)[0];
if(e){e.style.display="none";}dojo.query(".start_date_class",g)[0].innerHTML=dojo.global.$appContext$.requestParam.today;}},dealTimeDisplayByChgMain:function(f,j){var p=this;var m=this.subProdOfferOrderGrid.domNode;
var h=p.getIfChangeMainFlag();if(h==null){return;}else{if(h==1){var e="orderaccept.prodofferaccept.loader.ProductChangeAcceptLoader";if(!!this.controller&&(this.controller.declaredClass==e)){return;}var l=f.showData.rowIndex;
var o=f.showData.viewId;var d=dojo.query(".subProdOfferDetail-"+l,m)[0];var k=dojo.query(".subProdOfferStartDate-"+l,m)[0];var i=dojo.query(".productStartDateStyle",k)[0];var n=dojo.query(".subProdOfferEndDate-"+l,m)[0];
if((!(d.childNodes[0].checked))&&f.prodOfferInst!=null){var g=dojo.query("[id='offerDelayEndDateView-"+o+"']",n)[0];if(g){dojo.query(".prodDelayEndDateStyle",g)[0].style.display="none";dojo.query(".delay_date_class",n)[0].innerHTML=this.getSubProdOfferEndDate();
var r=p.getMainOfferStandardChgMem();if(r){if($ac$.get("offerStandardStartDate_"+r.prodOfferInstId)){var q=$ac$.get("offerStandardStartDate_"+r.prodOfferInstId);dojo.query(".delay_date_class",n)[0].innerHTML=q.beginDate;
}}}}if(d.childNodes[0].checked&&f.prodOfferInst==null){if(i){i.style.display="none";}dojo.query(".start_date_class",k)[0].innerHTML=this.getSubProdOfferStartDate();var r=p.getMainOfferStandardChgMem();
if(r){if($ac$.get("offerStandardStartDate_"+r.prodOfferInstId)){var q=$ac$.get("offerStandardStartDate_"+r.prodOfferInstId);dojo.query(".start_date_class",k)[0].innerHTML=q.beginDate;}}}}}},getSubProdOfferEndDate:function(){return a.DateHelper.formatDate(a.DateHelper.getFirstDayAfterPeriod());
},getSubProdOfferStartDate:function(){return a.DateHelper.formatDate(a.DateHelper.getFirstDayAfterPeriod());},setBacthPortSpeedSubProdOfferTime:function(){var d=this;var i=false;var f=$ac$.selectedMemberProdOfferList;
if($ac$.selectedMainProdOfferInfoVO.bindType==2){var k=d.uniqueId;var g=dojo.filter(f||[],function(l){return l.uniqueId==k;});if(g.length>0&&g[0].action=="new"){i=true;}}else{if(!$ac$.mainProdOfferInstVO){i=true;
}}if(i){var j=d.getSubGridBindingData();var h=dojo.global.$appContext$.requestParam.today;var e=this.subProdOfferOrderGrid.domNode;dojo.forEach(j||[],function(m){if(a.ProdOfferHelper.getRaiseSpeedObj(m.subProdOfferInfo)==null){return;
}var o=m.showData.rowIndex;var n=dojo.query(".subProdOfferStartDate-"+o,e)[0];var l=dojo.query(".productStartDateStyle",n)[0];if(l){l.style.display="none";}dojo.query(".start_date_class",n)[0].innerHTML=h;
});}},setPortSpeedSubProdOfferTime:function(f){var n=this;var d=false;var g=$ac$.selectedMemberProdOfferList;if($ac$.selectedMainProdOfferInfoVO.bindType==2){var i=n.uniqueId;var j=dojo.filter(g||[],function(o){return o.uniqueId==i;
});if(j.length>0&&j[0].action=="new"){d=true;}}else{if(!$ac$.mainProdOfferInstVO){d=true;}}if(d){if(a.ProdOfferHelper.getRaiseSpeedObj(f.subProdOfferInfo)==null){return;}var e=dojo.global.$appContext$.requestParam.today;
var m=this.subProdOfferOrderGrid.domNode;var l=f.showData.rowIndex;var k=dojo.query(".subProdOfferStartDate-"+l,m)[0];var h=dojo.query(".productStartDateStyle",k)[0];if(h){h.style.display="none";}dojo.query(".start_date_class",k)[0].innerHTML=e;
}},setSelectAbleSubProdOfferTime:function(j){var o=this;if(o.getIfNewFlag()||j){var g=null;var k=null;var d=$ac$.selectedMainProdOfferInfoVO;if(d.bindType==2){var n=a.ProdOfferHelper.getMainProdOffer(dojo.global.$appContext$.get("prodOfferList"+o.uniqueId))[0];
g=n.prodOfferRelaList;k=n.prodOfferId;}else{k=d.prodOfferId;if(!!$ac$.get("prodOfferRelaList_"+o.uniqueId)){g=$ac$.get("prodOfferRelaList_"+o.uniqueId);}else{var e=a.ServiceFactory.getService("url:orderDetailAction.do?method=getProdOfferRelaListByMainProdOfferId",null,{method:"post",content:{prodOfferId:d.prodOfferId}});
g=e;$ac$.set("prodOfferRelaList_"+o.uniqueId,g);}}var f=o.getSubGridBindingData();var m=dojo.filter(f||[],function(p){return dojo.some(g||[],function(q){return q.offerAId==k&&q.offerZId==p.subProdOfferInfo.prodOfferId&&q.selectDefault==1&&q.selectable==1;
})&&p.prodOfferInst==null;});var h=dojo.global.$appContext$.requestParam.today;var i=o.getIfChangeMainFlag();if(i==1){h=o.getSubProdOfferEndDate();}var l=this.subProdOfferOrderGrid.domNode;dojo.forEach(m||[],function(q){var s=q.showData.rowIndex;
var r=dojo.query(".subProdOfferStartDate-"+s,l)[0];var p=dojo.query(".productStartDateStyle",r)[0];if(p){p.style.display="none";}dojo.query(".start_date_class",r)[0].innerHTML=h;dojo.query(".sub-prodoffer-del-img_"+s,l)[0].disabled=true;
q.showData.selectAble=true;});}},getIfNewFlag:function(){var d=this;var g=false;var f=$ac$.selectedMemberProdOfferList;if(d.contentPane){var e=dojo.filter(f||[],function(i){return i.uniqueId==d.uniqueId;
});if(e.length>0){if(e[0].action=="new"){g=true;}}}else{var h=f[0];if(h.action=="new"){g=true;}}return g;},getMainOfferStandardChgMem:function(){var d=this;var f=$ac$.selectedMemberProdOfferList;if(d.contentPane){var e=dojo.filter(f||[],function(h){return h.uniqueId==d.uniqueId;
});if(e.length>0){if(!!(e[0].offerInstVO)){return e[0].offerInstVO;}}}else{var g=f[0];if(!!(g.offerInstVO)){return g.offerInstVO;}}return null;},getIfProdInstallFlag:function(){var d=this;var f=$ac$.selectedMemberProdOfferList;
if(d.contentPane){var e=dojo.filter(f||[],function(h){return h.uniqueId==d.uniqueId;});if(e.length>0){if(!(e[0].offerInstVO)){return true;}}}else{var g=f[0];if(!(g.offerInstVO)){return true;}}return false;
},getIfChangeMainFlag:function(){var d=this;var f=$ac$.selectedMemberProdOfferList;if(d.contentPane){var e=dojo.filter(f||[],function(h){return h.uniqueId==d.uniqueId;});if(e.length>0){if(!!(e[0].offerInstVO)){if(e[0].offerInstVO.prodOfferId!=e[0].prodOfferId){return 1;
}}}}else{var g=f[0];if(!!(g.offerInstVO)){if(g.offerInstVO.prodOfferId!=g.prodOfferId){return 1;}}}return null;},saveSubProdOfferViewData:function(){pageData={};var f=this;var g=this.subProdOfferOrderGrid.ds.getRawData();
var e=this.subProdOfferOrderGrid.domNode;var d=f.getIfChangeMainFlag();dojo.forEach(g||[],function(r){var q=r.showData.rowIndex;var z=r.showData.viewId;var j=null;var n=null;var o=null;var v=null;var l=null;
var p=null;var k=null;var t=dojo.query(".subProdOfferDetail-"+q,e)[0];var i=dojo.query(".subProdOfferStartDate-"+q,e)[0];var w=dojo.query(".productStartDateStyle",i)[0];var C=dojo.query(".subProdOfferEndDate-"+q,e)[0];
var A=dojo.query(".productEndDateStyle",C)[0];var y=dojo.query(".offerEndDateCycleStyle",C)[0];var u=dojo.query(".choose_number_class_"+q,e)[0];if(w&&w.style.display!="none"){if(dojo.query("[id='delayTime-"+z+"']",i)[0]){j=dojo.query("[id='delayTime-"+z+"']",i)[0].value;
}if(dojo.query("[id='delayUnit-"+z+"']",i)[0]){n=dojo.query("[id='delayUnit-"+z+"']",i)[0].value;}}if(A&&A.style.display!="none"){if(dojo.query("[id='validPeriod-"+z+"']",C)[0]){o=dojo.query("[id='validPeriod-"+z+"']",C)[0].value;
}if(dojo.query("[id='validType-"+z+"']",C)[0]){v=dojo.query("[id='validType-"+z+"']",C)[0].value;}}else{if(y&&A.style.display!="none"){if(dojo.query("[id='cyclePeriod-"+z+"']",C)[0]){var s=dojo.query("[id='cyclePeriod-"+z+"']",C)[0].value;
var h=s.split("~");o=h[0];v=h[1];}}}if(!t.childNodes[0].checked&&r.prodOfferInst!=null){var m=dojo.query("[id='offerDelayEndDateView-"+z+"']",C)[0];if(m){if(m.style.display==""){if(dojo.query(".prodDelayEndDateStyle",m)[0].style.display==""){k=dojo.query("[id='delayEndTime-"+z+"']",C)[0].value;
p=dojo.query("[id='endDateDelayUnit-"+z+"']",C)[0].value;}else{l=dojo.trim(dojo.query(".delay_date_class",C)[0].innerHTML);}}}}var x=dojo.attr(u.childNodes[0],"serviceKind");var B=dojo.attr(u.childNodes[0],"serviceKindIndex");
f.pageData[q]={checkBoxValue:t.childNodes[0].checked,delayTime:j,delayUnit:n,validPeriod:o,validType:v,orderSatus:dojo.query(".orderStatus_"+q,e)[0].innerHTML,serviceKindIndex:B,serviceKind:x,beginDate:dojo.trim(dojo.query(".start_date_class",i)[0].innerHTML),endDate:l!=null?l:dojo.trim(dojo.query(".end_date_class",C)[0].innerHTML),delayUnorderUnit:p,delayUnorderTime:k,prodOfferName:r.showData.prodOfferName,prodOfferId:r.subProdOfferInfo.prodOfferId,ifChangeMainFlag:d};
});},refreshSubProdOfferCart:function(j,e){var d=this.subProdOfferOrderGrid.domNode;var h=dojo.attr(j,"serviceKindIndex"),i=dojo.attr(j,"serviceKind"),f="selected_number_"+i+"_"+h,g=dojo.query("[id='"+f+"']",d);
dojo.forEach(g||[],function(k){var l=dojo.attr(k,"name");dojo.query(".subProdOfferDetail-"+l,d)[0].childNodes[0].checked=e;if(!e){dojo.query(".orderStatus_"+l,d)[0].innerText="\u672a\u8ba2\u8d2d";}else{dojo.query(".orderStatus_"+l,d)[0].innerText="\u8ba2\u8d2d";
}});},getSubGridBindingData:function(){var d=this.subProdOfferOrderGrid.ds.getRawData();return dojo.filter(d,function(e){return e.showData.prodOfferStyle!="prod-offer-invalid";});},getAllSubGridData:function(){return this.subProdOfferOrderGrid.ds.getRawData();
},setInvalidProdOfferCartData:function(f){var d=this;var e=this.subProdOfferOrderGrid.domNode;dojo.forEach(f,function(g){g.showData.prodOfferStyle="prod-offer-invalid";var h=g.rowIndex;dojo.query(".subProdOfferDetail-"+h,e)[0].childNodes[0].checked=false;
dojo.query(".subProdOfferDetail-"+h,e)[0].childNodes[0].disabled="disabled";dojo.query(".orderStatus_"+h,e)[0].innerText="未订购";d.setSubGridCssStyle(g.showData.prodOfferStyle,g.rowIndex);d.setSubOfferViewDisplay(h,true);
});},updateCurrentProdOfferStyle:function(h,i){var f=this;var g=this.subProdOfferOrderGrid.domNode;var j=h.rowIndex;if(i=="prod-offer-del"){if(h.showData.prodOfferStyle=="prod-offer-reserve"){h.showData.oldProdOfferStyle=h.showData.prodOfferStyle;
}var d=h.showData.viewId;var e=dojo.query(".subProdOfferEndDate-"+j,g)[0];dojo.query(".orderStatus_"+j,g)[0].innerText="已退订";if(!dojo.query(".subProdOfferDetail-"+j,g)[0].childNodes[0].checked&&h.prodOfferInst!=null){if(dojo.query("[id='offerDelayEndDateView-"+d+"']",e)[0]){dojo.query("[id='offerDelayEndDateView-"+d+"']",e)[0].style.display="";
}if(dojo.query("[id='offerEndDateDisplay-"+d+"']",e)[0]){dojo.query("[id='offerEndDateDisplay-"+d+"']",e)[0].style.display="none";}}}else{if(i=="prod-offer-change"){if(h.showData.oldProdOfferStyle&&h.showData.oldProdOfferStyle=="prod-offer-reserve"){i="prod-offer-reserve";
}var d=h.showData.viewId;var e=dojo.query(".subProdOfferEndDate-"+j,g)[0];dojo.query(".orderStatus_"+j,g)[0].innerText="用户已有";if(dojo.query(".subProdOfferDetail-"+j,g)[0].childNodes[0].checked&&h.prodOfferInst!=null){if(dojo.query("[id='offerDelayEndDateView-"+d+"']",e)[0]){dojo.query("[id='offerDelayEndDateView-"+d+"']",e)[0].style.display="none";
}if(dojo.query("[id='offerEndDateDisplay-"+d+"']",e)[0]){dojo.query("[id='offerEndDateDisplay-"+d+"']",e)[0].style.display="";}}}else{if(i=="prod-offer-add"){f.setSubOfferViewDisplay(j,false);dojo.query(".orderStatus_"+j,g)[0].innerText="订购";
}else{if(i=="prod-offer-unorder"){if(!!$ac$.get("currentOperDelView")){f.setSubOfferViewDisplay(j,true);}dojo.query(".orderStatus_"+j,g)[0].innerText="未订购";}}}}f.setSubGridCssStyle(i,j);h.showData.prodOfferStyle=i;
f.dealTimeDisplayByChgMain(h,true);},_tempSaveOfferStyle:function(d){},batchOrderSubProdOffer:function(e){var d=this;dojo.forEach(e,function(g){var h=a.ProdOfferHelper.createProdOfferRowData(g);var f=d.doGetChooseNumList(g);
if(f.chooseNumberList.length>0){h.showData.chooseNumberObj=f.chooseNumberList[0];}else{h.showData.chooseNumberObj=null;}d.addOneRow(h);});},getSubProdOfferPageData:function(){var q=this;var f=null;if(q.prodOfferInfoWidget){f=q.prodOfferInfoWidget.getPageData();
if(!f){return false;}f.currentContentPane=this.contentPane;f.mainProdOfferDetailWidget=q.prodOfferInfoWidget.mainProdOfferDetailWidget;}var k=this.getSubGridBindingData();if(!this.controller.route("/checkInstance/checkIfHasUseNumber",k,null)){return false;
}this.saveSubProdOfferViewData();for(var e=0;e<k.length;e++){var h=k[e];var o=h.rowIndex;var l=h.prodOfferInst;h.prodOfferPageInfo=q.pageData[o];if(h.prodOfferPageInfo.checkBoxValue&&h.showData.prodOfferDetailFlag==1&&!!h.handlePageData&&dojo.isFunction(h.handlePageData)){if(h.handlePageData()===false){return false;
}}if(!h.relaProdPageInfoList||h.relaProdPageInfoList.length==0){h.relaProdPageInfoList=q.getDefaultSubrodPageData(h);}if(!h.offerAttrPageInfoList){var g={};if(!!l&&!!l.offerInstAttrList){dojo.forEach(l.offerInstAttrList,function(t){var u=dojo.filter(h.subProdOfferInfo.attrList,function(v){return v.attrCd==t.attrCd;
})[0];var p=t.attrValue;if(!!u&&!isNaN(p)){if(u.valueUnit==a.AttrUnitConst.unitConst||u.valueUnit==a.AttrUnitConst.minuteConst){p=parseFloat(p+"")/100;}}g[""+t.attrCd]=p;});}h.offerAttrPageInfoList=a.AttrUtil.getAttrDefaultValueList(!!l&&!!l.offerInstAttrList?g:h.subProdOfferInfo.attrList);
}if(!h.relaBusPageInfoList){if(!!l){var n=[];var m=c.load("FavourKindConst").FavourKindConst;var s=!!h&&!!h.showData?h.showData.chooseNumberObj:null;var j=(!!s&&!!s.userId?s.userId:0)+"";if(!!l.selfFavourRelaList&&l.selfFavourRelaList.length>0){var r=l.selfFavourRelaList;
dojo.forEach(r,function(p){n.push({cityCode:"",userId:j,serviceId:"",serviceKind:"0",favourKind:m.SELF_FAVOUR,prodOfferId:p.prodOfferId,operKind:2,objServiceId:p.objectServiceId,objCityCode:p.objCityCode,objServiceKind:p.objServiceKind,ifBind:"-1",netOwner:p.netOwner,areaId:"",subGroupType:p.subGroupType});
});}else{if(!!l.favourRelaList&&l.favourRelaList.length>0){var d=l.favourRelaList;dojo.forEach(d,function(p){n.push({cityCode:"",userId:j,serviceId:"",serviceKind:"0",favourKind:m.COMMON_FAVOUR,unitId:p.unitId,prodOfferId:p.prodOfferId,operKind:2,objServiceId:p.serviceId,objCityCode:p.cityCode,objServiceKind:p.serviceKind,ifBind:"-1",netOwner:"",areaId:"",subGroupType:""});
});}else{if(!!l.ocsSubseridInfoList&&l.ocsSubseridInfoList.length>0){var i=l.ocsSubseridInfoList;dojo.forEach(i,function(p){n.push({cityCode:"",userId:j,serviceId:"",serviceKind:"0",favourKind:m.OCS_FAVOUR,unitId:"",prodOfferId:p.prodOfferId,operKind:2,objServiceId:p.objServiceId,objCityCode:p.cityCode,objServiceKind:p.serviceKind,ifBind:"-1",netOwner:"",areaId:"",subGroupType:p.subGroupType});
});}}}if(n.length>0){h.relaBusPageInfoList=n;}}}if(!h.resRelaPageInfoList){h.resRelaPageInfoList=!!l&&!!l.resRelaInfoList?l.resRelaInfoList:h.resRelaPageInfoList;}}var h={checkedProdOfferGridData:null,allSubProdOfferCartData:k};
if(!this.controller.route("/checkInstance/doCheckBeforeCommit",h,q)){return false;}return{subProdOfferPageData:k,mainProdOfferPageData:f};},getDefaultSubrodPageData:function(h){var e=[];var j=this.controller;
if((!h.relaProdPageInfoList||h.relaProdPageInfoList.length==0)&&h.subProdOfferInfo.offerProdRelaList.length>0){var g=dojo.filter(h.subProdOfferInfo.offerProdRelaList,function(n){return n.productInfoVO.prodFuncType!=c.load("ProductFuncTypeConst").ProductFuncTypeConst.ACCESS;
});var m=dojo.filter(g,function(n){return dojo.some(n.productInfoVO.prodRelaList,function(o){return(o.relaType==a.PRODOFFERTYPE.SUBORDINATE_TYPE)&&(o.prodA==h.showData.chooseNumberObj.productId);});});
if(m.length>0){var k=0;if(m.length==1){k=1;}dojo.forEach(m,function(p){var q=null;if(!!h.prodOfferInst&&!!h.prodOfferInst.prodInstList&&h.prodOfferInst.prodInstList.length>0){q=dojo.filter(h.prodOfferInst.prodInstList,function(r){return p.productId==r.productId;
})[0];}var o={};if(!!q&&!!q.prodInstAttrList){dojo.forEach(q.prodInstAttrList,function(s){var t=dojo.filter(p.productInfoVO.attrList,function(u){return u.attrCd==s.attrCd;})[0];var r=s.attrValue;if(!!t&&!isNaN(r)){if(t.valueUnit==a.AttrUnitConst.unitConst||t.valueUnit==a.AttrUnitConst.minuteConst){r=parseFloat(r+"")/100;
}}o[""+s.attrCd]=r;});}var n={prodBasicInfo:{productId:p.productId,prodInstId:!!q?q.prodInstId:null,prodInstInfo:!!q?q:null,checkedStatus:k==1||p.ifDefault==1||!!q?true:false},prodAttrInfo:a.AttrUtil.getAttrDefaultValueList((!!q&&!!q.prodInstAttrList)?o:p.productInfoVO.attrList),productInfo:p};
e.push(n);});}else{var i=dojo.filter(h.subProdOfferInfo.offerProdRelaList,function(n){if(n.productId==h.showData.chooseNumberObj.productId){return true;}})[0];var d="orderaccept.prodofferaccept.loader.ProductChangeAcceptLoader";
var l=false;if(!!j&&!!j.declaredClass){if(j.declaredClass==d&&!h.prodOfferPageInfo.checkBoxValue&&h.prodOfferInst!=null){l=true;}}if(!l){var f={prodBasicInfo:{productId:i.productId,prodInstId:null,prodInstInfo:null,checkedStatus:true},prodAttrInfo:null,productInfo:i};
e.push(f);}}}return e;},dealCoopNumOfferForReset:function(){var h=this;var g=h.uniqueId||"";var f=$ac$.get("coopNumOffers"+g);var e=h.getSubGridBindingData();var d=dojo.filter(f,function(i){return !dojo.some(e||[],function(j){return j.subProdOfferInfo.prodOfferId==i.prodOfferId;
});});h.batchAddForCoopNum(d);},batchAddForCoopNum:function(d){var e=this;dojo.forEach(d,function(g){var h=a.ProdOfferHelper.createProdOfferRowData(g);var f=e.doGetChooseNumList(g);if(f.chooseNumberList.length>0){h.showData.chooseNumberObj=f.chooseNumberList[0];
}else{h.showData.chooseNumberObj=null;}h.coopNumRela=true;e.addSimpleOneRow(h);});},interFaceForCoopNum:function(d){var e=this;e.removeCoopNumRelaOffer();e.addForCoopNum(d);},addForCoopNum:function(h){var j=this;
var i=j.uniqueId||"";if(!h||h.length==0){$ac$.set("coopNumOffers"+i,[]);return;}var d=this.subProdOfferOrderGrid.domNode;var g=j.getSubGridBindingData();var m=dojo.filter(g||[],function(n){return dojo.some(h||[],function(o){return o==n.subProdOfferInfo.prodOfferId;
})&&dojo.query(".subProdOfferDetail-"+n.rowIndex,d)[0].childNodes[0].checked==false;});dojo.forEach(m||[],function(n){j.updateOfferStyle(n,"prod-offer-add");});var l=dojo.filter(h,function(n){return !dojo.some(g||[],function(o){return o.subProdOfferInfo.prodOfferId==n;
});});var f=function(){try{return prodOfferAcceptLoader.getBelongCode();}catch(n){}}();var k=a.ServiceFactory.getService("url:orderDetailAction.do?method=getBatchProdOfferDetail&prodOfferIdListStr="+dojo.toJson(l)+"&interfaceType="+5+"&belongCode="+(f||""));
j.batchAddForCoopNum(k);var e=dojo.map(j.getSubGridBindingData()||[],function(n){return n.subProdOfferInfo;});$ac$.set("coopNumOffers"+i,dojo.map(h||[],function(n){return BusCard.find(e||[],function(o){return o.prodOfferId==n;
});}));},addSimpleOneRow:function(d){var e=this;d.uniqueId=e.uniqueId;e.subProdOfferOrderGrid.add(d);e.setSubGridCssStyle(d.showData.prodOfferStyle,d.rowIndex);},removeCoopNumRelaOffer:function(){var f=this;
var e=f.getSubGridBindingData();var d=dojo.filter(e||[],function(g){return g.coopNumRela==true;});dojo.forEach(d||[],function(g){f.updateOfferStyle(g,"prod-offer-unorder");});},updateOfferStyle:function(e,f){var h=this;
var d=this.subProdOfferOrderGrid.domNode;var g=e.rowIndex;if(f=="prod-offer-unorder"){e.coopNumRela=false;h.setSubOfferViewDisplay(g,true);dojo.query(".subProdOfferDetail-"+g,d)[0].childNodes[0].checked=false;
dojo.query(".orderStatus_"+g,d)[0].innerText="未订购";h.setSubGridCssStyle(f,g);}else{e.coopNumRela=true;h.setSubOfferViewDisplay(g);dojo.query(".subProdOfferDetail-"+g,d)[0].childNodes[0].checked=true;dojo.query(".orderStatus_"+g,d)[0].innerText="订购";
h.setSubGridCssStyle(f,g);}},getTempSaveSubProdOfferPageData:function(){var e=this;var d=null;if(e.prodOfferInfoWidget){d=e.prodOfferInfoWidget.getPageData();}this.saveSubProdOfferViewData();var f=this.getSubGridBindingData();
dojo.forEach(f,function(g){var h=g.rowIndex;g.prodOfferPageInfo=e.pageData[h];});return{subProdOfferPageData:f,mainProdOfferPageData:d};},showTempSaveProdOffer:function(){var e=this;var g=dojo.global.$appContext$.get("_tempSaveProdOfferObj_"+e.uniqueId);
var d=g.mainProdOfferPageData;var f=g.subProdOfferPageData;dojo.forEach(f,function(h){e.subProdOfferOrderGrid.add(h);});},showOrderChangeProdOffer:function(){this.showProdOfferFromOrderItem();},showProdOfferFromOrderItem:function(){var d=this;
var f=a.CustOrderVOHelper.getInstance(dojo.global.$appContext$.get("_custOrderVO_"));var e=f.getSubProdOfferItemList();dojo.forEach(e,function(i){var h=f.getServiceProdItemListForOfferItem(i);var j=a.ProdOfferHelper.createProdOfferRowDataByOrderItem(i,h);
var g=d.doGetChooseNumByOrderItem(j,f);if(g.length>0){j.showData.chooseNumberObj=g[0];}else{j.showData.chooseNumberObj=null;}d.subProdOfferOrderGrid.add(j);});},doGetChooseNumByOrderItem:function(l,f){var e=dojo.query(".main-product-basic",this.controller.mainProdOfferWidget.domNode),h=[],j=l.offerItemData;
if(!j){return h;}var g=f.getAcessProdItem(j);if(g==null){return h;}var k=g.serviceId,d=dojo.filter(e,function(n){var m=dojo.attr(n,"viewId");return dojo.query(".serviceId-"+m,n)[0].value==k;})[0],i=dojo.attr(d,"viewId");
h.push({serviceKind:dojo.attr(d,"serviceKind")||"-1",serviceKindIndex:dojo.attr(d,"serviceKindIndex")||"-1",serviceId:dojo.query(".serviceId-"+i,d)[0].value,productId:dojo.attr(d,"productId")||"-1"});return h;
}});});
defineModule("orderaccept.prodofferaccept.widget.budget.BudgetWidget",["orderaccept.prodofferaccept.util","orderaccept.custom._BaseWidget","orderaccept.custom._BusCardTemplated","dijit._Container","orderaccept.common.js.ConstantsPool","unieap.layout.Container"],function(a,e,d,b,c){dojo.declare("orderaccept.prodofferaccept.widget.budget.BudgetWidget",[e,d,b],{templatePath:dojo.moduleUrl("orderaccept.prodofferaccept.widget.budget","template/budgetPage.html"),custOrderId:null,batchRegNo:null,batchBudgetAcceptInfo:null,batchBudget:-1,constructor:function(f){this.custOrderId=f.custOrderId;
this.batchRegNo=f.batchRegNo;this.batchBudgetAcceptInfo=f.batchBudgetAcceptInfo;if(!!f.batchBudgetAcceptInfo){this.batchBudget=f.batchBudgetAcceptInfo.batchBudget;}},postMixInProperties:function(){this.budgetData=this.getBudgetData();
},postCreate:function(){this.gridContainer=dojo.query(".budget-grid",this.domNode)[0];this.initBudgetView();this._init_sub_page();this.initPerferSession();},initBudgetView:function(){var h=this.gridContainer;
var f=new unieap.layout.Container({id:"budgetContainer"});dojo.place(f.domNode,h,"last");var g=new unieap.layout.Container({id:"gridCardContainer"});dojo.place(g.domNode,f.containerNode,"last");var n=0;
var m=this.budgetData;for(var l=0,k=m.length;l<k;l++){n+=parseFloat(m[l].actualAmount.toString());}var o="<div class='totalAmount-class' id='totalAmountView'>\u5408\u8ba1："+this.fmoney(n,2)+"\u5143</div>";
dojo.place(o,f.containerNode,"last");this.initGridCard(g.domNode,dojo.query(".totalAmount-class",this.domNode)[0]);},fmoney:function(f,g){g=g>0&&g<=20?g:2;f=parseFloat((f+"").replace(/[^\d\.-]/g,"")).toFixed(g)+"";
return f;},initGridCard:function(f,g){var h=BusCard.createInstance({gridData:this.budgetData,totalAmountContainer:g},f,{gType:3,fromURL:true,url:"/buscardapp/protocol/xml/card_pi_budget.xml"});h.init(function(){});
return h;},initTotalAmount:function(){var h=this.budgetData;var k=0;for(var g=0,f=h.length;g<f;g++){k+=parseFloat(h[g].actualAmount.replace(/[^\d\.-]/g,""));}var l=document.createElement("div");l.className="totalAmountName";
l.id="totalAmount";this.gridContainer.appendChild(l);},getBudgetData:function(){var j=Object.prototype.toString;var h={custOrderId:parseInt(this.custOrderId),orderAlterId:$ac$.get("orderAlterId")?$ac$.get("orderAlterId"):0,orderChangeFlag:!!$ac$.get("orderChangeFlag")?$ac$.get("orderChangeFlag"):-1,batchRegNo:this.batchRegNo,batchBudget:this.batchBudget};
var p=[];var m=$ac$.get("selectedMemberProdOfferList");if(!!m){var g=[];var o="";var n="";var f=c.load("StaticTypeConst").StaticTypeConst.PROD_INST_ACCT_STATE_1000;var l=c.load("ServiceOfferIDConst").ServiceOfferIDConst.PROD_QUIT;
dojo.forEach(m,function(s){if(s.action=="quit"){var r=!!s.prodInstVO?s.prodInstVO.serviceRelationVO:null;if(!!r){g.push(r.userId);n=r.cityCode;if(o==""){o=BusCard.$remote("prodInstAcctBO").getProdInstAcct({state:f,cityCode:r.cityCode,prodInstId:r.userId,ifOperate:true});
}}}});if(g.length>0){var i=BusCard.$remote("acctBalanceInfoCaller").execute({useMode:6,objectType:3,objectValue:o,cityCode:n,deviceNo:"",serviceKind:0,servIdGroup:g});if(!!i&&!!i.acctBalancBundleGroup){dojo.forEach(i.acctBalancBundleGroup,function(r){var s=BusCard.$remote("feeMgrFacadeBO").queryPayWayByKind(r.paymentMethod);
var t={amount:r.balance/100,acctItemTypeId:s,userId:r.servId};p.push(t);BusCard.$remote("prodOfferSaleDataBO").doInsertBusFeeBill(i.acctBalancBundleGroup,h.custOrderId,l,o);});}}}dojo.mixin(h,{otherFeeList:p});
if(this.batchBudget==1){var q="/budgetComponentAction.do?method=doBatchBudgetforShow";}else{var q="/budgetComponentAction.do?method=doBudget";}var k=BusCard.util.doPost(BusCard.path.contextPath+q,h,false,null,null,true);
if(k.checkFeeAll!=null){$ac$.set("errorFlag",-1);alert(k.checkFeeAll.message);}if(k.error!=null){$ac$.set("errorFlag",-1);alert(k.error.message);}this.initData(k.dataList,h);return k.dataList;},initData:function(f,g){dojo.getObject("_budget_._temp_._data_",true);
_budget_._temp_._data_=f;dojo.global.$appContext$.set("_budgetParamList_",f);dojo.global.$appContext$.set("_custOrderId_",g.custOrderId);},getFeeConfirmData:function(){var g="";try{g=dojo.global.$appContext$.get("_authWorkNo_");
}catch(h){}var f=dojo.global.$appContext$.get("_budgetParamList_");if(!!dojo.global.$appContext$.get("_custOrderId_")){}return{authWorkNo:g,batchBudget:this.batchBudget,batchRegNo:this.batchRegNo,orderAlterId:$ac$.get("orderAlterId")?$ac$.get("orderAlterId"):0,orderChangeFlag:!!$ac$.get("orderChangeFlag")?$ac$.get("orderChangeFlag"):-1,custOrderId:!!dojo.global.$appContext$.get("_custOrderId_")?parseInt(dojo.global.$appContext$.get("_custOrderId_").toString()):0,budgetParamList:f};
},_init_sub_page:function(){if($ac$.get("errorFlag")==-1){dojo.global.$appContext$.set("_budgetcomputeAmountFlag_",false);dojo.query(".fee-modify-class",this.domNode)[0].disabled=true;dojo.query(".fee-confirm-class",this.domNode)[0].disabled=true;
}else{var f=this;if(f.computeAmount()==0){dojo.global.$appContext$.set("_budgetcomputeAmountFlag_",true);dojo.query(".fee-modify-class",this.domNode)[0].disabled=true;dojo.query(".fee-confirm-class",this.domNode)[0].disabled=true;
}if(!f._checkIfModify()){dojo.global.$appContext$.set("_budgetcomputeAmountFlag_",true);dojo.query(".fee-modify-class",this.domNode)[0].disabled=true;dojo.query(".fee-confirm-class",this.domNode)[0].disabled=true;
}}},_checkIfModify:function(){var f=this;var g=false;var j=f.budgetData;if(j.length>0){for(var h=0;h<j.length;h++){if(j[h].ifModify==0){g=true;break;}}}return g;},computeAmount:function(){var h=dojo.global.$appContext$.get("_budgetParamList_");
var f=0;if(h.length>0){for(var g=0;g<h.length;g++){f+=parseInt(h[g].amount.toString());}}return f;},initPerferSession:function(){var g=this;var j=BusCard.util.doGet(BusCard.path.contextPath+"/budgetComponentAction.do",{method:"getSessionInfo"});
var h=j.workno;var i=j.pwd;if(BusCard.util.trim(h)&&BusCard.util.trim(i)){var f=BusCard.util.doPost(BusCard.path.contextPath+"/budgetComponentAction.do?method=feeModifyAuth",{account:h,pwd:i,pwdflag:"1"});
if(f.flag=="-1"){dojo.global.$appContext$.set("_budgetcomputeAmountFlag_",true);dojo.query(".fee-modify-class",this.domNode)[0].disabled=true;dojo.query(".fee-confirm-class",this.domNode)[0].disabled=true;
return false;}else{g.unlock(this.gridContainer);dojo.global.$appContext$.set("_authWorkNo_",h);g.setButton();}}},setButton:function(){},unlock:function(f){BusCard.util.each(f.getElementsByTagName("INPUT"),function(h){var g=h.getAttribute("ifModify");
if(g!=null&&h.ifModify=="0"){h.disabled=false;}});},lock:function(){BusCard.util.each(this.gridContainer.getElementsByTagName("INPUT"),function(g){var f=g.getAttribute("ifModify");if(f!=null){g.disabled=true;
}});},computeShouldPayValue:function(){var h=dojo.global.$appContext$.get("_budgetParamList_");var f=0;if(h.length>0){for(var g=0;g<h.length;g++){f+=parseFloat(h[g].actualAmount.toString());}}return f;
}});});
defineModule("orderaccept.prodofferaccept.OrderShowLoader",["orderaccept.prodofferaccept.util","orderaccept.prodofferaccept.widget.budget.BudgetWidget"],function(b,a){dojo.declare("orderaccept.prodofferaccept.OrderShowLoader",[],{layoutTemplateUrl:dojo.moduleUrl("orderaccept.prodofferaccept","view/orderShowPage.html"),custOrderId:null,orderDetailListObj:null,custOrderListGrid:null,budgetComponent:null,constructor:function(c){this.custOrderId=c.custOrderId;
},_clearDirtyEnv:function(){try{var f=unieap.byId("custOrderListPane"),c=unieap.byId("budgetHeadPane");if(f){f.destroyRecursive();}if(c){c.destroyRecursive();}}catch(d){}},postscript:function(){var e=this;
var c=dojo.byId("order-show-root");this._clearDirtyEnv();c.innerHTML=dojo._getText(this.layoutTemplateUrl);dojo.parser.parse(c);e.initOrderDetailData();e.renderCustOrderListGrid();if(e.budgetComponent){e.budgetComponent.destroyRecursive();
}var d="<div  id='_budgetGridContainer'></div>";dojo.place(d,unieap.byId("budgetHeadPane").containerNode,"last");e.budgetComponent=new a({custOrderId:e.custOrderId},dojo.byId("_budgetGridContainer"));e.openShowDataPane();
this.getAccountAll4Dealer();},getAccountAll4Dealer:function(){var d=unieap.byId("budgetHeadPane");var e=prodOfferAcceptLoader.getNewServiceInfoList(true)||[];var f=dojo.map(dojo.filter(e,function(g){return true||!!(g.uimResInstId||g.resInstId);
}),function(g){var h={serviceId:g.serviceId,cityCode:BusCard.$session.cityCode+""||"",serviceKind:g.netType+"",dealerId:BusCard.$session.acceptDealer+""||BusCard.$session.dealerId+""};if(g.resInstId){h.resInstId=g.resInstId+"";
}if(g.uimResInstId){h.corResInstId=g.uimResInstId+"";}return h;});var c=function(m,l){dojo.require("unieap.util.util");var l=d.buttonContainerNode;var k="<span style='color:red;margin-right:100px' id='dealerAccountQuerySpan'>\u4ee3\u7406\u8d26\u6237\u4f59\u989d</span>";
var i=BusCard.Template.create("<div style='margin-left:10px;margin-right:10px;'><tp:for ds=list><p>${toString()}</p></tp:for><div style='text-align:center;color:red'><span style='cursor:pointer' onclick='return unieap.hideTooltip(dojo.byId(\"dealerAccountQuerySpan\"));'>关闭</span></div></div>");
if(m&&m.length){try{var g=BusCard.$remote("feeToBussInterBO").getAccountAll(m);if(true||g.length>0){var h=i.apply({list:g});dojo.place(k,l,"last");dojo.connect(BusCard.query("span",l)[0],"onclick",function(){if(!unieap._masterTT){unieap._masterTT=new unieap._MasterTooltip();
}unieap._masterTT.domNode.style.width="240px";if(unieap._masterTT.isShowingNow){unieap.hideTooltip(this);}else{unieap.showTooltip(h,this,["after","below"]);}});}}catch(j){return false;}}};c(f,d.buttonContainerNode);
},initOrderDetailData:function(){var d=this;if(!d.custOrderId){return;}var g="custOrderId="+d.custOrderId;var c=b.ServiceFactory.getService("url:orderQueryAction.do?method=orderListInit&"+g);try{d.orderDetailListObj=(typeof c=="string")?dojo.fromJson(c):c;
}catch(f){return;}},renderCustOrderListGrid:function(){var e=this;var d=e.sortOrderDetail(e.orderDetailListObj);var c=new BusCard.widget.grid.ColumnModel({metaData:this.getCustOrderColumns()});this.custOrderListGrid=new BusCard.widget.grid.Grid({cm:c,paging:true,ds:new BusCard.widget.grid.JsonDataSource({loadData:function(g){var h=g.start,f=g.end;
return{root:d.slice(h,f),totalProperty:d.length};}},c),pageSize:10});this.custOrderListGrid.render(unieap.byId("custOrderListPane").containerNode);},getCustOrderColumns:function(){return cm=[{width:"10%",name:"custOrderId",text:"客户订单号",canSort:false},{width:"10%",name:"orderItemId",text:"订单项编号",canSort:false},{width:"10%",name:"orderItemCdDesc",text:"订单项类型",canSort:false},{width:"20%",name:"orderName",text:"销售品/产品名称",canSort:false},{width:"10%",name:"serviceOfferDesc",text:"服务提供",canSort:false},{width:"10%",name:"serviceId",text:"接入号码",canSort:false},{width:"20%",name:"handleTime",text:"受理时间",canSort:false},{width:"10%",name:"orderStatus",text:"订单状态",canSort:false}];
},showOrderListData:function(){var e=this;var c=dojo.map(e.sortOrderDetail(e.orderDetailListObj),function(f){return{custOrderId:f.custOrderId,orderItemId:f.orderItemId,orderItemCdDesc:f.orderItemCdDesc,orderName:f.orderName,serviceOfferDesc:f.serviceOfferDesc,serviceId:f.serviceId?f.serviceId:"",handleTime:f.handleTime,orderStatus:f.orderStatus};
});var d=new unieap.ds.DataStore("order_data",c);dataCenter.addDataStore(d);this.custOrderListGrid.getBinding().setDataStore(d);},sortOrderDetail:function(h){var e=0,g=[];for(var f=0;f<h.length;f++){if(b.orderTypeObj.OFFER==h[f].orderItemCd){g[e]=h[f];
e++;}}for(var d=0;d<h.length;d++){if(b.orderTypeObj.PRODUCT==h[d].orderItemCd){g[e]=h[d];e++;}}for(var c=0;c<h.length;c++){if(b.orderTypeObj.ACCOUNT==h[c].orderItemCd){g[e]=h[c];e++;}}return g;},openShowDataPane:function(){var c=["custOrderListPane","budgetHeadPane"];
dojo.forEach(c,function(d){var e=unieap.byId(d);if(e&&!e.open){e.toggle();}});},destroy:function(){for(var c in this){if(this[c]&&(this[c].destroyRecursive||this[c].destroy)){(this[c].destroyRecursive||this[c].destroy).apply(this[c],arguments);
}try{if(this.hasOwnProperty(c)){delete this[c];}}catch(d){}}}});});
defineModule("orderaccept.prodofferaccept.widget.mainprodoffer.orderPreViewWidget",["orderaccept.custom._BaseWidget","orderaccept.custom._BusCardTemplated","unieap.dialog.Dialog","../../../custom/BusCardGrid","../../util","orderaccept.prodofferaccept.ProductDateBuilder"],function(f,e,b,d,a,c){dojo.declare("orderaccept.prodofferaccept.widget.mainprodoffer.orderPreViewWidget",[f,e],{templateString:"<div class='orderPreView' id='orderPreView'>										</div>"});
});
defineModule("orderaccept.prodofferaccept.formatter.PromotionFormatterProvider",["orderaccept.custom._BusCardTemplated","../util"],function(c,b){var a={PageInfoInit:{},createPromotionNameDetail:function(f,d){var e=BusCard.Template.create("<div class='promotionNameDetail-#{rowIndex}'><input type='checkbox' #{disabledOption} #{checkedOption} rowIndex='#{rowIndex}' id='#{viewId}' name='promotionChecked' value='#{promotionInfo.promotionId}' promotionStyle='#{promotionStyle}' dojoAttachEvent='onclick:elementclick' dojoAttachTopic='/promotionChecked'/>&nbsp;&nbsp;&nbsp;<span id='promotionName-#{viewId}' style='color:red;cursor:pointer' dojoAttachEvent='onclick:elementclick' dojoAttachTopic='/promotionName'>#{promotionName}</span>&nbsp;&nbsp;<tp:if $$.promotionStyle=='promotion-change'><a href='javascript:void(0);' id='promotionDetailLink-#{viewId}' style='color:#3399cc;font-weight:bold;cursor:pointer' rowIndex='#{rowIndex}' name='promotionDetailLink' value='#{promotionInfo.promotionId}' dojoAttachEvent='onclick:elementclick' dojoAttachTopic='/promotionChangeDetailLink'>[\u4fc3\u9500\u653f\u7b56\u8be6\u60c5]</a></tp:if><tp:if $$.promotionStyle=='promotion-new'><a href='javascript:void(0);' id='promotionDetailLink-#{viewId}' style='color:#3399cc;font-weight:bold;cursor:pointer' rowIndex='#{rowIndex}' name='promotionDetailLink' value='#{promotionInfo.promotionId}' dojoAttachEvent='onclick:elementclick' dojoAttachTopic='/promotionDetailLink'>[\u4fc3\u9500\u653f\u7b56\u8be6\u60c5]</a></tp:if>&nbsp;<img id='finishPage-#{rowIndex}' style='display:none' src='"+BusCard.path.contextPath+"/common/images/icon/finish_icon.png'></img></div>");
d.showData.rowIndex=f;return e.apply(d.showData);},createPromotionStartDate:function(f,e){var d=BusCard.Template.create("<div class='promotionStartDate-#{rowIndex}'><span class='start_date_class'>#{startDate}</span><div id='promotionStartDateView-#{viewId}' style='#{dateStyle.startDateView}'><span class='promotionStartDateStyle#{promotionStartDate.style.hiddenStyleOption}'><input type='hidden' id='delayTime-#{viewId}' value = '#{promotionStartDate.data.time}'/>#{promotionStartDate.data.delayUnitViewInstance}</span></div></div>");
return d.apply(e.showData);},createPromotionEndDate:function(f,e){var d=BusCard.Template.create("<div class='promotionEndDate-#{rowIndex}'><span id='promotionEndDateDisplay-#{viewId}' class='end_date_class'>#{endDate}</span><div id='promotionEndDateView-#{viewId}' style='#{dateStyle.endDateView}'><span class='promotionEndDateStyle#{promotionEndDate.style.hiddenStyleOption}'>\u6709\u6548\u671f:<select id='validPeriod-#{viewId}'> #{promotionEndDate.data.validPeriodOption}</select><select id='validType-#{viewId}'>#{promotionEndDate.data.validTypeOption}</select> <input type='hidden' id='prodCycleSize-#{viewId}' value = '#{promotionEndDate.data.prodCycleSize}'/></span></div><div>");
return d.apply(e.showData);},createPromotionTargetObject:function(f,e){var d=BusCard.Template.create("<div class='promotionTargetType-#{rowIndex}'><span style='color:red;'><tp:if $$.statusObj==1>销售品</tp:if><tp:if $$.statusObj==2>产品</tp:if></span></div>");
return d.apply(e.showData);},createPromotionStatus:function(e,d){return"<div class='promotionStatus-"+e+"'>"+d.showData.promotionStatus+"</div>";},createPromotionTargetNum:function(e,d){return"<div class='promotionTargetNum-"+e+"'></div>";
},createPromotonCollect:function(g,f){var e=dojo.global.$appContext$.get("prodOfferList");var d=b.ProdOfferHelper.getMainProdOffer(e)[0];f.showData.mainProdOfferId=d.prodOfferId;return BusCard.Template.create("<div class='collect_promotion_#{rowIndex}' style='text-align:center'><img class='collect-#{rowIndex}' name='collectPromotion' src='"+BusCard.path.contextPath+"/common/images/button/button_addFav.png' value='#{promotionInfo.promotionId}~#{promotionName}~13~#{mainProdOfferId}'style='cursor: pointer; width: 20px; height: 20px;margin-right:10px' dojoAttachEvent='onclick:elementclick' dojoAttachTopic='/promotionCollect' title='收藏'/>&nbsp;&nbsp;<img class='cancelCollect-#{rowIndex}' name='cancelCollectPromotion' src='"+BusCard.path.contextPath+"/common/images/button/button_cancelFav.png' value='#{promotionInfo.promotionId}~13~#{mainProdOfferId}'style='cursor: pointer; width: 20px; height: 20px;' dojoAttachEvent='onclick:elementclick' dojoAttachTopic='/promotionCancelCollect' title='取消收藏'/></div>").apply(f.showData);
}};orderaccept.prodofferaccept.formatter.PromotionFormatterProvider.promotionFormatter=a;});
defineModule("orderaccept.prodofferaccept.widget.attrcard.PromotionItemsCardWidget",["orderaccept.prodofferaccept.widget.attrcard.ProductAttrCardWidget","../../util","orderaccept.common.dialog.MessageBox"],function(ProductAttrCardWidget,util,messageBox){var groupKind={RENT:"50",TERMINAL:"51",TRANSFER_INFO:"52",AGREEMENT_INFO:"53",SUBSIDY:"54",MONTH_CONVERT:"55",WORDS_FEE_AS_PRESENT:"56",YUCUN_PRESENT:"57",ZIFEI_PRESENT:"58",GIFT_PRESENT:"59",COST:"60"};
var showTypeConst={SELECT_TYPE:"select"};var attrRelTypeConst={RELEVANCE:"3",EXCLUDE:"200000",RELY_ON:"100000"};dojo.declare("orderaccept.prodofferaccept.widget.attrcard.PromotionItemsCardWidget",[ProductAttrCardWidget],{firstClickAttrList:[],attrExprRelaCdList:{},attrExprList:{},needRendering:true,NOOP:function(){},postMixInProperties:function(){var modelData=this.getModel();
var promotionInfoVO=modelData.promotionInfoVO;var promotionInstInfo=modelData.promotionInstInfo;var protocolInstanceXml="<?xml version='1.0' encoding='UTF-8'?>					<card id='${cardId}' cardType='0' name='促销政策明细' pageColumn='2' xmlns='http://www.crm1.com/buscard'><metaData>	             	 ${promotionItemList}	             	 </metaData></card>";
if(promotionInfoVO.flag){protocolInstanceXml="<?xml version='1.0' encoding='UTF-8'?>					<card id='${cardId}' cardType='0' name='促销政策明细' pageColumn='4' xmlns='http://www.crm1.com/buscard'><metaData>	             	 ${promotionItemList}	             	 </metaData></card>";
}var cardId="promotion_"+promotionInfoVO.promotionId;var finalXml="";var cardWidget=this;if(this.checkIfNeedRendering(promotionInfoVO.salesPromotionItemList||[])){var _string=this.promotionAttrList(promotionInfoVO.salesPromotionItemList);
finalXml=BusCard.Template.create(protocolInstanceXml).apply({cardId:cardId,promotionItemList:_string});this.templateString=finalXml;}else{this.buildRendering=this.NOOP;this.postCreate=this.NOOP;}this.addCardCallback(function(){cardWidget.initProdSelect(this.busCardInstance);
cardWidget.initLength();cardWidget.initDisplayElement();cardWidget.renderDefaultValue();cardWidget.initAttrDisabled();cardWidget.dealAttrValueRel();cardWidget.dealAttrExpr();cardWidget.dealSpecialItem();
});},dealAttrIsInstance:function(){},initSpecialValueByAttrCode:function(){},bindUpdateEventForExprAttr:function(){},dealSpecialItem:function(){var mainProdOfferInfo=$ac$.selectedMainProdOfferInfoVO;var card=this.getCard();
if(mainProdOfferInfo){if(mainProdOfferInfo.prodOfferBrandId==54&&mainProdOfferInfo.bindType==2){var promotionItemList=this.getModel().promotionInfoVO.salesPromotionItemList||[];BusCard.each(promotionItemList,function(oneItem){if(oneItem.itemAttrId=="10610"){if(card.$(oneItem.attrSpec.attrCd)){card.$(oneItem.attrSpec.attrCd).value=1;
}}});}}},initProdSelect:function(){var card=this.getCard(),promotionItemList=this.getModel().promotionInfoVO.salesPromotionItemList||[];selectAttrList=BusCard.findAll(promotionItemList,function(promotionItemVO){return(/select/i.test(promotionItemVO.attrSpec.valueShowType));
});BusCard.each(selectAttrList,function(promotionItemVO){var attrVO=promotionItemVO.attrSpec,attrValueList=attrVO.attrValueList||[],selectParamList=BusCard.map(attrValueList,function(valueVO){return{id:valueVO.attrValue,name:valueVO.attrValueName};
});BusCard.$rs(card.$(attrVO.attrCd),selectParamList);});},dealAttrValueRel:function(){var widget=this;var card=this.getCard();var promotionItemList=this.getModel().promotionInfoVO.salesPromotionItemList||[];
var selectAttrList=dojo.filter(promotionItemList||[],function(onePromotionItem){return onePromotionItem.attrSpec.valueShowType==showTypeConst.SELECT_TYPE;});dojo.forEach(selectAttrList||[],function(oneSelectAttrObj){var attrVO=oneSelectAttrObj.attrSpec;
var elem=card.$(attrVO.attrCd);if(elem){elem.onchange=function(){widget.changeAttrValue(card,attrVO,selectAttrList);};}});},changeAttrValue:function(card,attrVO,selectAttrList){var cardWidget=this;var attrValue=card.$(attrVO.attrCd).value;
var attrValueList=attrVO.attrValueList;var attrValueVO=dojo.filter(attrValueList||[],function(oneAttrValue){return oneAttrValue.attrValue==attrValue;})[0];var attrValueRelaList=attrValueVO.attrValueRelaList;
if(attrValueRelaList&&attrValueRelaList.length>0){dojo.forEach(attrValueRelaList||[],function(oneAttrValueRelaInfo){var relAttrCd=oneAttrValueRelaInfo.attrCd;var relAttrElem=card.$(relAttrCd);if(relAttrElem){var relAttrValueList=oneAttrValueRelaInfo.attrValueRelaValueList;
var releAttrValueList=dojo.filter(relAttrValueList||[],function(oneRelAttrValue){return oneRelAttrValue.attrRelaType==attrRelTypeConst.RELEVANCE;});var valueStr="";dojo.forEach(releAttrValueList||[],function(oneReleAttrValue){valueStr+="<option value='"+oneReleAttrValue.attrValue+"'>"+oneReleAttrValue.attrValueName+"</option>";
});relAttrElem.innerHTML=valueStr;var attrInfo={attrCd:relAttrCd};var flag=dojo.some(cardWidget.firstClickAttrList||[],function(oneClickAttr){return oneClickAttr.attrCd==relAttrCd;});if(!flag){cardWidget.firstClickAttrList.push(attrInfo);
}}});var noRelAttrList=dojo.filter(cardWidget.firstClickAttrList||[],function(oneAttr){return !dojo.some(attrValueRelaList||[],function(oneValue){return oneAttr.attrCd==oneValue.attrCd;});});cardWidget.createSelectValue(card,noRelAttrList);
}else{cardWidget.createSelectValue(card,cardWidget.firstClickAttrList);}},createSelectValue:function(card,attrList){var promotionItemList=this.getModel().promotionInfoVO.salesPromotionItemList||[];var selectAttrList=dojo.filter(promotionItemList||[],function(onePromotionItem){return onePromotionItem.attrSpec.valueShowType==showTypeConst.SELECT_TYPE;
});dojo.forEach(attrList||[],function(oneAttr){var attrCd=oneAttr.attrCd;var oldAttr=dojo.filter(selectAttrList||[],function(oneSelectAttr){return attrCd==oneSelectAttr.attrSpec.attrCd;})[0];var oldAttrValueList=oldAttr.attrSpec.attrValueList;
var elem=card.$(attrCd);if(elem){var valueStr="";dojo.forEach(oldAttrValueList||[],function(oneValue){valueStr+="<option value='"+oneValue.attrValue+"'>"+oneValue.attrValueName+"</option>";});elem.innerHTML=valueStr;
}});},dealAttrExpr:function(){var deal=this;var promotionItemList=this.getModel().promotionInfoVO.salesPromotionItemList||[];dojo.forEach(promotionItemList||[],function(onePromotionItem){var promAttrValueExprList=onePromotionItem.attrSpec.attrValueExpressionsList;
var attrCd=onePromotionItem.attrSpec.attrCd;var releAttrCd=[];var attrExprArray=[];if(promAttrValueExprList&&promAttrValueExprList.length>0){dojo.forEach(promAttrValueExprList||[],function(onePromoAttrExpr){onePromoAttrExpr.valueExpressions.replace(/\[(\d+?)\]/g,function($0,$1){releAttrCd.push($1);
});attrExprArray.push(onePromoAttrExpr);});deal.attrExprRelaCdList[attrCd]=releAttrCd;deal.attrExprList[attrCd]=attrExprArray;}});if(deal.attrExprRelaCdList){for(var p in deal.attrExprRelaCdList){var relaAttrCdList=deal.attrExprRelaCdList[p];
var attrExprArray=deal.attrExprList[p];if(relaAttrCdList&&relaAttrCdList.length>0){for(var i=0;i<relaAttrCdList.length;i++){deal.attrValueCount(relaAttrCdList[i],p,attrExprArray);}}}}},attrValueCount:function(relaAttrCd,sourceAttrCd,attrExprArray){var filteAttrExprArry=dojo.filter(attrExprArray||[],function(oneAttrExpr){return oneAttrExpr.valueExpressions.indexOf(relaAttrCd)>0;
});var card=this.getCard();var elem=card.$(relaAttrCd);var sourceElem=card.$(sourceAttrCd);try{if(elem){elem.onblur=function(){if(filteAttrExprArry.length>0){for(var i=0;i<filteAttrExprArry.length;i++){var attrExpr=filteAttrExprArry[i];
var valueExpr=attrExpr.valueExpressions;valueExpr=valueExpr.replace(/\[(\d+?)\]/g,function($0,$1){return card.$($1).value;});if(sourceElem){sourceElem.value=eval("("+valueExpr+")");var index=sourceElem.value.indexOf(".");
if(index>0){sourceElem.value=sourceElem.value.substring(0,index+3);}}}}};}}catch(e){messageBox.alert({busiCode:"08410159",infoList:[e]});}},initLength:function(){var card=this.getCard(),promotionItemList=this.getModel().promotionInfoVO.salesPromotionItemList||[];
BusCard.each(promotionItemList||[],function(promotionItemVO){var attrVO=promotionItemVO.attrSpec;var elem=card.$(attrVO.attrCd+"");if(elem&&attrVO.attrLeng){elem.maxLength=attrVO.attrLeng;}});},initDisplayElement:function(){var card=this.getCard(),promotionItemList=this.getModel().promotionInfoVO.salesPromotionItemList||[];
for(var i=0;i<promotionItemList.length;i++){var attrVO=promotionItemList[i];if(attrVO.ifVisible=="0"){card.hidden(attrVO.attrSpec.attrCd+"");}}},renderDefaultValue:function(){var card=this.getCard();card.renderDefaultValue(this.getDefaultValue());
},getDefaultValue:function(){var promotionItemList=null;var promotionItemInstList=null;var promotionItemDefaultList={};if(this.getModel().promotionInstInfo){promotionItemInstList=this.getModel().promotionInstInfo.salesPromotionItemInstVOList||[];
if(promotionItemInstList&&promotionItemInstList.length>0){var attrList=util.ProdOfferHelper.getPromotionItemsAttr(this.getModel().promotionInstInfo.promotionId);for(var i=0;i<promotionItemInstList.length;
i++){var promotionItemInstVO=promotionItemInstList[i];if(promotionItemInstVO.itemAttrId!=""&&promotionItemInstVO.itemAttrId!=null){var attrVO=dojo.filter(attrList||[],function(oneAttr){return oneAttr.attrCd==promotionItemInstVO.itemAttrId;
})[0];if(attrVO&&(attrVO.valueUnit=="D12"||attrVO.valueUnit=="D8")){promotionItemDefaultList[promotionItemInstVO.itemAttrId]=promotionItemInstVO.attrValue/100;}else{promotionItemDefaultList[promotionItemInstVO.itemAttrId]=promotionItemInstVO.attrValue;
}}}}}else{if(this.getModel().promotionInfoVO.salesPromotionChangeItemList){promotionItemList=this.getModel().promotionInfoVO.salesPromotionChangeItemList||[];var attrList=util.ProdOfferHelper.getPromotionItemsAttr(this.getModel().promotionInfoVO.promotionId);
if(promotionItemList&&promotionItemList.length>0){for(var i=0;i<promotionItemList.length;i++){var promotionItemVO=promotionItemList[i];if(promotionItemVO.itemAttrId!=""&&promotionItemVO.itemAttrId!=null){var attrVO=dojo.filter(attrList||[],function(oneAttr){return oneAttr.attrCd==promotionItemVO.itemAttrId;
})[0];if(attrVO&&(attrVO.valueUnit=="D12"||attrVO.valueUnit=="D8")){promotionItemDefaultList[promotionItemVO.itemAttrId]=promotionItemVO.attrValue/100;}else{promotionItemDefaultList[promotionItemVO.itemAttrId]=promotionItemVO.attrValue;
}}}}}else{promotionItemList=this.getModel().promotionInfoVO.salesPromotionItemList||[];if(promotionItemList&&promotionItemList.length>0){for(var i=0;i<promotionItemList.length;i++){var promotionItemVO=promotionItemList[i];
var attrVO=promotionItemVO.attrSpec;if(promotionItemVO.attrValue!=""&&promotionItemVO.attrValue!=null){if(attrVO.isFeeAttr==1){if(attrVO.valueUnit=="D12"){promotionItemDefaultList[attrVO.attrCd]=promotionItemVO.attrValue/100;
}else{if(attrVO.valueUnit=="D8"){promotionItemDefaultList[attrVO.attrCd]=promotionItemVO.attrValue;}}}else{promotionItemDefaultList[attrVO.attrCd]=promotionItemVO.attrValue;}}else{(attrVO.attrValueList||[]).unshift({attrValueName:"\u8bf7\u9009\u62e9",attrValue:""});
promotionItemDefaultList[attrVO.attrCd]="";}}}}}return promotionItemDefaultList;},initAttrDisabled:function(){var card=this.getCard(),promotionItemList=this.getModel().promotionInfoVO.salesPromotionItemList||[];
if(this.getModel().promotionInstInfo){var promotionItemInstList=this.getModel().promotionInstInfo.salesPromotionItemInstVOList||[];BusCard.each(promotionItemInstList,function(promotionItemInst){if(card.$(promotionItemInst.itemAttrId)){card.$(promotionItemInst.itemAttrId).disabled=true;
}});}else{if(this.getModel().promotionInfoVO.flag&&(this.getModel().promotionInfoVO.flag=="change"||this.getModel().promotionInfoVO.flag=="delete")){BusCard.each(promotionItemList,function(promotionItemVO){var attrVO=promotionItemVO.attrSpec;
if(card.$(attrVO.attrCd)){card.$(attrVO.attrCd).disabled=true;}});}else{BusCard.each(promotionItemList,function(promotionItemVO){var attrVO=promotionItemVO.attrSpec;if(promotionItemVO.ifReadonly==1&&attrVO.attrCd&&card.$(attrVO.attrCd)){card.$(attrVO.attrCd).disabled=true;
}else{if(promotionItemVO.ifReadonly==0&&attrVO.attrCd&&card.$(attrVO.attrCd)){card.$(attrVO.attrCd).disabled=false;}}});}}},promotionAttrList:function(salesPromotionItemList){var itemCard=this,rentAttrList=[],terminalList=[],transferInfoList=[],agreementInfoList=[],subsidyList=[],monthConvertList=[],wordsFeePresentList=[],yucunList=[],zifeiPresentList=[],giftList=[],costList=[],propertyXMLPath="<attrList>";
dojo.forEach(salesPromotionItemList||[],function(oneSalePromotionItem){if(oneSalePromotionItem.itemKind==groupKind.RENT){rentAttrList.push(itemCard.changeAttrSpecNullable(oneSalePromotionItem));}else{if(oneSalePromotionItem.itemKind==groupKind.TERMINAL){terminalList.push(itemCard.changeAttrSpecNullable(oneSalePromotionItem));
}else{if(oneSalePromotionItem.itemKind==groupKind.TRANSFER_INFO){transferInfoList.push(itemCard.changeAttrSpecNullable(oneSalePromotionItem));}else{if(oneSalePromotionItem.itemKind==groupKind.AGREEMENT_INFO){agreementInfoList.push(itemCard.changeAttrSpecNullable(oneSalePromotionItem));
}else{if(oneSalePromotionItem.itemKind==groupKind.SUBSIDY){subsidyList.push(itemCard.changeAttrSpecNullable(oneSalePromotionItem));}else{if(oneSalePromotionItem.itemKind==groupKind.MONTH_CONVERT){monthConvertList.push(itemCard.changeAttrSpecNullable(oneSalePromotionItem));
}else{if(oneSalePromotionItem.itemKind==groupKind.WORDS_FEE_AS_PRESENT){wordsFeePresentList.push(itemCard.changeAttrSpecNullable(oneSalePromotionItem));}else{if(oneSalePromotionItem.itemKind==groupKind.YUCUN_PRESENT){yucunList.push(itemCard.changeAttrSpecNullable(oneSalePromotionItem));
}else{if(oneSalePromotionItem.itemKind==groupKind.ZIFEI_PRESENT){zifeiPresentList.push(itemCard.changeAttrSpecNullable(oneSalePromotionItem));}else{if(oneSalePromotionItem.itemKind==groupKind.GIFT_PRESENT){giftList.push(itemCard.changeAttrSpecNullable(oneSalePromotionItem));
}else{if(oneSalePromotionItem.itemKind==groupKind.COST){costList.push(itemCard.changeAttrSpecNullable(oneSalePromotionItem));}}}}}}}}}}}});if(rentAttrList!=null&&rentAttrList.length>0){var rentLink="<subGroup id='rendGroup' name='租机'>";
propertyXMLPath+=this.promotionAttrList2xml(rentLink,rentAttrList);}if(terminalList!=null&&terminalList.length>0){var terminalLink="<subGroup id='terminalGroup' name='终端'>";propertyXMLPath+=this.promotionAttrList2xml(terminalLink,terminalList);
}if(transferInfoList!=null&&transferInfoList.length>0){var transferLink="<subGroup id='transferGroup' name='划拨信息'>";propertyXMLPath+=this.promotionAttrList2xml(transferLink,transferInfoList);}if(agreementInfoList!=null&&agreementInfoList.length>0){var agreementLink="<subGroup id='agreementGroup' name='协议信息'>";
propertyXMLPath+=this.promotionAttrList2xml(agreementLink,agreementInfoList);}if(subsidyList!=null&&subsidyList.length>0){var subSidyLink="<subGroup id='subsidyGroup' name='补贴卷'>";propertyXMLPath+=this.promotionAttrList2xml(subSidyLink,subsidyList);
}if(monthConvertList!=null&&monthConvertList.length>0){var monthConvertLink="<subGroup id='monthConvertGroup' name='分月转兑配置'>";propertyXMLPath+=this.promotionAttrList2xml(monthConvertLink,monthConvertList);
}if(wordsFeePresentList!=null&&wordsFeePresentList.length>0){var wordsFeeLink="<subGroup id='wordsFeeGroup' name='赠送话费设置'>";propertyXMLPath+=this.promotionAttrList2xml(wordsFeeLink,wordsFeePresentList);
}if(yucunList!=null&&yucunList.length>0){var yucunLink="<subGroup id='yucunGroup' name='赠送预存设置'>";propertyXMLPath+=this.promotionAttrList2xml(yucunLink,yucunList);}if(zifeiPresentList!=null&&zifeiPresentList.length>0){var zifeiLink="<subGroup id='zifeiGroup' name='赠送资费设置'>";
propertyXMLPath+=this.promotionAttrList2xml(zifeiLink,zifeiPresentList);}if(giftList!=null&&giftList.length>0){var giftLink="<subGroup id='giftGroup' name='赠送礼品设置'>";propertyXMLPath+=this.promotionAttrList2xml(giftLink,giftList);
}if(costList!=null&&costList.length>0){var costLink="<subGroup id='costGroup' name='费用'>";propertyXMLPath+=this.promotionAttrList2xml(costLink,costList);}propertyXMLPath+="</attrList>";return propertyXMLPath;
},changeAttrSpecNullable:function(promotionItemVO){var attrVO=promotionItemVO.attrSpec;if(promotionItemVO.ifNecessary==1){attrVO.nullable=false;}else{if(promotionItemVO.ifNecessary==0){attrVO.nullable=true;
}}return attrVO;},promotionAttrList2xml:function(propertyLink,propertyList){var propertyXMLPath="";var propertyListXML="<tp:for ds=list><tp:if $$.valueShowType=='text'&&$$.nullable==true><attr colspan='1' id='#{$$.attrCd}' cType='1' label='#{$$.attrName}' isNull = '1' title='#{$$.attrDesc}' disabled=\"#{$$.isReadOnly =='0'?0:1}\"/></tp:if><tp:if $$.valueShowType=='text'&&$$.nullable==false><attr colspan='1' id='#{$$.attrCd}' cType='1' label='#{$$.attrName}' isNull = '0' title='#{$$.attrDesc}' disabled=\"#{$$.isReadOnly =='0'?0:1}\"/></tp:if><tp:if $$.valueShowType=='select'&&$$.nullable==true><attr colspan='1' id='#{$$.attrCd}' cType='2' label='#{$$.attrName}' isNull = '1' title='#{$$.attrDesc}' disabled=\"#{$$.isReadOnly =='0'?0:1}\"/></tp:if><tp:if $$.valueShowType=='select'&&$$.nullable==false><attr colspan='1' id='#{$$.attrCd}' cType='2' label='#{$$.attrName}' isNull = '0' title='#{$$.attrDesc}' disabled=\"#{$$.isReadOnly =='0'?0:1}\"/></tp:if><tp:if $$.valueShowType=='checkbox'&&$$.nullable==true><attr colspan='1' id='#{$$.attrCd}' cType='3' label='#{$$.attrName}' isNull = '1' title='#{$$.attrDesc}' disabled=\"#{$$.isReadOnly =='0'?0:1}\"/></tp:if><tp:if $$.valueShowType=='checkbox'&&$$.nullable==false><attr colspan='1' id='#{$$.attrCd}' cType='3' label='#{$$.attrName}' isNull = '0' title='#{$$.attrDesc}' disabled=\"#{$$.isReadOnly =='0'?0:1}\"/></tp:if><tp:if $$.valueShowType=='radiobox'&&$$.nullable==true><attr colspan='1' id='#{$$.attrCd}' cType='13' label='#{$$.attrName}' isNull = '1' title='#{$$.attrDesc}' disabled=\"#{$$.isReadOnly =='0'?0:1}\"/></tp:if><tp:if $$.valueShowType=='radiobox'&&$$.nullable==false><attr colspan='1' id='#{$$.attrCd}' cType='13' label='#{$$.attrName}' isNull = '0' title='#{$$.attrDesc}' disabled=\"#{$$.isReadOnly =='0'?0:1}\"/></tp:if><tp:if $$.valueShowType=='date'&&$$.nullable==true><attr colspan='1' id='#{$$.attrCd}' cType='4' label='#{$$.attrName}' isNull = '1' title='#{$$.attrDesc}' disabled=\"#{$$.isReadOnly =='0'?0:1}\"/></tp:if><tp:if $$.valueShowType=='date'&&$$.nullable==false><attr colspan='1' id='#{$$.attrCd}' cType='4' label='#{$$.attrName}' isNull = '0' title='#{$$.attrDesc}' disabled=\"#{$$.isReadOnly =='0'?0:1}\"/></tp:if><tp:if $$.valueShowType=='pwd'&&$$.nullable==true><attr colspan='1' id='#{$$.attrCd}' cType='8' label='#{$$.attrName}' isNull = '1' title='#{$$.attrDesc}' disabled=\"#{$$.isReadOnly =='0'?0:1}\"/></tp:if><tp:if $$.valueShowType=='pwd'&&$$.nullable==false><attr colspan='1' id='#{$$.attrCd}' cType='8' label='#{$$.attrName}' isNull = '0' title='#{$$.attrDesc}' disabled=\"#{$$.isReadOnly =='0'?0:1}\"/></tp:if></tp:for>";
var propertyCard=BusCard.Template.create(propertyListXML);propertyXMLPath=propertyLink+propertyCard.apply({list:propertyList})+"</subGroup>";return propertyXMLPath;}});});
defineModule("orderaccept.prodofferaccept.builder.promotiondetail.PromotionResRelaBuilder",["../../util","../../widget/resourcecard/ResourceCardWidget","orderaccept.common.js.ConstantsPool"],function(a,c,b){dojo.declare("orderaccept.prodofferaccept.builder.promotiondetail.PromotionResRelaBuilder",[],{resourceCardWidgetClass:c,constructor:function(d){this.loader=d.loader,this.promotionDetailWidget=d.promotionDetailWidget,this.promotionInfo=d.promotionInfo,this.tabContainer=d.tabContainer,this.contentPane=d.contentPane,this.resourceCardList=[],this.resRelaItemList=[],this.uniqueid=d.uniqueid,this.rowIndex=d.rowIndex;
},initPromotionResRela:function(){var s=this,k=s.loader,n=s.resourceCardWidgetClass,f=s.promotionDetailWidget,i=s.promotionInfo,t=s.tabContainer,h=s.contentPane,e=s.getPromotionResKind(i),g=s.checkIfNewInstall();
var d=[];var q=[];if(i.proodOfferInfo.resRelaList&&i.proodOfferInfo.resRelaList.length>0){t.addChild(h);}var p=dojo.some(i.promotionTargetObjectList||[],function(v){return v.targetObjectType==2;});var u=dojo.some(i.proodOfferInfo.resRelaList||[],function(v){return(v.mktResCd==a.RES_RELA_CONST.RENT_ACCEPT||v.mktResCd==a.RES_RELA_CONST.OTHER_RENT_ACCEPT)&&v.resourceKind=="-1";
});var o=dojo.some(i.proodOfferInfo.resRelaList||[],function(v){return v.mktResCd==a.RES_RELA_CONST.RENT_ACCEPT;});if(o){q.push(a.RES_RELA_CONST.RENT_ACCEPT);}var m=dojo.some(i.proodOfferInfo.resRelaList||[],function(v){return v.mktResCd==a.RES_RELA_CONST.OTHER_RENT_ACCEPT;
});if(m){q.push(a.RES_RELA_CONST.OTHER_RENT_ACCEPT);}var j=dojo.filter(i.proodOfferInfo.resRelaList||[],function(v){return v.mktResCd==a.RES_RELA_CONST.RENT_ACCEPT||v.mktResCd==a.RES_RELA_CONST.OTHER_RENT_ACCEPT;
});var l=dojo.filter(i.proodOfferInfo.resRelaList||[],function(v){return v.mktResCd==a.RES_RELA_CONST.SUBSIDY_ACCEPT;});var r=dojo.filter(i.proodOfferInfo.resRelaList||[],function(v){return v.mktResCd==a.RES_RELA_CONST.GIFT_ACCEPT;
});if(j&&j.length>0){d.push(j[0]);}if(l&&l.length>0){d.push(l[0]);}if(r&&r.length>0){d.push(r[0]);}dojo.forEach(d||[],function(B){if(!B||!B.mktResCd){return;}var C="";if(B.mktResCd==a.RES_RELA_CONST.GIFT_ACCEPT){var z="&ServiceKind=-1&apply_event=-1&infoId=225";
var J=a.ServiceFactory.getService("url:businessAcceptAction.do?method=getCityBusinessParamValue"+z);C=J;}var G="";var w="";var A="";var y="";var F="";if(B.mktResCd==a.RES_RELA_CONST.SUBSIDY_ACCEPT){G=dojo.global.$appContext$.requestParam.today;
var z="&ServiceKind=-1&apply_event=-1&infoId=225";var J=a.ServiceFactory.getService("url:businessAcceptAction.do?method=getCityBusinessParamValue"+z);w=J?J:"0";var D=f.promotionItemsCard.getCardData();
if(D){for(var v in D){if(v==b.load("PromotionCommonConst").PromotionCommonConst.SUBSIDY_FEE_CD){A=D[v];break;}}}}var x=f.promotionItemsCard.getCardData();if(x){for(var v in x){if(v==b.load("PromotionCommonConst").PromotionCommonConst.SUBSIDY_AMOUNT_CD){F=x[v]?x[v]:0;
break;}}}var E={productId:a.RES_RELA_CONST.DEFAULT_PRODUCT,serviceOfferId:B.mktResCd/-1,cityCode:k.requestParam.customerData.cityCode,resKindList:e,validMonths:C,sysdate:G,months:w,subsidyFee:A,promotionRentResTypeList:q,ifNotAllResKind:u,rowIndex:s.rowIndex,subsidyAmount:F,realPriceCd:b.load("PromotionCommonConst").PromotionCommonConst.REAL_PRICE_CD,promotionType:s.promotionInfo.promotionType};
var H=new n(E);H.busCardInstance.addEventListener("onprerequest",function(K){K.$syncCardRequest=true;});H.renderCard(h.domNode,"last");s.resourceCardList.push(H);var I={promotionInfoVO:i,resRelaInfo:B,itemIndex:B.mktResCd,acceptCardObj:H.busCardInstance};
s.resRelaItemList.push(I);});},getPageData:function(){var f=this,e=f.promotionDetailWidget;f.resRelaDataList=[];for(var j in f.resRelaItemList){if(!f.resRelaItemList.hasOwnProperty(j)){continue;}var g=f.resRelaItemList[j];
var i={};var h=g.acceptCardObj.getData();if(h==false){if(g&&g.resRelaInfo&&(g.resRelaInfo.mktResCd==a.RES_RELA_CONST.RENT_ACCEPT||g.resRelaInfo.mktResCd==a.RES_RELA_CONST.OTHER_RENT_ACCEPT)){g.acceptCardObj.$("deviceNo").focus();
}f.resRelaDataList=[];return false;}g.resRelaCardData=h;i.mktResCd=g.resRelaInfo.mktResCd;i.mktResTypeCd=g.resRelaInfo.mktResTypeCd;if(g.resRelaInfo.mktResCd==a.RES_RELA_CONST.GIFT_ACCEPT){i.mktGiftResInstId=h.mktGiftResInstId&&typeof(h.mktGiftResInstId)!="undefined"?h.mktGiftResInstId:"-1";
i.giftNo=h.giftNo&&typeof(h.giftNo)!="undefined"?h.giftNo:"";i.advancedPayment=h.advancedPayment&&typeof(h.advancedPayment)!="undefined"?h.advancedPayment*100:"0";i.advancedEffDate=h.advancedEffDate&&typeof(h.advancedEffDate)!="undefined"?h.advancedEffDate:"";
i.advancedDays=h.advancedDays&&typeof(h.advancedDays)!="undefined"?h.advancedDays:"0";var d={updateStatus:"0"};i.modifyGiftContent=dojo.toJson(d);f.buildRentInfo(i,h);var k={updateStatus:"0",saleMobilePrice:h.realFee&&typeof(h.realFee)!="undefined"?(h.realFee/1)*100+"":"0"};
i.modifyContent=dojo.toJson(k);}if(g.resRelaInfo.mktResCd==a.RES_RELA_CONST.SUBSIDY_ACCEPT){i.subFee=h.subFee&&typeof(h.subFee)!="undefined"?h.subFee:"0";i.mktResId=h.mktResId&&typeof(h.mktResId)!="undefined"?h.mktResId:"-1";
i.mktResInstId=h.mktResInstId&&typeof(h.mktResInstId)!="undefined"?h.mktResInstId:"-1";i.advancedEffDate=h.advancedEffDate&&typeof(h.advancedEffDate)!="undefined"?h.advancedEffDate:"";i.advancedDays=h.advancedDays&&typeof(h.advancedDays)!="undefined"?h.advancedDays:"0";
var k={operKind:0,cardKind:1,cardValue:h.subFee&&typeof(h.subFee)!="undefined"?(h.subFee/1)*100+"":"0"};i.modifyContent=dojo.toJson(k);}if(g.resRelaInfo.mktResCd==a.RES_RELA_CONST.RENT_ACCEPT||g.resRelaInfo.mktResCd==a.RES_RELA_CONST.OTHER_RENT_ACCEPT){f.buildRentInfo(i,h);
var k={updateStatus:"0",saleMobilePrice:h.realFee&&typeof(h.realFee)!="undefined"?(h.realFee/1)*100+"":"0"};i.modifyContent=dojo.toJson(k);}f.resRelaDataList.push(i);}return f.resRelaDataList;},buildRentInfo:function(e,d){var f=this;
e.mktResId=d.mktResId&&typeof(d.mktResId)!="undefined"?d.mktResId:"-1";e.mktResInstId=d.mktResInstId&&typeof(d.mktResInstId)!="undefined"?d.mktResInstId:"-1";e.deviceNo=d.deviceNo&&typeof(d.deviceNo)!="undefined"?f.doTrim(d.deviceNo):"-1";
e.moblieSourse=d.moblieSourse&&typeof(d.moblieSourse)!="undefined"?d.moblieSourse:"-1";e.resourceKind=d.resourceKind&&typeof(d.resourceKind)!="undefined"?d.resourceKind:"-1";e.resourceColour=d.resourceColour&&typeof(d.resourceColour)!="undefined"?d.resourceColour:"";
e.newoldStatus=d.newoldStatus&&typeof(d.newoldStatus)!="undefined"?d.newoldStatus:"";e.rentType=d.rentType&&typeof(d.rentType)!="undefined"?d.rentType:"-1";e.mobileAgent=d.mobileAgent&&typeof(d.mobileAgent)!="undefined"?d.mobileAgent:"-1";
e.costFee=d.costFee&&typeof(d.costFee)!="undefined"?d.costFee:"0";e.shouldFee=d.shouldFee&&typeof(d.shouldFee)!="undefined"?d.shouldFee*100:"0";e.realFee=d.realFee&&typeof(d.realFee)!="undefined"?d.realFee*100:"0";
e.custType=d.custType&&typeof(d.custType)!="undefined"?d.custType:"-1";e.rentPrestoreFee=d.rentPrestoreFee&&typeof(d.rentPrestoreFee)!="undefined"?d.rentPrestoreFee:"";e.rentDeposit=d.rentDeposit&&typeof(d.rentDeposit)!="undefined"?d.rentDeposit:"";
e.consumeKind=d.consumeKind&&typeof(d.consumeKind)!="undefined"?d.consumeKind:"-1";e.consumeScore=d.consumeScore&&typeof(d.consumeScore)!="undefined"?d.consumeScore:"";e.note=d.note&&typeof(d.note)!="undefined"?d.note:"";
e.customerGroup=d.custType&&typeof(d.custType)!="undefined"?d.custType:"";e.mobileType=d.moblieType&&typeof(d.moblieType)!="undefined"?d.moblieType:"";e.suggestFee=d.shouldFee&&typeof(d.shouldFee)!="undefined"?d.shouldFee*100:"0";
},getPromotionResKind:function(d){var e=d.proodOfferInfo.resRelaList;return dojo.filter(e||[],function(f){return f.resourceKind&&f.resourceKind!="-1";});},doTrim:function(d){return/^\s*(.*?)\s*$/.exec(d)[1];
},checkIfNewInstall:function(){var e=this.uniqueid;var f="serviceCardWidget_"+e;var d=unieap.byId(f);if(d.getModel().cardParam.userId==0){return true;}return false;}});});
defineModule("orderaccept.prodofferaccept.builder.promotiondetail.PromotionDetailBuilder",["../../util","../../../base/Controller","../../../custom/TooltipDialog","../../widget/attrcard/PromotionItemsCardWidget","./PromotionResRelaBuilder","../prodofferdetail/ProdOfferAssureBuilder","./PromotionAssureBuilder","orderaccept.common.js.ConstantsPool"],function(c,b,h,e,d,f,a,g){dojo.declare("orderaccept.prodofferaccept.builder.promotiondetail.PromotionDetailBuilder",[],{promotionItemsWidgetClass:e,prodOfferDetailWidgetList:[],agreementAttrCd:g.load("PromotionCommonConst").PromotionCommonConst.AGREEMENT_ATTR_CD,subsidyFee:g.load("PromotionCommonConst").PromotionCommonConst.SUBSIDY_FEE_CD,subsidyAmontCD:g.load("PromotionCommonConst").PromotionCommonConst.SUBSIDY_AMOUNT_CD,realPriceCD:g.load("PromotionCommonConst").PromotionCommonConst.REAL_PRICE_CD,isAgreement:false,isAgreementMonths:false,isGiftMonths:false,isAnotherGiftMonths:false,rowIndex:null,constructor:function(i){this.loader=i;
},initPromotionDetail:function(o){var m=this,q=this.loader,j=q.salesPromotionOrderGrid.ds.getRawData()[o],k=j.showData.promotionInfo,p=j.showData.promotionStyle,l=j.showData.promotionInstInfo,n=new h({id:"promotionDetail-"+o});
m.prodOfferDetailWidgetList[""+o]=n;n.rowIndex=o;n.resRelaBuilder=null;n.prodOfferAssureBuilder=null;n.startup();n.setAttribute("rowIndex",o);n.domNode.setAttribute("dojoAttachEvent","onmouseout:elementmouseout");
n.domNode.setAttribute("dojoAttachTopic","/promotionDetailDialog");var i="<div style='text-align:center;vertical-align:middle'><a href='javascript:void(0);' dojoAttachEvent='onclick:elementclick'  rowIndex='"+o+"'			    dojoAttachTopic='/promotionDetailBtn' style='text-align:center;vertical-align:middle;'>确定</a></div>";
dojo.place(i,n.containerNode,"last");n.enableEvtMsgPropagation(n.domNode);var r=new unieap.layout.TabContainer({height:"auto"});n.tabContainer=r;r.startup();m.initPromotionItems(n,k,l,r,o);if(!l){m.initPromotionResItems(n,k,r);
m.initPromotionAssureInfo(n,k,r);}n.handlePageData=function(){var v=q.salesPromotionOrderGrid.ds.getRawData()[o];if(!!n.promotionItemsCard){var z=n.promotionItemsCard.getCardData();if(!z){return false;
}dojo.mixin(v,{promotionItemsPageInfoList:z});}if(!l){var x=v.showData.promotionInfo;var D=x.promotionType;var s=g.load("PromotionTypeConst").PromotionTypeConst;if(D==s.DEVICE_RENT||D==s.SUBSIDY_PROMOTION||D==s.TELCHARGE_COUPON){var u=m.getPromotionInvalidDate(n);
if(u){m.changePromotionEndDate(0,o);dojo.mixin(v,{promotionStatusCd:"1299"});}else{var B=z[g.load("PromotionCommonConst").PromotionCommonConst.CONSUME_KIND_CD]?z[g.load("PromotionCommonConst").PromotionCommonConst.CONSUME_KIND_CD]:"-1";
if(B!="-1"){if(B==2){var t=z[m.agreementAttrCd]?z[m.agreementAttrCd]:0;m.changePromotionEndDate(t,o);}else{m.changePromotionEndDate(0,o);}}else{m.changePromotionEndDate(0,o);}dojo.mixin(v,{promotionStatusCd:"1000"});
}}else{m.changePromotionEndDate(0,o);dojo.mixin(v,{promotionStatusCd:"1000"});}}var w=m.getResPageData(o);if(w){dojo.mixin(v,{resRelaPageDataList:w});}else{return false;}m.dealSubsidyFee(z,w);m.dealRealPrice(n,w);
if(!!n.assurePageData){var y=[];var A=n.assureAttrCard.busCardInstance.getData();if(!A){return false;}for(var C in A){if(!A.hasOwnProperty(C)){continue;}y.push({attrId:C,attrValue:A[C]});}n.assurePageData.assureAttrList=y;
dojo.mixin(v,{promotionAssurePageInfoList:n.assurePageData});}m.addFinishPage(o);};dojo.place(r.domNode,n.containerNode,"first");},changePromotionEndDate:function(i,o){var j=dojo.query(".promotionStartDate-"+o,this.loader.salesPromotionOrderGrid.domNode)[0];
var n=dojo.query(".promotionEndDate-"+o,this.loader.salesPromotionOrderGrid.domNode)[0];var m="";if(i>0){var l=dojo.trim(dojo.query(".start_date_class",j)[0].innerHTML);var k=c.DateHelper.getDateFromString(l);
k.setMonth(k.getMonth()+parseInt(i));m=c.DateHelper.formatDate(k);}dojo.query(".end_date_class",n)[0].innerHTML=m;},changePromotionStartDate:function(l){var j=dojo.query(".promotionStartDate-"+l,this.loader.salesPromotionOrderGrid.domNode)[0];
var k=dojo.global.$appContext$.requestParam.today;var i=c.DateHelper.getDateFromString(k);i.setMonth(i.getMonth()+1);i.setDate(1);i.setHours(0);i.setMinutes(0);i.setSeconds(0);dojo.query(".start_date_class",j)[0].innerHTML=c.DateHelper.formatDate(i);
},getPromotionInvalidDate:function(r){var u=this.loader;var s=r.rowIndex;var q=u.salesPromotionOrderGrid.domNode;var k=dojo.query(".promotionTargetNum-"+s,q)[0];var i=dojo.filter(k.childNodes||[],function(x){return x.checked==true;
});var n=i.length>0?i[0].getAttribute("targetUniqueid"):0;var m=unieap.byId("serviceCardWidget_"+n);var t=m.busCardInstance.$("serviceId").value;var o=m.getModel().cardParam.userId;if(o&&o!="null"&&o!=0){var p=dojo.query(".promotionStartDate-"+s,u.salesPromotionOrderGrid.domNode)[0];
var v=dojo.trim(dojo.query(".start_date_class",p)[0].innerHTML);var j=c.DateHelper.getDateFromString(v);var l="&userId="+o;var w=c.ServiceFactory.getService("url:businessAcceptAction.do?method=getPromotionInvalidDate"+l);
if(w){return true;}}return false;},checkExpDateBetweenPromotionAndTarget:function(K){var N=this;var G=this.loader;var u=G.salesPromotionOrderGrid.domNode;var i=this.rowIndex;var I=dojo.query(".promotionTargetNum-"+i,u)[0];
var y=dojo.query(".promotionEndDate-"+i,u)[0];var s=dojo.filter(I.childNodes||[],function(V){return V.checked==true;});var t=c.DateHelper.getDateFromString(dojo.trim(dojo.query(".end_date_class",y)[0].innerHTML),1);
var H=s.length>0?s[0].getAttribute("productId"):"";var R=s.length>0?s[0].getAttribute("prodOfferId"):"";var p=s.length>0?s[0].getAttribute("targetUniqueid"):"";var D=$ac$.mainProdOfferInstVO;var x=$ac$.selectedMainProdOfferInfoVO;
var q=$ac$.selectedMainProdOfferInfoVO;var w=prodOfferAcceptLoader.mainProdOfferWidget.getPageStartEndDate();var T=c.ProdOfferHelper.getProductDateBuilder(q,w);var Q=T.getEndDate();if(D){if(H){var C="serviceCardWidget_"+p;
var m=unieap.byId(C);if(m&&m.getModel().cardParam.userId!=0){var L=[];if(D.ifBundle==1&&D.prodInstList.length==0){dojo.forEach($ac$.userHasProdOfferInfoList||[],function(V){if(V.prodOfferType==11&&V.prodOfferType=="11"){dojo.forEach(V.prodInstList||[],function(W){L.push(W.productId+"_"+W.stopRentTime);
});}});}else{L=dojo.map(D.prodInstList||[],function(V){return V.productId+"_"+V.stopRentTime;});}var S=dojo.filter(L||[],function(W){var V=W.split("_")[0];return H==V;});S.push(D.prodOfferId+"_"+D.expDate);
S.push(q.prodOfferId+"_"+Q);N.dateSort(S);var P=c.DateHelper.getDateFromString(S[0].split("_")[1],1);if(dojo.date.compare(P,t)<0){return true;}}else{if(m&&m.getModel().cardParam.userId==0){var M=$ac$.selectedMemberProdOfferList;
var O=dojo.some(M||[],function(V){var X=V.offerInstVO.prodOfferId;var W=V.prodOfferId;return X!=W;});if(O){var E=c.DateHelper.getDateFromString(Q,1);if(dojo.date.compare(E,t)<0){return true;}}else{var F=c.DateHelper.getDateFromString(D.expDate,1);
if(dojo.date.compare(F,t)<0){return true;}}}}}else{if(R){if(R==q.prodOfferId){var E=c.DateHelper.getDateFromString(Q,1);if(dojo.date.compare(E,t)<0){return true;}}else{var r=D.bundleType;var B=[];if(r==2){B=prodOfferAcceptLoader.multipleSubProdOfferHandler.subProdOfferOrderProviderMap.subProdOfferTreeContainer[p].getSubGridBindingData();
}else{B=prodOfferAcceptLoader.multipleSubProdOfferHandler.subProdOfferOrderProviderMap.subProdOfferTreeContainer.getSubGridBindingData();}var U=dojo.filter(B||[],function(V){return R==V.prodOfferInst.prodOfferId;
});if(U&&U.length>0){var o=U[0];var z=c.DateHelper.getDateFromString(o.expDate,1);if(dojo.date.compare(z,t)<0){return true;}}else{var k=dojo.filter(B||[],function(V){if(!V.prodOfferInst){return V.subProdOfferInfo.prodOfferId==R;
}});if(k&&k.length>0){var j=k[0];var v=prodOfferAcceptLoader.multipleSubProdOfferHandler.subProdOfferOrderProviderMap.subProdOfferTreeContainer;var l=v.saveSubProdOfferViewData;var J=j.subProdOfferInfo;
var A=c.ProdOfferHelper.getProductDateBuilder(J,l).getEndDate();var n=c.DateHelper.getDateFromString(A,1);if(dojo.date.compare(n,t)<0){return true;}}}}}}}else{if(H){var E=c.DateHelper.getDateFromString(Q,1);
if(dojo.date.compare(E,t)<0){return true;}}else{if(R){if(R==q.prodOfferId){var E=c.DateHelper.getDateFromString(Q,1);if(dojo.date.compare(E,t)<0){return true;}}else{var r=D.bundleType;var B=[];if(r==2){B=prodOfferAcceptLoader.multipleSubProdOfferHandler.subProdOfferOrderProviderMap.subProdOfferTreeContainer[p].getSubGridBindingData();
}else{B=prodOfferAcceptLoader.multipleSubProdOfferHandler.subProdOfferOrderProviderMap.subProdOfferTreeContainer.getSubGridBindingData();}var k=dojo.filter(B||[],function(V){if(!V.prodOfferInst){return V.subProdOfferInfo.prodOfferId==R;
}});if(k&&k.length>0){var j=k[0];var v=prodOfferAcceptLoader.multipleSubProdOfferHandler.subProdOfferOrderProviderMap.subProdOfferTreeContainer;var l=v.saveSubProdOfferViewData;var J=j.subProdOfferInfo;
var A=c.ProdOfferHelper.getProductDateBuilder(J,l).getEndDate();var n=c.DateHelper.getDateFromString(A,1);if(dojo.date.compare(n,t)<0){return true;}}}}}}return false;},dateSort:function(n){for(var m=0;
m<n.length;m++){for(var l=m+1;l<n.length;l++){var p=c.DateHelper.getDateFromString(n[m].split("_")[1],1);var o=c.DateHelper.getDateFromString(n[l].split("_")[1],1);if(dojo.date.compare(p,o)>0){var k=o;
o=p;p=k;}}}},dealSubsidyFee:function(k,j){if(k){for(var l in k){if(l==this.subsidyFee){var i=k[l];dojo.forEach(j||[],function(m){if(m.subFee){m.subFee=i*100;}});}}}},dealRealPrice:function(i,k){var j=this;
var n="0";var l=i.promotionItemsCard.getCardData();if(l){for(var m in l){if(m==this.realPriceCD){n=l[m];}}}dojo.forEach(k||[],function(o){if(n>0){o.realFee=j.moneyConvert(n,2);}else{o.realFee=n;}});},moneyConvert:function(m,k){m=m.toString();
var o=/^\s*(\d+)\.(\d+)\s*$/g;var i=o.exec(m);if(i){var j=i[2];if(j.length<k){var n=k-j.length;while(n--){j=j+"0";}}return parseInt(i[1]+j.substring(0,k));}else{var l=parseInt(m);while(k--){l=l*10;}return l;
}},addFinishPage:function(j){var i=dojo.query("[id=finishPage-"+j+"]",this.loader.salesPromotionOrderGrid.domNode)[0];if(i){i.style.display="";}},initPromotionItems:function(j,n,o,l,p){var i=this.loader,k=new this.promotionItemsWidgetClass({promotionInfoVO:n,promotionInstInfo:o,rowIndex:p});
if(k.needRendering){var m=new unieap.layout.ContentPane({title:"促销政策属性",width:"650px"});k.renderCard(m.domNode,"first");k.busCardInstance.setParent(m);j.promotionItemsCard=k;l.addChild(m);}},initPromotionResItems:function(o,l,r){var q=this.loader,k=new unieap.layout.ContentPane({title:"营销资源",width:"580px"});
var p=o.rowIndex;var n=q.salesPromotionOrderGrid.domNode;var j=dojo.query(".promotionTargetNum-"+p,n)[0];var i=dojo.filter(j.childNodes||[],function(s){return s.checked==true;});var m=i.length>0?i[0].getAttribute("targetUniqueid"):0;
o.resRelaBuilder=new d({loader:q,promotionDetailWidget:o,promotionInfo:l,tabContainer:r,contentPane:k,uniqueid:m,rowIndex:p});o.resRelaBuilder.initPromotionResRela();},initPromotionAssureInfo:function(i,k,j){var m=this;
var l=k.proodOfferInfo;i.prodOfferAssureBuilder=new a({detailBuilder:m,prodOfferDetailWidget:i,prodOfferInfo:l,tabContainer:j,promotionInfo:k});i.prodOfferAssureBuilder.initProdOfferAssure();},getResPageData:function(l){var k=this,i=k.prodOfferDetailWidgetList[l],j=i.resRelaBuilder;
return !!j?j.getPageData():[];}});});
defineModule("orderaccept.prodofferaccept.builder.promotiongrid.PromotionCartDataProvider",["../../util","../../formatter/FormatterProvider"],function(a,b){dojo.declare("orderaccept.prodofferaccept.builder.promotiongrid.PromotionCartDataProvider",[],{controller:null,salesPromotionOrderGrid:null,mainProdOfferWidget:null,constructor:function(c){this.controller=c;
this.salesPromotionOrderGrid=c.salesPromotionOrderGrid;this.mainProdOfferWidget=c.mainProdOfferWidget;},showOrderedPromotion:function(){var f=this;var h=dojo.global.$appContext$.orderPromotionList||[];
var c=dojo.query(".main-product-basic",f.mainProdOfferWidget.domNode);var i=dojo.filter(c||[],function(j){return dojo.query(".main-product-check",j)[0].checked;});var e=dojo.filter(h||[],function(j){var k=j.targetObjectInstId;
var l=j.targetObjectType;return dojo.some(i||[],function(m){return dojo.attr(m,"userId")==k;})&&l==2;});var g=dojo.map(e,function(j){var k=a.ProdOfferHelper.getSalesPromotionDetail(j.promotionId);var l=[];
if(k){l=a.ProdOfferHelper.createSalesPromotionRowDataForChg(k,j);}return{rowData:l,detailData:k};});dojo.forEach(g||[],function(m){f.salesPromotionOrderGrid.add(m.rowData);f.controller.createTargetObjectNum(m.rowData,f.controller.mainProdOfferId);
var l=m.rowData.showData.promotionInstInfo.targetObjectInstId;var p=dojo.filter(i||[],function(q){return dojo.attr(q,"userId")==l;})[0];var n=dojo.attr(p,"uniqueid");var o=m.rowData.rowIndex;var k=dojo.query(".promotionTargetNum-"+o,f.salesPromotionOrderGrid.domNode)[0];
var j=dojo.filter(k.childNodes||[],function(q){return q.getAttribute("targetUniqueid")==n;})[0];j.checked=true;f.controller.dealPromotionRaiseSpeedInfo(m.detailData,m.rowData,true);});var d=f.salesPromotionOrderGrid.ds.getRawData();
dojo.query("input[promotionStyle=promotion-change]",f.salesPromotionOrderGrid.domNode).each(function(j){j.disabled=true;});dojo.query("input[type=radio]",f.salesPromotionOrderGrid.domNode).each(function(j){j.disabled=true;
});}});});
defineModule("orderaccept.prodofferaccept.widget.commheader.CommHeaderWidget",["orderaccept.custom._BaseWidget","orderaccept.custom._BusCardTemplated","orderaccept.prodofferaccept.util"],function(b,a){dojo.declare("orderaccept.prodofferaccept.widget.commheader.CommHeaderWidget",[b,a],{templatePath:dojo.moduleUrl("orderaccept.prodofferaccept.widget.commheader","template/commHeader.html")});
});
defineModule("orderaccept.prodofferaccept.widget.mainprodoffer.MainProdOfferWidget",["orderaccept.custom._BaseWidget","orderaccept.custom._BusCardTemplated","dijit._Container","orderaccept.prodofferaccept.util"],function(d,c,b,a){dojo.declare("orderaccept.prodofferaccept.widget.mainprodoffer.MainProdOfferWidget",[d,c,b],{templatePath:dojo.moduleUrl("orderaccept.prodofferaccept.widget.mainprodoffer","template/mainProdOfferTpl.html"),postMixInProperties:function(){this.viewInitData=this.buildViewInitData();
loadCssModule("orderaccept.prodofferaccept.widget.mainprodoffer.resources.mainProdOffer");},buildViewInitData:function(){var q=this,s="key",n=dojo.global.$appContext$.prodOfferList,j=$ac$.get("selectedMainProdOfferInfoVO")||a.ProdOfferHelper.getMainProdOffer(n)[0],i=dojo.global.$appContext$.requestParam,r=s+"-"+j.parentProdOfferId+j.prodOfferId,l="\u8ba2\u8d2d",m=a.ProdOfferHelper.toProductStartDateView(j,{key:"key"}),g=a.ProdOfferHelper.toProductEndDateView(j,{key:"key"}),p=a.ProdOfferHelper.IfShowMainOfferDetail(j)?"1":"0",o=a.ProdOfferHelper.getProductDateBuilder(j),f=dojo.global.$appContext$.requestParam.today,k=!!a.ProdOfferHelper.ifShowEndTime(j)?o.getEndDate():"";
m.style.hiddenStyleOption=" hiddenStyle";var h=false;var e=dojo.global.$appContext$.get("mainProdOfferInstVO");h=a.AttrUtil.checkIfNotNull(j.attrList);if(!h){h=dojo.some(j.offerProdRelaList,function(t){if(t.productInfoVO.prodFuncType==ConstantsPool.load("ProductFuncTypeConst").ProductFuncTypeConst.ACCESS){return false;
}return a.AttrUtil.checkIfNotNull(t.productInfoVO.attrList);});var e=dojo.global.$appContext$.get("mainProdOfferInstVO");h=!!e?false:h;}tpContext={prodOfferDetailFlag:p,detailNotNull:h?"":"hidden-elem",finishImg:!h?"":"hidden-elem",productStartDateView:m,productEndDateView:g,viewId:r,startDate:f,endDate:k,actionName:l,displayStartEndTime:"",prodOfferInfoVO:j};
return{prodOfferViewData:tpContext,prodViewData:this.buildProductViewInitData(j,{key:s})};},buildProductViewInitData:function(e,f){},insertMainProductRow:function(x,l){var v=this,e=null,w=dojo.query("[uniqueId="+x+"]",v.domNode)[0],i=w;
while(true){e=i.nextSibling;if(e&&(e.tagName||"").toUpperCase()=="TR"){break;}i=e;}var k=0,s=-1,t=w.getAttribute("viewId"),p="[name=serviceOper-"+t+"-"+x+"]",q=dojo.query(p,w),o=dojo.query("[name=mainProdSel-"+t+"]",w)[0].value,h=null,f=document.createDocumentFragment(),j=null,m=this.productServiceKindMap[o],u=m?a.ServiceKindCounter.get(m.serviceKind):"-1",n=!!m?a.ServiceKindPrefixMap[m.serviceKind]+"号码"+u:"",r=!!m?m.serviceKind:"-1",g=a.CommUtils.generateUniqueId();
dojo.forEach(q,function(y){if(y.checked){s=k;}k++;});h=w.cloneNode(true);dojo.attr(h,{userId:"",prodInstId:"",serviceId:""});dojo.attr(h,"serviceKind",r+"");dojo.attr(h,"serviceKindIndex",u);dojo.attr(h,"uniqueId",g);
dojo.attr(dojo.query("[name=mainProdSel-"+t+"]",h)[0],"disabled",false);dojo.attr(dojo.query("[name=serviceId]",h)[0],"value",n);f.appendChild(h);(function(){var A=e.cloneNode(false),z=dojo.query("TD",e)[0].cloneNode(false),y=dojo.query(".mainProdServiceInfo-"+t,e)[0].cloneNode(false),B=dojo.query(".mainProdAttrInfo-"+t,e)[0].cloneNode(false);
z.appendChild(y);z.appendChild(B);A.appendChild(z);f.appendChild(A);dojo.place(f,e,"after");j=dojo.query(p,h);dojo.forEach(j,function(C){dojo.attr(C,"name","serviceOper-"+t+"-"+g);dojo.attr(C,"disabled",false);
});if(s!=-1){q[s].checked=true;}j[1].checked=true;v.enableEvtMsgPropagation(h);v.enableEvtMsgPropagation(A);dojo.style(dojo.query(".addProItem-"+t,h)[0],{display:"none"});dojo.style(dojo.query(".delProItem-"+t,h)[0],{display:""});
(l||function(){}).apply(v,[dojo.attr(h,"uniqueId"),h,y]);}());},removeMainProductRow:function(i,f){var g=null,e=this,h=dojo.query("[uniqueId="+i+"]",e.domNode)[0];while(true){g=h.nextSibling;if(g&&(g.tagName||"").toUpperCase()=="TR"){break;
}g=g.nextSibling;}dojo.destroy(h);dojo.destroy(g);(f||function(){}).apply(e,[i]);},getPageData:function(){var k=dojo.global.$appContext$.get("prodOfferList"),m=a.ProdOfferHelper.getMainProdOffer(k)[0],h=dojo.global.$appContext$.get("requestParam"),l={},i=dojo.query("tr[uniqueId]",this.domNode),f=[],j=false,g=this.getPageStartEndDate(),e=["uniqueId","viewId","prodOfferId","roleCD","roleNumMax","roleNumMin","parentRoleCD","productId","roleName","serviceKindIndex","serviceKind","userId","prodInstId"];
BusCard.each(i,function(n){var s={};dojo.forEach(dojo._toArray(n.attributes),function(z){s[z.name]=z.nodeValue;});dojo.forEach(e,function(z){var A=s[z.toLowerCase()];if(A!=null&&z!=z.toLowerCase()){try{delete s[z.toLowerCase()];
s[z]=A;}catch(B){}}});var y={},w=s.viewId,t=s.uniqueId,u="serviceCardWidget_"+t,q=unieap.byId(u),r=q.serviceProductWidget,x=dojo.query("."+w,n)[0].checked,p=dojo.query("SELECT",n)[0].value,v=x?q.getPageData():q.getPageData(null,null,true),o=!!r?r.getPageData():null;
if(v==false){j=true;return false;}if(o===false){j=true;return false;}dojo.mixin(s,{productChecked:x,productId:p});dojo.mixin(y,v);dojo.mixin(y,{serviceProductInfo:o});dojo.mixin(y,{prodBasicInfo:s});f.push(y);
});if(j){return false;}else{return{prodOfferPageInfo:g,productInfoList:f};}},getPageStartEndDate:function(){var o=dojo.query(".current-accept-class",this.domNode)[0],k=dojo.query(".productStartDateStyle",o)[0],m=dojo.query(".delayUnit-class",o)[0],h=dojo.query(".productEndDateStyle",o)[0],f=dojo.query(".offerEndDateCycleStyle",o)[0],n=dojo.query(".effect-class",o)[0],i=dojo.query(".effectType-class",o)[0],l=dojo.query(".cycle-effect-class",o)[0],e=dojo.trim(dojo.query(".startDate-class",o)[0].innerHTML),j=dojo.trim(dojo.query(".endDate-class",o)[0].innerHTML),p={};
if(e){p.startDate=e;}if(j){p.endDate=j;}if(k&&k.style.display!="none"){if(m){p.delayUnit=m.value;}}if(h&&h.style.display!="none"){if(n){p.validPeriod=n.value;}if(i){p.validType=i.value;}}else{if(f&&f.style.display!="none"){var g=l.value.split("~");
p.validPeriod=g[0];p.validType=g[1];}}dojo.mixin(p,{prodOfferId:dojo.attr(o,"prodOfferId")});return p;}});});
defineModule("orderaccept.prodofferaccept.builder.prodofferdetail.MainProdOfferDetailBuilder",["./ProdOfferDetailBuilder","../../util","../../widget/attrcard/ProductOfferAttrCardWidget","../../widget/attrcard/ProductAttrCardWidget","../../../custom/TooltipDialog","../../widget/attrcard/OfferAgreementCardWidget","unieap.layout.TabContainer","unieap.layout.ContentPane"],function(b,a,e,c,d,f){dojo.declare("orderaccept.prodofferaccept.builder.prodofferdetail.MainProdOfferDetailBuilder",[b],{ProductOfferAttrCardWidgetClass:e,ProductAttrCardWidgetClass:c,agreementAttrCardWidget:null,constructor:function(g){this.loader=g;
this.prodOfferDetailWidgetList=[];},initProdOfferDetail:function(h){var k=this,q=this.loader,i=h.subProdOfferInfo,p="main-"+i.prodOfferId,n=h.prodOfferInst,o=h.prodOfferInfoWidget,m=!!o?o.uniqueId:"",j=h.ifMultiplSub;
var l=new d({id:(!!j?"multipleProdOfferDetailDialog-":"mainProdOfferDetailDialog-")+i.prodOfferId+(m==""?"":("-"+m))});if(m!=""){p+="-"+m;}h.rowIndex=p;this.prodOfferDetailWidgetList[""+p]=l;l.rowData=h;
l.rowIndex=p;l.builder=this;l.prodOfferAttrCard=null;l.favourBuilder=null;l.prodOfferAssureBuilder=null;l.startup();l.setAttribute("rowIndex",p);l.domNode.setAttribute("dojoAttachEvent","onmouseout:elementmouseout");
l.domNode.setAttribute("dojoAttachTopic","/prodOfferDetailDialog");var g="<div style='text-align:center;vertical-align:middle'><a href='javascript:void(0);' dojoAttachEvent='onclick:elementclick'  rowIndex="+p+"			        		dojoAttachTopic='/mainProdOfferDetailBtn' style='text-align:center;vertical-align:middle;'>关闭</a></div>";
dojo.place(g,l.containerNode,"last");l.enableEvtMsgPropagation(l.domNode);var r=new unieap.layout.TabContainer({height:"auto",uniqueId:m});l.tabContainer=r;r.startup();this.initAgreementInfo(l,h,r);this.initProdOfferAttr(l,h,r);
this.initFamilyInfo(l,h,r);if(!!n&&(!n.prodOfferInstAssureList||n.prodOfferInstAssureList.length==0)){this.initProdOfferAssure(l,h,r);}this.specialDealAttr(l,i,n);l.handlePageData=dojo.hitch(l,function(){var v={};
if(!!l.prodOfferAttrCard){if(!k.checkNotNull(l.prodOfferAttrCard.domNode,l.prodOfferAttrCard.domNode)){return false;}var w=l.prodOfferAttrCard.getCardData(null,null,true);if(w){dojo.mixin(v,{offerAttrPageInfoList:w});
}else{return false;}}if(!!l.favourBuilder){dojo.mixin(v,{relaBusPageInfoList:l.favourBuilder.getAllFavourData()});}if(!!l.assurePageData){var t=[];var u=l.assureAttrCard.busCardInstance.getData();if(!u){return false;
}for(var s in u){if(!u.hasOwnProperty(s)){continue;}t.push({attrId:s,attrValue:u[s]});}l.assurePageData.assureAttrList=t;}dojo.mixin(v,{prodOfferAssurePageInfoList:l.assurePageData});if(!j){q.mainProdOfferDetailWidget.mainProdOfferDetailData=v;
}else{return v;}});dojo.mixin(h,{handlePageData:l.handlePageData});dojo.place(r.domNode,l.containerNode,"first");},initAgreementInfo:function(k,j,g){if(j.prodOfferInst){return;}var i=new f({prodOfferInfoVO:j.subProdOfferInfo,config:j.config});
if(i.needRendering===false){return;}else{this.agreementAttrCardWidget=i;}var h=new unieap.layout.ContentPane({title:"销售品协议",uniqueId:g.uniqueId});i.renderCard(h.domNode,"first");k.agreementAttrCardWidget=i;
g.addChild(h);}});});
defineModule("orderaccept.prodofferaccept.widget.mainprodoffer.MultipleMainProdOfferWidget",["./MainProdOfferWidget","orderaccept.prodofferaccept.util"],function(b,a){dojo.declare("orderaccept.prodofferaccept.widget.mainprodoffer.MultipleMainProdOfferWidget",[b],{templatePath:dojo.moduleUrl("orderaccept.prodofferaccept.widget.mainprodoffer","template/mainProdOfferTpl.html"),delayCreateBeforeBindModel:true,postMixInProperties:function(){this.modelData=this.getModel(),this.uniqueId=this.modelData.uniqueId;
this.prodOfferInfoVO=this.modelData.mainProdOfferInfoVO;this.prodOfferInstVO=this.modelData.prodOfferInstVO;this.contentPane=this.modelData.contentPane;this.inherited(arguments);},buildViewInitData:function(){var n=this,p="key",g=this.prodOfferInfoVO,i=this.prodOfferInstVO,f=dojo.global.$appContext$.requestParam,o=p+"-"+g.parentProdOfferId+g.prodOfferId,j=!!i?"\u4fdd\u7559":"\u8ba2\u8d2d",k=a.ProdOfferHelper.toProductStartDateView(g,{key:"key"}),d=a.ProdOfferHelper.toProductEndDateView(g,{key:"key"}),m=a.ProdOfferHelper.IfShowMainOfferDetail(g)?"1":"0",l=a.ProdOfferHelper.getProductDateBuilder(g),c=!!a.ProdOfferHelper.ifShowStartTime(g)?l.getBeginDate():"",h=!!a.ProdOfferHelper.ifShowEndTime(g)?l.getEndDate():"";
if(i){k.style.hiddenStyleOption=" hidden-elem";d.style.hiddenStyleOption=" hidden-elem";d.style.cycleStyleOption=" hidden-elem";}if(this.contentPane.action=="split"){c=a.DateHelper.getStringFirstDayOFNextMonth();
k.style.hiddenStyleOption=" hiddenStyle";}else{if(this.contentPane.action=="new"){c=dojo.global.$appContext$.requestParam.today;k.style.hiddenStyleOption=" hiddenStyle";}else{if(this.contentPane.action=="change"&&this.contentPane.offerInstVO.prodOfferId!=this.contentPane.prodOfferId){c=a.DateHelper.getStringFirstDayOFNextMonth();
k.style.hiddenStyleOption=" hiddenStyle";}}}var e=false;e=a.AttrUtil.checkIfNotNull(g.attrList);if(!e){e=dojo.some(g.offerProdRelaList,function(q){if(q.productInfoVO.prodFuncType==ConstantsPool.load("ProductFuncTypeConst").ProductFuncTypeConst.ACCESS){return false;
}return a.AttrUtil.checkIfNotNull(q.productInfoVO.attrList);});}e=!!i?false:e;tpContext={prodOfferDetailFlag:m,detailNotNull:e?"":"hidden-elem",finishImg:!e?"":"hidden-elem",productStartDateView:k,productEndDateView:d,viewId:o,startDate:a.DateHelper.format(!!i?i.effDate:c),endDate:a.DateHelper.format(!!i?i.expDate:h),actionName:j,displayStartEndTime:"",prodOfferInfoVO:g,ifMultipleMainProd:true,multipleUniqueId:"-"+n.uniqueId};
return{prodOfferViewData:tpContext,prodViewData:null};},getPageData:function(){var e=this.prodOfferInfoVO,c=this.prodOfferInstVO,d=this.mainProdOfferDetailWidget;requestParam=dojo.global.$appContext$.get("requestParam"),pageInfoData={},detailPageData={},offerAttrPageDataList={},relaBusPageInfoList={},productBasicTrList=dojo.query("[uniqueId="+this.uniqueId+"]"),exceptionFlag=false,prodOfferInfo=this.getPageStartEndDate(),attrKeyList=["uniqueId","viewId","prodOfferId","roleCD","roleNumMax","roleNumMin","parentRoleCD","productId","roleName","serviceKindIndex","serviceKind","userId","prodInstId"];
if(!!d){detailPageData=d.handlePageData();if(detailPageData===false){exceptionFlag=true;}else{offerAttrPageDataList=detailPageData.offerAttrPageInfoList;relaBusPageInfoList=detailPageData.relaBusPageInfoList;
}}if(exceptionFlag){return false;}else{return{prodOfferPageInfo:prodOfferInfo,offerAttrPageInfoList:offerAttrPageDataList,relaBusPageInfoList:relaBusPageInfoList,prodOfferInfoVO:e,prodOfferInst:c,uniqueId:this.uniqueId};
}}});});
defineModule("orderaccept.prodofferaccept.widget.mainprodoffer.MainProdOfferFlatWidget",["./MainProdOfferWidget","orderaccept.prodofferaccept.util"],function(b,a){dojo.declare("orderaccept.prodofferaccept.widget.mainprodoffer.MainProdOfferFlatWidget",[b],{actionNameMap:a.actionNameMap,memberTemplate:BusCard.Template.create("<select class='member-main-prodoffer' style='width:98%'><tp:for ds='membProdOfferList'><option value='${prodOfferId}'>${prodOfferName}</option></tp:for></select>"),buildProductViewInitData:function(c,d){var g=this,f=Array.prototype.concat,e=this.key=d.key;
return this.buildMemberProdOfferInitData(c,d)||this.buildSharedProductInitData(c,d);},buildSharedProductInitData:function(d,e){var c=$ac$.get("selectedMemberProdOfferList"),f=this;if(d.bindType!=2){return dojo.map(c,function(j){var i=j.productId,g=BusCard.jsonPath(d,"$.offerProdRelaList[?(@.productId=="+i+")]")[0],h=f._buildEachProductViewData(d,g,g.roleInfoVO);
j.uniqueId=h.uniqueId;return h;});}},buildMemberProdOfferInitData:function(e,f){if(e.bindType!=2){return false;}var c=$ac$.get("selectedMemberProdOfferList"),d=this;if(c==null){return false;}else{var g=dojo.map(c,function(l){var n=l.prodOfferId,j=l.productId,k=dojo.filter(e.offerProdRelaList,function(o){return o.productInfoVO.productId==j;
})[0],i=null,m=function(){i=a.ProdOfferHelper.loadAndSetProdOffer(l.prodOfferId,{interfaceType:4});k=dojo.filter(i.offerProdRelaList,function(o){return o.productInfoVO.productId==j;})[0];};if(!l.permitEnterComb&&(l.prodInstId||l.prodOfferInstId)){m();
}i=i||dojo.filter(k.relatedOfferList,function(o){return o.prodOfferId==n;})[0];if(!i){m();}var h=d._buildEachProductViewData(e,k,k.roleInfoVO);h.memberProdOfferView=d._buildMemberMainProdOfferView(i);l.uniqueId=h.uniqueId;
return h;});this._updateMemeberMainProdOfferStatus(g);return g;}},_updateMemeberMainProdOfferStatus:function(c){dojo.forEach(c,function(d){d.prodOperClass="mainprodoffer-hidden";d.checkedOption="CHECKED";
d.disabledOption="DISABLED";});},_buildMemberMainProdOfferView:function(c){return this.memberTemplate.apply({membProdOfferList:[{prodOfferName:c.prodOfferName,prodOfferId:c.prodOfferId}]});},_buildEachProductViewData:function(i,n,f){this.productServiceKindMap=this.productServiceKindMap||{};
var h=n.productInfoVO,l=this.productServiceKindMap,e=BusCard.Template.create("<option isDefault = '#{isDefault}' value ='#{productId}'>#{productName}</option>"),g=function(o){return e.apply({isDefault:o.isDefault,productName:o.productInfoVO.productName,productId:o.productInfoVO.productId});
},k=g(n);if(!l[n.productId]&&n.productInfoVO.prodFuncType==a.ProductFuncTypeConst.ACCESS){l[n.productId]={serviceKind:h.netType};}var d=l[n.productId.toString()];var c=d?a.ServiceKindCounter.get(d.serviceKind):"-1";
var j=!!d?a.ServiceKindPrefixMap[d.serviceKind]+"号码"+c:"";var m=!!d?d.serviceKind:"-1";return dojo.mixin({uniqueId:a.CommUtils.generateUniqueId(),roleName:f?f.roleName:"无角色",viewId:this.key+"-product-"+h.productId,optionList:k,prodRela:n,checkedOption:"CHECKED"||(n.ifDefault==1?"CHECKED":""),disabledOption:"DISABLED"||((!f&&h.minCount)>0?"DISABLED":""),webPath:BusCard.path.contextPath,data:{},newCheckedOption:"CHECKED",prodOfferId:i.prodOfferId,productId:h.productId,maxCount:h.maxCount,minCount:h.minCount,prodOperClass:"mainprodoffer-hidden"||(h.maxCount>1?"":"mainprodoffer-hidden"),prodCancelClass:"mainprodoffer-hidden",serviceKindIndex:c,serviceKind:m,serviceId:j,actionName:"\u8ba2\u8d2d"},f);
}});});
defineModule("orderaccept.prodofferaccept.widget.prodofferfavoritelist.peddleProdOfferListWidget",["orderaccept.custom._BaseWidget","orderaccept.custom._BusCardTemplated"],function(b,a){dojo.declare("orderaccept.prodofferaccept.widget.prodofferfavoritelist.peddleProdOfferListWidget",[b,a],{templateString:"<div><ul class='favori_ul'>										<tp:for ds='prodOfferList'>										<li style='cursor:pointer;list-style-type:none;' prodOfferId='${prodOfferId}' class='peddle-prodoffer-item' dojoAttachEvent='ondblclick:elementdblclick' dojoAttachTopic='/peddleProdOfferItem'>										<a href='javascript:void(0);'><span dojoAttachEvent='onmouseover:elementmouseover,onmouseout:elementmouseout' dojoAttachTopic='/peddleProdOfferItem-span'>${prodOfferName}</span></a></li></tp:for></ul>										<a href='javascript:void(0);' id='peddleProdOfferMoreHref' name='morePeddleProdOffer'  style='display:none' dojoAttachEvent='onclick:elementclick' dojoAttachTopic='/morePeddleItem'>更多>></a>										<ul id ='morePeddleProdOffer' class='favori_ul' style='display:none'>										</ul></div>",moreTemplate:"<tp:for ds='morePeddleProdOfferList'>										<li style='cursor:pointer;list-style-type:none;' prodOfferId='${prodOfferId}' class='personal-prodoffer-item' dojoAttachEvent='ondblclick:elementdblclick,onmouseover:elementmouseover,onmouseout:elementmouseout' dojoAttachTopic='/peddleProdOfferItem'>										<a href='javascript:void(0);'><span dojoAttachEvent='onmouseover:elementmouseover,onmouseout:elementmouseout' dojoAttachTopic='/peddleProdOfferItem-span'>${prodOfferName}</span></a></li></tp:for>",hasRendering:false,postMixInProperties:function(){this.prodOfferList=dojo.global.$appContext$.get("_peddleProdOfferList");
this.morePeddleProdOfferList=[];this.delayRenderingMorePeddleProdOfferList=dojo.global.$appContext$.get("_morePeddleProdOfferList");},renderMore:function(){if(!this.hasRendering){var d=BusCard.Template.create(this.moreTemplate).apply({morePeddleProdOfferList:this.delayRenderingMorePeddleProdOfferList||[]});
var c=dojo.byId("morePeddleProdOfferList");c.innerHTML=d;this.enableEvtMsgPropagation(c);this.hasRendering=true;}}});});
defineModule("orderaccept.prodofferaccept.widget.prodofferfavoritelist.hotProdOfferListWidget",["orderaccept.custom._BaseWidget","orderaccept.custom._BusCardTemplated"],function(b,a){dojo.declare("orderaccept.prodofferaccept.widget.prodofferfavoritelist.hotProdOfferListWidget",[b,a],{templateString:"<div><ul class='favori_ul'>										<tp:for ds='prodOfferList'>										<li style='cursor:pointer;list-style-type:none;' prodOfferId='${productId}' class='hot-prodoffer-item' dojoAttachEvent='ondblclick:elementdblclick,onmouseover:elementmouseover,onmouseout:elementmouseout' dojoAttachTopic='/hotProdOfferItem'>										<a href='javascript:void(0);'><span dojoAttachEvent='onmouseover:elementmouseover,onmouseout:elementmouseout' dojoAttachTopic='/hotProdOfferItem-span'>${productName}</span></a></li></tp:for></ul>										<a href='javascript:void(0);' id='hotProdMoreHref' name='moreHotProdOffer' style='display:none' dojoAttachEvent='onclick:elementclick' dojoAttachTopic='/moreHotItem'>更多>></a>										<ul id ='moreHotProdOffer' class='favori_ul' style='display:none'>										</ul></div>",moreTemplate:"<tp:for ds='moreHotProdOfferList'>										<li style='cursor:pointer;list-style-type:none;' prodOfferId='${prodOfferId}' class='personal-prodoffer-item' dojoAttachEvent='ondblclick:elementdblclick,onmouseover:elementmouseover,onmouseout:elementmouseout' dojoAttachTopic='/hotProdOfferItem'>										<a href='javascript:void(0);'><span dojoAttachEvent='onmouseover:elementmouseover,onmouseout:elementmouseout' dojoAttachTopic='/hotProdOfferItem-span'>${prodOfferName}</span></a></li></tp:for>",hasRendering:false,postMixInProperties:function(){this.prodOfferList=dojo.global.$appContext$.get("_hotProdOfferList");
this.moreHotProdOfferList=[];this.delayRenderingMoreHotProdOfferList=dojo.global.$appContext$.get("_moreHotProdOfferList");},renderMore:function(){if(!this.hasRendering){var d=BusCard.Template.create(this.moreTemplate).apply({moreHotProdOfferList:this.delayRenderingMoreHotProdOfferList||[]});
var c=dojo.byId("moreHotProdOffer");c.innerHTML=d;this.enableEvtMsgPropagation(c);this.hasRendering=true;}}});});
defineModule("orderaccept.prodofferaccept.widget.prodofferfavoritelist.personalCollectListWidget",["orderaccept.custom._BaseWidget","orderaccept.custom._BusCardTemplated"],function(b,a){dojo.declare("orderaccept.prodofferaccept.widget.prodofferfavoritelist.personalCollectListWidget",[b,a],{templateString:"<div><ul class='favori_ul'>										<tp:for ds='prodOfferList'>										<li style='cursor:pointer;list-style-type:none;' prodOfferId='${prodOfferId}' class='personal-prodoffer-item' dojoAttachEvent='ondblclick:elementdblclick,onmouseover:elementmouseover,onmouseout:elementmouseout' dojoAttachTopic='/personalProdOfferItem'>										<a href='javascript:void(0);'><span dojoAttachEvent='onmouseover:elementmouseover,onmouseout:elementmouseout' dojoAttachTopic='/personalProdOfferItem-span'>${prodOfferName}</span></a></li></tp:for></ul>										<a href='javascript:void(0);' id='pcProdMoreHref' name='morePersonalProdOffer' style='display:none' dojoAttachEvent='onclick:elementclick' dojoAttachTopic='/morePersonalItem'>更多>></a>										<ul id ='morePersonalProdOffer' class='favori_ul' style='display:none'>										</ul></div>										",moreTemplate:"<tp:for ds='morePersonalProdOfferList'>										<li style='cursor:pointer;list-style-type:none;' prodOfferId='${prodOfferId}' class='personal-prodoffer-item' dojoAttachEvent='ondblclick:elementdblclick,onmouseover:elementmouseover,onmouseout:elementmouseout' dojoAttachTopic='/personalProdOfferItem'>										<a href='javascript:void(0);'><span dojoAttachEvent='onmouseover:elementmouseover,onmouseout:elementmouseout' dojoAttachTopic='/personalProdOfferItem-span'>${prodOfferName}</span></a></li></tp:for>",hasRendering:false,postMixInProperties:function(){this.prodOfferList=dojo.global.$appContext$.get("_personalProdOfferList");
this.morePersonalProdOfferList=[];this.delayRenderingMorePersonalProdOfferList=dojo.global.$appContext$.get("_morePersonalProdOfferList");},renderMore:function(){if(!this.hasRendering){var d=BusCard.Template.create(this.moreTemplate).apply({morePersonalProdOfferList:this.delayRenderingMorePersonalProdOfferList||[]});
var c=dojo.byId("morePersonalProdOffer");c.innerHTML=d;this.enableEvtMsgPropagation(c);this.hasRendering=true;}}});});
defineModule("orderaccept.prodofferaccept.widget.prodofferfavoritelist.personalSubCollectListWidget",["orderaccept.custom._BaseWidget","orderaccept.custom._BusCardTemplated"],function(b,a){dojo.declare("orderaccept.prodofferaccept.widget.prodofferfavoritelist.personalSubCollectListWidget",[b,a],{templateString:"<div><ul class='favori_ul'>										<tp:for ds='prodOfferList'>										<li style='cursor:pointer;list-style-type:none;' prodOfferId='${prodOfferId}' class='personal-prodoffer-item' dojoAttachEvent='ondblclick:elementdblclick' dojoAttachTopic='/personalSubProdOfferItem'>										<a href='javascript:void(0);'>${prodOfferName}</a></li></tp:for></ul>										<a href='javascript:void(0);' id='pcSubProdMoreHref${uniqueId}' name='morePersonalSubProdOffer${uniqueId}' subUniqueId='${uniqueId}'  style='display:none' dojoAttachEvent='onclick:elementclick' dojoAttachTopic='/morePersonalSubItem'>更多>></a>										<div id='subCollect${uniqueId}'></div></div>										",postMixInProperties:function(){var c=this.params;
var d=c.uniqueId;this.uniqueId=d;this.prodOfferList=dojo.global.$appContext$.get("_personalSubProdOfferList"+d);}});});
defineModule("orderaccept.prodofferaccept.widget.prodofferfavoritelist.personalSubCollectMoreListWidget",["orderaccept.custom._BaseWidget","orderaccept.custom._BusCardTemplated"],function(b,a){dojo.declare("orderaccept.prodofferaccept.widget.prodofferfavoritelist.personalSubCollectMoreListWidget",[b,a],{templateString:"<div>										<ul id ='morePersonalSubProdOffer${uniqueId}' class='favori_ul' style='display:none'>										<tp:for ds='morePersonalProdOfferList'>										<li style='cursor:pointer;list-style-type:none;' prodOfferId='${prodOfferId}' class='personal-prodoffer-item' dojoAttachEvent='ondblclick:elementdblclick' dojoAttachTopic='/personalSubProdOfferItem'>										<a href='javascript:void(0);'>${prodOfferName}</a></li></tp:for></ul></div>										",postMixInProperties:function(){var c=this.params;
var d=c.uniqueId;this.uniqueId=d;this.morePersonalProdOfferList=dojo.global.$appContext$.get("_morePersonalSubProdOfferList"+d);}});});
defineModule("orderaccept.prodofferaccept.widget.prodofferfavoritelist.personalPromotionCollectListWidget",["orderaccept.custom._BaseWidget","orderaccept.custom._BusCardTemplated"],function(b,a){dojo.declare("orderaccept.prodofferaccept.widget.prodofferfavoritelist.personalPromotionCollectListWidget",[b,a],{templateString:"<div><ul class='favori_ul'>										<tp:for ds='prodOfferList'>										<li style='cursor:pointer;list-style-type:none;' prodOfferId='${prodOfferId}' class='personal-promotion-item' dojoAttachEvent='ondblclick:elementdblclick' dojoAttachTopic='/personalPromotionItem'>										<a href='javascript:void(0);'>${prodOfferName}</a></li></tp:for></ul>										<a href='javascript:void(0);' id='pcPromotionMoreHref' name='morePersonalPromotion' style='display:none' dojoAttachEvent='onclick:elementclick' dojoAttachTopic='/morePersonalPromotionItem'>更多>></a>										<ul id ='morePersonalPromotion' class='favori_ul' style='display:none'>										<tp:for ds='morePersonalProdOfferList'>										<li style='cursor:pointer;list-style-type:none;' prodOfferId='${prodOfferId}' class='personal-promotion-item' dojoAttachEvent='ondblclick:elementdblclick' dojoAttachTopic='/personalPromotionItem'>										<a href='javascript:void(0);'>${prodOfferName}</a></li></tp:for></ul></div>										",postMixInProperties:function(){this.prodOfferList=dojo.global.$appContext$.get("_personalPromotionList");
this.morePersonalProdOfferList=dojo.global.$appContext$.get("_morePersonalPromotionList");}});});
defineModule("orderaccept.prodofferaccept.widget.functionnavigator.FunctionNavigatorWidget",["orderaccept.custom._BaseWidget","orderaccept.custom._BusCardTemplated"],function(b,a){dojo.declare("orderaccept.prodofferaccept.widget.functionnavigator.FunctionNavigatorWidget",[b,a],{templateString:"<div class='function-menu-ctn'>										<input type='button'    class = 'formButton' title='跳转到套餐选择页面' groupId ='0' value = '上一步'  dojoAttachEvent = 'onclick:elementclick' dojoAttachTopic='/toMainProdOfferSelectPane'/>										<input type = 'button'  class = 'formButton' value = '订单暂存' title='点击进行订单暂存操作' groupId = '100'/>										<input type = 'button'  class = 'formButton' value = '订单预览' title='点击进行订单预览操作' groupId = '0'  dojoAttachEvent='onclick:elementclick' dojoAttachTopic='/ordershow' />										<input type = 'button'  class = 'formButtonL' value = '订单保存/预算'  title='点击进行保存订单操作' groupId ='0' dojoAttachEvent='onclick:elementclick' dojoAttachTopic='/saveorder' />										<input type = 'button'  class = 'formButton toOrderDetailClass' title='返回订单详情' value = '上一步' groupId ='1'  dojoAttachEvent='onclick:elementclick' dojoAttachTopic='/toOrderDetailPage' />										<input type = 'button'  class = 'formButton' title='点击进行免填单打印操作'  value = '免填单打印' groupId ='1' dojoAttachEvent='onclick:elementclick' dojoAttachTopic='/doPrint' />										<input type = 'button'  class = 'formButton continueAcceptClass' value = '继续受理'  title='点击进行继续受理操作' groupId ='1' dojoAttachEvent='onclick:elementclick' dojoAttachTopic='/coutinueorder' />										<input type = 'button'  class='formButton commitOrderClass' value = '受理完成' menuId='841ABXD'  DISABLED title='点击进行受理完成操作' groupId = '1' dojoAttachEvent = 'onclick:elementclick' dojoAttachTopic='/completeorder' />										<input type = 'button'  class='formButton chargeClass'  value = '结算' title='点击进行结算操作' DISABLED groupId = '1'  dojoAttachEvent='onclick:elementclick' dojoAttachTopic='/doCharge' />										<input type='button'   class='formButton commitOrderClass' value='上一步' groupId = '2' dojoAttachEvent='onclick:elementclick' id='batchBackButton' dojoAttachTopic='/backBatch'  />										<input type='button'  class='formButton commitOrderClass' id='batchExpBtn' value='生成模板' groupId = '2' dojoAttachEvent='onclick:elementclick'dojoAttachTopic='/generationTemplate'  />										<input type = 'button'  class='formButtonL commitOrderClass'  value = '批量订单提交' DISABLED title='点击进行批量提交操作' groupId = '2'id='batchSubmitButton' dojoAttachEvent = 'onclick:elementclick' dojoAttachTopic='/saveBatch' />										<input type = 'button'  class='formButtonL' value = '改单保存/预算'   title='点击保存改单内容' groupId = '3' dojoAttachEvent = 'onclick:elementclick' dojoAttachTopic='/saveorder' />										<input type = 'button'  class='formButton' value = '改单完成'  menuId='841ABXD'  title='点击完成改单' groupId = '4' dojoAttachEvent = 'onclick:elementclick' dojoAttachTopic='/completeorder' />										<input type = 'button'  class='formButton' value = '返回'   title='返回订单变更初始化页面' groupId = '4' dojoAttachEvent = 'onclick:elementclick' dojoAttachTopic='/back2OrderChangePage' />									</div>",postCreate:function(){loadCssModule("orderaccept.prodofferaccept.widget.functionnavigator.resources.css.function-navigator");
var c=this;this.switchGroup(0);},switchGroup:function(c){var e=c+"",d=dojo.query("[groupId]",this.domNode);dojo.forEach(d,function(f){if(dojo.attr(f,"groupId")==e){f.style.display="";}else{f.style.display="none";
}});}});});
defineModule("orderaccept.prodofferaccept.loader.OldUserAddedHandler",["orderaccept.base.Controller","../util","orderaccept.prodofferaccept.widget.mainprodoffer.MultipleMainProdOfferWidget","orderaccept.common.dialog.MessageBox"],function(c,a,d,b){dojo.declare("orderaccept.prodofferaccept.loader.OldUserAddedHandler",[c],{quitTemplate:null,controller:null,constructor:function(e){this.controller=e;
},getQuitTemplate:function(){if(this.quitTemplate==null){this.quitTemplate=dojo._getText(dojo.moduleUrl("orderaccept.prodofferaccept","widget/mainprodoffer/template/quitProdOfferTpl.html"));}return this.quitTemplate;
},assertOldUserAvailable:function(l,m){var n=this,k=a.ACTION_CD_CONST,g=this.controller.serviceCardWidgetMap["serviceCardWidget_"+m],e=dojo.query("TR[uniqueId="+m+"]",n.controller.mainProdOfferWidget.domNode)[0],f=dojo.attr(e,"productId"),h=BusCard.jsonPath(l||[],"$.userHasProdOfferInfoList[*].prodInstList[?(@.productId=='"+f+"')]")[0],j=dojo.query("[name=searchNumber]",e)[0];
if(h){var o=h.prodInstId;var i=dojo.query("TR[prodInstId="+o+"]",e.parentNode);if(i&&(i.length>0)){unieap.showTooltip("<p style='color:red'>\u9009\u62e9\u7684\u8001\u7528\u6237\u5df2\u5b58\u5728</p>",j,["below","after"]);
setTimeout(function(){unieap.hideTooltip(j);},4000);return false;}}else{unieap.showTooltip("<p style='color:red'>\u9009\u62e9\u7684\u8001\u7528\u6237\u65e0\u6548,\u8bf7\u6838\u67e5\u6570\u636e</p>",j,["below","after"]);
setTimeout(function(){unieap.hideTooltip(j);},4000);return false;}},addOldUser:function(e){if(!$ac$.get("_prodOfferInstMap")){$ac$.set("_prodOfferInstMap",{});}e=dojo.isString(e)?dojo.fromJosn(e):e;var h=e.prodOfferInstId,g=e.serviceId,i=e.uniqueId,f=this;
if($ac$.get("_prodOfferInstMap")[h]){b.alert({busiCode:"08410155"});}BusCard.doGet(BusCard.path.contextPath+"/orderDetailAction.do",{method:"doGetProdOfferListForChgMainProvider",prodOfferInstId:h},true,function(j){$ac$.get("_prodOfferInstMap")[h]=j;
f.convertProductServiceInfo(i,j);f.renderQuitTemplate(i,h,j);f.updateSelectedMemberProdOfferList(j,h,i);f.dealOfferAttrDisplay(i);f.dealMainOfferDateDisplay(i);f.doSubProdofferHandling(j,i);f.dealAccManageDisplay();
});},dealMainOfferDateDisplay:function(){if(!!$ac$.mainProdOfferInstVO){return;}try{if(dojo.getObject("prodOfferAcceptLoader.mainProdOfferWidget.domNode")!=null){dojo.query(".startDate-class",prodOfferAcceptLoader.mainProdOfferWidget.domNode)[0].innerText=a.DateHelper.getStringFirstDayOFNextMonth();
}}catch(f){}},dealOfferAttrDisplay:function(l){if($ac$.selectedMainProdOfferInfoVO.bindType==2){var k=prodOfferAcceptLoader.multipleSubProdOfferHandler.subProdOfferOrderProviderMap;var h=null;for(var g in k){if(!k.hasOwnProperty(g)){continue;
}if(g==("subProdOfferTreeContainer"+l)){h=k[g];break;}}try{if(dojo.getObject("prodOfferInfoWidget.mainProdOfferDetailWidget.prodOfferAttrCard.busCardInstance",h)!=null){var i=h.prodOfferInfoWidget.mainProdOfferDetailWidget.prodOfferAttrCard.busCardInstance.$("300075");
if(!!i){i.value="2";i.disabled=true;}}}catch(j){}}else{try{if(dojo.getObject("prodOfferAcceptLoader.mainProdOfferDetailWidget.prodOfferAttrCard.busCardInstance")!=null){var f=prodOfferAcceptLoader.mainProdOfferDetailWidget.prodOfferAttrCard.busCardInstance.$("300075");
if(!!f){f.value="2";f.disabled=true;}}}catch(j){}}},dealAccManageDisplay:function(){var e=dojo.query("#manageNbrInfo")[0];if(e.children.length>0){if(dojo.attr(dojo.query("#manageNbrInfo")[0].children[0],"ifCreateAcc")!=1){b.alert({busiCode:"08410226"});
}}dojo.query(".userAccountButton")[0].style.display="none";dojo.byId("manageNbrInfo").style.display="none";dojo.byId("manageNbrInfo").innerHTML="";},updateSelectedMemberProdOfferList:function(f,h,j){var g=BusCard.jsonPath(f,"$.userHasProdOfferInfoList[?(@.prodOfferInstId=="+h+")]")[0];
if(!g){return false;}var e=this._isNeedQuit(j,g);var i=BusCard.jsonPath($ac$.get("selectedMemberProdOfferList"),"$[?(@.uniqueId=="+j+")]")[0];i.action=e?"change":"nochange";i.offerInstVO=g;i.prodOfferInstId=g.prodOfferInstId;
i.prodInstVO=g.prodInstList[0];i.prodInstId=i.prodInstVO.prodInstId;i.memberFromOldNumber=true;this.updateTitleInfo(j,i);},updateTitleInfo:function(j,k){try{var f=this.controller.mainProdOfferWidget;var g=dojo.query("tr[uniqueId="+j+"]",f.domNode)[0];
var o=this.controller.multipleSubProdOfferHandler.subProdOfferTabContainer.tablist;var l=this.controller.multipleSubProdOfferHandler.subProdOfferOrderProviderMap["subProdOfferTreeContainer"+j];var h=l.contentPane;
var m=o.pane2button[h].containerNode;var n=$ac$.get("prodOfferList"+j).find(function(e){return e.prodOfferId==k.prodOfferId;});m.innerHTML=n.prodOfferName+"-\u6210\u5458\u52a0\u88c5";dojo.query(".product-action-span",g)[0].innerHTML="\u6210\u5458\u52a0\u88c5";
}catch(i){}},convertProductServiceInfo:function(m,l){var o=this,k=a.ACTION_CD_CONST,h=this.controller.serviceCardWidgetMap["serviceCardWidget_"+m],f=h.attrCardWidget,j=h.serviceProductWidget,e=dojo.query("TR[uniqueId="+m+"]",o.controller.mainProdOfferWidget.domNode)[0],g=dojo.attr(e,"productId"),i=BusCard.jsonPath(l,"$.userHasProdOfferInfoList[*].prodInstList[?(@.productId=='"+g+"')]")[0],n=this.controller.getServiceOfferConfigVO(k.PRODUCT_CHANGE).serviceOfferId;
dojo.attr(e,{userId:i.prodInstId,prodInstId:i.prodInstId,serviceId:i.accNbr});if(h){h.destroyRecursive();}if(f){if(!!f.busCardInstance.deleteReceiveMessagePath){f.busCardInstance.deleteReceiveMessagePath();
}f.destroyRecursive();}if(j){j.destroyRecursive();}o.updateProductBasicViewStatus(e);this.controller.route("/self/addServiceCardWidget",[m,function(p,q){q.userId=i.prodInstId;q.serviceId=i.accNbr;q.serviceOfferId=n;
return{attrCardBindingData:{prodInstVO:i}};},function(){var p=this.busCardInstance;}]);},updateProductBasicViewStatus:function(f){var g=dojo.attr(f,"uniqueId");dojo.query("input[name=serviceId]",f)[0].value=dojo.attr(f,"serviceId");
dojo.forEach(dojo._toArray(dojo.query("input[name=serviceOper-"+dojo.attr(f,"viewId")+"-"+g+"]")),function(h){h.disabled=true;});var e=dojo.query(".main-product-check",f)[0];e.checked=true;e.disabled=true;
},_isNeedQuit:function(i,h){var f=this,e=dojo.query("TR[uniqueId="+i+"]",f.controller.mainProdOfferWidget.domNode)[0],g=dojo.query(".member-main-prodoffer",e);if(g[0]&&h){if(g[0].value==h.prodOfferId){return false;
}}return true;},dealNewAndOldTime:function(i,l,k){i=a.DateHelper.getStringFirstDayOFNextMonth();if($ac$.currentMainProdOfferInfoVO.bindType==2){var f=this.controller.multipleSubProdOfferHandler.subProdOfferOrderProviderMap["subProdOfferTreeContainer"+l];
var g=f.contentPane;if(g.action=="new"){dojo.query(".startDate-class",g.domNode)[0].innerText=a.DateHelper.getStringFirstDayOFNextMonth();}}else{if(!$ac$.mainProdOfferInstVO){dojo.query(".startDate-class",prodOfferAcceptLoader.mainProdOfferWidget.domNode)[0].innerText=a.DateHelper.getStringFirstDayOFNextMonth();
}}var e=null;if(k.offerStandardInstList&&k.offerStandardInstList.length>0){a.ProdOfferInstProvider.getBeginAndEndDateForAgreeMentLN(k);e=$ac$.get("offerStandardStartDate_"+k.prodOfferInstId);i=e.oldOfferEndDate;
if($ac$.currentMainProdOfferInfoVO.bindType==0){dojo.query(".startDate-class",prodOfferAcceptLoader.mainProdOfferWidget.domNode)[0].innerText=e.beginDate;}else{if($ac$.currentMainProdOfferInfoVO.bindType==2){var f=this.controller.multipleSubProdOfferHandler.subProdOfferOrderProviderMap["subProdOfferTreeContainer"+l];
var g=f.contentPane;dojo.query(".startDate-class",g.domNode)[0].innerText=e.beginDate;}}}if($ac$.currentMainProdOfferInfoVO.bindType==0&&$ac$.currentMainProdOfferInfoVO.offerAgreementVO.length>0){prodOfferAcceptLoader.mainProdOfferDetailWidget.agreementAttrCardWidget.resetOfferStandardTime(e.beginDate);
}else{if($ac$.currentMainProdOfferInfoVO.bindType==2){var j=prodOfferAcceptLoader.multipleSubProdOfferHandler.subProdOfferOrderProviderMap["subProdOfferTreeContainer"+l].prodOfferInfoWidget;var h=j.prodOfferInfoVO;
if(h.offerAgreementVO.length>0){j.mainProdOfferDetailWidget.agreementAttrCardWidget.resetOfferStandardTime(e.beginDate);}}}},renderQuitTemplate:function(r,j,o){var q=BusCard.jsonPath(o,"$.userHasProdOfferInfoList[?(@.prodOfferInstId=="+j+")]"),u=null,h=null;
if(q){h=q[0];if(!this._isNeedQuit(r,h)){return false;}var m=BusCard.jsonPath(o,"$.userHasProdOfferMetaInfoList[?(@.prodOfferId=="+h.prodOfferId+")]")[0],f=this,w=this.key,v=w+"-"+m.parentProdOfferId+m.prodOfferId,l="\u9000\u8ba2",s=a.ProdOfferHelper.getProductDateBuilder(m,{beginDate:h.effDate,endDate:h.expDate,changeKind:3}),k=h.effDate,t=s.getEndDate();
this.dealNewAndOldTime(t,r,h);tpContext={prodOfferInstId:h.prodOfferInstId,prodOfferDetailFlag:"0",viewId:v,startDate:k,endDate:t,actionName:l,displayStartEndTime:"",prodOfferInfoVO:m};u={prodOfferViewData:tpContext,prodViewData:[]||this.buildQuitProductViewInitData(m,h,{key:w})};
}if(u){var p=BusCard.Template.create(this.getQuitTemplate()).apply(u);var n=document.createElement("TABLE");trNode=dojo._toDom(p);n.appendChild(trNode);var e=document.createDocumentFragment();dojo.forEach(dojo._toArray(n.childNodes),function(x){e.appendChild(x);
});var i=e.childNodes,g=this;dojo.forEach(dojo._toArray(i),function(x){if(x.nodeType==1){g.controller.mainProdOfferWidget.enableEvtMsgPropagation(x);}});dojo.query("table.main-prodoffer-table",this.controller.mainProdOfferWidget.domNode.parentNode)[0].appendChild(e);
}},doSubProdofferHandling:function(n,r){var o=null;var p=a.ProdOfferHelper.getMainProdOffer(dojo.global.$appContext$.get("prodOfferList"))[0];var f=null;if(p.bindType==2){f=a.ProdOfferHelper.getMainProdOffer(dojo.global.$appContext$.get("prodOfferList"+r))[0];
o=this.controller.multipleSubProdOfferHandler.subProdOfferOrderProviderMap["subProdOfferTreeContainer"+r];var A=null;var h=o.contentPane.prodOfferInfoVO.prodOfferId;var e=dojo.filter(n.userHasProdOfferInfoList,function(E){return E.prodOfferId==h;
})[0];var k=dojo.filter(n.userHasProdOfferMetaInfoList,function(E){return E.prodOfferId==h;})[0];if(!!e&&!!o&&!!o.prodOfferInfoWidget){o.contentPane.offerInstVO=e;A=o.prodOfferInfoWidget.domNode.parentNode;
o.prodOfferInfoWidget.destroyRecursive();var t=o.prodOfferInfoWidget.mainProdOfferDetailWidget;t&&t.destroyRecursive();o.prodOfferInfoWidget.mainProdOfferDetailWidget=null;o.prodOfferInfoWidget=null;var u=new d({mainProdOfferInfoVO:k,prodOfferInstVO:e,uniqueId:r,contentPane:o.contentPane});
!!o?o.prodOfferInfoWidget=u:null;dojo.place(u.domNode,A,"first");this.controller.multipleSubProdOfferHandler.initMainProdOfferDetail(u);}}else{f=a.ProdOfferHelper.getMainProdOffer(dojo.global.$appContext$.get("prodOfferList"))[0];
o=this.controller.multipleSubProdOfferHandler.subProdOfferOrderProviderMap.subProdOfferTreeContainer;}var y=o.getSubGridBindingData();var l=dojo.filter(y,function(E){return E.showData.prodOfferStyle=="prod-offer-add"||(E.showData.prodOfferStyle=="prod-offer-unorder"&&E.prodOfferInst==null);
});var v=n.userHasProdOfferInfoList;var q=n.userHasProdOfferMetaInfoList;var x=dojo.global.$appContext$["userHasProdOfferMetaInfoList"+(o.uniqueId||"")];if(x){Array.prototype.push.apply(x,q);}else{dojo.global.$appContext$.set("userHasProdOfferMetaInfoList"+(o.uniqueId||""),q);
}var g=a.ProdOfferHelper.getMainProdOffer(q)[0];var j={newMainProdOfferInfo:f,addProdOfferCartData:l,userHasProdOfferInfoList:v,userHasProdOfferMetaInfoList:q},B=a.ProdOfferInstProvider.getKeepOrCancelProdOfferDataByPPM(j);
var D={keepProdOfferInstList:B.keepProdOfferInstList,cancelProdOfferInstList:B.cancelProdOfferInstList,mainProdOfferInst:dojo.filter(v,function(E){return E.prodOfferId==g.prodOfferId;})[0]};o.showChgOrderedProdOffer(D);
var s=dojo.query("TR[uniqueId="+r+"]")[0];var w=dojo.attr(s,"serviceKind");var C=dojo.attr(s,"serviceKindIndex");var m=dojo.attr(s,"serviceId");var z=dojo.filter(l,function(E){return dojo.some(B.keepProdOfferInstList,function(F){if(E.showData.chooseNumberObj!=null){return E.subProdOfferInfo.prodOfferId==F.prodOfferId&&E.showData.chooseNumberObj.serviceKind==w&&E.showData.chooseNumberObj.serviceKindIndex==C;
}else{return E.subProdOfferInfo.prodOfferId==F.prodOfferId;}});});var i=dojo.filter(l||[],function(F){var E=dojo.some(z||[],function(G){return G.subProdOfferInfo.prodOfferId==F.subProdOfferInfo.prodOfferId;
});if(E){return false;}else{return true;}});o.setInvalidProdOfferCartData(z);this.updataUseServiceId(w,C,m,o);this.updateAddReserveSubProdOffer(l,z,o);this.createResetSubProdOfferData(p,i,D,r);},createResetSubProdOfferData:function(f,e,g,i){var h=dojo.map(e||[],function(j){return j.subProdOfferInfo;
});if(f.bindType==2){dojo.global.$appContext$.set("leftProdOfferList"+i,h);dojo.global.$appContext$.set("keepProdOfferInstList"+i,g.keepProdOfferInstList);dojo.global.$appContext$.set("cancelProdOfferInstList"+i,g.cancelProdOfferInstList);
dojo.global.$appContext$.set("mainProdOfferInstVO"+i,g.mainProdOfferInst);}else{dojo.global.$appContext$.set("leftProdOfferList",h);dojo.global.$appContext$.set("keepProdOfferInstList",g.keepProdOfferInstList);
dojo.global.$appContext$.set("cancelProdOfferInstList",g.cancelProdOfferInstList);dojo.global.$appContext$.set("mainProdOfferInstVO",g.mainProdOfferInst);}},updataUseServiceId:function(k,j,l,e){var i=this;
var f=e.subProdOfferOrderGrid.domNode;var h=e.getSubGridBindingData();var g=dojo.filter(h,function(m){return m.showData.prodOfferStyle=="prod-offer-add";});dojo.forEach(g,function(n){var m=n.showData.chooseNumberObj;
var o=n.rowIndex;if(m!=null&&m.serviceKind==k&&m.serviceKindIndex==j){n.showData.chooseNumberObj.serviceId=l;dojo.query(".choose_number_class_"+o,f)[0].childNodes[0].innerText=l;}});},updateAddReserveSubProdOffer:function(h,j,g){var f=g.subProdOfferOrderGrid.domNode;
var e=dojo.filter(h||[],function(k){return !dojo.some(j||[],function(l){return k.rowIndex==l.rowIndex;});});var i=null;if(e.length>0){i=this.getNewOfferStardardDate(g);}dojo.forEach(e||[],function(n){var q=n.showData.rowIndex;
var k=n.showData.viewId;var o=dojo.query(".subProdOfferDetail-"+q,f)[0];var p=dojo.query(".subProdOfferStartDate-"+q,f)[0];var m=dojo.query(".productStartDateStyle",p)[0];var l=dojo.query(".subProdOfferEndDate-"+q,f)[0];
if(n.prodOfferInst==null){if(m){m.style.display="none";}dojo.query(".start_date_class",p)[0].innerHTML=a.DateHelper.formatDate(a.DateHelper.getFirstDayAfterPeriod());if(i!=null){dojo.query(".start_date_class",p)[0].innerHTML=i;
}}});},getNewOfferStardardDate:function(f){var h=f.uniqueId;var e=$ac$.get("selectedMemberProdOfferList");var g=null;if(h!=""){g=BusCard.find(e||[],function(i){return i.uniqueId==h;});}else{g=e[0];}if($ac$.get("offerStandardStartDate_"+g.prodOfferInstId)){return $ac$.get("offerStandardStartDate_"+g.prodOfferInstId).beginDate;
}return null;}});});
defineModule("orderaccept.prodofferaccept.widget.messagetips.ProdOfferInfoTipsWidget",["orderaccept.custom.TooltipDialog"],function(a){dojo.declare("orderaccept.prodofferaccept.widget.messagetips.ProdOfferInfoTipsWidget",[a],{constructor:function(){this.inherited(arguments);
},postscript:function(){this.inherited(arguments);var b="<div class='buscard-root' style='display:block;width:300px'>										 <div class='buscard-legend'>											<span class='buscard-legend-img'></span>											<span class='buscard-legend-text' id='prodoffer-name'></span>										 </div>										 <div class='buscard-content'>										 	<div class='buscard-row' id='prodoffer-desc'>											</div>											<div class='buscard-effDate'>生效时间:												<span id='prodoffer-effDate'></span>											</div>											<div class='buscard-expDate'>失效时间:												<span id='prodoffer-expDate'></span>											</div>										</div>";
dojo.place(b,this.containerNode,"last");}});});
defineModule("orderaccept.prodofferaccept.widget.messagetips.WarmTipsWidget",["orderaccept.custom.TooltipDialog"],function(a){dojo.declare("orderaccept.prodofferaccept.widget.messagetips.WarmTipsWidget",[a],{constructor:function(){this.inherited(arguments);
},postscript:function(){this.inherited(arguments);var b="<div class='buscard-root' style='display:block;width:220px'>										 <div class='buscard-legend'>											<span class='buscard-legend-img'></span>											<span class='buscard-legend-text' id='prodoffer-name'>温馨提示</span>										 </div>										 <div class='buscard-content'>										</div>									  </div>";
dojo.place(b,this.containerNode,"first");}});});
defineModule("orderaccept.prodofferaccept.widget.memberprodoffer.MemberProdOfferPickWidget",["orderaccept.custom._BaseWidget","orderaccept.custom._BusCardTemplated","orderaccept.prodofferaccept.util","orderaccept.common.js.ConstantsPool"],function(d,c,a,b){dojo.declare("orderaccept.prodofferaccept.widget.memberprodoffer.MemberProdOfferPickWidget",[d,c],{templatePath:dojo.moduleUrl("orderaccept.prodofferaccept","widget/memberprodoffer/template/memberProdOfferTpl.html"),acceptProdOfferInfoVO:null,prodOfferInfoVO:null,constructor:function(){},postMixInProperties:function(){loadCssModule("orderaccept.prodofferaccept.widget.memberprodoffer.resources.css.member-prodoffer");
this.prodOfferInfoVO=$ac$.get("independenceProdOfferInfoVO");$ac$.set("independenceProdOfferInfoVO",null);this.acceptProdOfferInfoVO=this.buildViewInitData();},postCreate:function(){this.inherited(arguments);
var e=dojo.query(".memeber-prodoffer-select",this.domNode);dojo.forEach(e,function(l){var m=dojo.attr(l,"prodOfferInstId");if(m){var i=a.DomHelper.findParentNode(l,function(n){return n.tagName.toUpperCase()=="TR";
}),g=($ac$.query("$.userHasProdOfferInfoList[?(@.prodOfferInstId=="+m+")]"))[0],h=dojo.query(".member-product-checkbox",i)[0];dojo.attr(h,{disabled:true,checked:true});var k=l.options,f=k.length;for(var j=0;
j<f;j++){if(k[j].value==g.prodOfferId){l.value=g.prodOfferId;break;}}}});this.updateOperStatus();},updateOperStatus:function(){var e=dojo.query(".member-product-tr",this.domNode);dojo.forEach(e,function(h){var f=dojo.attr(h,"enterComb");
if(f){var g=dojo.query(".member-offer-keep",h)[0];g.innerHTML="变组合";}});},buildViewInitData:function(){var f=$ac$.get("requestParam").actionCD,e=a.ACTION_CD_CONST;switch(f){case e.PRODUCT_INSTALL:return this.onProductInstall();
break;case e.PRODUCT_CHANGE_MAIN:return this.onProductChangeMain();break;case e.PRODUCT_CHANGE:return this.onProductChange();break;case e.MEMBER_OFFER_CHANGE:return this.onProductChange();break;}},onProductInstall:function(){return dojo.clone(this.prodOfferInfoVO);
},onProductChangeMain:function(){return this[$ac$.get("processId")]();},single2independence:function(){var h=this.constructClonedProdOfferInfoVO(this.prodOfferInfoVO),i=this,k=$ac$.get("requestParam").prodOfferInstId,f=$ac$.query("$.userHasProdOfferInfoList[?(@.prodOfferInstId=="+k+")]")[0],g=$ac$.query("$.userHasProdOfferMetaInfoList[?(@.prodOfferId=="+f.prodOfferId+")]")[0],l=BusCard.jsonPath(f,"$.prodInstList[?(@.serviceRelationVO!=null)].productId"),e=this.filterNotOrderedOfferProdRelaList(l),j=this.filterOrderdOfferRelaList(l);
dojo.forEach(j,function(n){var m=n.productInfoVO.productId;n.offerInstVO=f;n.ifDefault=1;n.enterComb="1";n.prodOfferInstId=f.prodOfferInstId;n.memberStatus=i.buildMemberStatus(f,g);});h.offerProdRelaList=[].concat(j).concat(e);
return h;},constructClonedProdOfferInfoVO:function(f){var g={};for(var e in f){if(!(dojo.isArray(f[e])||dojo.isObject(f[e]))){g[e]=f[e];}}return g;},buildMemberStatus:function(e,f){var g=BusCard.jsonPath(f,"$.relatedOfferList[?(@.prodOfferId=="+e.prodOfferId+")]")[0];
var h="";if(g){h="已有/"+g.prodOfferName+"/"+e.prodInstList[0].accNbr;}else{h="已有/"+f.prodOfferName+"/"+e.prodInstList[0].accNbr;}return h;},filterNotOrderedOfferProdRelaList:function(f){var e=this;return dojo.filter(e.prodOfferInfoVO.offerProdRelaList,function(g){return dojo.every(f,function(h){return h!=g.productInfoVO.productId;
});});},filterOrderdOfferRelaList:function(f){var e=this;return dojo.clone(dojo.filter(e.prodOfferInfoVO.offerProdRelaList,function(g){return dojo.some(f,function(h){return h==g.productInfoVO.productId;
});}));},onProductChange:function(){var j=this.constructClonedProdOfferInfoVO(this.prodOfferInfoVO);var k=this,f=$ac$.get("userHasProdOfferInfoList"),s=$ac$.get("prodOfferList"),h=$ac$.get("requestParam"),e=h.prodOfferInstId,i=b.load("ItemRelationTypeConst").ItemRelationTypeConst.OFFER_COMB_MEMBER,m=$ac$.query("$.userHasProdOfferInfoList[?(@.prodOfferInstId=="+e+")]")[0],l=BusCard.jsonPath(m,"$.offerInstRelaList[?(@.relationTypeCd=="+i+")].relatedProdOfferInstId"),q="$.userHasProdOfferInfoList[?("+dojo.map(l,function(u){return" @.prodOfferInstId=="+u+"||";
}).join("")+"false)]",r=$ac$.query(q),t=function(u){return dojo.filter(k.prodOfferInfoVO.offerProdRelaList,function(v){return v.productId==u;})[0];},o=function(u){return dojo.filter(r,function(v){return v.prodInstList[0].productId==u;
});},n=dojo.map(r,function(w){var v=w.prodInstList[0],u=dojo.clone(t(v.productId));u.offerInstVO=w;u.prodOfferInstId=w.prodOfferInstId;u.memberStatus=k.buildMemberStatus(w,u);u.ifDefault=1;return u;}),g=dojo.filter(k.prodOfferInfoVO.offerProdRelaList,function(u){return !o(u.productId);
}),p=[].concat(n,g);j.offerProdRelaList=p;return j;}});});
defineModule("orderaccept.prodofferaccept.widget.payrelation.PayRelationWidget",["dijit._Widget","dijit._Templated","orderaccept.prodofferaccept.util","orderaccept.custom.Grid","orderaccept.common.dialog.MessageBox","unieap.dialog.DialogUtil","orderaccept.common.js.ConstantsPool"],function(g,f,c,b,e,d,a){dojo.declare("orderaccept.prodofferaccept.widget.payrelation.PayRelationWidget",[g,f],{templatePath:dojo.moduleUrl("orderaccept.prodofferaccept.widget.payrelation","template/PayRelationTemplate.html"),widgetsInTemplate:true,serviceInfoList:null,accountRelationIndex:0,showMainInfoFlag:false,widgetPane:null,parameters:null,custInfo:null,accountInfoList:[],serviceInfoListDatastore:null,loader:null,payRelationInfoList:null,oldPayRelationQueryingFlag:false,oldPayRelationDatastore:null,ifCanUse:null,constructor:function(h){if(h){this.custInfo=h.custInfo;
this.loader=h.loader;this.widgetPane=h.widgetPane;}},postMixInProperties:function(){unieap.getTopWin=function(){return window;};var h=this;unieap.Action.requestData({url:unieap.WEB_APP_NAME+"/payRelationAction.do?method=init&custId="+this.custInfo.custId,parameters:{synLoadStatistics:true},sync:true,load:function(j){for(var k in j.getDataStores()){dataCenter.addDataStore(j.getDataStores()[k]);
}h.parameters=j.parameters;}});dataCenter.addDataStore(new unieap.ds.DataStore("accountQueryProductIdColl",[{CODEVALUE:"",CODENAME:"请输入号码后选择"}]));dataCenter.addDataStore(new unieap.ds.DataStore("customerAcountQueryColl",[{CODEVALUE:"1",CODENAME:"客户资料"},{CODEVALUE:"2",CODENAME:"服务号码"}]));
this.serviceInfoListDatastore=new unieap.ds.DataStore("serviceInfoListDatastore",[]);dataCenter.addDataStore(this.serviceInfoListDatastore);this.allServiceInfoListDatastore=new unieap.ds.DataStore("allServiceInfoListDatastore",[]);
dataCenter.addDataStore(this.allServiceInfoListDatastore);var i=new unieap.ds.DataStore("accountInfoListDatastore",[]);dataCenter.addDataStore(i);if(this.ifShowOperate()){dojo.connect(i.getRowSet(),"onAfterAddRow",orderaccept.prodofferaccept.widget.payrelation.PayRelationWidget.refreshGridAccountInfoAfterAddRow);
}},initFLag:false,isNeedInit:function(){if(!this.initFlag){this.initFlag=true;return true;}else{return false;}},initNewAccountForm:function(j){var k={accoWay:"4-0",accountFee:"0.00",ifDefault:"1",operKind:"1",accountName:this.custInfo.custName};
if(this.parameters&&this.parameters.defaultAccountCount>0){k.ifDefault="2";unieap.byId("ifDefault").setDisabled(true);}else{for(var i in this.accountInfoList){if(i.ifDefault=="1"){k.ifDefault="2";unieap.byId("ifDefault").setDisabled(true);
break;}}}unieap.byId("creditControl").setDisabled(true);unieap.byId("creditControl").setValue(1);var h=new unieap.ds.DataStore("newAccountDatastore",[k]);j.getBinding().bind(h.getRowSet().getRow(0));},setNewAccountId:function(){unieap.byId("accountId").setValue(this.getAccountId());
},initNewAccountInfo:function(h){if(!this.accountInfoList){this.accountInfoList=[];}var i=this.getNewAccountInfoFormData(h);this.accountInfoList.push(i);return i;},getNewAccountInfoFormData:function(h){var i=null;
if(h){i=h;}else{i=this.getNewAccountForm();}i.getHelper().apply();return accountInfo=h.getHelper().collectData();},postCreate:function(){var h=this.getNewAccountForm();if(h){this.initNewAccountForm(h);
this.initServiceInfoList();this.hideInheritAccountPane();this.query(".showNewAccountTab").onclick=function(j){return function(){j.hideInheritAccountPane();};}(this);this.queryById(".showInheritAccountTab").onclick=function(j){return function(){if(j.checkIfOcs()==true){e.alert({busiCode:"08410206"},j.queryById(".showInheritAccountTab"));
return false;}j.hideNewAccountPane();};}(this);}this.initAccountInfoGroup();this.initServiceInfoGroup();if(h){var i=this;dojo.subscribe("/buscard/serviceId/change",function(k){if(k.srcElement.value){if(i.loader){var j=i.loader.getNewServiceInfoList(true);
i.refreshServiceInfo(j);i.openWidgetPane();}}});dojo.subscribe("/buscard/serviceId/propertychange",function(k){if(k.srcElement.value){if(i.loader){var j=i.loader.getNewServiceInfoList(true);i.refreshServiceInfo(j);
i.openWidgetPane();}}});}},queryAccountInfo:function(i,h){this.getInheritAccountListPane().setHref(unieap.WEB_APP_NAME+"/payRelationAction.do?method=getAccountInfoList&customerId="+i+"&cityCode="+h);},checkIfOcs:function(){var j=$ac$.get("selectedMainProdOfferInfoVO");
var h=ConstantsPool.load("PaymentModeConst").PaymentModeConst;var i=false;if(!!j&&j.feeType==h.PREPAID){i=true;}return i;},hideNewAccountPane:function(){if(this.parameters&&this.parameters.accountCount>0){if(!this.getInheritAccountListPane().href){this.queryAccountInfo(this.custInfo.custId,this.custInfo.cityCode);
}}this.query(".showNewAccountTab").className="showNewAccountTab test";this.query(".showInheritAccountTab").className="showInheritAccountTab selected-header";unieap.byId("customerAcountQueryFlag").setValue(1);
this.getInheritAccountPane().show();this.getNewAccountPane().hide();},getNewAccountPane:function(){return this.newAccountPane=this.newAccountPane||unieap.byId("newAccountPane");},getInheritAccountPane:function(){return this.inheriteAccountPane=this.inheriteAccountPane||unieap.byId("inheritAccountPane");
},getInheritAccountListPane:function(){return this.inheriteAccountListPane=this.inheriteAccountListPane||unieap.byId("inheritAccountListPane");},hideInheritAccountPane:function(){this.query(".showNewAccountTab").className="showNewAccountTab selected-header";
this.query(".showInheritAccountTab").className="showInheritAccountTab test";this.getNewAccountPane().show();this.getInheritAccountPane().hide();},queryCustAccountInfo:function(){var m=unieap.byId("customerAcountQueryFlag");
switch(m.getValue()){case"1":var h=unieap.byId("firstNameQuery").getValue();var o=unieap.byId("identityKindQuery").getValue();var k=unieap.byId("identityCodeQuery").getValue();if(!h&&!k){e.alert({busiCode:"08410231"});
return;}var j=unieap.WEB_APP_NAME+"/customerAcceptAction.do?method=getCustomerInfoList&custIdQuery=&firstNameQuery="+h+"&identityKindQuery="+o+"&identityCodeQuery="+k+"&cityCode="+unieap.byId("queryAccountCustomerCityCode").getValue();
j+="&operFlag=newInheritAccount";var l=this;DialogUtil.showDialog({url:j,title:"查询客户信息",height:700,width:1000,dialogData:null,onComplete:function(p){if(p){l.queryAccountInfo(p.customerId,p.cityCode);}},iconCloseComplete:true});
break;case"2":var n=unieap.byId("accountQueryServiceId");var i=unieap.byId("accountQueryProductId");if(!n.getValue()){e.alert({busiCode:"08410005"});n.focus();return;}this.getInheritAccountListPane().setHref(unieap.WEB_APP_NAME+"/payRelationAction.do?method=getAccountInfoList&queryFlag=2&phoneNumber="+n.getValue()+"&productId="+i.getValue()+"&cityCode="+unieap.byId("queryAccountServiceCityCode").getValue());
this.clearQueryAccountInfo();break;default:e.alert({busiCode:"08410006"});break;}},clearQueryAccountInfo:function(){var i=dojo.query("#listAccountId")[0];if(i){i.value="";}var h=dojo.query("#listAccountName")[0];
if(h){h.value="";}},customerAcountQueryFlagChange:function(h){if(h.getValue){h=h.getValue();}switch(h){case"1":dojo.query("#custQueryFlag")[0].style.display="";dojo.query("#serviceIdQueryFlag")[0].style.display="none";
break;case"2":dojo.query("#custQueryFlag")[0].style.display="none";dojo.query("#serviceIdQueryFlag")[0].style.display="";break;default:e.alert({busiCode:"08410007"});return false;break;}},getNewAccountInfoData:function(){var i=this.getNewAccountForm();
if(!i.validate(true)){return false;}var h=this.accountInfoList;var j=this.getNewAccountInfoFormData(i);this.setNewAccountId();var j=this.initNewAccountInfo(i);return j;},getCheckedServiceListIndex:function(){var i=this.serviceInfoList;
if(i&&i.length>0){var j=[];for(var k=i.length,h=0;h<k;h++){j.push(i[h].serviceInfoIndex);}return j;}else{e.alert({busiCode:"08410001"});return false;}},getCheckedAccountListIndex:function(){var j=this.getAccountInfoCheckBoxGroup();
var h=j.getValue();if(h){var i=h.split(",");return i;}else{return false;}},createPayRelation:function(p,r){var h=this.getPayRelationGrid();var l=h.getBinding();for(var i=this.allServiceInfoList.length,o=0;
o<i;o++){var j=this.allServiceInfoList[o];if(j.serviceOfferId==301){var n=l.getRowCount();var q=this.payrelationDefaultChecked(l,j.serviceInfoIndex)?0:1;var k={serviceInfoIndex:o,serviceId:j.serviceId,productId:j.productId,operateKind:1,acctItemTypeGroupId:0,paymentLimitType:0,paymentLimit:0,priority:((q==1)?999:1),ifDefaultAcctId:q};
var m=this.getCheckedAccountListIndex();if(m){k.accountId=m[m.length-1];}l.insertRow(k,n);}}},payrelationDefaultChecked:function(k,j){var i=k.getRowSet().getData();for(var h=0,l=i.length;h<l;h++){if(i[h].ifDefaultAcctId==1&&j==i[h].serviceInfoIndex){return true;
}}return false;},addNewAccount:function(){var h=this.getCheckedServiceListIndex();if(!h){return false;}var i=this.getNewAccountInfoData();if(i){this.addAccountInfoList(i);return i;}else{return false;}},addInherateAccount:function(l){var h=this.getCheckedServiceListIndex();
if(!h){return false;}var m=l;m.operKind=2;if(!m.accountId){e.alert({busiCode:"08410002"});return false;}var k=false;for(var i=0,j=this.accountInfoList.length;i<j;i++){if(this.accountInfoList[i].accountId==m.accountId){m=this.accountInfoList[i];
k=true;break;}}if(!k){this.accountInfoList.push(m);this.addAccountInfoList(m);this.createPayRelation(this.getCheckedServiceListIndex(),m);}return m;},hasAccountInfo:function(k){var j=false;for(var h=0,i=this.accountInfoList.length;
h<i;h++){if(this.accountInfoList[h].accountId==k.accountId){j=true;break;}}return j;},addAccountInfoList:function(n){if(!this.accountInfoList){this.accountInfoList=[];}this.initAccountInfoGroup(n);var j=this.getAccountInfoCheckBoxGroup();
var p=j.getChildren();dojo.map(p||[],function(q){q.setChecked(true);q.setDisabled(true);});var m=false;var h=this.getPayRelationGrid();var o=h.getBinding().getRowSet().getData();this.payRelationInfoList=o;
for(var l=0,i=o.length;l<i;l++){var k=o[l];if(!k.accountId){k.accountId=n.accountId;m=true;}}if(m){h.getManager("ViewManager").refresh();}},ifShowOperate:function(){return true;},initAccountInfoGroup:function(o){var m=this;
var l=this.getAccountInfoCheckBoxGroup();var h=dataCenter.getDataStore("accountInfoListDatastore");var i=h.getRowSet();if(m&&m.accountInfoList){h.getRowSet().deleteAllRows();for(var n=0,j=m.accountInfoList.length;
n<j;n++){var o=m.accountInfoList[n];i.addRow({CODEVALUE:o.accountId,CODENAME:(o.accountName+"("+(o.accountId)+")["+(o.operKind==1?"新建":"继承")+"]"),operKind:o.operKind,_s:true});}}else{h.getRowSet().deleteAllRows();
h.getRowSet().addRow({CODEVALUE:null,CODENAME:"无账户信息，请点击确定按钮添加账户",_s:true});}var k=h.clone();dojo.connect(k.getRowSet(),"onAfterDeleteRow",orderaccept.prodofferaccept.widget.payrelation.PayRelationWidget.refreshAccountGroup);
dojo.map(k.getRowSet().getData()||[],function(r,s){var q=[];if(m.ifShowOperate()&&(r.CODEVALUE&&r.operKind==1)){q.push("<img style='cursor:hand;' src='");q.push(unieap.WEB_APP_NAME+"/common/images/button/delete_button.png' ");
q.push("onclick=\"orderaccept.prodofferaccept.widget.payrelation.PayRelationWidget.deleteAccountGroup(event,'");q.push(r.CODEVALUE?r.CODEVALUE:"");q.push("','"+s+"')\" />");}q.push("<A accountId='"+r.CODEVALUE);
q.push("'  onmouseover='orderaccept.prodofferaccept.widget.payrelation.PayRelationWidget.showAccountInfo(this);'");q.push("'  onmouseout='orderaccept.prodofferaccept.widget.payrelation.PayRelationWidget.hideAccountInfo(this);'>");
q.push(r.CODENAME+"</A>");r.CODENAME=q.join("");});l.getDataProvider().setDataStore(k);var p=l.getChildren();dojo.map(p||[],function(q){q.setChecked(true);q.setDisabled(true);q.setDisplay("none");});},initServiceInfoGroup:function(){if(this.allServiceInfoList){var h=this.allServiceInfoList.length;
var n=this.allServiceInfoList;var j=[];if(h>0){for(var k=0;k<h;k++){var i="";var m=n[k];if(m.serviceOfferId==301){i="[新增]";}else{i="[已有]";}j.push({CODEVALUE:k,CODENAME:m.serviceId+" "+m.productName+i,serviceId:m.serviceId,productId:m.productId,_s:true});
}}else{j.push({CODEVALUE:null,CODENAME:"无号码信息",_s:true});}var o=new unieap.ds.DataStore("serviceInfoGroupDatastore",j);var l=this.getServiceInfoCheckBoxGroup();l.getDataProvider().setDataStore(o);var p=l.getChildren();
dojo.map(p||[],function(q){q.setChecked(true);q.setDisabled(true);q.setDisplay("none");});}},addInheritAccountPayRelation:function(){var h=this.addInherateAccount();if(h){this.createPayRelation(this.getCheckedServiceListIndex(),h);
}},clearPayRelation:function(){var i=this.getPayRelationGrid();var h=i.getBinding();h.clear();},getPayRelationGrid:function(){var h=(this.payRelationGrid=this.payRelationGrid||orderaccept.prodofferaccept.widget.payrelation.PayRelationWidget.getPayRelationGrid());
h.parentWidget=this;return h;},getServiceInfoCheckBoxGroup:function(){return this.serviceInfoCheckBoxGroup=this.serviceInfoCheckBoxGroup||unieap.byId("serviceInfoCheckBoxGroup");},getAccountInfoCheckBoxGroup:function(){return this.accountInfoCheckBoxGroup=this.accountInfoCheckBoxGroup||unieap.byId("accountInfoCheckBoxGroup");
},getDefaultProdInstId:function(){return this.defaultProdInstId=this.defaultProdInstId||unieap.byId("defaultProdInstId");},getAccountTel:function(){return this.accountTel=this.accountTel||unieap.byId("accountTel");
},getNewAccountForm:function(){return this.newAccountForm=this.newAccountForm||unieap.byId("newAccountForm");},getPayRelationGridViewManager:function(){return this.payRelationGridViewManager=this.payRelationGridViewManager||this.getPayRelationGrid().getManager("ViewManager");
},showMainInfo:function(){if(!this.showMainInfoFlag){this.hideDiv("payRelationMainDiv");this.showDiv("payRelationPromptDiv");}else{this.showDiv("payRelationMainDiv");this.hideDiv("payRelationPromptDiv");
}},initServiceInfoList:function(){this.showMainInfo();if(this.serviceInfoList.length<=0){return;}this.initAccountInfoGroup(this.accountInfoList[0]);this.initServiceInfoGroup();this.refreshAccountTelList();
this.refreshServiceInfoList();if(this.ifShowOperate()){var h=this.getCheckedServiceListIndex();orderaccept.prodofferaccept.widget.payrelation.PayRelationWidget.refreshGridAccountInfo();if(h){this.createPayRelation(h);
}}},refreshServiceInfoList:function(){this.serviceInfoListDatastore.getRowSet().reset();this.allServiceInfoListDatastore.getRowSet().reset();for(var j=0,l=this.serviceInfoList.length;j<l;j++){if(this.needStoreMoneyProduct(this.serviceInfoList[j].productId)){var m={};
m.CODEVALUE=j;m.CODENAME=this.serviceInfoList[j].serviceId+" "+this.serviceInfoList[j].productName;this.serviceInfoListDatastore.getRowSet().addRow(m);}}for(var j=0,l=this.allServiceInfoList.length;j<l;
j++){var m={};m.CODEVALUE=j;m.CODENAME=this.allServiceInfoList[j].serviceId+" "+this.allServiceInfoList[j].productName;this.allServiceInfoListDatastore.getRowSet().addRow(m);}var h=this.getDefaultProdInstId();
if(h){h.getDataProvider().setDataStore(this.serviceInfoListDatastore);h.setSelectedIndex([0]);for(var k=0,l=this.serviceInfoList.length;k<l;k++){if(this.serviceInfoList[k].netType==8||this.serviceInfoList[k].netType==10){h.setSelectedIndex([k]);
break;}}}unieap.transcode.clear("allServiceInfoListDatastore");unieap.byId("payRelationGrid").getManager("ViewManager").refresh();},getDefaultServiceId:function(h){return this.serviceInfoList[h].serviceId;
},getDefaultProductId:function(h){return this.serviceInfoList[h].productId;},refreshServiceInfo:function(i){this.showMainInfo();this.generateServiceInfoList(i);if(!this.accountInfoList||this.accountInfoList.length==0){this.setNewAccountId();
this.initNewAccountInfo(this.getNewAccountForm());}this.clearPayRelation();this.initServiceInfoList();if(this.oldPayRelationDatastore){if((this.serviceInfoList.length>0)){var n=this.getPayRelationGrid();
var k=n.getBinding();var m=this.oldPayRelationDatastore.getRowSet().getData();for(var l=m.length,h=0;h<l;h++){var j=this.getServiceInfoIndexByServiceId(m[h]);if(j!==null){m[h].serviceInfoIndex=j;k.getDataStore().getRowSet().addRow(m[h]);
}}}}},showDiv:function(i){var h=dojo.byId(i);if(null!=h){h.style.display="";}},hideDiv:function(i){var h=dojo.byId(i);if(null!=h){h.style.display="none";}},getServiceInfoIndexByServiceId:function(h){var k=this.allServiceInfoList;
if(k&&k.length>0&&h){for(var j=k.length,i=0;i<j;i++){var l=k[i];if((l.serviceId==h.serviceId)&&(h.productId==l.productId)){return i;}}}return null;},generateServiceInfoList:function(i){var k=[];var l=[];
for(var h=0,j=i.length;h<j;h++){if(i[h].serviceOfferId&&i[h].serviceOfferId==301){k.push(i[h]);}else{l.push(i[h]);}}for(var h=0,j=k.length;h<j;h++){k[h].serviceInfoIndex=h;}this.serviceInfoList=k;if(k.length>0){this.showMainInfoFlag=true;
}else{this.showMainInfoFlag=false;}this.allServiceInfoList=i;this.queryExistsPayRelationInfo();},queryExistsPayRelationInfo:function(){if(!this.showMainInfoFlag||this.oldPayRelationQueryingFlag){return;
}this.oldPayRelationQueryingFlag=true;var n=this;var j=BusCard.jsonPath($ac$.get("userHasProdOfferInfoList"),"$[*].prodInstList[?(@.prodFuncType==101)]");if(j&&j.length>0){var h=new unieap.ds.DataCenter();
var m=new unieap.ds.DataStore("oldServiceInfoList");var o=m.getRowSet();for(var k=j.length,i=0;i<k;i++){var l={};l.accNbr=j[i].accNbr;l.prodInstId=j[i].prodInstId;l.cityCode=j[i].cityCode;l.productId=j[i].productId;
o.addRow(l);}h.addDataStore("oldServiceInfoList",m);unieap.Action.requestData({url:unieap.WEB_APP_NAME+"/payRelationAction.do?method=getExistsPayRelationInfo",parameters:{synLoadStatistics:true},sync:true,load:function(p){n.oldPayRelationDatastore=dataCenter.getDataStore("existsPayRelationList");
var u=dataCenter.getDataStore("existsAccountInfoList");if(u){var r=u.getRowSet().getData();for(var s=r.length,q=0;q<s;q++){var t=r[q];if(!n.hasAccountInfo(t)){t.operKind=2;n.accountInfoList.push(t);}}}}},h);
}},needStoreMoneyProduct:function(i){if(i){var h=function(j){return !!(BusCard.jsonPath($ac$.selectedMainProdOfferInfoVO.offerProdRelaList,"$[*].combProductId")||[]).find(function(k){return k==j;});}(i);
if(h){return false;}else{return true;}}else{return false;}},refreshAccountTelList:function(){var j=[];for(var i=0,k=this.serviceInfoList.length;i<k;i++){if(this.needStoreMoneyProduct(this.serviceInfoList[i].productId)){var h={};
h.CODEVALUE=this.serviceInfoList[i].serviceId;h.CODENAME=this.serviceInfoList[i].serviceId;j.push(h);}}var h=this.getAccountTel();if(h){h.getDataProvider().setDataStore(new unieap.ds.DataStore("accountTelColl",j));
h.setSelectedIndex([0]);}},refreshCurrenAccountInfo:function(){var j=this.getNewAccountForm();j.getHelper().apply();var i=j.getHelper().collectData();if(this.accountInfoList&&this.accountInfoList.length>0){for(var h=0,k=this.accountInfoList.length;
h<k;h++){if(this.accountInfoList[h].accountId==i.accountId){if(!j.validate(true)){return false;}this.accountInfoList[h]=i;return i;}}}},openWidgetPane:function(){if(this.widgetPane){if(!this.widgetPane.open){this.widgetPane.toggle();
}}},getData:function(){this.openWidgetPane();if(this.serviceInfoList.length<=0){return{};}if(false===this.refreshCurrenAccountInfo()){return false;}var r=[];var h=this.getPayRelationGrid();var l=[];var q=h.getBinding();
if(!q.validate(true)){return false;}for(var o=0,i=this.accountInfoList.length;o<i;o++){var u=this.accountInfoList[o];if(u.operKind==1){l.push(u);u.defaultServiceId=this.getDefaultServiceId(u.defaultProdInstId);
u.defaultProductId=this.getDefaultProductId(u.defaultProdInstId);}}var n=[];var t=h.getBinding().getRowSet().getData();this.payRelationInfoList=t;for(var o=0,i=t.length;o<i;o++){var m=t[o];if(m.operateKind==1){n.push(m);
}else{continue;}var p=this.allServiceInfoList[m.serviceInfoIndex];m.serviceId=p.serviceId;m.productId=p.productId;for(var j=l.length-1;j>=0;j--){var s=l[j];if(s&&(s.accountId==m.accountId)){r.push(s);l[j]=null;
break;}}}var k={accountInfo:r,payRelationInfo:n};if(!this.doCheck(k)){return false;}return k;},doCheckAccountTel:function(o,j){if(o){for(var m=0,i=o.length;m<i;m++){var l=o[m];var p=false;if(l.accountTel){if(j){for(var n=0,h=j.length;
n<h;n++){var k=j[n];if((k.serviceId==l.accountTel)&&(k.accountId==l.accountId)&&(1==k.ifDefaultAcctId)){p=true;break;}}}if(!p){e.alert({busiCode:"08410222",infoList:[l.accountName+"("+l.accountId+")",l.accountTel]});
return false;}}}}return true;},doCheck:function(l){if(!this.doCheckAccountTel(l.accountInfo,l.payRelationInfo)){return false;}var h=[];var k=[];for(var j=0,m=this.payRelationInfoList.length;j<m;j++){if(this.payRelationInfoList[j].ifDefaultAcctId==1){k.push(this.payRelationInfoList[j].serviceInfoIndex);
}}h=dojo.filter(this.allServiceInfoList,function(r,o){var n=true;if(r.operKind!=1){return false;}for(var p=0,q=k.length;p<q;p++){if(o==k[p]){n=false;}}return n;});if(h.length>0){var i="";dojo.map(h,function(o,n){i+=o.serviceId;
if(n<h.length-1){i+=",";}});e.alert({busiCode:"08410004",infoList:[i]});return false;}return true;},getAccountId:function(){var h=this.getAjaxInfoWithParamString("prodOfferSaleAjaxAction","getId","&idName=accountId");
return h.message;},getAjaxInfoWithParamString:function(i,j,m){var k=new Date();var l="method="+j+m+"&timestamp="+k;var h=c.ServiceFactory.getService("url:"+i+".do?"+l,null,{method:"post"});return h;},accountAreaGradeChange:function(j){var i=unieap.byId("accountAreaGrade");
if(!j){i.setSelectedIndex([0]);}j=i.getValue();var h=this.queryById("payMethodName");if(j!="12"){if(h){h.style.display="";}}else{if(h){h.style.display="none";}}},accoWayChange:function(i){var k=unieap.byId("accoWay");
if(!i){k.setSelectedIndex([0]);}i=k.getValue();var j=this.queryById("bankInfo1");var h=this.queryById("bankInfo2");if(i.split("-")[1]==1){this.getObject("accountFee").setValue(0);this.getObject("accountFee").setDisabled(true);
if(j){j.style.display="";this.getObject("nkId").setRequired(true);}if(h){h.style.display="";this.nkIdChange(this.getObject("nkId").getValue());this.getObject("nkAccount").setRequired(true);this.getObject("nkCharge").setRequired(true);
}}else{this.getObject("accountFee").setDisabled(false);if(j){j.style.display="none";this.getObject("nkId").setRequired(false);this.getObject("nkId").setValue("");this.getObject("nkAccount").setValue("");
this.getObject("countName").setValue("");this.getObject("belongCodeBC").setValue("");}if(h){h.style.display="none";this.getObject("nkAccount").setRequired(false);this.getObject("nkAccount").setValue("");
this.getObject("nkCharge").setRequired(false);this.getObject("nkCharge").setValue("");this.getObject("reementNo").setValue("");}}},nkIdChange:function(i){var h=this.getObject("belongCodeBC");this.getBankChargeInfo(i,h.getValue());
},belongCodeBCChange:function(i){var h=this.getObject("nkId");this.getBankChargeInfo(h.getValue(),i);},getBankChargeInfo:function(j,l){var m="&BankChargeId=nkCharge&BankId="+(j?j:"")+"&belongCodeBC="+(l?l:"");
var i=this.getAjaxInfoWithParamString("payRelationAction","getBankChargeQuery",m);var k=new unieap.ds.DataStore("belongCodeBC",i);var h=this.getObject("nkCharge");h.getDataProvider().setDataStore(k);h.setSelectedIndex([0]);
},queryById:function(i){var h=dojo.query("#"+i,this.domNode);if(h||h.length>0){return h[0];}},query:function(i){var h=dojo.query(i,this.domNode);if(h||h.length>0){return h[0];}},getObject:function(h){return unieap.byId(h);
},testSubmit:function(){var h=this.getData();if(h){this.data=h;unieap.debug(this);}},accountQueryServiceIdChange:function(l){var j=unieap.byId("accountQueryServiceId");var k=unieap.byId("accountQueryProductId");
if(l==""||!j){return;}var i=this.getAjaxInfoWithParamString("payRelationAction","getProductList","&serviceId="+l+"&ifValid=1&cityCode="+unieap.byId("queryAccountServiceCityCode").getValue());var h=null;
if(i){h=new unieap.ds.DataStore("accountQueryProductIdColl",i);}else{e.alert({id:3,infoList:[l]});h=new unieap.ds.DataStore("accountQueryProductIdColl",[{CODEVALUE:"",CODENAME:"请输入号码后选择"}]);j.setValue("");
j.focus();}k.getDataProvider().setDataStore(h);k.setSelectedIndex([0]);},showPaymentFormat:function(k){var j=this.getObject("paymentLimit");var i=j.getDisplayFormatter();var h=j.getValidator();if(k=="1"){j.setDisabled(false);
j.setRequired(true);i.setFormat("##％");j.setValue(0);j.range.min=0;j.range.max=100;h.errorMsg="请正确输入百分百0-100";}else{if(k=="0"){i.setFormat("");j.setValue(0);j.setDisabled(true);j.setRequired(false);j.range.min=0;
j.range.max=Infinity;}else{i.setFormat("");j.setValue(0);j.setDisabled(false);j.setRequired(true);j.range.min=0;j.range.max=Infinity;h.errorMsg="请输入数字";}}},payRelationInfoOnfocus:function(){}});orderaccept.prodofferaccept.widget.payrelation.PayRelationWidget.ifDefaultFormatter=function(n,s){var l=this;
var m=l.editor.editorClass;var k=this.grid.getBinding().getRowSet();var q=l.editor.editorProps||(l.editor.editorProps={});var j={checkedValue:"1",uncheckedValue:"0"};l.radioProps=dojo.mixin(j,q);q.disabled=true;
l.serial="cell_"+unieap.getUnique();window[l.serial]=l;l.checkLogic=function(t,z){t=dojo.fixEvent(t);var w=this["radioProps"]["checkedValue"],y=this["radioProps"]["uncheckedValue"];var u=this.grid.getBinding().getRowSet();
for(var v=0,x=this.grid.getBinding().getRowCount();v<x;v++){if(t.srcElement.name&&t.srcElement.name==this.radionamePrefix+u.getItemValue(v,"serviceInfoIndex")){u.setItemValue(v,this.name,y);}}u.setItemValue(z,this.name,w);
this["radioProps"]["onClick"]&&this["radioProps"]["onClick"](z,w);this["radioProps"]["onChange"]&&this["radioProps"]["onChange"](z,w);};if(this.enable==false){return n;}var o=" ";var p="radio_payrelation_";
var i=p+k.getItemValue(s,"serviceInfoIndex");l.radionamePrefix=p;if(String(n)==String(l.radioProps["checkedValue"])){o=" checked ";l.checked=true;}var r=['<input tabindex="-1" type="radio" '],h=Math.floor((this.grid.managers.get("RowManager").defaultRowHeight-14)/2)+"px";
r.push("name='");r.push(i);r.push("'");r.push(" serviceInfoIndex='");r.push(k.getItemValue(s,"serviceInfoIndex"));r.push("' ");if(dojo.isIE>7||dojo.isFF){r.push(' style="margin-top:');r.push(h+'"');}r.push(o);
r.push('onclick="');r.push("window['");r.push(l.serial);r.push("'].checkLogic(event,");r.push(s);r.push(')"');r.push(">");return r.join("");};orderaccept.prodofferaccept.widget.payrelation.PayRelationWidget.deleteRow=function(h,l){var j=orderaccept.prodofferaccept.widget.payrelation.PayRelationWidget.getPayRelationGrid();
var i=j.getManager("EditManager");i.apply();var k=j.getBinding().getRow(l);if(k.ifDefaultAcctId&&k.ifDefaultAcctId==1){e.alert({busiCode:"08410010"});return;}else{j.getBinding().deleteRow(l);}};orderaccept.prodofferaccept.widget.payrelation.PayRelationWidget.getPayRelationGrid=function(){return unieap.byId("payRelationGrid");
};orderaccept.prodofferaccept.widget.payrelation.PayRelationWidget.addRow=function(h,n){var j=orderaccept.prodofferaccept.widget.payrelation.PayRelationWidget.getPayRelationGrid();var m=j.getBinding();
var k=m.getRowCount();var l=unieap.fromJson(unieap.toJson(m.getRow(n)));if(l.ifDefaultAcctId==1){l.ifDefaultAcctId=0;}l.acctItemTypeGroupId=null;l.paymentLimit=0;l.priority=null;l.paymentLimitType=null;
m.insertRow(l,k);var i=j.getManager("EditManager");i.apply();i.setEdit(k,"acctItemTypeGroupId");};orderaccept.prodofferaccept.widget.payrelation.PayRelationWidget.deleteAccountGroup=function(q,o,n){var j=unieap.byId("accountInfoCheckBoxGroup");
var p=j.getDataProvider().getDataStore();if(o){p.getRowSet().forEach(function(t,i,s){if(t.getData()&&t.getData().CODEVALUE==o){s.deleteRow(i);return;}});if(p.getRowSet().getRowCount()==0){p.getRowSet().addRow({CODEVALUE:null,CODENAME:"无账户信息，请添加账户",_s:true});
}j.getDataProvider().setDataStore(p);var r=j.getChildren();dojo.map(r||[],function(i){i.setChecked(true);i.setDisabled(true);i.setDisplay("none");});var k=[];var m=orderaccept.prodofferaccept.widget.payrelation.PayRelationWidget.getWidget();
if(m&&m.accountInfoList){for(var l=0,h=m.accountInfoList.length;l<h;l++){if(m.accountInfoList[l].accountId!=o){k.push(m.accountInfoList[l]);}}m.accountInfoList=k;}}};orderaccept.prodofferaccept.widget.payrelation.PayRelationWidget.refreshGridAccountInfo=function(p,h){var i=orderaccept.prodofferaccept.widget.payrelation.PayRelationWidget.getPayRelationGrid();
var n=i.getCell("accountId");n.setEditor("unieap.form.ComboBox",{textValidate:true,dataProvider:{store:"accountInfoListDatastore"},dataFilter:{searchAttr:["CODENAME"],spellAttr:"py"},title:"账户信息",required:true,hasDefault:true,dojoAttachEvent:"onclick:payRelationInfoOnfocus}"});
if(p){var m=false;var o=i.getBinding().getRowSet().getData();for(var l=0,j=o.length;l<j;l++){var k=o[l];if(k.accountId&&k.accountId==p.getData().CODEVALUE){k.accountId=null;m=true;}}if(m){i.getManager("ViewManager").refresh();
}}unieap.transcode.clear("accountInfoListDatastore");};orderaccept.prodofferaccept.widget.payrelation.PayRelationWidget.refreshGridAccountInfoAfterAddRow=function(k,j){var i=orderaccept.prodofferaccept.widget.payrelation.PayRelationWidget.getPayRelationGrid();
var h=i.getCell("accountId");h.setEditor("unieap.form.ComboBox",{textValidate:true,dataProvider:{store:"accountInfoListDatastore"},dataFilter:{searchAttr:["CODENAME"],spellAttr:"py"},title:"账户信息",required:true,hasDefault:true});
unieap.transcode.clear("accountInfoListDatastore");};orderaccept.prodofferaccept.widget.payrelation.PayRelationWidget.refreshAccountGroup=function(i,h){var j=dataCenter.getDataStore("accountInfoListDatastore").getRowSet();
dojo.map(j.getData()||[],function(l,k){if(l&&l.CODEVALUE==i.getData().CODEVALUE){j.deleteRow(k);}});orderaccept.prodofferaccept.widget.payrelation.PayRelationWidget.refreshGridAccountInfo(i);};orderaccept.prodofferaccept.widget.payrelation.PayRelationWidget.deleteBottonFormatter=function(k,l){var j=this;
j.name=this.name;j.grid=this.grid;var i=unieap.fromJson(unieap.toJson(j.grid.getBinding().getRow(l)));if(i.operateKind==2){return"";}j.serial="cell_"+unieap.getUnique();window[j.serial]=j;j.deleteRow=function(m,n){this.grid.getBinding().deleteRow(n);
};j.addRow=function(m,n){this.grid.getBinding().deleteRow(n);};var h="<div align='center'><img style='cursor:hand;' src='"+unieap.WEB_APP_NAME+"/common/images/button/add_button.png' onclick=\"orderaccept.prodofferaccept.widget.payrelation.PayRelationWidget.addRow(event,'"+l+"')\" />&#160<img style='cursor:hand;' src='"+unieap.WEB_APP_NAME+"/common/images/button/reduce_button.png' onclick=\"orderaccept.prodofferaccept.widget.payrelation.PayRelationWidget.deleteRow(event,'"+l+"')\" /></div>";
return h;};orderaccept.prodofferaccept.widget.payrelation.PayRelationWidget.showAccountInfo=function(i){var l=orderaccept.prodofferaccept.widget.payrelation.PayRelationWidget.getWidget();l.refreshCurrenAccountInfo();
if(l&&l.accountInfoList){for(var h=0,j=l.accountInfoList.length;h<j;h++){if(l.accountInfoList[h].accountId==i.accountId){var k=[];k.push("账户编号："+l.accountInfoList[h].accountId+" 账户名称："+l.accountInfoList[h].accountName);
if(l.accountInfoList[h].accountFee!==undefined){k.push(" 预存款(元)："+l.accountInfoList[h].accountFee);}unieap.showTooltip({inner:k.join(""),autoClose:true},i);}}}};orderaccept.prodofferaccept.widget.payrelation.PayRelationWidget.hideAccountInfo=function(i){var k=orderaccept.prodofferaccept.widget.payrelation.PayRelationWidget.getWidget();
k.refreshCurrenAccountInfo();if(k&&k.accountInfoList){for(var h=0,j=k.accountInfoList.length;h<j;h++){if(k.accountInfoList[h].accountId==i.accountId){unieap.hideTooltip(i);}}}};orderaccept.prodofferaccept.widget.payrelation.PayRelationWidget.getWidget=function(){return unieap.byId("orderaccept_prodofferaccept_widget_payrelation_PayRelationWidget_0");
};orderaccept.prodofferaccept.widget.payrelation.PayRelationWidget.payRelationGridBeforeEdit=function(i,h){var m=true;var j=orderaccept.prodofferaccept.widget.payrelation.PayRelationWidget.getPayRelationGrid();
var l=j.getBinding();if(l){var k=l.getRow(i);if(k&&k.operateKind==2){m=false;}}return m;};});
defineModule("orderaccept.prodofferaccept.widget.mainprodoffer.MultipleMainProdOfferWidget",["./MainProdOfferWidget","orderaccept.prodofferaccept.util"],function(b,a){dojo.declare("orderaccept.prodofferaccept.widget.mainprodoffer.MultipleMainProdOfferWidget",[b],{templatePath:dojo.moduleUrl("orderaccept.prodofferaccept.widget.mainprodoffer","template/mainProdOfferTpl.html"),delayCreateBeforeBindModel:true,postMixInProperties:function(){this.modelData=this.getModel(),this.uniqueId=this.modelData.uniqueId;
this.prodOfferInfoVO=this.modelData.mainProdOfferInfoVO;this.prodOfferInstVO=this.modelData.prodOfferInstVO;this.contentPane=this.modelData.contentPane;this.inherited(arguments);},buildViewInitData:function(){var n=this,p="key",g=this.prodOfferInfoVO,i=this.prodOfferInstVO,f=dojo.global.$appContext$.requestParam,o=p+"-"+g.parentProdOfferId+g.prodOfferId,j=!!i?"\u4fdd\u7559":"\u8ba2\u8d2d",k=a.ProdOfferHelper.toProductStartDateView(g,{key:"key"}),d=a.ProdOfferHelper.toProductEndDateView(g,{key:"key"}),m=a.ProdOfferHelper.IfShowMainOfferDetail(g)?"1":"0",l=a.ProdOfferHelper.getProductDateBuilder(g),c=!!a.ProdOfferHelper.ifShowStartTime(g)?l.getBeginDate():"",h=!!a.ProdOfferHelper.ifShowEndTime(g)?l.getEndDate():"";
if(i){k.style.hiddenStyleOption=" hidden-elem";d.style.hiddenStyleOption=" hidden-elem";d.style.cycleStyleOption=" hidden-elem";}if(this.contentPane.action=="split"){c=a.DateHelper.getStringFirstDayOFNextMonth();
k.style.hiddenStyleOption=" hiddenStyle";}else{if(this.contentPane.action=="new"){c=dojo.global.$appContext$.requestParam.today;k.style.hiddenStyleOption=" hiddenStyle";}else{if(this.contentPane.action=="change"&&this.contentPane.offerInstVO.prodOfferId!=this.contentPane.prodOfferId){c=a.DateHelper.getStringFirstDayOFNextMonth();
k.style.hiddenStyleOption=" hiddenStyle";}}}var e=false;e=a.AttrUtil.checkIfNotNull(g.attrList);if(!e){e=dojo.some(g.offerProdRelaList,function(q){if(q.productInfoVO.prodFuncType==ConstantsPool.load("ProductFuncTypeConst").ProductFuncTypeConst.ACCESS){return false;
}return a.AttrUtil.checkIfNotNull(q.productInfoVO.attrList);});}e=!!i?false:e;tpContext={prodOfferDetailFlag:m,detailNotNull:e?"":"hidden-elem",finishImg:!e?"":"hidden-elem",productStartDateView:k,productEndDateView:d,viewId:o,startDate:a.DateHelper.format(!!i?i.effDate:c),endDate:a.DateHelper.format(!!i?i.expDate:h),actionName:j,displayStartEndTime:"",prodOfferInfoVO:g,ifMultipleMainProd:true,multipleUniqueId:"-"+n.uniqueId};
return{prodOfferViewData:tpContext,prodViewData:null};},getPageData:function(){var e=this.prodOfferInfoVO,c=this.prodOfferInstVO,d=this.mainProdOfferDetailWidget;requestParam=dojo.global.$appContext$.get("requestParam"),pageInfoData={},detailPageData={},offerAttrPageDataList={},relaBusPageInfoList={},productBasicTrList=dojo.query("[uniqueId="+this.uniqueId+"]"),exceptionFlag=false,prodOfferInfo=this.getPageStartEndDate(),attrKeyList=["uniqueId","viewId","prodOfferId","roleCD","roleNumMax","roleNumMin","parentRoleCD","productId","roleName","serviceKindIndex","serviceKind","userId","prodInstId"];
if(!!d){detailPageData=d.handlePageData();if(detailPageData===false){exceptionFlag=true;}else{offerAttrPageDataList=detailPageData.offerAttrPageInfoList;relaBusPageInfoList=detailPageData.relaBusPageInfoList;
}}if(exceptionFlag){return false;}else{return{prodOfferPageInfo:prodOfferInfo,offerAttrPageInfoList:offerAttrPageDataList,relaBusPageInfoList:relaBusPageInfoList,prodOfferInfoVO:e,prodOfferInst:c,uniqueId:this.uniqueId};
}}});});
defineModule("orderaccept.prodofferaccept.loader.MultipleSubProdOfferHandler",["orderaccept.base.Controller","../util","unieap.layout.TabContainer","unieap.layout.ContentPane","../builder/subprodoffergrid/SubProdOfferCartDataProvider","orderaccept.prodofferaccept.widget.mainprodoffer.MultipleMainProdOfferWidget","../builder/prodofferdetail/MainProdOfferDetailBuilder"],function(f,a,b,e,d,g,c){dojo.declare("orderaccept.prodofferaccept.loader.MultipleSubProdOfferHandler",[f],{controller:null,subProdOfferTabContainer:null,subProdOfferOrderProviderMap:{},multipleSubProdOfferContentTemplate:dojo.cache("orderaccept.prodofferaccept.view","multipleSubProdOfferLayout.html"),constructor:function(h){this.controller=h;
},_getMainProdOfferList:function(){var h=function(j,l){var k=l.parentNode;while(k&&k!=k.parent){if(k.tagName.toUpperCase()==j.toUpperCase()){return k;}else{k=k.parentNode;}}},i=dojo.map(dojo.query(".member-main-prodoffer",this.controller.mainProdOfferWidget.domNode),function(l){var m=dojo.attr(h("TR",l),"uniqueId"),k=$ac$.query("$.selectedMemberProdOfferList[?(@.uniqueId=="+m+")]");
var j={uniqueId:m,prodOfferInfoVO:{prodOfferId:l.value,prodOfferName:l.options[l.selectedIndex].text}};if(k){dojo.mixin(j,k[0]);}return j;});return dojo.filter(i,function(j){return j.action!="quit";});
},doMultipleSubProdOfferFilter:function(n){var m=dojo.query(".member-main-prodoffer",this.controller.mainProdOfferWidget.domNode),j=this;this.initPersonalSubProdOfferData();if(m.length>0){try{j.clearDirtyContext();
this.initSubProdOfferAcceptList(this._getMainProdOfferList());}catch(k){BusCard.showErrorStack(k);j.clearErrorContext();}}else{if(this.subProdOfferTabContainer){this.subProdOfferTabContainer.destroyRecursive();
this.subProdOfferTabContainer=null;}var h=unieap.byId("subProdOfferTreeContainer");if(!h){this.controller.renderSubProdOfferLayout();}else{h.destroyRecursive();this.controller.renderSubProdOfferLayout();
}unieap.byId("subProdOfferTreeContainer").resizeContainer();for(var i in j.subProdOfferOrderProviderMap){if(!j.subProdOfferOrderProviderMap.hasOwnProperty(i)){continue;}var l=j.subProdOfferOrderProviderMap[i];
l.prodOfferDetailBuilder.destroy();if(!!l.prodOfferInfoWidget){if(!!l.prodOfferInfoWidget.mainProdOfferDetailWidget){l.prodOfferInfoWidget.mainProdOfferDetailWidget.destroyRecursive();}l.prodOfferInfoWidget.destroyRecursive();
}}this.subProdOfferOrderProviderMap={};return this[$ac$.get("processId")+"Dispatch"]();}},initPersonalSubProdOfferData:function(){if(!!$ac$.get("_allSubProdOffers_")){return;}var i="method=getPersonalCollectSubProdOffer";
var h=a.ServiceFactory.getService("url:prodOfferSaleAjaxAction.do?"+i);$ac$.set("_allSubProdOffers_",h);},subProdOfferChangeDispatch:function(){var h=this;h.initSubProdOfferPane(h.controller.mainProdOfferId,"",null);
},sharedMemberChangeDispatch:function(){var h=this;h.initSubProdOfferPane(h.controller.mainProdOfferId,"",null);},single2singleDispatch:function(){return this.single2combDispatch.apply(this,arguments);
},single2combDispatch:function(){var j=this,k=$ac$.get("selectedMainProdOfferInfoVO"),l=$ac$.get("mainProdOfferInstVO"),i=BusCard.find($ac$.selectedMemberProdOfferList||[],function(n){return(!!n.offerInstVO)&&l.prodOfferInstId==n.offerInstVO.prodOfferInstId;
}),m=!!i?i.uniqueId:"",h=BusCard.jsonPath($ac$.get("userHasProdOfferInfoList"),"$[?(@.prodOfferId!="+l.prodOfferId+")].prodOfferId")||[];a.ServiceFactory.getService("url:orderDetailAction.do?method=doGetMemberProdOfferListForChgMem&oldProdOfferId="+l.prodOfferId+"&newProdOfferId="+k.prodOfferId+"&userHasProdOfferIdList="+dojo.toJson(h)+"&commonRegionId="+(j.controller.getBelongCode()||"")+"&accProdListStr="+(j.controller.getAccProdIdList(m)||""),function(o){var q=o.prodOfferList,n=o.userHasProdOfferMetaInfoList,p=dojo.filter(q,function(r){return dojo.filter(h,function(s){return s==r.prodOfferId;
}).length>0;});Array.prototype.push.apply(n,p);$ac$.set("userHasProdOfferMetaInfoList",n);Array.prototype.push.apply($ac$.get("prodOfferList"),q);a.ProdOfferInstProvider.getProdOfferDataForChgMain();j.initSubProdOfferPane(j.controller.mainProdOfferId,"",null);
});},sharedProdOfferInstallDispatch:function(){var h=this;this.controller.route("url:orderDetailAction.do?method=doGetProdOfferList&prodOfferId="+$ac$.get("selectedMainProdOfferInfoVO").prodOfferId+"&commonRegionId="+(h.controller.getBelongCode()||"")+"&accProdListStr="+(h.controller.getAccProdIdList("")||""),[true,function(i){Array.prototype.push.apply($ac$.get("prodOfferList"),i||[]);
h.initSubProdOfferPane(h.controller.mainProdOfferId,"",null);}]);},buildTabPageTitle:function(h){return a.actionNameMap[h];},initSubProdOfferAcceptList:function(l){var k=this,i=this.controller,h=i.mainProdOfferWidget;
if(this.subProdOfferTabContainer){this.subProdOfferTabContainer.destroyRecursive();this.subProdOfferTabContainer=null;}this.subProdOfferTabContainer=new b({id:"subProdOfferTabContainer",height:"460px"});
this.subProdOfferTabContainer.startup();dojo.place(this.subProdOfferTabContainer.domNode,unieap.byId("subProdOfferPane").containerNode,"first");for(var j in k.subProdOfferOrderProviderMap){if(!k.subProdOfferOrderProviderMap.hasOwnProperty(j)){continue;
}var m=k.subProdOfferOrderProviderMap[j];m.prodOfferDetailBuilder.destroy();if(!!m.prodOfferInfoWidget){if(!!m.prodOfferInfoWidget.mainProdOfferDetailWidget){m.prodOfferInfoWidget.mainProdOfferDetailWidget.destroyRecursive();
}m.prodOfferInfoWidget.destroyRecursive();}}k.subProdOfferOrderProviderMap={};dojo.forEach(l,function(o){var n=new e(dojo.mixin({title:o.prodOfferInfoVO.prodOfferName+"-"+k.buildTabPageTitle(o.action),prodOfferInfoVO:o.prodOfferInfoVO,uniqueId:o.uniqueId,onShow:function(){return function(){try{var r=k.subProdOfferOrderProviderMap;
for(var p in r){if(!r.hasOwnProperty(p)){continue;}if(r[p].prodOfferInfoWidget.mainProdOfferDetailWidget){orderaccept.custom.popup.close({widget:r[p].prodOfferInfoWidget.mainProdOfferDetailWidget,notHandleData:true});
}}}catch(q){if(window.console&&window.console.warn){window.console.warn("warn in MultipleSubProdOfferHandler.js:"+q.message);}}};}(k)},o));k.subProdOfferTabContainer.addChild(n);k.initEachSubProdOfferTab(n,o);
});},initEachSubProdOfferTab:function(i,n){var o=i.uniqueId,l=i.prodOfferInfoVO,h=i.offerInstVO,m=i.action,k=this;i.containerNode.innerHTML=BusCard.Template.create(k.multipleSubProdOfferContentTemplate).apply({uniqueId:o});
dojo.parser.parse(i.containerNode);k.controller.renderSubProdOfferSearch(o);var j=unieap.byId("subProdOfferTreeContainer"+o);j&&j.resizeContainer();k.computationChgProdOffer(h,o);k.getProdOfferList(i,function(p){k.setProdOfferList(o,p,m,n);
k.rendSubProdOffer(o,l,i);});},setProdOfferList:function(k,h,i,j){if(h.prodOfferList){dojo.global.$appContext$.set("prodOfferList"+k,h.prodOfferList);dojo.global.$appContext$.set("userHasProdOfferMetaInfoList"+k,h.userHasProdOfferMetaInfoList);
}else{dojo.global.$appContext$.set("prodOfferList"+k,h);}if(!i){return;}if(i=="change"||i=="split"){a.ProdOfferInstProvider.getProdOfferDataForChgMain(k,j);}else{if(i=="nochange"){a.ProdOfferInstProvider.getProdOfferDataForChg(k,j);
}}},getProdOfferList:function(l,i){var p=l.uniqueId,q=l.prodOfferInfoVO,o=l.offerInstVO,m=q.prodOfferId,k=l.action,r=this;var j=dojo.global.$appContext$.get("userHasProdOfferInfoList"+p);var p=p||"";var n=null;
if(k=="change"||k=="split"){var h=[];dojo.forEach(j||[],function(s){return h.push(s.prodOfferId);});n=a.ServiceFactory.getService("url:orderDetailAction.do?method=doGetMemberProdOfferListForChgMem&oldProdOfferId="+o.prodOfferId+"&newProdOfferId="+m+"&userHasProdOfferIdList="+dojo.toJson(h)+"&commonRegionId="+(r.controller.getBelongCode()||"")+"&accProdListStr="+(r.controller.getAccProdIdList(p)||""),function(t){var v=t.prodOfferList,s=t.userHasProdOfferMetaInfoList,u=dojo.filter(v,function(w){return dojo.filter(h,function(x){return x==w.prodOfferId;
}).length>0;});Array.prototype.push.apply(s,u);i(t);});}else{if(k=="nochange"){var h=[];dojo.forEach(j||[],function(s){return h.push(s.prodOfferId);});n=a.ServiceFactory.getService("url:orderDetailAction.do?method=doGetMemberProdOfferListForChg&prodOfferId="+m+"&userHasProdOfferIdList="+dojo.toJson(h)+"&commonRegionId="+(r.controller.getBelongCode()||""),function(s){s.prodOfferList=s.userHasProdOfferMetaInfoList;
i(s);});}else{n=a.ServiceFactory.getService("url:orderDetailAction.do?method=doGetProdOfferList&prodOfferId="+m+"&commonRegionId="+(r.controller.getBelongCode()||"")+"&accProdListStr="+(r.controller.getAccProdIdList(p)||""),i);
}}},computationChgProdOffer:function(h,i){if(!h){return;}a.ProdOfferInstProvider.queryMemberProdOfferAndSub(h.prodOfferInstId,i);},rendSubProdOffer:function(l,j,h){var i=this;var k=dojo.global.$appContext$.get("prodOfferList"+l);
i.initSubProdOfferPane(j.prodOfferId,l,h);i.initMainProdOfferPane(h,k);},initMainProdOfferPane:function(k,m){var l=this,n=l.subProdOfferOrderProviderMap,o=n["subProdOfferTreeContainer"+k.uniqueId],j=a.ProdOfferHelper.getMainProdOffer(m)[0],h=k.offerInstVO;
if(k.prodOfferInfoVO.bindType!=2){var i=new g({prodOfferInstVO:(h&&(h.prodOfferId==j.prodOfferId?h:null)),mainProdOfferInfoVO:j,uniqueId:k.uniqueId,contentPane:k});l.initMainProdOfferDetail(i);!!o?o.prodOfferInfoWidget=i:null;
dojo.place(i.domNode,k.domNode,"first");l.initOldAndNewDate(i,h,k);}},initOldAndNewDate:function(i,h,j){if((!!h)&&$ac$.get("offerStandardStartDate_"+h.prodOfferInstId)){var k=$ac$.get("offerStandardStartDate_"+h.prodOfferInstId);
dojo.query(".startDate-class",j.domNode)[0].innerText=k.beginDate;i.mainProdOfferDetailWidget.agreementAttrCardWidget.resetOfferStandardTime(k.beginDate);}},initMainProdOfferDetail:function(m){var p=m.prodOfferInfoVO;
var l=m.prodOfferInstVO;var o=a.ProdOfferHelper.IfShowMainOfferDetail(p)?"1":"0";if(o==1){var j=new c(this);var i={};var k=dojo.query(".main-product-basic",this.controller.mainProdOfferWidget.domNode);
var h=dojo.filter(k,function(r){return dojo.attr(r,"uniqueId")==m.uniqueId;})[0];var n=dojo.attr(h,"viewId");var q={serviceKind:dojo.attr(h,"serviceKind")||"-1",serviceKindIndex:dojo.attr(h,"serviceKindIndex")||"-1",serviceId:dojo.query(".serviceId-"+n,h)[0].value,productId:dojo.attr(h,"productId")||"-1",uniqueId:dojo.attr(h,"uniqueId")};
i.chooseNumberObj=q;j.initProdOfferDetail({subProdOfferInfo:p,prodOfferInst:l,ifMultiplSub:true,prodOfferInfoWidget:m,showData:i});m.mainProdOfferDetailWidget=j.prodOfferDetailWidgetList["main-"+p.prodOfferId+"-"+m.uniqueId];
}},initSubProdOfferPane:function(l,k,i){var j=this;j.controller.renderSubProdOffer({mainProdOfferId:l,uniqueId:k});j.controller.renderSubProdOfferOrderGrid({uniqueId:k});var h=this.getSubProdOfferCartDataProvider(this.controller,k,i);
j.subProdOfferOrderProviderMap["subProdOfferTreeContainer"+k]=h;j.controller.showSubProdOfferCart(h);j.showResetButton(k);},showResetButton:function(k,n){var o=this;var p=unieap.byId("subProdOfferCart"+k);
if(p){var i=p.titleText||p.titleNode;var j="<img title='点此可重置可选包购物车数据' id='resetSubProdOfferBtn_"+k+"' style='cursor:pointer;float:right' src='"+BusCard.path.contextPath+"/common/images/icon/refresh_icon.png' />";
var h=document.createElement("div");var l=document.createDocumentFragment();h.innerHTML=j;var m=h.childNodes;dojo.forEach(dojo._toArray(m),function(q){l.appendChild(q);});h=null;i.appendChild(l);}dojo.connect(dojo.byId("resetSubProdOfferBtn_"+k),"onclick",function(q){o.subProdOfferOrderProviderMap["subProdOfferTreeContainer"+k].resetSubProdOfferCart();
});},getSubProdOfferCartDataProvider:function(h,j,i){return new d(h,j,i);},getSubProdOfferPageData:function(){var k=[];for(var j in this.subProdOfferOrderProviderMap){var h=this.subProdOfferOrderProviderMap[j];
var i=h.getSubProdOfferPageData();if(!i){if(h.contentPane!=null){this.subProdOfferTabContainer.showTab(h.contentPane.id,true);}return false;}k.push(i);}return k;},clearDirtyContext:function(){this.controller.clear(true);
if(this.subProdOfferTabContainer){Try.these([function(){return handler.subProdOfferTabContainer.destroyRecursive();},function(){handler.subProdOfferTabContainer.destroy();}]);this.subProdOfferTabContainer=null;
}},clearErrorContext:function(){var h=this;this.controller.clear();if(this.subProdOfferTabContainer){Try.these([function(){return h.subProdOfferTabContainer.destroyRecursive();},function(){h.subProdOfferTabContainer.destroy();
}]);this.subProdOfferTabContainer=null;}}});});
defineModule("orderaccept.prodofferaccept.data.ProdOfferNewDataBuilder",["../ProductDateBuilder","../util","../../common/js/ConstantsPool","orderaccept.prodofferaccept.builder.date.DateBuilderFactory"],function(b,a,c,d){dojo.declare("orderaccept.prodofferaccept.data.ProdOfferNewDataBuilder",[],{controller:null,MAIN_PROD_OFFER_PAGE_DATA:"mainProdOfferPageData",SUB_PROD_OFFER_PAGE_DATA_LIST:"subProdOfferPageDataList",USER_ID_MAP:"userIdMap",processId:null,MAIN_KEY:null,SUB_KEY:null,USER_ID_KEY:null,beanBuildFactory:null,constructor:function(e){this.controller=e;
this.beanBuildFactory=new a.BeanBuildFactoryProvider().getInstance();},process:function(){var f;c.load(["ActionCDConst"]);c.load(["AccessLevelConst"]);this.preProcess();try{f=this.generateOrder();if(this.inspectServiceIdWithBlankChar(f)===true){f=false;
}}catch(g){BusCard.showErrorStack(g);this.postProcess();this.controller.waitingBarInstance.hideMe();throw g;}this.postProcess();return f;},inspectServiceIdWithBlankChar:function(e){if(!e){return false;
}else{var g=BusCard.jsonPath(e,"$.orderAcceptInfoList[*].prodOfferAcceptInfoList[*].accessProdAcceptInfoList[*]")||[];var f=BusCard.jsonPath(g,"$[*].accessProdAcceptInfoList[*]")||[];var h=[].concat(g).concat(f).find(function(j){var i=j.serviceId;
if(i&&j.operKind==1){var k=i.toString();if(k.replace(/\s+/g,"").length!=k.length){dojo.require("orderaccept.common.dialog.MessageBox");orderaccept.common.dialog.MessageBox.alert({message:"\u53f7\u7801["+i+"]\u5b58\u5728\u7a7a\u683c,\u8bf7\u6838\u67e5"});
return true;}}});if(h){return true;}}return false;},generateOrder:function(){var k={},g=Array.prototype.push,l=[],n=[],p=null,i=null,s=null,r=null,f=[],e=this.controller.getCustOrderId(),q=this.buildCustOrderBasicAcceptInfoVO();
if(!q){return false;}if(this.controller.route("/checkInstance/doCheckPayModeMethod")){return false;}if(!((p=this.doMainProdOfferInfoComputation())!==false&&(i=this.doSubProdOfferInfoComputation(p))!==false&&(s=this.doAccountInfoComputation())!==false&&(r=this.doSalesPromotionInfoComputation())!==false&&(f=this.doQuitMainProdOfferInfoComputation(p,i))!==false)){return false;
}var o=dojo.global.$appContext$.get(this.SUB_KEY);if(!this.controller.route("/checkInstance/checkIfReserveCancelSpeedOffer",[p,i,o])){return false;}if(this.doProdRelationCheck(p.prodOfferAcceptInfoVO,dojo.global.$appContext$.get(this.MAIN_KEY),dojo.global.$appContext$.get(this.SUB_KEY))===false){return false;
}if(!this.controller.route("/checkInstance/doCheckPasswordMethod")){return false;}if(!this.controller.route("/checkInstance/checkOrderedOfferProdRelationByPPM",[p,i])){return false;}l.push(p.prodOfferAcceptInfoVO);
g.apply(l,i.prodOfferAcceptInfoList||[]);g.apply(l,f);var m=""+this.getAcceptGroupId();n.push(dojo.mixin({acceptGroupId:m,prodOfferAcceptInfoList:l,salesPromotionAcceptInfoList:r.promotionAcceptInfoList||[]},s));
var j=this.buildCustomerAcceptInfoVO();this.doComputationManageNbrInfo(q);dojo.mixin(k,{customerAcceptInfoVO:j,custOrderBasicAcceptInfoVO:q,orderAcceptInfoList:n});if(this.doGlobalBusAndRuleCheck(k)==false){return false;
}this.doOffer2ProdRelComputation(k);this.doOffer2OfferRelComputation(k);this.doProd2ProdRelComputation(k);this.setAccProdInstIdForAll(k);var h=d.getInstance(k);h.build();this.doCombMembProductRelComputation(k);
k.preRgstNo=!!$ac$.get("requestParam")&&!!$ac$.get("requestParam").preRgstNo?$ac$.get("requestParam").preRgstNo:"";return k;},doCombMembProductRelComputation:function(j){var l=$ac$.get("selectedMainProdOfferInfoVO");
if(l){var m=l.prodOfferId;var k=BusCard.jsonPath(j||{},"$.orderAcceptInfoList[*].prodOfferAcceptInfoList[?(@.prodOfferId=="+m+")]");if(k&&k.length>0){var i=k[0];var g=i.accessProdAcceptInfoList||[];var h=-1;
var f=c.load("ProductTypeConst").ProductTypeConst.COMPOSE;BusCard.each(g,function(o,n){var p=n.prodTypeCd||n.prodType;if(p==f){h=o;return false;}},true);if(h!=-1){var e=g.splice(h,1)[0];e.accessProdAcceptInfoList=g;
i.accessProdAcceptInfoList=[e];}}}},doComputationManageNbrInfo:function(f){var i=[];var j=this;var e=dojo.query("#manageNbrInfo")[0];if(e.children.length>0){if(dojo.attr(dojo.query("#manageNbrInfo")[0].children[0],"ifCreateAcc")==1){return;
}var h="";var k=dojo.attr(dojo.query("#manageNbrInfo")[0].children[0],"targetUniqueId");var g="";if(dojo.attr(dojo.query("#manageNbrInfo")[0].children[0],"prodInstId")==""||dojo.attr(dojo.query("#manageNbrInfo")[0].children[0],"prodInstId")=="undefined"){g=j.getVirtualUserId(k);
if(prodOfferAcceptLoader.serviceCardWidgetMap["serviceCardWidget_"+k].busCardInstance.$("serviceId")){h=prodOfferAcceptLoader.serviceCardWidgetMap["serviceCardWidget_"+k].busCardInstance.$("serviceId").value;
}}else{g=dojo.attr(dojo.query("#manageNbrInfo")[0].children[0],"prodInstId");h=dojo.attr(dojo.query("#manageNbrInfo")[0].children[0],"serviceId");}i.push({relaProdInstId:g,accNbr:h,accNbrType:2,operKind:1});
f.acctNbrTempList=i;}},setAccProdInstIdForAll:function(g){var e=BusCard.jsonPath(g,"$.orderAcceptInfoList[*].prodOfferAcceptInfoList[*].serviceProdAcceptInfoList[*]"),f=BusCard.jsonPath(g,"$.orderAcceptInfoList[*].prodOfferAcceptInfoList[*].accessProdAcceptInfoList[*]");
dojo.forEach([].concat(e||[]).concat(f||[]),function(h){if(h.userId){h.accProdInstId=h.userId;}});},doOffer2ProdRelComputation:function(e){},doProd2ProdRelComputation:function(e){},doOffer2OfferRelComputation:function(e){},doGlobalBusAndRuleCheck:function(g){var h=this.controller.route("/checkInstance/doCheckPayRelationValidNew",[g]);
if(h===false){return false;}if(this.controller.checkInstance.doGlobalBusAndRuleCheck){var e=this.controller.checkInstance.doGlobalBusAndRuleCheck;return e.apply(this.controller.checkInstance,arguments);
}},doProdRelationCheck:function(y,m,t){var p=m.productInfoList;var j=[];var l={};var k={};var s=[];if(y.bindType!=2){dojo.forEach(p,function(A){if(!(!!A.serviceProductInfo&&A.serviceProductInfo.length>0)){return;
}Array.prototype.push.call(j,{serviceid:A.prodBasicInfo.serviceid,serviceProductInfo:A.serviceProductInfo});s=s.concat(A.serviceProductInfo);});}else{dojo.forEach(p,function(A){if(!(!!A.serviceProductInfo&&A.serviceProductInfo.length>0)){return;
}Array.prototype.push.call(j,{serviceid:A.prodBasicInfo.serviceid,serviceProductInfo:A.serviceProductInfo});s=s.concat(A.serviceProductInfo);});}for(var z in t){if(!t.hasOwnProperty(z)){continue;}var i=t[z].subProdOfferPageData;
for(var v in i){if(!i.hasOwnProperty(v)){continue;}var q=i[v].relaProdPageInfoList;var w=l[i[v].showData.chooseNumberObj.uniqueId];if(!w){l[i[v].showData.chooseNumberObj.uniqueId]={};w=l[i[v].showData.chooseNumberObj.uniqueId];
}for(var u in q){if(!q.hasOwnProperty(u)){continue;}if(i[v].showData.chooseNumberObj!=null&&i[v].prodOfferPageInfo.checkBoxValue){var f=q[u];if(f.prodBasicInfo.checkedStatus&&(!!f.prodAttrInfo)){if(k[i[v].showData.chooseNumberObj.uniqueId]){k[i[v].showData.chooseNumberObj.uniqueId].push(f);
}else{k[i[v].showData.chooseNumberObj.uniqueId]=[];k[i[v].showData.chooseNumberObj.uniqueId].push(f);}}}if(i[v].prodOfferPageInfo.checkBoxValue&&q[u].prodBasicInfo.checkedStatus==true){if(q[u].productInfo.productInfoVO.prodFuncType!=c.load("ProductFuncTypeConst").ProductFuncTypeConst.ACCESS){var x={productInfo:q[u].productInfo,prodOfferName:i[v].showData.prodOfferName,serviceId:i[v].showData.chooseNumberObj.serviceId};
w[q[u].prodBasicInfo.productId]=x;}}}}}for(var z in j){if(!j.hasOwnProperty(z)){continue;}var e=j[z].serviceid;var h=j[z].serviceProductInfo;for(var v in h){if(!h.hasOwnProperty(v)){continue;}var o=h[v];
if(!l[o.uniqueId]){l[o.uniqueId]={};}if(o.prodBasicInfo.checkedStatus==true){l[o.uniqueId][o.prodBasicInfo.productId]={serviceId:e,productInfo:o};}}}for(var z in l){if(!l.hasOwnProperty(z)){continue;}var n=l[z];
for(var v in n){var r=n[v];var g=this.controller.route("/checkInstance/doCheckProdRelation",[r,n]);if(g.flag==0){return false;}}}if(!this.controller.route("/checkInstance/doCheckSameProdOfAttr",[s,k])){return false;
}},preProcess:function(){this.processId=a.CommUtils.generateUniqueId();this.MAIN_KEY=this.MAIN_PROD_OFFER_PAGE_DATA+"_"+this.processId;this.SUB_KEY=this.SUB_PROD_OFFER_PAGE_DATA_LIST+"_"+this.processId;
this.USER_ID_KEY=this.USER_ID_MAP+"_"+this.processId;return this;},postProcess:function(){dojo.global.$appContext$.deleteProperty(this.MAIN_KEY);dojo.global.$appContext$.deleteProperty(this.SUB_KEY);},loadMainProdOfferPageData:function(f){var e=this.controller.route("/mainProdOfferWidget/getPageData");
if(!e){return false;}if(f){return e;}else{return dojo.global.$appContext$.set(this.MAIN_KEY,e);}},loadSubProdOfferPageData:function(e){var f=this.controller.route("/multipleSubProdOfferHandler/getSubProdOfferPageData");
if(!f){return false;}if(e){return f;}else{return dojo.global.$appContext$.set(this.SUB_KEY,f);}},getCommInfo:function(){var e=this.controller;return{belongCode:e.getBelongCode()};},getCustomerData:function(){return dojo.global.$appContext$.get("requestParam").customerData||{};
},getAcceptGroupId:function(){if(!dojo.global.$acceptGroupId$){var e=BusCard.$load("com.neusoft.crm.ordermgr.common.idgenerator.bo.IdGeneratorBOStaticFacade");dojo.global.$acceptGroupId$=e.generateSequenceLong("acceptGroupId").replace(/"/g,"");
}return dojo.global.$acceptGroupId$;},buildCustOrderBasicAcceptInfoVO:function(){var g={};dojo.mixin(g,BusCard.$session);g.custOrderId=this.controller.getCustOrderId();dojo.mixin(g,$ac$.get("requestParam"));
dojo.mixin(g,this.getCommInfo());dojo.mixin(g,this.getCustomerData());var e=this.controller.route("/viaInfoCardWidget/getPageData");var f=this.controller.route("/orderInfoCardWidget/getPageData");if(!e||!f){return false;
}dojo.mixin(g,e);dojo.mixin(g,f);return this.beanBuildFactory.getCustOrderBasicAcceptInfoVO(g);},buildProdOfferAcceptInfoVO:function(e){return this.beanBuildFactory.getProdOfferAcceptInfoVO(e);},buildAttrInstItemVO:function(e){return this.beanBuildFactory.getProdInstAttrTempVO(e);
},buildOfferAttrInstItemVO:function(e){return this.beanBuildFactory.getOfferInstAttrTempVO(e);},buildAccessProdAcceptInfoVO:function(e){return this.beanBuildFactory.getAccessProdAcceptInfoVO(e);},buildServiceProdAcceptInfoVO:function(e){return this.beanBuildFactory.getServiceProdAcceptInfoVO(e);
},buildCustomerAcceptInfoVO:function(){var e=this.getCustomerData();return this.beanBuildFactory.getCustomerAcceptInfoVO({customerId:e.custId,firstName:e.custName,linkPhone:e.linkPhone});},buildRelaBusVO:function(e){return this.beanBuildFactory.getRelaBusVO(e);
},buildOcsSubseridBusTempVO:function(e){return this.beanBuildFactory.getOcsSubseridBusTempVO(e);},buildProdOfferInstAssureVO:function(e){return this.beanBuildFactory.getProdOfferInstAssureVO(e);},buildAccountAcceptInfoVO:function(e){return this.beanBuildFactory.getAccountAcceptInfoVO(e);
},buildProdInstAcctTempVO:function(e){return this.beanBuildFactory.getProdInstAcctTempVO(e);},buildAccNbrInfoVO:function(e){return this.beanBuildFactory.getAcctNbrTempVO(e);},buildUserTasteTempVO:function(e){return this.beanBuildFactory.getUserTasteTempVO(e);
},buildOneStopCustInfoMgrVO:function(e){return this.beanBuildFactory.getOneStopCustInfoMgrVO(e);},buildSalesPromotionAcceptInfo:function(e){return this.beanBuildFactory.getSalesPromotionAcceptInfoVO(e);
},buildPromotionInfoVOBean:function(e){return this.beanBuildFactory.getSalesPromotionVO(e);},buildPromotionItemVOBean:function(e){return this.beanBuildFactory.getSalesPromotionItemVO(e);},buildPromotionResRelaInfoVOBean:function(e){return this.beanBuildFactory.getPromotionResRelaInfoVO(e);
},buildOfferResInstRelaVO:function(e){return this.beanBuildFactory.getOfferResInstRelaVO(e);},buildRentSubsidyTempVO:function(e){return this.beanBuildFactory.getRentSubsidyTempVO(e);},buildDeviceRentBusTempVO:function(e){return this.beanBuildFactory.getDeviceRentBusTempVO(e);
},doProdOfferAcceptInfoComputation:function(h){var e=h.offerInstVO,f=h.prodOfferInfoVO,g=h.prodOfferPageData;if(e!=null){if(g.checkBoxValue){return dojo.mixin(this._cloneBasicProperty(e),{operKind:2,ActionCD:c.ActionCDConst.PRODUCT_CHANGE});
}else{return dojo.mixin(this._cloneBasicProperty(e),{operKind:3,ActionCD:c.ActionCDConst.PRODUCT_CANCEL});}}else{return{operKind:1,ActionCD:c.ActionCDConst.PRODUCT_INSTALL};}},doMainProdOfferAcceptInfoComputation:function(e){return{operKind:1,ActionCD:c.ActionCDConst.PRODUCT_INSTALL};
},assertSubProdOfferChange:function(e,f){return e&&f&&(e.prodOfferId==f.prodOfferId);},doMainProdOfferAttrInfoComputation:function(k,q){var t=this;var w=this.controller.mainProdOfferDetailWidget;var j=k.prodOfferInfoVO;
var f=k.offerInstVO;var r=j.attrList;var p=dojo.query(".main-prodoffer-detail",this.controller.mainProdOfferWidget.domNode);if(p.length>0){if(w.handlePageData()===false){return false;}var m=!!w?w.mainProdOfferDetailData:null;
var g=!!m&&!!m.offerAttrPageInfoList?m.offerAttrPageInfoList:[];if(f!=null&&this.assertSubProdOfferChange(f,j)){var o=f,e=o.offerInstAttrList||[],u=j.attrList||[],v=dojo.global.$appContext$.get("requestParam"),x=[];
dojo.forEach(e,function(B){var z=g[B.attrCd];if(z!=null){var y=BusCard.find(u,function(C){return C.attrId==B.attrId;});z=t.convertFeeAttr(y,z);if(z==null||z==B.attrValue){return;}var A=dojo.clone(B);A.oldAttrValue=B.attrValue;
A.attrValue=z;A.operKind=2;A.ifInstantiation=y.ifInstantiation;A.isTemp=y.isTemp;if(B.attrCd==a.SpecAttrCdConst.cyclePriceAttrCd){A.effDate=a.DateHelper.format(a.DateHelper.getFirstDayAfterPeriod());}x.push(t.buildOfferAttrInstItemVO(A));
}});BusCard.each(g,function(B,C){var y=BusCard.find(e,function(D){return D.attrCd==B;});if(!y){var A=BusCard.find(u,function(D){return D.attrCd==B;});if(A){C=t.convertFeeAttr(A,C);var z=t.getAttrInfoVOTemplate(1,A.attrId,B,C,A.ifInstantiation,A.pricingParamAttr,A.unique,A.isTemp);
z.effDate=v.today;z.expDate=o.expDate;z.isTemp=A.isTemp;x.push(t.buildOfferAttrInstItemVO(z));}}},true);return x;}else{var r=j.attrList||[],i=[],q=q||{},h=function(y){return BusCard.find(r,function(z){return z.attrCd==y;
});};if(g){for(var n in g){var s=g[n];var l=h(n);s=t.convertFeeAttr(l,s);if(l&&(s||s==0)){i.push(this.buildOfferAttrInstItemVO(dojo.mixin(this.getAttrInfoVOTemplate(1,l.attrId,n,s,l.ifInstantiation,l.pricingParamAttr,l.unique,l.isTemp),q)));
}}}return i;}}else{if(p.length==0){if(r&&r.length>0){return dojo.map(r,function(y){y.defaultValue=t.convertFeeAttr(y,y.defaultValue);return t.buildOfferAttrInstItemVO(t.getAttrInfoVOTemplate(1,y.attrId,y.attrCd,y.defaultValue,y.ifInstantiation,y.pricingParamAttr,y.unique,y.isTemp),q);
});}}}},doMainProdOfferAssureInfoComputation:function(i,e){var l=this;var g=this.controller.mainProdOfferDetailWidget;var n=i.prodOfferInfoVO;var k=i.offerInstVO;var h=n.attrList;var j=dojo.query(".main-prodoffer-detail",this.controller.mainProdOfferWidget.domNode);
var m=null;if(j.length>0){if(a.AttrUtil.checkedIfNeedShow(h)){return false;}var f=!!g?g.mainProdOfferDetailData:null;m=!!f?f.prodOfferAssurePageInfoList:[];}return m;},doMemOfferStandardComputation:function(i,g){var j=i.prodOfferPageData.mainProdOfferDetailWidget;
if(j&&j.agreementAttrCardWidget){var e=j.agreementAttrCardWidget,h=e.getModel().prodOfferInfoVO,f=h.offerAgreementVO[0];if(f.templetId=="2"){return this.beanBuildFactory.getOfferStandardBusTempVO(e.busCardInstance.getData(function(m){var l=!isNaN(m["300008"]*100)?m["300008"]*100:"",k=m["300009"];
m.feeValue=l;m.ifBudget=k||"0";return m;}));}else{return null;}}},doOfferStandardComputation:function(j,h){var g=this.controller.mainProdOfferDetailWidget;if(g&&g.agreementAttrCardWidget){var e=g.agreementAttrCardWidget,i=e.getModel().prodOfferInfoVO,f=i.offerAgreementVO[0];
if(f.templetId=="2"){return this.beanBuildFactory.getOfferStandardBusTempVO(e.busCardInstance.getData(function(m){var l=!isNaN(m["300008"]*100)?m["300008"]*100:"",k=m["300009"];m.feeValue=l;m.ifBudget=k||"0";
return m;}));}else{return null;}}},doProductAcceptInfoComputation:function(e){return{operKind:1,ActionCD:c.ActionCDConst.PRODUCT_INSTALL};},_cloneBasicProperty:function(e){if(!dojo.isObject(e)){return e;
}else{if(BusCard.isObject(e)){var f={};BusCard.each(e,function(g,j){var i=Object.prototype.toString,h=i.call(j);if(/String/i.test(h)||/Number/i.test(h)||/Boolean/i.test(h)){f[g]=j;}},true);return f;}else{return{};
}}},doAccessProductAcceptInfoComputation:function(l){var m=l.prodPageData,j=m.prodBasicInfo.userId,i=m.prodBasicInfo.prodInstId;if(j&&parseInt(j+"")>0){var g=a.ProdOfferInstProvider.queryRelaProdInfoVO(j),f=dojo.mixin(this._cloneBasicProperty(g),{operKind:2,ActionCD:c.ActionCDConst.PRODUCT_CHANGE});
var h=this.controller.getServiceOfferConfigVO(a.ACTION_CD_CONST.PRODOFFER_CANCEL_ACTION).serviceOfferId;try{if(h==m.serviceInfo.serviceOfferId){dojo.mixin(f,{operKind:3,ActionCD:c.ActionCDConst.PRODUCT_QUIT});
}}catch(k){}return f;}else{return{operKind:1,ActionCD:c.ActionCDConst.PRODUCT_INSTALL};}},doMainProdOfferInfoComputation:function(){this.loadMainProdOfferPageData();var g=dojo.global.$appContext$.get(this.MAIN_KEY);
if(!g){return false;}var f=a.ProdOfferHelper.getMainProdOffer(dojo.global.$appContext$.get("prodOfferList"))[0],t=dojo.global.$appContext$.get("mainProdOfferInstVO"),v=null,w=this._cloneBasicProperty(f),q=dojo.global.$appContext$.get("requestParam"),j=this.getCommInfo(),h=this.doProdOfferDateComputation(g,w),l={},i=null,u=null,e=null,m=this;
dojo.mixin(l,j);dojo.mixin(l,h);dojo.mixin(w,q);dojo.mixin(w,q.customerData);dojo.mixin(w,j);dojo.mixin(w,g.prodOfferPageInfo);dojo.mixin(w,h),dojo.mixin(w,{prodOfferInstId:-a.CommUtils.generateUniqueId()});
dojo.mixin(w,this.doMainProdOfferAcceptInfoComputation({prodOfferInfoVO:f,offerInstVO:null,prodOfferPageData:g}));dojo.mixin(w,{prodOfferType:f.prodOfferType,offerKind:f.offerKind,billMode:f.feeType,ifAdded:f.ifAdded,offerNbr:f.offerNbr});
v=this.buildProdOfferAcceptInfoVO(w);var p=m.doMainProdOfferAttrInfoComputation({prodOfferInfoVO:f,offerInstVO:!!t?t:null,prodOfferPageData:g},l);if(p===false){return false;}dojo.mixin(v,{offerInstAttrList:p});
var s=this.doRelaBusTempListComputation(g);var r=s.relaBusInfoList;var n=s.ocsRelaList;v.relaBusInfoList=r||[];v.ocsRelaList=n||[];var o=m.doMainProdOfferAssureInfoComputation({prodOfferInfoVO:f,offerInstVO:!!t?t:null,prodOfferPageData:g},l);
if(!!o){if(!v.prodOfferInstAssureList||v.prodOfferInstAssureList.length<=0){v.prodOfferInstAssureList=[];}dojo.mixin(v,{prodOfferInstAssureList:v.prodOfferInstAssureList.push(o)});}if(v.bindType!=2){v.prodOfferInstAssureList=v.prodOfferInstAssureList||[];
dojo.forEach(g.productInfoList||[],function(x){if(!!x.assureInfo&&!!x.assureInfo.securityMethodCd&&x.assureInfo.securityMethodCd!=""){var y=x.assureInfo.securityFee;if(!!y&&!isNaN(parseFloat(y))){x.assureInfo.securityFee=parseFloat(y)*100;
}x.assureInfo.assureAttrList=[];x.assureInfo.assureAttrList.push({attrId:50030,attrValue:!!x.assureInfo.identityKind?x.assureInfo.identityKind:""});x.assureInfo.assureAttrList.push({attrId:50031,attrValue:!!x.assureInfo.identityCode?x.assureInfo.identityCode:""});
x.assureInfo.assureAttrList.push({attrId:50032,attrValue:!!x.assureInfo.contactPhone?x.assureInfo.contactPhone:""});x.assureInfo.assureAttrList.push({attrId:50033,attrValue:!!x.assureInfo.contactAddress?x.assureInfo.contactAddress:""});
v.prodOfferInstAssureList.push(m.buildProdOfferInstAssureVO(x.assureInfo));}});}i=BusCard.findAll(g.productInfoList||[],function(x){return x.prodBasicInfo.productChecked==true;});u=dojo.map(i,function(x){return m.doAccessProductInfoComputation(f,x,l);
});e=this.doBuildServiceProdInfoComputation(i,f,l);v.accessProdAcceptInfoList=u;v.serviceProdAcceptInfoList=e;var k=this.doOfferStandardComputation({prodOfferInfoVO:f,offerInstVO:null,prodOfferPageData:g},l);
v.offerStandardBusTempVOList=k?[k]:null;return{prodOfferAcceptInfoVO:v};},doBuildServiceProdInfoComputation:function(h,g,e){var f=[];var i=this;dojo.forEach(h||[],function(j){dojo.forEach(j.serviceProductInfo||[],function(k){f=f.concat(i.doBuildOneProductInfo(k,g,e));
});});return f;},doBuildOneProductInfo:function(f,n,e){var j=this,h=f.prodBasicInfo.productId,i=!!f.prodBasicInfo.prodInstInfo?f.prodBasicInfo.prodInstInfo:null,e=e||{},m=null;var k=j.getVirtualUserId(f.uniqueId),l={userId:k,accProdInstId:k,prodInstId:i!=null?i.prodInstId:-1},g=BusCard.find($ac$.get("serviceProdList-"+f.uniqueId),function(p){return p.productId==h;
}),o=this._cloneBasicProperty(g.productInfoVO);dojo.mixin(o,g);dojo.mixin(o,e);dojo.mixin(o,j.doSerProductAcceptInfoComputation({productInfoVO:g.productInfoVO,prodInstVO:i,prodPageData:f}));dojo.mixin(o,l);
o.prodId=h;o.prodOfferId=n.prodOfferId;o.prodType=g.productInfoVO.prodBundleType;o.prodTypeCd=g.productInfoVO.prodBundleType;o.prodName=g.productInfoVO.productName;if(a.PRODUCTTYPE.ACCESS_PROD_TYPE==g.productInfoVO.prodFuncType){o.ifNeedCreateProdInst=0;
}else{o.ifNeedCreateProdInst=1;}if(g.productInfoVO.prodCompDetailList&&g.productInfoVO.prodCompDetailList.length>0){o.relaType=a.PRODOFFERTYPE.OFFER_COMB_MEMBER;}else{o.relaType=a.PRODOFFERTYPE.OFFER_PRODUCT;
}if(!o.accessLevel){o.accessLevel=c.AccessLevelConst.SERVICE_LEVEL;}if(f.prodBasicInfo.checkedStatus&&(!!f.prodBasicInfo.prodInstInfo)){o.operKind=2;o.effDate=f.prodBasicInfo.prodInstInfo.beginRentTime;
o.expDate=f.prodBasicInfo.prodInstInfo.stopRentTime;o.beginRentTime=f.prodBasicInfo.prodInstInfo.beginRentTime;o.stopRentTime=f.prodBasicInfo.prodInstInfo.stopRentTime;}else{if((!(f.prodBasicInfo.checkedStatus))&&(!!f.prodBasicInfo.prodInstInfo)){o.operKind=3;
o.effDate=f.prodBasicInfo.prodInstInfo.beginRentTime;o.expDate=dojo.global.$appContext$.requestParam.today;o.beginRentTime=f.prodBasicInfo.prodInstInfo.beginRentTime;o.stopRentTime=f.prodBasicInfo.prodInstInfo.stopRentTime;
}else{if(f.prodBasicInfo.checkedStatus&&(!f.prodBasicInfo.prodInstInfo)){o.operKind=1;o.effDate=dojo.global.$appContext$.requestParam.today;o.expDate="2037-01-01 00:00:00";}}}m=j.doSerProdAttrListComputation(g.productInfoVO,f,e);
o.prodInstAttrList=m;return o;},doQuitMainProdOfferInfoComputation:function(n,h){var o=dojo.query(".mainprodoffer-class-quit",this.controller.mainProdOfferWidget.domNode),j=this,f=this.controller.getServiceOfferConfigVO(a.ACTION_CD_CONST.OFFER_CANCEL).serviceOfferId,e=this.controller.getServiceOfferConfigVO(a.ACTION_CD_CONST.PRODUCT_QUIT).serviceOfferId,m=a.ProdOfferInstProvider,k=dojo.map(o,function(s){var r=dojo.attr(s,"prodOfferInstId"),p=dojo.trim(dojo.query(".endDate-class",s)[0].innerHTML),q=m.queryProdOfferAcceptInfoVO(r),t=dojo.clone(q);
t.relaProdInfoList=null;t.offerAttrInfoList=null;t.relaBusInfoList=null;t.resRelaInfoList=null;t.offerInstAttrList=null;t.prodOfferAcceptList=null;dojo.mixin(t,{operKind:3,serviceOfferId:f,expDate:p,prodOfferType:dojo.attr(s,"prodOfferType"),offerKind:dojo.attr(s,"offerKind")});
t.serviceProdAcceptInfoList=j.createQuitServiceProdList(n,h,r);q.offerStandardBusTempVOList=j.doComputationOfferStandardBusInfo(r,t);return j.buildProdOfferAcceptInfoVO(t);})||[];var i=n.prodOfferAcceptInfoVO.accessProdAcceptInfoList||[];
dojo.forEach(k,function(r){r.accessProdAcceptInfoList=[];var p=m.queryProdOfferAcceptInfoVO(r.prodOfferInstId),q=BusCard.jsonPath(i,"$[?(@.serviceOfferId=="+e+")]")||[];dojo.forEach(q,function(s){var t=s.prodInstId,u=dojo.some(p.prodInstList||[],function(v){return v.prodInstId==t;
});if(u){r.accessProdAcceptInfoList.push(s);}});});var l=BusCard.jsonPath(k,"$[*].accessProdAcceptInfoList[*]")||[],g=dojo.filter(i,function(p){return !dojo.some(l,function(q){return p===q;});});i.length=0;
Array.prototype.push.apply(i,g||[]);return k;},createQuitServiceProdList:function(o,h,f){var j=this;var g=function(t,s){var r=[];r=r.concat(dojo.filter(s||[],function(v){return !dojo.some(t.serviceProdAcceptInfoList||[],function(w){return w.productId==v.productId;
});}));var q=[];var u=[];dojo.forEach(t.serviceProdAcceptInfoList||[],function(v){if(v.operKind==3){q.push(BusCard.find(s||[],function(w){return v.prodInstId==w.prodInstId;}));}else{u.push(v);}});t.serviceProdAcceptInfoList=u;
r=r.concat(q);return dojo.map(r||[],function(w){var v=j._cloneBasicProperty(w);v.operKind=3;v.effDate=w.beginRentTime;v.expDate=a.DateHelper.formatDate(a.DateHelper.getFirstDayAfterPeriod());return j.buildServiceProdAcceptInfoVO(v);
});};var m=h.prodOfferAcceptInfoList||[];var e=$ac$.selectedMainProdOfferInfoVO;var k=$ac$.selectedMemberProdOfferList;var n=dojo.filter(k||[],function(q){return q.offerInstVO&&q.offerInstVO.prodOfferInstId==f;
});if(e.bindType==2){if(n.length>0&&n[0].prodInstVO){var p=n[0].prodInstVO.prodInstList||[];var l=n[0].prodInstVO.prodInstId;var i=BusCard.find(m||[],function(q){return q.prodOfferType==1&&dojo.some(q.accessProdAcceptInfoList||[],function(r){return r.userId==l;
});});if(!i){return[];}return g(i,p);}}else{if(n.length>0&&n[0].prodInstVO){var p=n[0].prodInstVO.prodInstList||[];return g(o.prodOfferAcceptInfoVO,p);}}return[];},doComputationOfferStandardBusInfo:function(f,e){return null;
},getVirtualUserId:function(){try{if(typeof arguments[0]=="object"){var f=arguments[0].prodBasicInfo;return arguments.callee.apply(this,[f.uniqueId])||arguments.callee.apply(this,[f.serviceKind,f.serviceKindIndex]);
}if(arguments.length==1){return dojo.global.$appContext$.get(this.USER_ID_KEY)["userId@uniqueId_"+arguments[0]];}else{if(arguments.length==2){return dojo.global.$appContext$.get(this.USER_ID_KEY)["userId@"+arguments[0]+"_"+arguments[1]];
}}}catch(g){return null;}},generateVirtualUserId:function(e){var j=e.prodBasicInfo.userId||-a.CommUtils.generateUniqueId(),i=dojo.global.$appContext$.get(this.USER_ID_KEY)||{},h=e.prodBasicInfo.serviceKind,g=e.prodBasicInfo.serviceKindIndex;
if(h&&g!=null){i["userId@"+h+"_"+g]=j;}else{var f=e.prodBasicInfo.productId;if(typeof console!="undefined"){console.warn("serviceKind or serviceKindIndex can't found when set virtual userId for product:"+f);
}}i["userId@uniqueId_"+e.prodBasicInfo.uniqueId]=j;dojo.global.$appContext$.set(this.USER_ID_KEY,i);return j;},doProdOfferDateComputation:function(h,f,g){var i=h.prodOfferPageInfo,e=a.ProdOfferHelper.getProductDateBuilder(f,{changeKind:g||1,delayUnit:i.delayUnit||0,delayTime:i.delayTime||0,validType:i.validType,validPeriod:i.validPeriod,beginDate:i.beginDate,endDate:i.endDate,delayUnorderUnit:i.delayUnorderUnit,delayUnorderTime:i.delayUnorderTime,ifChangeMainFlag:i.ifChangeMainFlag});
return{effDate:e.getBeginDate(),expDate:e.getEndDate()};},_doGetMemberProdOfferInfoVO:function(f){var i=f.prodBasicInfo.uniqueId,g=f.serviceInfo.serviceOfferId,e=this.controller.getServiceOfferConfigVO(a.ACTION_CD_CONST.PRODOFFER_CANCEL_ACTION).serviceOfferId;
if($ac$.get("prodOfferList"+i)){return a.ProdOfferHelper.getMainProdOffer($ac$.get("prodOfferList"+i))[0];}else{if(g==e){var h=a.ProdOfferHelper.getProdOfferDetail(this._doGetMemberProdOfferId(f),{permitCache:true,permitFromCache:true,interfaceType:3,assertCacheResult:function(j){return j&&j.offerProdRelaList&&j.offerProdRelaList.length>0;
}});return h;}}},_doGetMemberProdOfferId:function(f){var g=f.prodBasicInfo.uniqueId;var e=BusCard.jsonPath($ac$.get("selectedMemberProdOfferList"),"$[?(@.action=='quit'&& @.uniqueId=="+g+")]");if(e){return e[0].offerInstVO.prodOfferId;
}},doAccessProductInfoComputation:function(n,p,e){var h=p.prodBasicInfo.productId,e=e||{},m=null,j=null,i=null,k=!!this.getVirtualUserId(p)?this.getVirtualUserId(p):this.generateVirtualUserId(p),l={userId:k,prodInstId:k};
n=this._doGetMemberProdOfferInfoVO(p)||n;var g=BusCard.find(a.ProdOfferHelper.getProductList(true,n),function(q){return q.productId==h;}),o=this._cloneBasicProperty(g.productInfoVO);dojo.mixin(o,this._cloneBasicProperty(g));
dojo.mixin(o,e);o.prodId=h;o.prodOfferId=this._doGetMemberProdOfferId(p)||n.prodOfferId;o.prodType=g.productInfoVO.prodBundleType;o.prodTypeCd=g.productInfoVO.prodBundleType;o.prodName=g.productInfoVO.productName;
if(g.productInfoVO.prodCompDetailList&&g.productInfoVO.prodCompDetailList.length>0){o.relaType=a.PRODOFFERTYPE.OFFER_COMB_MEMBER;}else{o.relaType=a.PRODOFFERTYPE.OFFER_PRODUCT;}if(!o.accessLevel){o.accessLevel=c.AccessLevelConst.SERVICE_LEVEL;
}j=this.doComputationOneStopCustInfo(p);prodInstAttrList=this.doAccessProdAttrInfoListComputation(g.productInfoVO,p,e);dojo.mixin(o,this.doAccessProductAcceptInfoComputation({productInfoVO:g.productInfoVO,prodInstVO:null,prodPageData:p}));
dojo.mixin(o,p.serviceInfo);dojo.mixin(o,l);dojo.mixin(o,{serviceKind:g.productInfoVO.netType});var f=this.doAccNbrInfoComputation(p.serviceInfo);i=this.buildAccessProdAcceptInfoVO(o);i.prodInstAttrList=prodInstAttrList;
i.acctNbrTempList=f;i.oneStopCustInfoMgrVO=j;return i;},doAccessProdAttrInfoListComputation:function(e,f,g){return this.doProdAttrInfoListComputation(e,f,g);},doComputationOneStopCustInfo:function(e){var g=e.serviceInfo;
if(g.oneStop!=""&&g.oneStop!=null){var f={};dojo.mixin(f,g.oneStop);return this.buildOneStopCustInfoMgrVO(f);}else{return null;}},doAccNbrInfoComputation:function(h,e){if(!h){return null;}var g=this;var f=h.accountNbrChoose||[];
return dojo.map(f,function(m){var k="";var j="";if(m.sourceFlag!=3){k=m.prodInstId;j=m.serviceId;}else{var n=m.serviceKind;var l=m.serviceKindIndex;var i={prodBasicInfo:{serviceKind:n,serviceKindIndex:l,uniqueId:m.uniqueId}};
k=!!g.getVirtualUserId(i)?g.getVirtualUserId(i):g.generateVirtualUserId(i);if(!k){k=m.prodInstId;}var o=m.uniqueId;if(prodOfferAcceptLoader.serviceCardWidgetMap["serviceCardWidget_"+o].busCardInstance.$("serviceId")){j=prodOfferAcceptLoader.serviceCardWidgetMap["serviceCardWidget_"+o].busCardInstance.$("serviceId").value;
}}return g.buildAccNbrInfoVO({relaProdInstId:k,accNbr:j,accNbrType:!!e?e:1,operKind:1});});},doServiceInfoComputation:function(j,h,i){var e={},k=this.getVirtualUserId(h)?this.getVirtualUserId(h):this.generateVirtualUserId(h),g=h.serviceInfo,f=BusCard.find(a.ProdOfferHelper.getProductList(true,j),function(m){return m.productId==h.prodBasicInfo.productId;
}),l={};dojo.mixin(l,i);dojo.mixin(l,{prodOfferId:j.prodOfferId});dojo.mixin(l,this.doAccessProductAcceptInfoComputation({productInfoVO:f.productInfoVO,prodInstVO:null,prodPageData:h}));dojo.mixin(l,g||{});
dojo.mixin(l,{userId:k});dojo.mixin(l,{serviceKind:f.productInfoVO.netType});e.serFixedVO=this.buildSerFixedVO(l);return e;},getAttrInfoVOTemplate:function(f,j,i,k,g,h,l,e){return{attrId:j,operKind:f,attrCd:i,attrValue:k,ifInstantiation:g,pricingParamAttr:h,unique:l,isTemp:e};
},doProdAttrInfoListComputation:function(i,t,e){var m=this,u=t.prodBasicInfo.prodInstId;if(u){var n=a.ProdOfferInstProvider.queryRelaProdInfoVO(u),l=n.prodInstAttrList||[],q=t.prodAttrInfo||{},p=i.attrList||[],j=dojo.global.$appContext$.get("requestParam"),h=[];
dojo.forEach(l,function(y){if(y.attrCd==a.SpecAttrCdConst.itemAttrCd||y.attrCd==a.SpecAttrCdConst.balanceInetMethodAttrCd){return false;}var w=q[y.attrCd];if(w!=null){var v=BusCard.find(p,function(z){return z.attrId==y.attrId;
});w=m.convertFeeAttr(v,w);if(w==null||w==y.attrValue){return;}var x=dojo.clone(y);x.oldAttrValue=y.attrValue;x.attrValue=w;x.operKind=2;x.ifInstantiation=v.ifInstantiation;x.isTemp=v.isTemp;h.push(m.buildAttrInstItemVO(x));
}});BusCard.each(q,function(y,z){if(y==a.SpecAttrCdConst.itemAttrCd||y==a.SpecAttrCdConst.balanceInetMethodAttrCd){return;}var v=BusCard.find(l,function(A){return A.attrCd==y;});if(!v){var x=BusCard.find(p,function(A){return A.attrCd==y;
});if(x){z=m.convertFeeAttr(x,z);var w=m.getAttrInfoVOTemplate(1,x.attrId,y,z,x.ifInstantiation,x.pricingParamAttr,x.unique,x.isTemp);w.effDate=j.today;w.expDate=n.expDate;w.isTemp=x.isTemp;h.push(m.buildAttrInstItemVO(w));
}}},true);return h;}else{var g=i.attrList||[],f=[],e=e||{},k=function(v){return BusCard.find(g,function(w){return w.attrCd==v;});};if(t.prodAttrInfo||t.prodOfferAttrInfo){for(var o in t.prodAttrInfo){var r=t.prodAttrInfo[o];
var s=k(o);if(s&&r){r=m.convertFeeAttr(s,r);f.push(this.buildAttrInstItemVO(dojo.mixin(this.getAttrInfoVOTemplate(1,s.attrId,o,r,s.ifInstantiation,s.pricingParamAttr,s.unique,s.isTemp),e)));}}}return f;
}},doProdOfferAttrInfoListComputation:function(s,t,e){var l=this;if(t.prodOfferInst!=null&&this.assertSubProdOfferChange(t.prodOfferInst,s)){var o=t.prodOfferInst,k=o.offerInstAttrList||[],r=t.offerAttrPageInfoList||{},n=s.attrList||[],i=dojo.global.$appContext$.get("requestParam"),h=[];
dojo.forEach(k,function(y){var v=r[y.attrCd],w=v;if(dojo.isArray(w)){w=dojo.toJson(w);}if(v!=null){var u=BusCard.find(n,function(z){return z.attrId==y.attrId;});w=l.convertFeeAttr(u,v);v=l.convertFeeAttr(u,v);
if(v==null||w==y.attrValue){return;}var x=dojo.clone(y);if(v instanceof Array){x.oldAttrValue=dojo.fromJson(y.attrValue);}else{x.oldAttrValue=y.attrValue;}x.attrValue=v;x.operKind=2;x.ifInstantiation=u.ifInstantiation;
x.pricingParamAttr=u.pricingParamAttr;x.unique=u.unique;x.isTemp=u.isTemp;if(y.attrCd==a.SpecAttrCdConst.cyclePriceAttrCd){x.effDate=a.DateHelper.format(a.DateHelper.getFirstDayAfterPeriod());}h.push(l.buildOfferAttrInstItemVO(x));
}});BusCard.each(r,function(x,y){var u=BusCard.find(k,function(z){return z.attrCd==x;});if(!u){var w=BusCard.find(n,function(z){return z.attrCd==x;});if(w){y=l.convertFeeAttr(w,y);var v=l.getAttrInfoVOTemplate(1,w.attrId,x,y,w.ifInstantiation,w.pricingParamAttr,w.unique,w.isTemp);
v.effDate=i.today;v.expDate=o.expDate;v.isTemp=w.isTemp;h.push(l.buildOfferAttrInstItemVO(v));}}},true);return h;}else{var g=s.attrList||[],f=[],e=e||{},j=function(u){return BusCard.find(g,function(v){return v.attrCd==u;
});};if(t.offerAttrPageInfoList){for(var m in t.offerAttrPageInfoList){var p=t.offerAttrPageInfoList[m];var q=j(m);p=l.convertFeeAttr(q,p);if(q&&p){f.push(this.buildOfferAttrInstItemVO(dojo.mixin(this.getAttrInfoVOTemplate(1,q.attrId,m,p,q.ifInstantiation,q.pricingParamAttr,q.unique,q.isTemp),e)));
}}}return f;}},doMultiPleProdOfferOperKindComputation:function(f){var e=f.offerInstVO;if(!!e){return dojo.mixin(this._cloneBasicProperty(e),{operKind:2,ActionCD:c.ActionCDConst.PRODUCT_CHANGE});}else{return{operKind:1,ActionCD:c.ActionCDConst.PRODUCT_INSTALL};
}},dealMemParentInstId:function(f,g,e){if(f=="split"){if(!!e.prodOfferInst){return{parentProdOfferInstId:g.prodOfferInstId,splitFlag:1};}else{return{parentProdOfferInstId:""};}}else{return{parentProdOfferInstId:g.prodOfferInstId};
}},doMultipleMainProdOfferComputation:function(f,l){var e=f.prodOfferInfoVO,w=this,o=f.currentContentPane,q=o.action,x=null,y=this._cloneBasicProperty(e),s=dojo.global.$appContext$.get("requestParam"),k=w.getCommInfo(),g=w.doProdOfferDateComputation(f,y,!!f.prodOfferInst&&!!f.prodOfferInst.prodOfferInstId?2:1),n={};
dojo.mixin(n,k);dojo.mixin(n,g);dojo.mixin(y,g);dojo.mixin(y,w.doMultiPleProdOfferOperKindComputation({prodOfferInfoVO:e,offerInstVO:!!f.prodOfferInst?f.prodOfferInst:null,prodOfferPageData:f.prodOfferPageInfo}));
dojo.mixin(y,s.customerData);dojo.mixin(y,k);dojo.mixin(y,{ifAdded:e.ifAdded,offerNbr:e.offerNbr,billMode:e.feeType,prodOfferInstId:!!f.prodOfferInst?f.prodOfferInst.prodOfferInstId:-a.CommUtils.generateUniqueId()});
dojo.mixin(y,w.dealMemParentInstId(q,l,f));dojo.mixin(y,{prodOfferType:e.prodOfferType});dojo.mixin(y,{uniqueId:o.uniqueId});x=w.buildProdOfferAcceptInfoVO(y);x.accessProdAcceptInfoList=this.doMultipleAccessProdComputation(f,l);
x.serviceProdAcceptInfoList=this.doMultipleServiceProdComputation(f,l);x.offerInstAttrList=this.doProdOfferAttrInfoListComputation(e,f,n);var u=w.doRelaBusTempListComputation(f);var t=u.relaBusInfoList;
var p=u.ocsRelaList;x.relaBusInfoList=t||[];x.ocsRelaList=p||[];var r=w.doMainProdOfferAssureInfoComputation({prodOfferInfoVO:e,offerInstVO:null,prodOfferPageData:f},n);if(!!r){if(!x.prodOfferInstAssureList||x.prodOfferInstAssureList.length<=0){x.prodOfferInstAssureList=[];
}dojo.mixin(x,{prodOfferInstAssureList:x.prodOfferInstAssureList.push(r)});}x.prodOfferInstAssureList=x.prodOfferInstAssureList||[];var h=dojo.global.$appContext$.get(this.MAIN_KEY);if(!!h){var i=BusCard.findAll(h.productInfoList||[],function(z){return z.prodBasicInfo.productChecked==true;
});var v=dojo.filter(i,function(z){if(!!z&&!!z.prodBasicInfo){return z.prodBasicInfo.uniqueId==x.uniqueId;}})[0];if(!!v){if(!!v.assureInfo&&!!v.assureInfo.securityMethodCd&&v.assureInfo.securityMethodCd!=""){var j=v.assureInfo.securityFee;
if(!!j&&!isNaN(parseFloat(j))){v.assureInfo.securityFee=parseFloat(j)*100;}v.assureInfo.assureAttrList=[];v.assureInfo.assureAttrList.push({attrId:50030,attrValue:!!v.assureInfo.identityKind?v.assureInfo.identityKind:""});
v.assureInfo.assureAttrList.push({attrId:50031,attrValue:!!v.assureInfo.identityCode?v.assureInfo.identityCode:""});v.assureInfo.assureAttrList.push({attrId:50032,attrValue:!!v.assureInfo.contactPhone?v.assureInfo.contactPhone:""});
v.assureInfo.assureAttrList.push({attrId:50033,attrValue:!!v.assureInfo.contactAddress?v.assureInfo.contactAddress:""});x.prodOfferInstAssureList.push(this.buildProdOfferInstAssureVO(v.assureInfo));}}}var m=this.doMemOfferStandardComputation({prodOfferInfoVO:e,offerInstVO:null,prodOfferPageData:f},n);
x.offerStandardBusTempVOList=m?[m]:null;return x;},doMultipleAccessProdComputation:function(f,j){var i=this;var k=f.uniqueId;var g=[];if(j.accessProdAcceptInfoList!=null&&j.accessProdAcceptInfoList.length>0){for(var h=0;
h<j.accessProdAcceptInfoList.length;h++){var e=j.accessProdAcceptInfoList[h];if(e.userId==i.getVirtualUserId(k)){g=[e];j.accessProdAcceptInfoList.splice(h,1);break;}}}return g;},doMultipleServiceProdComputation:function(e,i){var h=this;
var j=e.uniqueId;var f=[];var g=[];if(i.serviceProdAcceptInfoList!=null&&i.serviceProdAcceptInfoList.length>0){dojo.forEach(i.serviceProdAcceptInfoList||[],function(k){if(k.userId==h.getVirtualUserId(j)){f.push(k);
}else{g.push(k);}});i.serviceProdAcceptInfoList=g;}return f;},doSetParentProdOfferInst:function(f,e){dojo.forEach(f,function(g){g.parentProdOfferInstId=e.prodOfferInstId;});},doSetAccessProdForMain:function(e,f){if(f.prodOfferAcceptInfoVO.bindType==2){f.prodOfferAcceptInfoVO.accessProdAcceptInfoList=[];
}},doMultipleSubProdOfferComputation:function(m,l){var h=this;var j=[];var k=m.subProdOfferPageData;if(!!m.mainProdOfferPageData){var e=m.mainProdOfferPageData;var g=h.doMultipleMainProdOfferComputation(e,l);
j.push(g);h.doSetParentProdOfferInst(k,g);}else{h.doSetParentProdOfferInst(k,l);}var i=h.doComputationDeleteProdOffer(k);var f=h.doComputationAddProdOffer(k);var n=h.doComputationChgProdOffer(k);j=j.concat(i,f,n);
return j;},doSubProdOfferInfoComputation:function(g){var h=this;var f=[];this.loadSubProdOfferPageData();var e=dojo.global.$appContext$.get(this.SUB_KEY);if(!e){return false;}dojo.forEach(e,function(i){f=f.concat(h.doMultipleSubProdOfferComputation(i,g.prodOfferAcceptInfoVO));
});return{prodOfferAcceptInfoList:f};},createProdOfferAcceptInfoList:function(g,e){var f=this;return dojo.map(g||[],function(s){var u=s.subProdOfferInfo,o=null,m=f._cloneBasicProperty(u),k=dojo.global.$appContext$.get("requestParam"),v=f.getCommInfo(),j=f.doProdOfferDateComputation(s,m,e),h={};
dojo.mixin(h,v);dojo.mixin(h,j);dojo.mixin(m,f.doProdOfferAcceptInfoComputation({prodOfferInfoVO:u,offerInstVO:s.prodOfferInst!=null?s.prodOfferInst:null,prodOfferPageData:s.prodOfferPageInfo}));dojo.mixin(m,j);
dojo.mixin(m,k.customerData);dojo.mixin(m,v);dojo.mixin(m,{billMode:u.feeType,ifAdded:u.ifAdded,offerNbr:u.offerNbr});dojo.mixin(m,{rateFlag:s.rateFlag});dojo.mixin(m,{parentProdOfferInstId:s.parentProdOfferInstId||""});
dojo.mixin(m,{prodOfferType:u.prodOfferType,custTaste:f.getIfCustTasteFlag(s.subProdOfferInfo)});o=f.buildProdOfferAcceptInfoVO(m);var r=f.doServiceProductInfoComputation(s,h);var n=f.doProdOfferAttrInfoListComputation(s.subProdOfferInfo,s,h);
var q=f.doRelaBusTempListComputation(s);var t=q.relaBusInfoList;var i=q.ocsRelaList;o.relaBusInfoList=t||[];o.ocsRelaList=i||[];var l=f.doProdOfferAssureInfoListComputation(s);var p=f.getCustTasteObj(u,j,e);
if(r!=null&&r.length>0){if("101"==r[0].prodFuncType){o.accessProdAcceptInfoList=r||[];}else{o.serviceProdAcceptInfoList=r||[];}}o.offerInstAttrList=n||[];o.prodOfferInstAssureList=l||[];if(p!=null){o.userTasteTempVO=p;
}if(e==3){if(o.serviceProdAcceptInfoList){dojo.forEach(o.serviceProdAcceptInfoList,function(w){w.operKind=3;if(w.prodInstAttrList){dojo.forEach(w.prodInstAttrList,function(x){x.operKind=3;});}});}if(o.offerInstAttrList){dojo.forEach(o.offerInstAttrList,function(w){w.operKind=3;
});}if(o.accessProdAcceptInfoList){dojo.forEach(o.accessProdAcceptInfoList,function(w){w.operKind=3;if(w.prodInstAttrList){dojo.forEach(w.prodInstAttrList,function(x){x.operKind=3;});}});}if(!!o.relaBusInfoList){dojo.forEach(o.relaBusInfoList,function(x,w){if(x.operKind==1){delete o.relaBusInfoList[w];
}else{x.operKind=3;}});}if(!!o.ocsRelaList){dojo.forEach(o.ocsRelaList,function(x,w){if(x.operKind==1){delete o.ocsRelaList[w];}else{x.operKind=3;}});}}return o;});},getCustTasteObj:function(l,i,h){var g=null;
var f=l.usageTypeList;var k=dojo.some(l.usageTypeList||[],function(m){return m==12||m=="12";});if(k&&l.prodOfferTaste&&l.prodOfferTaste!=null){var e=l.prodOfferTaste;var j=e.messageDate;g={};dojo.mixin(g,{tasteProdOfferId:l.prodOfferId,prodOfferId:e.formalProdOfferId,beginDate:i.effDate,endDate:i.expDate,smsDate:a.DateHelper.getPreTimeOfTargetTime(i.expDate,j),ifSms:e.ifMessage,changeKind:h});
return this.buildUserTasteTempVO(g);}return g;},getIfCustTasteFlag:function(g){var e=g.usageTypeList;var f=dojo.some(g.usageTypeList||[],function(h){return h==12||h=="12";});if(f){return 1;}else{return 0;
}},doSubProdOfferAttrInfoListComputation:function(g,e,f){var h=this;return h.doProdOfferAttrInfoListComputation(g,e,f);},doComputationAddProdOffer:function(f){var g=this,e=dojo.filter(f||[],function(h){return h.prodOfferPageInfo.checkBoxValue&&h.prodOfferInst==null;
});return g.createProdOfferAcceptInfoList(e,1);},doComputationDeleteProdOffer:function(g){var h=this,e=dojo.filter(g,function(i){return !i.prodOfferPageInfo.checkBoxValue&&i.prodOfferInst!=null;}),f=h.createProdOfferAcceptInfoList(e,3);
return f;},doComputationChgProdOffer:function(g){var h=this,e=dojo.filter(g||[],function(i){return i.prodOfferPageInfo.checkBoxValue&&i.prodOfferInst!=null;}),f=h.createProdOfferAcceptInfoList(e,2);return f;
},doServiceProductInfoComputation:function(k,f){var j=this,h=[];if(k.prodOfferPageInfo.serviceKind==null||k.prodOfferPageInfo.serviceKindIndex==null){return h;}var i=j.doAddServiceProductComputation(k,f);
var g=j.doChgServiceProductComputation(k,f);var e=j.doDelServiceProductComputation(k,f);return[].concat(i,g,e);},doDelServiceProductComputation:function(i,f){var h=this,e=dojo.filter(i.relaProdPageInfoList||[],function(j){return(!j.prodBasicInfo.checkedStatus&&j.prodBasicInfo.prodInstInfo!=null)||(i.prodOfferPageInfo.checkBoxValue==false&&j.prodBasicInfo.prodInstInfo!=null);
});if(i.prodOfferPageInfo.checkBoxValue==false){dojo.forEach(e||[],function(j){j.prodBasicInfo.backUpCheckedStatus=j.prodBasicInfo.checkedStatus;j.prodBasicInfo.checkedStatus=false;});}var g=h.createProdAcceptInfoList(e,i,f);
if(i.prodOfferPageInfo.checkBoxValue==false){dojo.forEach(e||[],function(j){j.prodBasicInfo.checkedStatus=j.prodBasicInfo.backUpCheckedStatus;});}return g;},doChgServiceProductComputation:function(h,f){if(h.prodOfferPageInfo.checkBoxValue==false&&h.prodOfferInst!=null){return[];
}var g=this,e=dojo.filter(h.relaProdPageInfoList||[],function(i){return i.prodBasicInfo.checkedStatus&&i.prodBasicInfo.prodInstInfo!=null&&h.prodOfferPageInfo.checkBoxValue;});return g.createProdAcceptInfoList(e,h,f);
},doAddServiceProductComputation:function(h,f){if(h.prodOfferPageInfo.checkBoxValue==false&&h.prodOfferInst!=null){return[];}var g=this,e=dojo.filter(h.relaProdPageInfoList||[],function(i){return i.prodBasicInfo.checkedStatus&&i.prodBasicInfo.prodInstInfo==null;
});return g.createProdAcceptInfoList(e,h,f);},doSerProductAcceptInfoComputation:function(g){var f=g.prodInstVO,h=g.prodPageData,e=g.productInfoVO;if(f!=null){if(h.prodBasicInfo.checkedStatus){return dojo.mixin(this._cloneBasicProperty(f),{operKind:2,ActionCD:c.ActionCDConst.PRODUCT_CHANGE});
}else{if(!h.prodBasicInfo.checkedStatus){return dojo.mixin(this._cloneBasicProperty(f),{operKind:3,ActionCD:c.ActionCDConst.PRODUCT_CANCEL});}}}else{return{operKind:1,ActionCD:c.ActionCDConst.PRODUCT_INSTALL};
}},createProdAcceptInfoList:function(f,h,e){var g=this;return dojo.map(f,function(i){var k=i.prodBasicInfo.productId,m=!!i.prodBasicInfo.prodInstInfo?i.prodBasicInfo.prodInstInfo:null,l=e||{},q=null,n=null;
var o=g.getVirtualUserId(h.prodOfferPageInfo.serviceKind,h.prodOfferPageInfo.serviceKindIndex),p={userId:o,accProdInstId:o,prodInstId:m!=null?m.prodInstId:-1},j=BusCard.find(a.ProdOfferHelper.getProductList(true,h.subProdOfferInfo),function(s){return s.productId==k;
}),r=g._cloneBasicProperty(j.productInfoVO);dojo.mixin(r,j);dojo.mixin(r,l);dojo.mixin(r,g.doSerProductAcceptInfoComputation({productInfoVO:j.productInfoVO,prodInstVO:m,prodPageData:i}));dojo.mixin(r,p);
r.prodId=k;r.prodOfferId=h.subProdOfferInfo.prodOfferId;r.prodType=j.productInfoVO.prodBundleType;r.prodTypeCd=j.productInfoVO.prodBundleType;r.prodName=j.productInfoVO.productName;if(a.PRODUCTTYPE.ACCESS_PROD_TYPE==j.productInfoVO.prodFuncType){r.ifNeedCreateProdInst=0;
}else{r.ifNeedCreateProdInst=1;}if(j.productInfoVO.prodCompDetailList&&j.productInfoVO.prodCompDetailList.length>0){r.relaType=a.PRODOFFERTYPE.OFFER_COMB_MEMBER;}else{r.relaType=a.PRODOFFERTYPE.OFFER_PRODUCT;
}if(!r.accessLevel){r.accessLevel=c.AccessLevelConst.SERVICE_LEVEL;}g.dealProductDate(r,h,i);q=g.doSerProdAttrListComputation(j.productInfoVO,i,l);if("101"==j.productInfoVO.prodFuncType){n=g.buildAccessProdAcceptInfoVO(r);
}else{n=g.buildServiceProdAcceptInfoVO(r);}n.prodInstAttrList=q;return n;});},dealProductDate:function(e,g,f){if(g.prodOfferInst==null){return;}else{if(g.prodOfferInst!=null){if(g.prodOfferPageInfo.checkBoxValue){if(f.prodBasicInfo.checkedStatus&&f.prodBasicInfo.prodInstInfo==null){e.effDate=dojo.global.$appContext$.requestParam.today;
}else{if(!(f.prodBasicInfo.checkedStatus)&&f.prodBasicInfo.prodInstInfo!=null){e.expDate=dojo.global.$appContext$.requestParam.today;}}}else{if(!(g.prodOfferPageInfo.checkBoxValue)){return;}}}}},doSerProdAttrListComputation:function(e,f,g){var h=this;
return h.doProdAttrInfoListComputation(e,f,g);},doAccountInfoComputation:function(){var k=this.controller.route("/self/getNewServiceInfoList");if(!k||k.length==0){return{};}var l=this.controller.route("/payRelationWidgetInstance/getData"),j=this.getCustomerData(),g=this.getCommInfo(),f=this,i={};
dojo.mixin(i,j);dojo.mixin(i,g);if(l==false){return false;}else{var e=l.accountInfo,h=l.payRelationInfo;return{accountAcceptInfoList:dojo.map(e||[],function(n){var m=dojo.clone(n);dojo.mixin(m,i);return f.buildAccountAcceptInfoVO(m);
}),accountRelaList:dojo.map(h||[],function(m){var n=dojo.clone(m);dojo.mixin(n,i);return f.buildProdInstAcctTempVO(n);})};}},doRelaBusTempListComputation:function(h){var j=this,i=[],e=null,g=[],f=null;
list=h.relaBusPageInfoList;dojo.forEach(list,function(l){var k=c.load("FavourKindConst").FavourKindConst;if(l.favourKind==k.OCS_FAVOUR){f=j.buildOcsSubseridBusTempVO(l);g.push(f);}else{e=j.buildRelaBusVO(l);
i.push(e);}});return{ocsRelaList:g,relaBusInfoList:i};},doResRelaInfoListComputation:function(h){var i=this,f=[],e=null,g=h.resRelaPageInfoList;dojo.forEach(g,function(j){e=i.buildResRelaInfoVOBean(j);
f.push(e);});return f;},doProdOfferAssureInfoListComputation:function(g){var i=this;var f=g.prodOfferAssurePageInfoList;var e=[];var h={};if(!!f){e.push(i.buildProdOfferInstAssureVO(f));}return e;},doSalesPromotionInfoComputation:function(){var g=this,e=this.controller.getSubProdOfferPageData();
if(!e){return false;}var f=dojo.map(e||[],function(u){var s=u.showData.promotionInfo;var k=u.promotionPageInfo;var o=null;var p=dojo.clone(s);var r=dojo.global.$appContext$.get("requestParam");var v=g.getCommInfo();
var t=a.ProdOfferHelper.getProductDateBuilder(s,{changeKind:1,delayUnit:k.delayUnit,delayTime:k.delayTime,validType:k.validType,validPeriod:k.validPeriod,beginDate:k.startDate,endDate:k.endDate});var n={effDate:k.startDate,expDate:k.endDate};
var i={};dojo.mixin(i,v);dojo.mixin(i,n);dojo.mixin(p,n);dojo.mixin(p,{serviceId:g.getCheckServiceId(k)});dojo.mixin(p,g.doProdOfferAcceptInfoComputation({prodOfferInfoVO:s,offerInstVO:null,prodOfferPageData:k}));
dojo.mixin(p,r);dojo.mixin(p,r.customerData);dojo.mixin(p,v);dojo.mixin(p,{targetProductId:k.productId});dojo.mixin(p,{serviceKind:k.serviceKind});dojo.mixin(p,{targetprodOfferId:k.prodOfferId});dojo.mixin(p,{remark:s.remark});
dojo.mixin(p,{targetObjectType:u.showData.statusObj});dojo.mixin(p,{rateFlag:u.rateFlag});dojo.mixin(p,{ifOcs:s.ifCos});dojo.mixin(p,{expDate:k.endDate});o=g.buildSalesPromotionAcceptInfo(p);var q=g.doSalesPromotionItemsComputation(u,i);
var h=g.doPromotionResRelaComputation(u);o.promotionItemList=q||[];o.deviceRentBusTempList=h.deviceRentBusTempList;o.rentSubsidyTempList=h.rentSubsidyTempList;o.offerResInstRelaList=h.offerResInstRelaList;
var m=g.doPromotionAssurePageInfoCoputation(u);o.prodOfferInstAssureList=m||[];o.promotionStatusCd=u.promotionStatusCd;var w=s.promotionType;if(w==5){var j=s.proodOfferInfo.resRelaList;var l=dojo.some(j||[],function(x){return x.mktResCd==27;
});if(l){o.ifHasSubsidy="1";}}return o;});return{promotionAcceptInfoList:f||[]};},doSalesPromotionItemsComputation:function(g,e){var i=this,f=[];if(!!g.promotionItemsPageInfoList){f=i.doPromotionItemsInfoComputation(g,{promotionPageInfo:g.promotionItemsPageInfoList,dataType:"userData"},e);
}else{var h=g.showData.promotionInfo.salesPromotionItemList;f=i.doPromotionItemsInfoComputation(g,{promotionPageInfo:a.AttrUtil.getPromotionItemValue(h),dataType:"standardData"},e);}return f;},doPromotionItemsInfoComputation:function(r,o,e){var j=this;
var i=r.showData.promotionInfo;var g=dojo.map(i.salesPromotionItemList||[],function(t){return t.attrSpec;});var l=[];var e=e||{};var h=function(t){return BusCard.find(g,function(u){return u.attrCd==t;});
};if(o.promotionPageInfo){for(var k in o.promotionPageInfo){var p=o.promotionPageInfo[k];var n=o.dataType;var q=h(k);if(q.isFeeAttr==1){if(n=="userData"){if(p!=0){p=j.moneyConvert(p,2);}}}if(q&&p){var s=this.buildAttrInstItemVO(dojo.mixin(this.getAttrInfoVOTemplate(1,q.attrId,k,p),e));
var f=dojo.filter(i.salesPromotionItemList||[],function(t){return k==t.attrSpec.attrCd;})[0];var m=this.buildPromotionItemVOBean(f);m.attrSpec=s;l.push(m);}}}return l;},moneyConvert:function(i,g){i=i.toString();
var k=/^\s*(\d+)\.(\d+)\s*$/g;var e=k.exec(i);if(e){var f=e[2];if(f.length<g){var j=g-f.length;while(j--){f=f+"0";}}return parseInt(e[1]+f.substring(0,g));}else{var h=parseInt(i);while(g--){h=h*10;}return h;
}},getCheckServiceId:function(i){var f=dojo.global.$appContext$.get(this.MAIN_KEY);var e=f.productInfoList;var g=dojo.filter(e||[],function(k){var j=k.prodBasicInfo;return j.serviceKindIndex==i.serviceKindIndex&&j.productId==i.productId;
});var h="";if(g&&g.length>0){h=g[0].serviceInfo.serviceId;}return h;},doPromotionResRelaComputation:function(o){var l=this,i=[],p=[],g=null,f=null,m=null,n={},j={},h={},e=[],k=o.resRelaPageDataList;dojo.forEach(k||[],function(s){if(s.mktResCd&&s.mktResCd==a.RES_RELA_CONST.SUBSIDY_ACCEPT){j.buildDate=s.advancedEffDate;
j.beginDate=s.advancedEffDate;var q=a.DateHelper.getDateFromString(s.advancedEffDate);var r=s.advancedDays&&typeof(s.advancedDays)!="undefined"?parseInt(s.advancedDays):0;q.setMonth(q.getMonth()+r);var t=a.DateHelper.formatDate(q);
j.endDate=t;j.subsidyFee=s.subFee&&typeof(s.subFee)!="undefined"?s.subFee:0;f=l.buildRentSubsidyTempVO(j);i.push(f);}else{if(s.mktResCd&&s.mktResCd==a.RES_RELA_CONST.GIFT_ACCEPT){j.buildDate=s.advancedEffDate;
j.beginDate=s.advancedEffDate;var q=a.DateHelper.getDateFromString(s.advancedEffDate);var r=s.advancedDays&&typeof(s.advancedDays)!="undefined"?parseInt(s.advancedDays):0;q.setMonth(q.getMonth()+r);var t=a.DateHelper.formatDate(q);
j.endDate=t;j.subsidyFee=s.advancedPayment&&typeof(s.advancedPayment)!="undefined"?s.advancedPayment:0;f=l.buildRentSubsidyTempVO(j);i.push(f);n=l.buildOfferResInstRela(s,"gift");g=l.buildOfferResInstRelaVO(n);
e.push(g);h=l.buildDeviceRentInfo(s);m=l.buildDeviceRentBusTempVO(h);p.push(m);n=l.buildOfferResInstRela(s,"giftrent");g=l.buildOfferResInstRelaVO(n);e.push(g);}else{if(s.mktResCd&&(s.mktResCd==a.RES_RELA_CONST.RENT_ACCEPT||s.mktResCd==a.RES_RELA_CONST.OTHER_RENT_ACCEPT)){h=l.buildDeviceRentInfo(s);
m=l.buildDeviceRentBusTempVO(h);p.push(m);n=l.buildOfferResInstRela(s,"rent");g=l.buildOfferResInstRelaVO(n);e.push(g);}}}});return{offerResInstRelaList:e,rentSubsidyTempList:i,deviceRentBusTempList:p};
},buildDeviceRentInfo:function(e){var f={};f.mobileAgent=e.mobileAgent;f.manufacturer=e.moblieSourse;f.deviceType=e.resourceKind;f.deviceNo=e.deviceNo;f.realPrice=e.realFee;f.costPrice=e.costFee;f.retailPrice=e.shouldFee;
f.rentKind=e.rentType;f.devColor=e.resourceColour;f.note=e.note;f.customerGroup=e.customerGroup;f.userSource=e.mobileType;f.confirmPrice=e.suggestFee;return f;},buildOfferResInstRela:function(f,e){var g={};
g.mktResTypeCd=f.mktResTypeCd;if(e=="rent"){g.mktResCd=f.mktResCd;g.mktResInstId=f.mktResInstId;g.modifyContentStr=f.modifyContent;}else{if(e=="giftrent"){g.mktResCd=a.RES_RELA_CONST.RENT_ACCEPT;g.mktResInstId=f.mktResInstId;
g.modifyContentStr=f.modifyContent;}else{g.mktResCd=f.mktResCd;g.mktResInstId=f.mktGiftResInstId;g.modifyContentStr=f.modifyGiftContent;}}return g;},doPromotionAssurePageInfoCoputation:function(h){var i=this;
var g=[];var f=h.promotionAssurePageInfoList;if(f){var e=i.buildProdOfferInstAssureVO(f);g.push(e);}return g;},convertFeeAttr:function(g,f){var e=f;if(!!g&&!!f&&!isNaN(f)){if(g.valueUnit==a.AttrUnitConst.unitConst||g.valueUnit==a.AttrUnitConst.minuteConst){e=a.AttrUtil.accMul(parseFloat(f+""),100)+"";
}}return e;}});});
defineModule("orderaccept.prodofferaccept.widget.prodoffersearchlist.ProdOfferSearchListWidget",["orderaccept.custom._BaseWidget","orderaccept.custom._BusCardTemplated"],function(b,a){dojo.declare("orderaccept.prodofferaccept.widget.prodoffersearchlist.ProdOfferSearchListWidget",[b,a],{templateString:"<div><ul class='favori_ul'>										<tp:for ds='prodOfferList'>										<li style='cursor:pointer;list-style-type:none;' prodOfferId='${prodOfferId}' class='prodoffer-search-item' dojoAttachEvent='ondblclick:elementdblclick,onmouseover:elementmouseover,onmouseout:elementmouseout' dojoAttachTopic='/searchProdItem'>										<a href='javascript:void(0);'><span dojoAttachEvent='onmouseover:elementmouseover,onmouseout:elementmouseout' dojoAttachTopic='/searchProdItem-span'>${prodOfferName}</span></a></li></tp:for></ul></div>",postMixInProperties:function(){this.prodOfferList=dojo.global.$appContext$.get("_searchProdOfferList");
}});});
defineModule("orderaccept.prodofferaccept.widget.subprodoffernum.SubProdOfferNumWidget",["orderaccept.custom.TooltipDialog"],function(a){dojo.declare("orderaccept.prodofferaccept.widget.subprodoffernum.SubProdOfferNumWidget",[a],{constructor:function(){this.inherited(arguments);
this.chooseNumberList=arguments[0].chooseNumberList;this.subProdOfferDetail=arguments[0].subProdOfferDetail;this.subProdOfferCartDataProvider=arguments[0].subProdOfferCartDataProvider;this.bindingData=arguments[0].bindingData;
},postscript:function(){this.inherited(arguments);var f=this.subProdOfferDetail.prodOfferId;var e=dojo.filter(this.bindingData,function(j){var g=j.showData,h=g.subProdOfferInfo,i=h.prodOfferId;return f==i;
});var d="<div class='buscard-root' style='display:block'>										 <div class='buscard-legend'>											<span class='buscard-legend-img'></span>											<span class='buscard-legend-text' id='buscard-name'>号码信息</span>										 </div>										 <div class='buscard-content'> ";
var b=1;dojo.forEach(this.chooseNumberList,function(i){var g="";if(b%2==1){d+="<div class='buscard-row'>";}var h=dojo.filter(e,function(n){var j=n.showData,m=j.chooseNumberObj,l=m.serviceKind,k=m.serviceKindIndex;
return l==i.serviceKind&&k==i.serviceKindIndex;});if(h&&h.length>0){g=" checked='checked' disabled=true ";}d+=" <span>										<input type='checkbox' class='subProdOfferNumBox' id='subProdOfferNumBox' "+g+"											name='subProdOfferNumBox' value='"+i.serviceId+"' 											serviceKind='"+i.serviceKind+"' serviceKindIndex='"+i.serviceKindIndex+"' 											uniqueId ='"+i.uniqueId+"' defaultNumber='"+i.serviceId+"' productId='"+i.productId+"' />:										<input type='text' disabled='disabled'  value='"+i.serviceId+"' /> 									</span>";
if(b%2==0){d+="</div>";}b++;});d+="</div></div>";dojo.place(d,this.containerNode,"last");var c="<div style='text-align:center;vertical-align:middle'><a href='javascript:void(0);' dojoAttachEvent='onclick:elementclick'			        		dojoAttachTopic='/subProdOfferNumBtn' toolTipId='"+this.id+"' style='text-align:center;vertical-align:middle;'>确定</a></div>";
dojo.place(c,this.containerNode,"last");this.enableEvtMsgPropagation(this.containerNode);}});});
defineModule("orderaccept.prodofferaccept.widget.serviceinfolist.ServiceInfoListWidget",["orderaccept.custom.TooltipDialog"],function(a){dojo.declare("orderaccept.prodofferaccept.widget.serviceinfolist.ServiceInfoListWidget",[a],{constructor:function(){this.inherited(arguments);
this.productId=arguments[0].productId;this.cityCode=arguments[0].cityCode;this.customerId=arguments[0].customerId;this.uniqueId=arguments[0].uniqueId;},postscript:function(){this.inherited(arguments);this.initChooseNumberTable();
},initChooseNumberTable:function(){var e=this,b=new BusCard.widget.grid.ColumnModel({metaData:this.getServiceInfoColumns()}),f=BusCard.$remote("secondAcceptCommBO").getServiceInfoCountByCustomerIdAndProdId(e.customerId,e.cityCode,e.productId),d=new BusCard.widget.grid.JsonDataSource({loadData:function(h){var g=BusCard.$remote("secondAcceptCommBO").getServiceInfoConversionByCustomerIdAndProdId(e.customerId,e.cityCode,e.productId,h.start,h.end);
return{totalProperty:f,root:g};}},b);var c=new orderaccept.custom.BusCardGrid({cm:b,ds:d,paging:true,pageSize:5},this.containerNode);},getServiceInfoColumns:function(){var b=this;return cm=[{width:"15%",text:"选择",name:"checkService",render:function(h,e,c){var i=c.getByName("serviceId");
var j=c.getByName("prodOfferInstId");var f=c.getByName("userId");var g=c.getByName("serviceKind");var d=BusCard.Template.create("<input type = 'radio' productUniqueId='${uniqueId}'  prodOfferInstId = '${prodOfferInstId}' cityCode='${cityCode}' serviceKind='${serviceKind}' dojoAttachEvent='onclick:elementclick' dojoAttachTopic='/oldnumberselect' serviceId='${serviceId}' userId='${userId}'/>").apply({serviceId:i,prodOfferInstId:j,cityCode:b.cityCode,serviceKind:g,userId:f,uniqueId:b.uniqueId});
return d;}},{cssStyle:"width:80px",text:"实例编号",name:"userId"},{cssStyle:"width:180px",text:"产品名称",name:"productName"},{cssStyle:"width:100px",text:"入网时间",name:"applyStartDate"},{cssStyle:"width:100px",text:"产品接入号码",name:"serviceId"},{cssStyle:"width:60px",text:"服务状态",name:"servingStatusName"},{text:"",name:"prodOfferInstId",cssStyle:"display:none"},{text:"",name:"serviceKind",cssStyle:"display:none"}];
}});});
defineModule("orderaccept.prodofferaccept.behavior.ProdOfferNewBehavior",["../util","../widget/prodoffersearchlist/ProdOfferSearchListWidget","../widget/attrcard/ProductAttrCardWidget","../widget/subprodoffernum/SubProdOfferNumWidget","../widget/serviceinfolist/ServiceInfoListWidget","orderaccept.common.js.ConstantsPool","orderaccept.custom.popup","orderaccept.common.dialog.MessageBox","../widget/prodoffersearchlist/SubProdOfferSearchListWidget","../widget/promotionsearchlist/PromotionSearchListWidget","../widget/mainprodoffer/orderPreViewWidget","../widget/prodofferfavoritelist/personalSubCollectMoreListWidget"],function(j,h,e,g,c,i,b,d,a,f,k,l){dojo.declare("orderaccept.prodofferaccept.behavior.ProdOfferNewBehavior",[],{controller:null,handleRegistry:null,promotionRefreshWidget:null,refreshWidget:null,mainProductChangeRefreshWidget:null,constructor:function(m){this.controller=m;
this.handleRegistry=[];},postscript:function(){this.subscribe();},subscribe:function(){var o=this;var n=this.controller;this.handleRegistry.push(dojo.subscribe("/mainProdOfferDetail/click",function(p){o.onMainProdOfferDetailClick.apply(o,arguments);
}));this.handleRegistry.push(dojo.subscribe("/mainProdOfferDetailBtn/click",function(p){var q=j.DomHelper.getParentWidget(p.currentTarget,"orderaccept.custom.TooltipDialog");orderaccept.custom.popup.close({widget:q,notHandleData:true});
}));this.handleRegistry.push(dojo.subscribe("/serviceProdOfferAttr/click",function(){o.onServiceProdOfferAttrClick.apply(o,arguments);}));this.handleRegistry.push(dojo.subscribe("/batchServiceProdOfferAttr/click",function(){o.onBatchServiceProdOfferAttrClick.apply(o,arguments);
}));this.handleRegistry.push(dojo.subscribe("/serviceProdCheck/click",function(){o.onServiceProdCheckClick.apply(o,arguments);}));this.handleRegistry.push(dojo.subscribe("/accessprodattr/click",function(p){return o.onMainProdAttrClick(p);
}));this.handleRegistry.push(dojo.subscribe("/mainProdOfferTree/dblclick",function(){o.onMainProdOfferTreeNodeClick.apply(o,arguments);}));this.handleRegistry.push(dojo.subscribe("/prodOfferSearch/keyup",function(){o.onMainProdOfferSearchKeyup.apply(o,arguments);
}));this.handleRegistry.push(dojo.subscribe("/clickProdOfferSearch/click",function(){o.onMainProdOfferSearchKeyup.apply(o,arguments);}));this.handleRegistry.push(dojo.subscribe("/prodOfferSearch/focus",function(){o.onMainProdOfferSearchFocus.apply(o,arguments);
}));this.handleRegistry.push(dojo.subscribe("/prodOfferSearch/blur",function(){o.onMainProdOfferSearchBlur.apply(o,arguments);}));this.handleRegistry.push(dojo.subscribe("/prodOfferOpenAdvanceSearch/click",function(p){o.onOpenAdvanceSearchClick(p);
}));this.handleRegistry.push(dojo.subscribe("/advancesearch/click",function(p){o.onAdvanceSearchClick(p);}));this.handleRegistry.push(dojo.subscribe("/prodBigKid/change",function(p){o.getProdByProdBigKind(p);
}));this.handleRegistry.push(dojo.subscribe("/prodAdvance/change",function(p){var q=p.currentTarget.value;o.prodAdvanceChang(q);}));this.handleRegistry.push(dojo.subscribe("/searchProdItem/dblclick",function(p){o.controller.changeMainProdOffer(p.currentTarget.getAttribute("prodOfferId"),p.currentTarget);
}));this.handleRegistry.push(dojo.subscribe("/mainProdOfferTree/mouseover",function(){o.onMainProdOfferTreeNodeMouseOver.apply(o,arguments);}));this.handleRegistry.push(dojo.subscribe("/mainProdOfferTree/mouseout",function(){o.onProdOfferInfoMouseOut.apply(o,arguments);
}));this.handleRegistry.push(dojo.subscribe("/prodOfferTips/mouseover",function(p){o.onMainProdOfferMouseOver(p);}));this.handleRegistry.push(dojo.subscribe("/prodOfferTips/mouseout",function(p){o.onProdOfferInfoMouseOut(p);
}));this.handleRegistry.push(dojo.subscribe("/peddleProdOfferItem/dblclick",function(p){o.controller.changeMainProdOffer(p.currentTarget.getAttribute("prodOfferId"),p.currentTarget);}));this.handleRegistry.push(dojo.subscribe("/hotProdOfferItem/dblclick",function(p){o.controller.changeMainProdOffer(p.currentTarget.getAttribute("prodOfferId"),p.currentTarget);
}));this.handleRegistry.push(dojo.subscribe("/personalProdOfferItem/dblclick",function(p){o.controller.changeMainProdOffer(p.currentTarget.getAttribute("prodOfferId"),p.currentTarget);}));var m=["/morePersonalItem/click","/morePeddleItem/click","/moreHotItem/click"];
dojo.forEach(m,function(p){o.handleRegistry.push(dojo.subscribe(p,function(q){var r=dijit.getEnclosingWidget(q.currentTarget);if(r.renderMore){r.renderMore();}o.controller.showMoreProdOffer(q.srcElement);
}));});this.handleRegistry.push(dojo.subscribe("/prodOfferCollect/click",function(p){return o.onCollectProdOfferClick(p);}));this.handleRegistry.push(dojo.subscribe("/prodOfferCancelCollect/click",function(p){return o.onCancelCollectProdOfferClick(p);
}));this.handleRegistry.push(dojo.subscribe("/belongCode/change",function(){return o.onBelongCodeChange();}));this.handleRegistry.push(dojo.subscribe("/searchnumber/click",function(p){return o.onSearchNumberClick(p);
}));this.handleRegistry.push(dojo.subscribe("/oldnumberselect/click",function(p){return o.onOldNumberSelect(p);}));this.handleRegistry.push(dojo.subscribe("/addproduct/click",function(p){return o.onAddProductClick(p);
}));this.handleRegistry.push(dojo.subscribe("/delproduct/click",function(p){return o.onDelProductClick(p);}));this.handleRegistry.push(dojo.subscribe("/subProdOfferTree/dblclick",function(){return o.onSubProdOfferTreeNodeClick.apply(o,arguments);
}));this.handleRegistry.push(dojo.subscribe("/prodOfferLink/click",function(p){return o.onProdOfferDetailClick(p);}));this.handleRegistry.push(dojo.subscribe("/subProdOfferTree/mouseover",function(){o.onMainProdOfferTreeNodeMouseOver.apply(o,arguments);
}));this.handleRegistry.push(dojo.subscribe("/subProdOfferTree/mouseout",function(){o.onProdOfferInfoMouseOut.apply(o,arguments);}));this.handleRegistry.push(dojo.subscribe("/personalSubProdOfferItem/dblclick",function(p){return o.showSubProdOffer(p.currentTarget.getAttribute("prodOfferId"),{domNode:p.currentTarget});
}));this.handleRegistry.push(dojo.subscribe("/searchSubProdOfferItem/dblclick",function(p){return o.showSubProdOffer(p.currentTarget.getAttribute("prodOfferId"),{domNode:p.currentTarget});}));this.handleRegistry.push(dojo.subscribe("/prodOfferName/mouseover",function(p){return o.onSubProdOfferNameMouseOver(p);
}));this.handleRegistry.push(dojo.subscribe("/prodOfferName/mouseout",function(p){return o.onProdOfferInfoMouseOut(p);}));this.handleRegistry.push(dojo.subscribe("/prodOfferDetailBtn/click",function(p){return o.onProdOfferDetailBtnClick(p);
}));this.handleRegistry.push(dojo.subscribe("/batchProdOfferDetailBtn/click",function(p){return o.onBatchProdOfferDetailBtnClick(p);}));this.handleRegistry.push(dojo.subscribe("/checkProduct/click",function(p){return o.refreshSubProdOfferCart(p);
}));this.handleRegistry.push(dojo.subscribe("/subProdOfferCheck/click",function(p){return o.onSubProdOfferCheckBoxClick(p);}));this.handleRegistry.push(dojo.subscribe("/delSubProdOfferView/click",function(p){return o.onSubProdOfferDelViewClick(p);
}));this.handleRegistry.push(dojo.subscribe("/familyNumber/click",function(p){return o.onFamilyNumberClick(p);}));this.handleRegistry.push(dojo.subscribe("/familyUnit/click",function(p){return o.onFamilyUnitClick(p);
}));this.handleRegistry.push(dojo.subscribe("/familyNumberCh/click",function(p){return o.onFamilyNumberChClick.apply(o,arguments);}));this.handleRegistry.push(dojo.subscribe("/promotionTree/dblclick",function(){return o.onPromotionTreeNodeClick.apply(o,arguments);
}));this.handleRegistry.push(dojo.subscribe("/saveorder/click",function(p){return o.onSaveOrder.apply(o,arguments);}));this.handleRegistry.push(dojo.subscribe("/completeorder/click",function(p){return o.onCompleteOrder.apply(o,arguments);
}));this.handleRegistry.push(dojo.subscribe("/coutinueorder/click",function(p){return o.onCoutinueOrder(p);}));this.handleRegistry.push(dojo.subscribe("/promotionChecked/click",function(p){return o.onPromotionDetailCheckClick(p);
}));this.handleRegistry.push(dojo.subscribe("/feeModify/click",function(p){return o.onFeeModifyClick.apply(o,arguments);}));this.handleRegistry.push(dojo.subscribe("/feeConfirm/click",function(p){return o.onFeeConfirmClick.apply(o,arguments);
}));this.handleRegistry.push(dojo.subscribe("/couponsAdd/click",function(p){return o.onCouponsAddClick(p);}));this.handleRegistry.push(dojo.subscribe("/promotionDetailLink/click",function(p){return o.onPromotionDetailClick(p);
})),this.handleRegistry.push(dojo.subscribe("/promotionDetailBtn/click",function(p){return o.onPromotionDetailBtnClick(p);}));this.handleRegistry.push(dojo.subscribe("/custRecognitionPage/click",function(p){o.OnJump2CustRecognitionPage(p);
}));this.handleRegistry.push(dojo.subscribe("/orderDetailPage/click",function(p){o.OnJump2OrderDetailPage(p);}));this.handleRegistry.push(dojo.subscribe("/assureSelect/click",function(p){return o.showAssureQueryView(p);
}));this.handleRegistry.push(dojo.subscribe("/assureQuery/click",function(p){return o.onAssureQueryClick(p);}));this.handleRegistry.push(dojo.subscribe("/assureCommit/click",function(p){return o.onAssureCommitClick(p);
}));this.handleRegistry.push(dojo.subscribe("/assureCustSelect/click",function(p){return o.onAssureCustSelectClick(p);}));this.handleRegistry.push(dojo.subscribe("/assureAccountSelect/click",function(p){return o.onAssureAccountSelectClick(p);
}));this.handleRegistry.push(dojo.subscribe("/assureProductSelect/click",function(p){return o.onAssureProductSelectClick(p);}));this.handleRegistry.push(dojo.subscribe("/subProdSelect/click",function(p){return o.onSubProdSelectClick(p);
}));this.handleRegistry.push(dojo.subscribe("/subProdOfferNumBtn/click",function(p){return o.onSubProdOfferNumBtnClick(p);}));this.handleRegistry.push(dojo.subscribe("/manageAccNumBtn/click",function(p){return o.onManageAccNumBtnClick(p);
}));this.handleRegistry.push(dojo.subscribe("/mainprodoffer-confirm-button/click",function(p){return o.onMainProdOfferConfirm(p);}));this.handleRegistry.push(dojo.subscribe("/mainprodoffer-check-button/click",function(p){return o.onMainProdOfferCheck(p);
}));this.handleRegistry.push(dojo.subscribe("/addMemberProdOffer/click",function(p){return o.onAddMemeberProdOffer(p);}));this.handleRegistry.push(dojo.subscribe("/doCharge/click",function(p){return o.onDoChargeClick(p);
}));this.handleRegistry.push(dojo.subscribe("/backBatch/click",function(p){return o.onBackBatchClick(p);}));this.handleRegistry.push(dojo.subscribe("/saveBatch/click",function(p){return o.onSaveBatchClick(p);
}));this.handleRegistry.push(dojo.subscribe("/generationTemplate/click",function(p){return o.onGenerTemplateClick.apply(o,arguments);}));this.handleRegistry.push(dojo.subscribe("/radioBoxTargetNumberChg/click",function(p){return o.onPromotionTargetNumChgClick(p);
}));this.handleRegistry.push(dojo.subscribe("/accessProductSelect/change",function(p){return o.onAccessProductChange(p);}));this.handleRegistry.push(dojo.subscribe("/toMainProdOfferSelectPane/click",function(p){return o.onToMainProdOfferSelectPane(p);
}));this.handleRegistry.push(dojo.subscribe("/toOrderDetailPage/click",function(p){return o.onToOrderDetailPage(p);}));this.handleRegistry.push(dojo.subscribe("/personalProdOfferItem-span/mouseover",function(p){return o.onMainProdOfferTreeNodeMouseOver(p);
}));this.handleRegistry.push(dojo.subscribe("/personalProdOfferItem-span/mouseout",function(p){return o.onProdOfferInfoMouseOut(p);}));this.handleRegistry.push(dojo.subscribe("/hotProdOfferItem-span/mouseover",function(p){return o.onMainProdOfferTreeNodeMouseOver(p);
}));this.handleRegistry.push(dojo.subscribe("/hotProdOfferItem-span/mouseout",function(p){return o.onProdOfferInfoMouseOut(p);}));this.handleRegistry.push(dojo.subscribe("/peddleProdOfferItem-span/mouseover",function(p){return o.onMainProdOfferTreeNodeMouseOver(p);
}));this.handleRegistry.push(dojo.subscribe("/peddleProdOfferItem-span/mouseout",function(p){return o.onProdOfferInfoMouseOut(p);}));this.handleRegistry.push(dojo.subscribe("/searchProdItem-span/mouseover",function(p){return o.onMainProdOfferTreeNodeMouseOver(p);
}));this.handleRegistry.push(dojo.subscribe("/searchProdItem-span/mouseout",function(p){return o.onProdOfferInfoMouseOut(p);}));this.handleRegistry.push(dojo.subscribe("/subProdOfferSearch/keyup",function(){o.onSubProdOfferSearchKeyup.apply(o,arguments);
}));this.handleRegistry.push(dojo.subscribe("/subProdOfferSearch/focus",function(){o.onMainProdOfferSearchFocus.apply(o,arguments);}));this.handleRegistry.push(dojo.subscribe("/subProdOfferSearch/blur",function(){o.onMainProdOfferSearchBlur.apply(o,arguments);
}));this.handleRegistry.push(dojo.subscribe("/doPrint/click",function(){o.doPrint.apply(o,arguments);}));this.handleRegistry.push(dojo.subscribe("/promotionChangeDetailLink/click",function(p){o.onPromotionChangeDetailClick(p);
}));this.handleRegistry.push(dojo.subscribe("/promotionSearch/keyup",function(){o.onPromotionSearchKeyup.apply(o,arguments);}));this.handleRegistry.push(dojo.subscribe("/promotionSearch/focus",function(){o.onMainProdOfferSearchFocus.apply(o,arguments);
}));this.handleRegistry.push(dojo.subscribe("/promotionSearch/blur",function(){o.onMainProdOfferSearchBlur.apply(o,arguments);}));this.handleRegistry.push(dojo.subscribe("/searchPromotionItem/dblclick",function(p){o.showSalesPromotion(p.currentTarget.getAttribute("promotionId"));
}));this.handleRegistry.push(dojo.subscribe("/ordershow/click",function(){o.controller.showOrderPreView();}));this.handleRegistry.push(dojo.subscribe("/promotionCollect/click",function(p){return o.onCollectPromotionClick(p);
}));this.handleRegistry.push(dojo.subscribe("/promotionCancelCollect/click",function(p){return o.onCancelCollectPromotionClick(p);}));this.handleRegistry.push(dojo.subscribe("/personalPromotionItem/dblclick",function(p){o.showSalesPromotion(p.currentTarget.getAttribute("prodOfferId"));
}));this.handleRegistry.push(dojo.subscribe("/morePersonalSubItem/click",function(p){o.showMoreSubProdOffer(p);}));},showMoreSubProdOffer:function(m){var n=this;var x=n.controller;var v="";var q=m.currentTarget,t=q.getAttribute("subUniqueId");
if(t==""){v=$ac$.selectedMainProdOfferInfoVO.prodOfferId;}else{var s=$ac$.selectedMemberProdOfferList;var u=dojo.filter(s||[],function(y){return y.uniqueId==t;});if(u.length>0){v=u[0].prodOfferId;}}if(!dojo.global.$appContext$.get("_morePersonalSubProdOfferList"+t)){var o=dojo.global.$appContext$.get("_personalSubProdOfferList"+t);
var p=dojo.filter($ac$.get("_allSubProdOffers_")||[],function(y){return dojo.some($ac$.get("_allowProdOfferIds_"+v)||[],function(z){return z.prodOfferId==y.prodOfferId;})&&dojo.every(o||[],function(z){return z.prodOfferId!=y.prodOfferId;
});});dojo.global.$appContext$.set("_morePersonalSubProdOfferList"+t,p);if(x.personalSubCollectMoreListWidgetInstanceMap[t]){x.personalSubCollectMoreListWidgetInstanceMap[t].destroyRecursive();}var w=new l({uniqueId:t});
x.personalSubCollectMoreListWidgetInstanceMap[t]=w;dojo.place(w.domNode,dojo.byId("subCollect"+t),"last");}var r=m.srcElement;dojo.byId(r.name).style.display=(dojo.byId(r.name).style.display=="block")?"none":"block";
dojo.byId(r).innerHTML=(dojo.byId(r).text=="更多>>")?"隐藏<<":"更多>>";},onSaveBatchClick:function(n){this.setBatchButtonDisableStatus(true);if(this.batchCheck()){var o=$("batchForm");var p=dojo.global.$appContext$.get("templateId");
if(null==p){p=this.onGenerTemplateClick(null,true);if(!p){this.setBatchButtonDisableStatus(false);}}var A=dojo.query(".main-product-basic");var z=i.load("ServiceKindCDConst").ServiceKindCDConst.CDMA_SERVICE_KIND;
var s="0";if($ac$.selectedMainProdOfferInfoVO.bindType==2&&A.length>1){s="1";dojo.forEach(A,function(B){if(z!=B.getAttribute("serviceKind")){s="0";}});}var x=dojo.global.$appContext$.get("_batchRegNo");
var r=dojo.global.$appContext$.get("_productId");var v=dojo.global.$appContext$.get("_serviceOfferId");var w=unieap.byId("doStartTime").getValue();var q=unieap.byId("doEndTime").getValue();var u=unieap.byId("remark").getValue();
var t=unieap.byId("relationGroup").getValue();var y="&templateId="+p+"&batchRegNo="+x+"&productId="+r+"&serviceOfferId="+v+"&doStartTime="+w+"&doEndTime="+q+"&remark="+u+"&relationGroup="+t+"&ifCdmaBatch="+s;
if(!!u){var m=BusCard.$remote("batchInfoMgrBO");if(!!m&&!!m.doUpdateBatchInfoByBatchRegNo){m.doUpdateBatchInfoByBatchRegNo({batchRegNo:x,remark:u});}}o.action=BusCard.path.contextPath+"/batchServiceAcceptCommonAction.do?method=doAddBatchRecord"+y;
o.target="batchresult";o.submit();}else{this.setBatchButtonDisableStatus(false);}},setBatchButtonDisableStatus:function(m){var o=dojo.byId("batchBackButton");if(o){o.disabled=m;}var n=dojo.byId("batchSubmitButton");
if(n){n.disabled=m;}},onBackBatchClick:function(){var m=this;dojo.style(dojo.byId("prodoffer-accept-root"),{display:"block"});dojo.style(dojo.byId("order-show-root"),{display:"none"});m.controller.functionNavigatorWidget.switchGroup(0);
},batchCheck:function(){var o=unieap.byId("fileName").getValue();var n=unieap.byId("doStartTime").getValidator();var m=unieap.byId("doEndTime").getValidator();if(o==null||o==""){d.alert({busiCode:"08410094"});
return false;}else{if(!n.validate()){d.alert({busiCode:"08410095"});return false;}else{if(!m.validate()){d.alert({busiCode:"08410096"});return false;}}}return true;},onGenerTemplateClick:function(r,o){var q=dojo.global.$appContext$.get("_productId");
var p=dojo.global.$appContext$.get("_serviceOfferId");var s=dojo.global.$appContext$.get("_serviceKind");var t="&productId="+q+"&serviceOfferId="+p+"&serviceKind="+s;var m=j.ServiceFactory.getService("url:batchExecMemberAddAction.do?method=doQuery"+t);
if(m){var n=m.split("&");if(n.length==1){d.alert({busiCode:"08410097"});return false;}else{dojo.global.$appContext$.set("templateId",n[0]);if(!o){window.open(BusCard.path.contextPath+n[1]);}else{return n[0];
}}}},destroy:function(){dojo.forEach(this.handleRegistry,function(m){dojo.unsubscribe(m);});while(this.handleRegistry.length){this.handleRegistry.pop();}},onMainProdOfferDetailClick:function(n){var m=this.controller;
var o=dijit.getEnclosingWidget(n.currentTarget);if(o.declaredClass=="orderaccept.prodofferaccept.widget.mainprodoffer.MultipleMainProdOfferWidget"){orderaccept.custom.popup.open({widget:{popup:o.mainProdOfferDetailWidget,around:n.currentTarget}});
}else{orderaccept.custom.popup.open({widget:{popup:m.mainProdOfferDetailWidget,around:n.currentTarget}});}},onMainProdOfferSearchKeyup:function(n){var q=n.currentTarget.parentNode;var v=dojo.query("[id=prodOfferSearch]",q)[0];
var s=dojo.attr(v,"tips");var r=v.value;if((r!=s)&&(n.keyCode==13||v!==n.currentTarget)){if(r){var o=dojo.byId("common-belongcode").value;if(o=="210101"){d.alert({busiCode:"08410098"});Me.$("belongCodeColl").focus();
return false;}var w=this.controller.requestParam.customerData.custType;var t=this.controller.requestParam.customerData.custId;var u=this.controller.requestParam.customerData.cityCode;var p="belongCode="+o+"&prodName="+r+"&custType="+w+"&cityCode="+u+"&custId="+t+"&method=getProdOfferInfoByName"+this.controller.appendOfferFilterParameters();
var m=j.ServiceFactory.getService("url:shoppingCartAction.do?"+BusCard.util.native2ascii(p));dojo.global.$appContext$.set("_searchProdOfferList",m);if(this.controller.searchListWidgetInstance){this.controller.searchListWidgetInstance.destroy();
}this.controller.searchListWidgetInstance=new h();dojo.place(this.controller.searchListWidgetInstance.domNode,unieap.byId("mainProdOfferSearchResult").containerNode,"last");unieap.byId("TabContainer").selectChild(unieap.byId("mainProdOfferSearchResult"));
}}},onSubProdOfferSearchKeyup:function(n){var o=this;var s=n.currentTarget;var u=-1;while(true){var t=dijit.getEnclosingWidget(s);if(t.declaredClass==="unieap.layout.BorderContainer"){break;}if(u!=t.id){s=t.domNode;
}else{s=t.domNode.parentNode;}u=t.id;}var x=this.controller.multipleSubProdOfferHandler.subProdOfferOrderProviderMap[s.id];var v=null;var w="";if(x.contentPane){v=x.contentPane.prodOfferInfoVO.prodOfferId;
w=x.uniqueId||"";}else{v=$ac$.currentMainProdOfferInfoVO.prodOfferId;w=x.uniqueId||"";}if(n.keyCode==13){var r=BusCard.native2ascii(dojo.trim(n.currentTarget.value));if(r){var q="prodOfferName="+r+"&prodOfferId="+v+"&accProdListStr="+(o.controller.getAccProdIdList(w)||"")+"&method=getSubProdOfferInfoByName";
var m=j.ServiceFactory.getService("url:shoppingCartAction.do?"+q);dojo.global.$appContext$.set("_searchSubProdOfferList"+w,m);if(this.controller.searchSubListWidgetInstanceMap[w]){this.controller.searchSubListWidgetInstanceMap[w].destroy();
}var p=new a({uniqueId:w});this.controller.searchSubListWidgetInstanceMap[w]=p;dojo.place(p.domNode,unieap.byId("subProdOfferSearchResult"+w).containerNode,"last");unieap.byId("subProdOfferTab"+w).selectChild(unieap.byId("subProdOfferSearchResult"+w));
}}},onPromotionSearchKeyup:function(m){var n=this;if(m.keyCode==13){var q=BusCard.native2ascii(dojo.trim(m.currentTarget.value));if(q){var r=this.controller.getProductIdsAndSubProdOfferIds();var t=r.productIdList;
var o=r.subProdOfferIdList;var s=this.controller.mainProdOfferId;var p="&promotionName="+q+"&prodOfferIdList="+dojo.toJson(o)+"&productIdList="+dojo.toJson(t)+"&mainProdOfferId="+s;var u=j.ServiceFactory.getService("url:orderDetailAction.do?method=getPromotionListByName"+p);
dojo.global.$appContext$.set("_promotionSearchList",u);if(this.controller.promotionSearchListWidgetInstance){this.controller.promotionSearchListWidgetInstance.destroy();}this.controller.promotionSearchListWidgetInstance=new f();
dojo.place(this.controller.promotionSearchListWidgetInstance.domNode,unieap.byId("promotionSearchResult").containerNode,"last");unieap.byId("promotionTab").selectChild(unieap.byId("promotionSearchResult"));
}}},onMainProdOfferSearchFocus:function(n){var o=n.currentTarget;o.value=dojo.attr(o,"valueCache");if(o.createTextRange){var m=o.createTextRange();m.moveStart("character",o.value.length);m.collapse(true);
m.select();}else{if(typeof o.selectionStart=="number"){o.setSelectionRange(o.value.length,o.value.length);}}o.style.color="#000000";},onOpenAdvanceSearchClick:function(n){var m=unieap.byId("advanceSearchTip");
orderaccept.custom.popup.open({widget:{popup:m,around:n.currentTarget}});},onAdvanceSearchClick:function(n){var r=unieap.byId("advanceSearchTip");var t=dojo.query("[id='prodbigkind']",r.containerNode)[0].value,v=dojo.query("[id='prod']",r.containerNode)[0].value,s=dojo.query("[id='userType']",r.containerNode)[0].value,q=dojo.query("[id='cycleYear']",r.containerNode)[0].value,u=dojo.query("[id='bandwidth']",r.containerNode)[0].value,w=dojo.query("[id='accessMode']",r.containerNode)[0].value;
var o=dojo.byId("common-belongcode").value;if(o=="210101"){d.alert({busiCode:"08410098"});Me.$("belongCodeColl").focus();return false;}var p="method=getOfferListByProdAndOtherCondition";p+="&netType="+t;
p+="&productId="+v;p+="&belongCode="+(o=="-1"?"":o);p+="&userType="+(s=="-1"?"":s);p+="&cycleYear="+(q=="-1"?"":q);p+="&bandwidth="+(u=="-1"?"":u);p+="&accessMode="+(w=="-1"?"":w);var m=j.ServiceFactory.getService("url:shoppingCartAction.do?"+p+this.controller.appendOfferFilterParameters());
dojo.global.$appContext$.set("_searchProdOfferList",m);if(this.controller.searchListWidgetInstance){this.controller.searchListWidgetInstance.destroy();}this.controller.searchListWidgetInstance=new h();
dojo.place(this.controller.searchListWidgetInstance.domNode,unieap.byId("mainProdOfferSearchResult").containerNode,"last");unieap.byId("TabContainer").selectChild(unieap.byId("mainProdOfferSearchResult"));
orderaccept.custom.popup.close({widget:r});},getCard:function(){return this.busCardInstance;},getSelectList:function(n){var m=this.getCard();var o=[];o=BusCard.map(n,function(p){return{id:p.attrValue,name:p.attrValueName};
});o.unshift({id:"-1",name:"不区分"});return o;},getProdByProdBigKind:function(o){var p=o.currentTarget.value,n=BusCard.$remote("serviceParamBO").getProdByProdNetType(p),m=unieap.byId("advanceSearchTip");
BusCard.$rs(dojo.query("[id=prod]",m.containerNode)[0],n.list);this.prodAdvanceChang("-1");},prodAdvanceChang:function(p){advanceSearchWidget=unieap.byId("advanceSearchTip");var m=BusCard.$remote("innerInterfaceBO").doQueryCondition({serviceKind:dojo.query("[id='prodbigkind']",advanceSearchWidget.containerNode)[0].value,productId:dojo.query("[id='prod']",advanceSearchWidget.containerNode)[0].value});
var q=this.getSelectList(m.userTypeList);var n=this.getSelectList(m.productAccModeList);var o=this.getSelectList(m.productRateList);var r=this.getSelectList(m.offerCycleList);BusCard.$rs(dojo.query("[id=userType]",advanceSearchWidget.containerNode)[0],q);
BusCard.$rs(dojo.query("[id=accessMode]",advanceSearchWidget.containerNode)[0],n);BusCard.$rs(dojo.query("[id=bandwidth]",advanceSearchWidget.containerNode)[0],o);BusCard.$rs(dojo.query("[id=cycleYear]",advanceSearchWidget.containerNode)[0],r);
},onMainProdOfferSearchBlur:function(m){var n=m.currentTarget;if(n.value==""){dojo.attr(n,"valueCache","");n.value=dojo.attr(n,"tips");n.style.color="#cccccc";}else{dojo.attr(n,"valueCache",n.value);}},onMainProdOfferTreeNodeClick:function(p){var o=this;
var q=p.getData(),o=this,s=p.getData().id,m=p.getData().leaf,n=p.getData().isCatalog;if(m&&n!="1"){var r=true;r=o.controller.orderGroupProductCheck(p.getData().id);if(!r){return;}o.controller.changeMainProdOffer(s,p.domNode);
}else{!!p.tree&&!!p.tree.expandNode?p.tree.expandNode(p):null;}},onMainProdOfferTreeNodeMouseOver:function(p){var n=null,s=null;if(p&&p.getData){var q=p.getData(),m=this,s=p.getData().id,v=p.getData().leaf,w=p.getData().isCatalog,n=dojo.query(".dijitTreeLabel",p.domNode)[0];
if(w=="1"){return false;}}else{n=p.currentTarget;var u=j.DomHelper.findParentNode(n,function(A){return A.tagName.toUpperCase()=="LI";});s=dojo.attr(u,"prodOfferId");}var x=unieap.byId("prodOfferInfoTips"),z=j.ProdOfferHelper.getProdOfferDetail(s,{permitFromCache:true,permitCache:true,interfaceType:1}),o=z.prodOfferName,t=z.prodOfferDesc,y=z.effDate,r=z.expDate;
dojo.query("[id='prodoffer-name']",x.containerNode)[0].innerHTML=o;dojo.query("[id='prodoffer-desc']",x.containerNode)[0].innerHTML=t;dojo.query("[id='prodoffer-effDate']",x.containerNode)[0].innerHTML=y;
dojo.query("[id='prodoffer-expDate']",x.containerNode)[0].innerHTML=r;unieap.byId("prodOfferInfoTips").domNode.className="dijitTooltipDialog dijitTooltipRight";orderaccept.custom.popup.open({widget:{popup:x,around:n,pos:"R"}});
},onProdOfferInfoMouseOut:function(){var m=unieap.byId("prodOfferInfoTips");orderaccept.custom.popup.close({widget:m});},onMainProdOfferMouseOver:function(r){var p=j.ProdOfferHelper.getMainProdOffer(dojo.global.$appContext$.get("prodOfferList"))[0],o=unieap.byId("prodOfferInfoTips"),m=p.prodOfferName,s=p.prodOfferDesc,q=p.effDate,n=p.expDate;
dojo.query("[id='prodoffer-name']",o.containerNode)[0].innerHTML=m;dojo.query("[id='prodoffer-desc']",o.containerNode)[0].innerHTML=s;dojo.query("[id='prodoffer-effDate']",o.containerNode)[0].innerHTML=q;
dojo.query("[id='prodoffer-expDate']",o.containerNode)[0].innerHTML=n;unieap.byId("prodOfferInfoTips").domNode.className="dijitTooltipDialog dijitTooltipABLeft dijitTooltipBelow";orderaccept.custom.popup.open({widget:{popup:o,around:r.currentTarget}});
},onServiceProdOfferAttrClick:function(p){var o=p.currentTarget,q=o.getAttribute("rowIndex"),m=j.DomHelper.getParentWidget(p.currentTarget,"orderaccept.prodofferaccept.widget.serviceproduct.ServiceProductWidget"),n=m.serviceProdList,m=m.serviceProdAttrList[q];
orderaccept.custom.popup.open({widget:{popup:m,around:p.currentTarget}});},onBatchServiceProdOfferAttrClick:function(p){var o=p.currentTarget,q=o.getAttribute("rowIndex"),m=j.DomHelper.getParentWidget(p.currentTarget,"orderaccept.prodofferaccept.widget.serviceproduct.BatchServiceProductWidget"),n=m.serviceProdList,m=m.serviceProdAttrList[q];
orderaccept.custom.popup.open({widget:{popup:m,around:p.currentTarget}});},onServiceProdCheckClick:function(o){var n=o.currentTarget,p=n.getAttribute("rowIndex"),m=j.DomHelper.getParentWidget(o.currentTarget,"orderaccept.prodofferaccept.widget.serviceproduct.ServiceProductWidget");
m.handleServiceProduct(p,n);},onMainProdAttrClick:function(n){var u=n.currentTarget,m=j.DomHelper.findParentNode(u,function(w){return w.tagName.toUpperCase()=="TR";}),v=m.getAttribute("viewId"),q=dojo.query("select",m)[0].value,s=dojo.attr(m,"uniqueId"),t=function(){var w=m;
while(true){w=w.nextSibling;if(w&&(w.tagName||"").toUpperCase()=="TR"){break;}}return dojo.query(".mainProdServiceInfo-"+v,w)[0];}(),r=t.parentNode.parentNode;if(n.type=="program"){var o=/hidden\-elem/.test(t.parentNode.parentNode.className);
if(n.display===true){if(o){dojo.toggleClass(t.parentNode.parentNode,"hidden-elem");}}else{if(n.display===false){if(!o){dojo.toggleClass(t.parentNode.parentNode,"hidden-elem");}}}}else{dojo.toggleClass(t.parentNode.parentNode,"hidden-elem");
}if(dojo.hasClass(r,"hidden-elem")){dojo.removeClass(u,"product-serviceinfo-oper-open");dojo.addClass(u,"product-serviceinfo-oper-close");var p=this.controller.serviceCardWidgetMap["serviceCardWidget_"+s];
if(p&&p.attrCardWidget){p.attrCardWidget.completeRequiredState();}else{p.completeRequiredState();}}else{dojo.removeClass(u,"product-serviceinfo-oper-close");dojo.addClass(u,"product-serviceinfo-oper-open");
}},onCollectProdOfferClick:function(n){var m=n.currentTarget.getAttribute("value");var o=this;var x=unieap.byId("collectTips");if(m){var u=m.split("~");var s=u[0];var q=u[1];var w=u[2];var t=u[3];var v=this.controller.checkInstance.checkCollectProdOffer(s,w,t);
if(v||v==-1){dojo.query("[id='tip-info']",x.containerNode)[0].innerHTML="销售品已被收藏,不能重复收藏！";orderaccept.custom.popup.open({widget:{popup:x,around:n.currentTarget}});window.setTimeout(function(){o.onCollectTipsClose();
},1500);return;}var p="&prodOfferId="+s+"&prodOfferName="+BusCard.native2ascii(q)+"&prodOfferType="+w+"&mainProdOfferId="+t;var z=j.ServiceFactory.getService("url:prodOfferSaleAjaxAction.do?method=savePersonalCollectProdOffer"+p);
if(z){var r=z.split("~")[0];var y=z.split("~")[1];if(r=="success"){dojo.query("[id='tip-info']",x.containerNode)[0].innerHTML="销售品收藏成功！";}else{dojo.query("[id='tip-info']",x.containerNode)[0].innerHTML="收藏失败,原因为:"+y;
}orderaccept.custom.popup.open({widget:{popup:x,around:n.currentTarget}});window.setTimeout(function(){o.onCollectTipsClose();},1500);}}},onCancelCollectProdOfferClick:function(n){var m=n.currentTarget.getAttribute("value"),v=unieap.byId("collectTips"),o=this;
if(m){var s=m.split("~");var q=s[0];var u=s[1];var r=s[2];}var t=this.controller.checkInstance.checkCollectProdOffer(q,u,r);if(t==-1){dojo.query("[id='tip-info']",v.containerNode)[0].innerHTML="系统默认收藏,不能进行删除！";
orderaccept.custom.popup.open({widget:{popup:v,around:n.currentTarget}});window.setTimeout(function(){o.onCollectTipsClose();},1500);return;}if(!t){dojo.query("[id='tip-info']",v.containerNode)[0].innerHTML="未收藏,不能进行删除操作！";
orderaccept.custom.popup.open({widget:{popup:v,around:n.currentTarget}});window.setTimeout(function(){o.onCollectTipsClose();},1500);return;}var p="&prodOfferId="+q;var w=j.ServiceFactory.getService("url:prodOfferSaleAjaxAction.do?method=deleteCollectProdOffer"+p);
if(w){if(parseInt(w)>0){dojo.query("[id='tip-info']",v.containerNode)[0].innerHTML="已收藏销售品删除成功！";orderaccept.custom.popup.open({widget:{popup:v,around:n.currentTarget}});window.setTimeout(function(){o.onCollectTipsClose();
},1500);}}},onCollectTipsClose:function(m){var n=unieap.byId("collectTips");orderaccept.custom.popup.close({widget:n});},onBelongCodeChange:function(){var m=this.controller;m.renderProdOfferFavorite();
if(m.mainProdOfferTree){m.mainProdOfferTree.destroy();m.renderMainProdOfferTree();}if(m.searchListWidgetInstance){m.searchListWidgetInstance.destroy();dojo.byId("prodOfferSearch").value="";}if(m.shoppingCartWidgetInstance){m.shoppingCartWidgetInstance.destroyRecursive();
m.shoppingCartWidgetInstance=null;}m.clear();m.mainProdOfferId="";},onSearchNumberClick:function(v){var t=v.currentTarget,m=t.parentNode.parentNode.parentNode,u=m.getAttribute("viewId"),o=m.getAttribute("productId"),r=m.getAttribute("uniqueId"),q=dojo.attr(m,"userId"),w=dojo.attr(m,"prodInstId"),p=dojo.global.$appContext$.get("requestParam");
if(q||w){unieap.showTooltip("<p style='color:red'>\u6b64\u4ea7\u54c1\u5b58\u5728\u5df2\u6709\u7528\u6237</p>",t,["below","after"]);setTimeout(function(){unieap.hideTooltip(t);},4000);return false;}if(dojo.query(".serviceOperOld-"+u)[0].checked==true){if(dojo.query(".serviceOperOld-"+u)[0].checked!=true){return;
}var n={id:"selectOldNumberWidget~"+r,uniqueId:r,productId:o,cityCode:p.customerData.cityCode,customerId:p.customerData.custId},s=unieap.byId("selectOldNumberWidget~"+r);if(!s){s=new c(n);}orderaccept.custom.popup.open({widget:{popup:s,around:v.currentTarget}});
}},onOldNumberSelect:function(v){var p=v.currentTarget;var t=dojo.attr(p,"serviceId");var o=dojo.attr(p,"userId");var q=dojo.attr(p,"productUniqueId");var m=dojo.attr(p,"prodOfferInstId");var s=dojo.attr(p,"cityCode");
var u=dojo.attr(p,"serviceKind");var r=unieap.byId("selectOldNumberWidget~"+q);var n="&cityCode="+s+"&serviceId="+t+"&serviceKind="+u+"&userId="+o;var w=j.ServiceFactory.getService("url:prodOfferSaleAjaxAction.do?method=doCheckUncomplete"+n);
if(w&&w.flag<0){d.alert({busiCode:"08410099",infoList:[w.message]});orderaccept.custom.popup.close({widget:r});return false;}if(!this.controller.route("/checkInstance/doCheckIfCanChange",[$ac$.currentMainProdOfferInfoVO,m,q])){return false;
}if(!this.controller.route("/checkInstance/doChekOldUserServiceReserve",[m,t])){return false;}if(!this.controller.route("/checkInstance/doCheckProductRestFee",[$ac$.currentMainProdOfferInfoVO,m,q,o,t])){return false;
}this.controller.oldUserAddedHandler.addOldUser({serviceId:t,userId:o,prodInstId:o,prodOfferInstId:m,uniqueId:q});orderaccept.custom.popup.close({widget:r});return false;},onAddProductClick:function(p){var q=p.currentTarget,m=this.controller;
while(true){if(q&&(q.tagName||"").toUpperCase()=="TR"){break;}q=q.parentNode;}var o=parseInt(q.getAttribute("maxCount"))||0;count=dojo.query("."+q.getAttribute("viewId")).length,viewId=q.getAttribute("viewId");
if(count>=o){var n=dojo.query("[name=mainProdSel-"+viewId+"]",q)[0].options[0].text;d.alert({busiCode:"08410100",infoList:[n,o]});return false;}else{return this.controller.route("/mainProdOfferWidget/insertMainProductRow",dojo.attr(q,"uniqueId"),function(r){m.addServiceCardWidget(r);
});}},onDelProductClick:function(n){var o=n.currentTarget,m=this.controller;while(true){if(o&&(o.tagName||"").toUpperCase()=="TR"){break;}o=o.parentNode;}return this.controller.route("/mainProdOfferWidget/removeMainProductRow",dojo.attr(o,"uniqueId"),function(p){m.removeServiceCardWidget(p);
});},onSubProdOfferTreeNodeClick:function(p){var q=p.getData(),o=this,r=p.getData().id,m=p.getData().leaf,n=p.getData().isCatalog;if(m&&n!="1"){o.showSubProdOffer(r,p);}},showSubProdOffer:function(m,n){var o=n.domNode;
var r=-1;while(true){var q=dijit.getEnclosingWidget(o);if(q.declaredClass==="unieap.layout.BorderContainer"){break;}if(r!=q.id){o=q.domNode;}else{o=q.domNode.parentNode;}r=q.id;}var v=this.controller.multipleSubProdOfferHandler.subProdOfferOrderProviderMap[o.id];
var w=j.ProdOfferHelper.getProdOfferDetail(m),s=this.controller,t=v.getSubGridBindingData();chooseNumberObjList=v.doGetChooseNumList(w);allProdBasicTrList=chooseNumberObjList.allProdBasicList,chooseNumberList=chooseNumberObjList.chooseNumberList;
var p={prodOfferInfoVO:w,allProdBasicTrList:allProdBasicTrList,chooseNumberList:chooseNumberList,subBindingData:t,subProdOfferCartDataProvider:v};if(!(this.controller.checkInstance.checkBeforeChooseSubProdOffer(p))){return false;
}if(chooseNumberList.length==1){if(this.controller.checkInstance.doCheckByRateSpeed(w,chooseNumberList[0])){return;}v.showOneSubProdOffer(w,chooseNumberList[0]);var p={rowIndex:v.getSubGridBindingData().length-1,subProdOfferCartDataProvider:v};
this.controller.route("/checkInstance/doCheckedSubProdOffer",p);}else{if(allProdBasicTrList==0){v.showOneSubProdOffer(w,null);var p={rowIndex:v.getSubGridBindingData().length-1,subProdOfferCartDataProvider:v};
this.controller.route("/checkInstance/doCheckedSubProdOffer",p);}else{var u=new g({bindingData:t,chooseNumberList:chooseNumberList,subProdOfferCartDataProvider:v,subProdOfferDetail:w});orderaccept.custom.popup.open({widget:{popup:u,around:event.srcElement}});
}}},onSubProdOfferNumBtnClick:function(m){var r=this.controller,q=m.currentTarget.getAttribute("toolTipId"),u=unieap.byId(q),s=dojo.byId(q),o=dojo.query(".subProdOfferNumBox",s),v=u.subProdOfferDetail,t=u.subProdOfferCartDataProvider,n=[];
dojo.forEach(o,function(w){if(w.checked&&!w.disabled){n.push({serviceKind:w.getAttribute("serviceKind"),serviceKindIndex:w.getAttribute("serviceKindIndex"),serviceId:w.getAttribute("defaultNumber"),productId:w.getAttribute("productId"),uniqueId:w.getAttribute("uniqueId")});
}});dojo.forEach(n,function(w){if(r.checkInstance.doCheckByRateSpeed(v,w)){return;}t.showOneSubProdOffer(v,w);});orderaccept.custom.popup.close({widget:s});u.destroyRecursive();var p={rowIndex:t.getSubGridBindingData().length-1,subProdOfferCartDataProvider:t};
this.controller.route("/checkInstance/doCheckedSubProdOffer",p);},onManageAccNumBtnClick:function(p){var m=this.controller,o=p.currentTarget.getAttribute("toolTipId"),q=unieap.byId(o),n=dojo.byId(o),t=dojo.query(".manageAccNumBox",n),s=[];
dojo.forEach(t,function(u){if(u.checked){s.push({serviceKind:u.getAttribute("serviceKind"),serviceKindIndex:u.getAttribute("serviceKindIndex"),serviceId:u.getAttribute("defaultNumber"),productId:u.getAttribute("productId"),uniqueId:u.getAttribute("uniqueId"),prodInstId:u.getAttribute("userId")});
}});if(s.length>0){var r=BusCard.Template.create("[<span name='accNbrResult' targetUniqueId='#{uniqueId}' value='#{serviceId}' serviceId='#{serviceId}' prodInstId ='#{prodInstId}' serviceKind='#{serviceKind}' serviceKindIndex='#{serviceKindIndex}'>#{serviceId}</span>]");
dojo.byId("manageNbrInfo").innerHTML=r.apply(s[0]);}orderaccept.custom.popup.close({widget:n});q.destroyRecursive();},onProdOfferDetailClick:function(m){var v=m.currentTarget,r=-1;while(true){var q=dijit.getEnclosingWidget(v);
if(q.declaredClass==="unieap.layout.BorderContainer"){break;}if(r!=q.id){v=q.domNode;}else{v=q.domNode.parentNode;}r=q.id;}var y=this.controller.multipleSubProdOfferHandler.subProdOfferOrderProviderMap[v.id],s=this.controller,v=m.currentTarget,x=v.getAttribute("rowIndex"),p=dojo.filter(y.getSubGridBindingData(),function(A){return A.rowIndex==x;
})[0],t=v.getAttribute("value"),w=v.getAttribute("id")+"_dropdown",z=dojo.query("DIV[id='"+w+"']")[0],o=y.prodOfferDetailBuilder,n=o.prodOfferDetailWidgetList,u=n[""+x];if(!u){o.initProdOfferDetail(x);
u=n[""+x];p.isOpen=true;}if(z&&z.style.display!="none"){orderaccept.custom.popup.close({widget:u,notHandleData:true});}else{orderaccept.custom.popup.open({widget:{popup:u,around:m.currentTarget,onCancel:function(){orderaccept.custom.popup.close({widget:u,notHandleData:true});
}}});}},onSubProdOfferCheckBoxClick:function(m){var n=this;var o=m.currentTarget;var q=-1;n.warningRefreshPromotion({changeObj:"subProdOffer"});while(true){var p=dijit.getEnclosingWidget(o);if(p.declaredClass==="unieap.layout.BorderContainer"){break;
}if(q!=p.id){o=p.domNode;}else{o=p.domNode.parentNode;}q=p.id;}var u=this.controller.multipleSubProdOfferHandler.subProdOfferOrderProviderMap[o.id];var s=m.currentTarget,t=s.getAttribute("rowIndex"),r=u.getSubGridBindingData(),v=dojo.filter(r,function(w){return w.rowIndex==t;
})[0];if(s.checked===false){if(this.controller.checkInstance.checkIfPortSpeedReserve(v)){s.checked=true;return;}}if(s.checked===true){if(this.controller.checkInstance.doCheckByRateSpeed(v.subProdOfferInfo,v.showData.chooseNumberObj)){s.checked=false;
return;}}if(s.checked===false){this.controller.route("/checkInstance/doUnCheckedSubProdOffer",{rowIndex:t,subProdOfferCartDataProvider:u});}else{this.controller.route("/checkInstance/doCheckedSubProdOffer",{rowIndex:t,subProdOfferCartDataProvider:u});
}u.dealRaiseXDSLSpeed(v.subProdOfferInfo,v.showData.chooseNumberObj,s.checked,v);},onSubProdOfferDelViewClick:function(m){var n=this;var o=m.currentTarget;var q=-1;while(true){var p=dijit.getEnclosingWidget(o);
if(p.declaredClass==="unieap.layout.BorderContainer"){break;}if(q!=p.id){o=p.domNode;}else{o=p.domNode.parentNode;}q=p.id;}var v=this.controller.multipleSubProdOfferHandler.subProdOfferOrderProviderMap[o.id];
var s=m.currentTarget,u=s.getAttribute("rowIndex"),r=v.getSubGridBindingData(),w=dojo.filter(r,function(x){return x.rowIndex==u;})[0];if(w.prodOfferInst!=null){return;}if(!!w.showData.selectAble){return;
}n.warningRefreshPromotion({changeObj:"subProdOffer"});var t=v.subProdOfferOrderGrid.domNode;dojo.query(".subProdOfferDetail-"+u,t)[0].childNodes[0].checked=false;$ac$.set("currentOperDelView",true);this.controller.route("/checkInstance/doUnCheckedSubProdOffer",{rowIndex:u,subProdOfferCartDataProvider:v});
v.dealRaiseXDSLSpeed(w.subProdOfferInfo,w.showData.chooseNumberObj,s.checked,w);},warningRefreshPromotion:function(o){if(!dojo.byId("refresh-promotion-href")){return;}var n=this;var m=null;if(o&&o.changeObj=="subProdOffer"){if(n.promotionRefreshWidget){n.promotionRefreshWidget.destroyRecursive();
}n.promotionRefreshWidget=new orderaccept.custom.TooltipDialog({id:"subProdChangeRefresh",noCloseBtn:true});n.refreshWidget=n.promotionRefreshWidget;m="<span style='color:red'>\u53ef\u9009\u5305\u9009\u62e9\u53d1\u751f\u53d8\u5316\uff0c\u8bf7\u91cd\u65b0\u5237\u65b0\u4fc3\u9500\u653f\u7b56\u76ee\u5f55\u6811\u53ca\u8d2d\u7269\u8f66\u4fe1\u606f</span>";
}else{if(n.mainProductChangeRefreshWidget){n.mainProductChangeRefreshWidget.destroyRecursive();}n.mainProductChangeRefreshWidget=new orderaccept.custom.TooltipDialog({id:"mainProductChangeRefresh",noCloseBtn:true});
n.refreshWidget=n.mainProductChangeRefreshWidget;m="<span style='color:red'>\u63a5\u5165\u7c7b\u4ea7\u54c1\u9009\u62e9\u53d1\u751f\u53d8\u5316\uff0c\u8bf7\u91cd\u65b0\u5237\u65b0\u4fc3\u9500\u653f\u7b56\u76ee\u5f55\u6811\u53ca\u8d2d\u7269\u8f66\u4fe1\u606f</span>";
}dojo.place(m,n.refreshWidget.containerNode,"first");var p=dojo.byId("refresh-promotion-href");orderaccept.custom.popup.open({widget:{popup:n.refreshWidget,around:p}});$ac$.set("refreshPromotionWidget",n.refreshWidget);
},onSubProdOfferNameMouseOver:function(m){var o=m.currentTarget;var q=-1;while(true){var p=dijit.getEnclosingWidget(o);if(p.declaredClass==="unieap.layout.BorderContainer"){break;}if(q!=p.id){o=p.domNode;
}else{o=p.domNode.parentNode;}q=p.id;}var z=this.controller.multipleSubProdOfferHandler.subProdOfferOrderProviderMap[o.id];var v=m.currentTarget,w=v.getAttribute("rowIndex"),u=z.getAllSubGridData(),s=u[w].subProdOfferInfo,x=unieap.byId("prodOfferInfoTips"),n=s.prodOfferName,t=s.prodOfferDesc,y=s.effDate,r=s.expDate;
if(!!s.prodOfferGroupVO&&!!s.prodOfferGroupVO.groupName&&s.prodOfferGroupVO.groupName!=""){n+="【"+s.prodOfferGroupVO.groupName+"】";}dojo.query("[id='prodoffer-name']",x.containerNode)[0].innerHTML=n;dojo.query("[id='prodoffer-desc']",x.containerNode)[0].innerHTML=t;
dojo.query("[id='prodoffer-effDate']",x.containerNode)[0].innerHTML=y;dojo.query("[id='prodoffer-expDate']",x.containerNode)[0].innerHTML=r;unieap.byId("prodOfferInfoTips").domNode.className="dijitTooltipDialog dijitTooltipABLeft dijitTooltipBelow";
orderaccept.custom.popup.open({widget:{popup:x,around:m.currentTarget}});},onProdOfferDetailBtnClick:function(m){var n=j.DomHelper.getParentWidget(m.currentTarget,"orderaccept.custom.TooltipDialog");orderaccept.custom.popup.close({widget:n,notHandleData:true});
},onBatchProdOfferDetailBtnClick:function(m){var n=j.DomHelper.getParentWidget(m.currentTarget,"orderaccept.custom.TooltipDialog");orderaccept.custom.popup.close({widget:n,notHandleData:true});},onFamilyNumberClick:function(n){var o=n.currentTarget,m=o.parentNode;
familyNum=(dojo.query("[id=familyNumber]",m)||[])[0];return j.DomHelper.getParentWidget(o,"orderaccept.custom.TooltipDialog").builder.onFamilyNumberClick(familyNum);},onFamilyUnitClick:function(n){var o=n.currentTarget,m=o.parentNode;
favourUnit=(dojo.query("[id=favourUnit]",m)||[])[0];return j.DomHelper.getParentWidget(o,"orderaccept.custom.TooltipDialog").builder.onFavourUnitClick(favourUnit);},onFamilyNumberChClick:function(m){var q=this.controller,s=m.currentTarget,u=s.getAttribute("rowIndex"),r=j.DomHelper.getParentWidget(m.currentTarget,"orderaccept.custom.TooltipDialog"),t=s.value,v=r.favourBuilder,p=v.favourItemList,w=v.uncheckedFavourList,o=dojo.filter(p,function(x){return x.getFavourNumber()==t;
})[0],n=w[t];(o||n).handleFavourNumber();},refreshSubProdOfferCart:function(o){var r=o.currentTarget,m=false;if(r.checked===false){m=false;}else{m=true;}while(true){if(r&&(r.tagName||"").toUpperCase()=="TR"){break;
}r=r.parentNode;}var n=this.controller.multipleSubProdOfferHandler.subProdOfferOrderProviderMap;for(var q in n){n[q].refreshSubProdOfferCart(r,m);}this.warningRefreshPromotion({changeObj:"mainProduct"});
},onAssureCustSelectClick:function(o){var p=o.currentTarget,q=p.getAttribute("rowIndex"),n=p.getAttribute("subRowIndex"),m=j.DomHelper.getParentWidget(o.currentTarget,"orderaccept.custom.TooltipDialog").prodOfferAssureBuilder;
m.onAssureCustSelectClick(q,n);},onAssureAccountSelectClick:function(o){var p=o.currentTarget,q=p.getAttribute("rowIndex"),n=p.getAttribute("subRowIndex"),m=j.DomHelper.getParentWidget(o.currentTarget,"orderaccept.custom.TooltipDialog").prodOfferAssureBuilder;
m.onAssureAccountSelectClick(q,n);},onAssureProductSelectClick:function(o){var p=o.currentTarget,q=p.getAttribute("rowIndex"),n=p.getAttribute("subRowIndex"),m=j.DomHelper.getParentWidget(o.currentTarget,"orderaccept.custom.TooltipDialog").prodOfferAssureBuilder;
m.onAssureProductSelectClick(q,n);},onAssureCommitClick:function(o){var p=o.currentTarget,q=p.getAttribute("rowIndex"),n=p.getAttribute("subRowIndex"),m=j.DomHelper.getParentWidget(o.currentTarget,"orderaccept.custom.TooltipDialog").prodOfferAssureBuilder;
m.onAssureCommitClick(q,n);},showAssureQueryView:function(o){var q=o.currentTarget,r=q.getAttribute("rowIndex"),n=q.getAttribute("subRowIndex"),p=q.getAttribute("assureMethodCD"),m=j.DomHelper.getParentWidget(o.currentTarget,"orderaccept.custom.TooltipDialog").prodOfferAssureBuilder;
m.showAssureQueryView(r,n,p);},onAssureQueryClick:function(o){var p=o.currentTarget,n=p.getAttribute("subRowIndex"),m=j.DomHelper.getParentWidget(o.currentTarget,"orderaccept.custom.TooltipDialog").prodOfferAssureBuilder;
m.assureQuery(n);},onSubProdSelectClick:function(m){var q=m.currentTarget,n=q.getAttribute("id"),u=n.split("-"),o=u[2],t=u[3],p=j.DomHelper.getParentWidget(m.currentTarget,"orderaccept.custom.TooltipDialog").productItemList,s=dojo.filter(p,function(v){return o==v.productInfo.productId;
})[0];var r=s.productAttrCard;s.checkedStatus=q.checked;if(!!r){r.domNode.style.display=q.checked?"block":"none";}},onPromotionTreeNodeClick:function(p){var q=p.getData(),o=this,r=p.getData().id,m=p.getData().leaf,n=p.getData().isCatalog;
if(m){o.showSalesPromotion(r);}},showSalesPromotion:function(s){var o=j.ProdOfferHelper.getSalesPromotionDetail(s);var m=this.controller.getCheckedPromotionList();var p=[];var r=dojo.filter(o.promotionTargetObjectList||[],function(t){return t.targetObjectType==1;
});dojo.forEach(r||[],function(t){var v=t.targetObjectId;var u=j.ProdOfferHelper.getProdOfferDetail(v);if(u){p.push(u);}});var q=this.controller.salesPromotionOrderGrid.ds.getRawData();var n={currentPromotionId:s,currentPromotionDetail:o,checkedPromotionList:m,bindingData:q,targetProdOfferDetailList:p,salesPromotionOrderGrid:this.controller.salesPromotionOrderGrid};
if(!this.controller.checkInstance.doCheckBeforeShowPromotionDetail(n)){this.controller.showSalesPromotionDetail(o);}},onCollectPromotionClick:function(n){var m=n.currentTarget.getAttribute("value");var o=this;
var x=unieap.byId("collectTips");if(m){var u=m.split("~");var s=u[0];var q=u[1];var w=u[2];var t=u[3];var v=this.controller.checkInstance.checkCollectPromotion(s,w);if(v){dojo.query("[id='tip-info']",x.containerNode)[0].innerHTML="促销已被收藏,不能重复收藏！";
orderaccept.custom.popup.open({widget:{popup:x,around:n.currentTarget}});window.setTimeout(function(){o.onCollectTipsClose();},1500);return;}var p="&prodOfferId="+s+"&prodOfferName="+BusCard.native2ascii(q)+"&prodOfferType="+w+"&mainProdOfferId="+t;
var z=j.ServiceFactory.getService("url:prodOfferSaleAjaxAction.do?method=savePersonalCollectProdOffer"+p);if(z){var r=z.split("~")[0];var y=z.split("~")[1];if(r=="success"){dojo.query("[id='tip-info']",x.containerNode)[0].innerHTML="促销政策收藏成功！";
}else{dojo.query("[id='tip-info']",x.containerNode)[0].innerHTML="促销政策收藏失败,原因为:"+y;}orderaccept.custom.popup.open({widget:{popup:x,around:n.currentTarget}});window.setTimeout(function(){o.onCollectTipsClose();
},1500);}}},onCancelCollectPromotionClick:function(n){var m=n.currentTarget.getAttribute("value"),v=unieap.byId("collectTips"),o=this;if(m){var s=m.split("~");var q=s[0];var u=s[1];var r=s[2];}var t=this.controller.checkInstance.checkCollectPromotion(q,u);
if(!t){dojo.query("[id='tip-info']",v.containerNode)[0].innerHTML="未收藏,不能进行删除操作！";orderaccept.custom.popup.open({widget:{popup:v,around:n.currentTarget}});window.setTimeout(function(){o.onCollectTipsClose();
},1500);return;}var p="&prodOfferId="+q;var w=j.ServiceFactory.getService("url:prodOfferSaleAjaxAction.do?method=deleteCollectProdOffer"+p);if(w){if(parseInt(w)>0){dojo.query("[id='tip-info']",v.containerNode)[0].innerHTML="已收藏销售品删除成功！";
orderaccept.custom.popup.open({widget:{popup:v,around:n.currentTarget}});window.setTimeout(function(){o.onCollectTipsClose();},1500);}}},onSaveOrder:function(m){var n=this.controller;m.preventDefault();
this.controller.expandAllPanes();this.controller.waitingBarInstance.showMe();var s=dojo.global.$appContext$.get("checkBlackberry");var r=true;if(!!s&&s=="99"){var o={custId:$ac$.requestParam.customerData.custId};
var t=BusCard.$remote("groupInfoDAO").queryByCustId(o);if(t!="null"){var u=dojo.global.$appContext$.get("requestParam").customerData.cityCode;var p=t.groupId;r=this.controller.route("/checkInstance/doCheckIfBigGroup",{cityCode:u,groupId:p});
}}if(!r){if($("groupId")&&$("groupId").value==""){d.alert({message:"\u60a8\u8ba2\u8d2d\u7684\u662f\u9ed1\u8393\u4e1a\u52a1\uff0c\u8bf7\u9009\u62e9\u4e00\u4e2a\u5927\u5ba2\u6237\u96c6\u56e2"});return false;
}}var q=function(){var x=this.controller.route("/dataBuilder/process");if(!x){this.controller.waitingBarInstance.hideMe();return false;}else{var w=this.controller.route("/specDataBuilder/process",x,null);
var v=BusCard.doPost(BusCard.path.contextPath+"/orderAcceptAction.do?method=doSaveProdOfferAcceptInfo",w,true,function(y){n.waitingBarInstance.hideMe();if(y&&y.flag==-1){d.alert({message:y.message});return false;
}else{if(y&&y.batchRegNo){dojo.global.$appContext$.set("_batchRegNo",y.batchRegNo);dojo.global.$appContext$.set("_productId",y.productId);dojo.global.$appContext$.set("_serviceOfferId",y.serviceOfferId);
dojo.global.$appContext$.set("_serviceKind",y.serviceKind);n.showBatchNewAccept();n.resetShoppingCartCount();}else{var z=y.message;dojo.global.$appContext$.set("_currentCustOrderId",z);dojo.global.$appContext$.set("_hasSaveOrder",true);
n.showOrderList(y.message);n.resetShoppingCartCount();}}changeStep(4);});}};setTimeout(function(v){return function(){return q.apply(v,arguments);};}(this),100);},_buildCompleteOrderParam:function(){var m=dojo.global.$appContext$.get("_currentCustOrderId");
return{custOrderId:m};},onCompleteOrder:function(o){var p=this;var n=dojo.global.$appContext$.get("_currentCustOrderId");prodOfferAcceptLoader.waitingBarInstance.showMe();var m=BusCard.util.doPost(BusCard.path.contextPath+"/orderDetailAction.do?method=doCompleteOrder",this._buildCompleteOrderParam(),true,function(r){var q=r;
if(q.flag<0){prodOfferAcceptLoader.waitingBarInstance.hideMe();d.alert({busiCode:"08410099",infoList:[q.message]});return false;}prodOfferAcceptLoader.waitingBarInstance.hideMe();d.alert({busiCode:"08410102",infoList:[q.message],onComplete:function(){var u="&custOrderId="+n;
var t=j.ServiceFactory.getService("url:orderQueryAction.do?method=shoppingCartSubmit"+u);if(t.flag<0){alert(t.message);return false;}p.controller.resetShoppingCartCount();if(p.controller.route("/orderShowLoader/budgetComponent/computeShouldPayValue")==0){p.controller.setCustOrderId2CustRecognitionPage("");
if($ac$.get("orderChangeFlag")!=1){d.alert({busiCode:"08410103",onComplete:function(){if(!!unieap.getDialog()){unieap.getDialog().close();}else{window.close();}}});}dojo.query(".continueAcceptClass",p.controller.functionNavigatorWidget.domNode)[0].disabled=true;
dojo.query(".commitOrderClass",p.controller.functionNavigatorWidget.domNode)[0].disabled=true;return false;}else{var s=j.ServiceFactory.getService("url:budgetComponentAction.do?method=checkAllFee&custOrderId="+n);
if(s.flag<0){alert(s.message);return false;}if(s.flag==0){p.controller.setCustOrderId2CustRecognitionPage("");d.alert({busiCode:"08510183",infoList:["\u8d39\u7528\u5df2\u6e05\u5c06\u5173\u95ed\u5f53\u524d\u7a97\u53e3!"],onComplete:function(){if(!!unieap.getDialog()){unieap.getDialog().close();
}else{window.close();}}});dojo.query(".continueAcceptClass",p.controller.functionNavigatorWidget.domNode)[0].disabled=true;dojo.query(".commitOrderClass",p.controller.functionNavigatorWidget.domNode)[0].disabled=true;
return false;}}dojo.query(".chargeClass",p.controller.functionNavigatorWidget.domNode)[0].disabled=false;dojo.query(".continueAcceptClass",p.controller.functionNavigatorWidget.domNode)[0].disabled=true;
dojo.query(".commitOrderClass",p.controller.functionNavigatorWidget.domNode)[0].disabled=true;dojo.query(".toOrderDetailClass",p.controller.functionNavigatorWidget.domNode)[0].disabled=true;}});},null,true);
},onCoutinueOrder:function(o){o.preventDefault();var m=dojo.global.$appContext$.get("_hasSaveOrder");if(!m){var p=confirm("\u8ba2\u5355\u5c1a\u672a\u6ca1\u6709\u4fdd\u5b58,\u662f\u5426\u9700\u8981\u5148\u4fdd\u5b58\u8ba2\u5355?");
if(p){return;}else{this.controller.destroy();if(window.opener){if(!!unieap.getDialog()){unieap.getDialog().close();}else{window.close();}}}}else{var n=dojo.global.$appContext$.get("_currentCustOrderId");
this.controller.setCustOrderId2CustRecognitionPage(n+"");if(!!unieap.getDialog()){unieap.getDialog().close();}else{window.close();}}},onPromotionDetailCheckClick:function(m){var r=m.currentTarget,u=r.getAttribute("rowIndex"),o={rowIndex:u};
var q=this.controller.salesPromotionOrderGrid.ds.getRawData();var y=dojo.filter(q||[],function(z){return z.rowIndex==u;})[0];var s=false;if(r.checked){s=this.controller.checkInstance.doCheckPromotionGroupCount(q,this.controller.salesPromotionOrderGrid,y.showData.promotionInfo);
}if(!s){this.controller.changePromotionCheckedStatus(o);this.controller.dealPromotionRaiseSpeedInfo(y.showData.promotionInfo,y,r.checked);}else{r.checked=false;}if(!r.checked){var v=this.controller.promotionDetailBuilder;
if(!!v){var p=v.prodOfferDetailWidgetList;var t=p[""+u];if(!!t){var x=t.resRelaBuilder.resourceCardList;if(x.length>0){var n=x[0];if(!!n){var w=n.busCardInstance;if(w.$("deviceNo")){w.$("deviceNo").value="";
w.$("deviceNo").onblur();}}}}}}},onPromotionTargetNumChgClick:function(n){var o=n.currentTarget,q=o.getAttribute("rowIndex");var p=this.controller.salesPromotionOrderGrid.ds.getRawData();var m=dojo.filter(p||[],function(r){return r.rowIndex==q;
})[0];this.controller.dealPromotionRaiseSpeedInfo(m.showData.promotionInfo,m,o.checked);},onFeeModifyClick:function(n){var o=null;var m=n.currentTarget;while(true){var o=dijit.getEnclosingWidget(m);if(o.declaredClass==="orderaccept.prodofferaccept.widget.budget.BudgetWidget"){break;
}m=o.domNode;}dojo.query(".fee-confirm-class",o.domNode)[0].disabled=false;o.unlock(o.gridContainer);},onFeeConfirmClick:function(q){var s=null;var p=q.currentTarget;while(true){var s=dijit.getEnclosingWidget(p);
if(s.declaredClass==="orderaccept.prodofferaccept.widget.budget.BudgetWidget"){break;}p=s.domNode;}var r=s.getFeeConfirmData();var n=BusCard.util.doPost(BusCard.path.contextPath+"/budgetComponentAction.do?method=doFeeConfirm",r,false,null,null,true);
var m=n;if(m.flag<0){d.alert({busiCode:"08410099",infoList:[m.message]});return false;}dojo.query(".commitOrderClass",this.controller.functionNavigatorWidget.domNode)[0].disabled=false;var o=dojo.query(".commitOrderClass",this.controller.functionNavigatorWidget.domNode);
if(!!o&&!!o[3]){var t=o[3];t.disabled=false;}dojo.query(".fee-confirm-class",s.domNode)[0].disabled=true;dojo.query(".fee-modify-class",s.domNode)[0].disabled=true;s.lock();},onPromotionDetailClick:function(p){var o=this.controller,s=p.currentTarget.getAttribute("rowIndex"),r=p.currentTarget.getAttribute("id")+"_dropdown",q=dojo.query("DIV[id='"+r+"']")[0],n=p.currentTarget.getAttribute("value");
var m=o.promotionDetailBuilder.prodOfferDetailWidgetList[""+s];if(!m){o.initPromotionDetail(s);m=o.promotionDetailBuilder.prodOfferDetailWidgetList[""+s];}if(q&&q.style.display!="none"){orderaccept.custom.popup.close({widget:m});
}else{orderaccept.custom.popup.open({widget:{popup:m,around:p.currentTarget,onCancel:function(){orderaccept.custom.popup.close({widget:m});}}});}},onPromotionDetailBtnClick:function(o){var n=this.controller,q=o.currentTarget.getAttribute("rowIndex");
var p=n.promotionDetailBuilder,m=p.prodOfferDetailWidgetList[""+q];orderaccept.custom.popup.close({widget:m});},OnJump2CustRecognitionPage:function(m){m.preventDefault();if(window.parent&&window.parent.$switchPane$){window.parent.$switchPane$([true,false]);
}},OnJump2OrderDetailPage:function(m){m.preventDefault();if(window.parent&&window.parent.$switchPane$){window.parent.$switchPane$([false,true]);}},onToMainProdOfferSelectPane:function(){j.navigatorManager.to("mainProdOfferSelectPane")(function(o,m){dojo.byId("function-navigator-root").style.display="none";
var n=unieap.byId(o);if(!n){unieap.byId("shoppingCartPane").domNode.style.display="block";}});},onToOrderDetailPage:function(){var p=this;var m=dojo.global.$acceptGroupId$;var o=dojo.global.$appContext$.get("_custOrderId_");
var n=BusCard.$remote("custOrderNewFacadeBO");if(!!n&&!!n.doDeleteUncommitedCustOrder){n.doDeleteUncommitedCustOrder(o,m);dojo.global.$acceptGroupId$=null;}dojo.style(dojo.byId("prodoffer-accept-root"),{display:"block"});
dojo.style(dojo.byId("order-show-root"),{display:"none"});p.controller.functionNavigatorWidget.switchGroup(0);},doMemberAcceptCountCheck:function(){},selectedMemberEquals:function(n,m){n=n||{},m=m||{};
var o=["action","productId","prodOfferId","prodInstId","prodOfferInstId"];return dojo.every(o,function(p){return n[p]==m[p];});},assertSeletedChanged:function(m,o,q){var p=$ac$.get("selectedMemberProdOfferList")||[],m=m||[],o=o||BusCard.util.emptyFunction,q=q||BusCard.util.emptyFunction,n=this;
!(dojo.every(p,function(r,s){return n.selectedMemberEquals(r,m[s]);})&&dojo.every(m,function(r,s){return n.selectedMemberEquals(r,p[s]);})&&m.selectedBelongCode==p.selectedBelongCode)?o():q();},_getSelectedMemberInfoList:function(o){var p=dijit.getEnclosingWidget(o.currentTarget),m=dojo.query(".member-product-tr",p.domNode),q=dojo.query(".prodofferid-input",p.domNode)[0].value,n=dojo.map(dojo.filter(m,function(s){var r=dojo.query(".member-product-checkbox",s)[0];
if(r.checked){return true;}}),function(x){var u=dojo.query(".action-selected",x)[0],t=dojo.query(".memeber-prodoffer-select",x)[0],w=dojo.query(".product-select",x)[0],s={permitEnterComb:dojo.attr(x,"permitEnterComb"),prodInstId:dojo.attr(x,"prodInstId"),prodOfferInstId:dojo.attr(x,"prodOfferInstId"),prodOfferId:t.value,productId:w.value};
if(u){var v=dojo.attr(x,"prodOfferInstId"),r=$ac$.query("userHasProdOfferInfoList[?(@.prodOfferInstId=="+v+")]")[0];s.offerInstVO=r;s.prodInstVO=r.prodInstList[0];if(dojo.hasClass(u,"member-offer-keep")){s.action=(s.prodOfferId==r.prodOfferId)?"nochange":"change";
}else{if(dojo.hasClass(u,"member-offer-quit")){s.action="quit";if(s.offerInstVO){s.prodOfferId=s.offerInstVO.prodOfferId+"";}}else{if(dojo.hasClass(u,"member-offer-split")){s.action="split";}}}}else{s.action="new";
}return s;});return n;},checkMemberDataIntegrity:function(m){var n=(m||[]).find(function(o){return o.action=="split"&&!/^\d+$/.test(o.prodOfferId||"");});if(n){MessageBox.alert({message:"拆分成员"+n.prodInstVO.accNbr+"没有可供变更的销售品,请选择其他操作"});
return false;}return true;},onMainProdOfferConfirm:function(m){var q=dijit.getEnclosingWidget(m.currentTarget),w=this,r=dojo.query(".prodofferid-input",q.domNode)[0].value,p={"new":0,nochange:1,change:2,split:3,quit:4},s=this._getSelectedMemberInfoList(m);
if(this.checkMemberDataIntegrity(s)===false){return false;}var r=$ac$.get("currentMainProdOfferInfoVO").prodOfferId;var n=j.ProdOfferHelper.getProdOfferDetail(r).ifGrp;var t=true;if(n=="1"){var o=dojo.global.$appContext$.get("requestParam");
var v=o.customerData.cityCode;var u=o.customerData.custId;dojo.forEach(s,function(C){var y=C.productId;var x=BusCard.$remote("productToServiceDAO").queryById({productId:y});if(x.productType=="13"){var A=BusCard.$remote("prodInstCommonBO").queryNotInValidProdInst({cityCode:v,ownerCustId:u,prodFuncType:i.load("ProductFuncTypeConst").ProductFuncTypeConst.ACCESS});
if(dojo.some(A,function(D){return D.productId==y;})){d.alert({message:"\u96c6\u56e2\u5ba2\u6237\u4e0d\u5141\u8bb8\u91cd\u590d\u8ba2\u8d2d\u76f8\u540c\u7684\u96c6\u56e2\u4ea7\u54c1"});t=false;}var B=[i.load("ProductIdConst").ProductIdConst.PRODUCT_ID,i.load("ProductIdConst").ProductIdConst.WVPN,i.load("ProductIdConst").ProductIdConst.SVPN];
if(t&&dojo.some(B,function(D){return D==y;})&&dojo.some(A,function(D){return dojo.some(B,function(E){return E==D.productId;});})){d.alert({message:"语音类IVPN、SVPN、WVPN只能订购一个"});t=false;}var z=i.load("ServiceOfferIDConst").ServiceOfferIDConst.PROD_NEW;
if(t){A=BusCard.$remote("accessProdItemInfoDAO").selectByProperties({cityCode:v,customerId:u,serviceOfferId:z});if(dojo.some(A,function(D){return D.productId==y;})){d.alert({message:"\u96c6\u56e2\u5ba2\u6237\u4e0d\u5141\u8bb8\u91cd\u590d\u8ba2\u8d2d\u76f8\u540c\u7684\u96c6\u56e2\u4ea7\u54c1"});
t=false;}var B=[i.load("ProductIdConst").ProductIdConst.PRODUCT_ID,i.load("ProductIdConst").ProductIdConst.WVPN,i.load("ProductIdConst").ProductIdConst.SVPN];if(t&&dojo.some(B,function(D){return D==y;})&&dojo.some(A,function(D){return dojo.some(B,function(E){return E==D.productId;
});})){d.alert({message:"语音类IVPN、SVPN、WVPN只能订购一个"});t=false;}}}});}if(!t){return;}if(this.controller.route("/checkInstance/pilotageCheck",[{selectedMemberProdOfferList:s}])===false){return false;}if(this.controller.route("/checkInstance/doCheckMemberProdOfferSelect",[{selectedMemberProdOfferList:s,widget:q}])===false){return false;
}else{if(this.controller.route("/checkInstance/doCheckSubGroupProdOffer",[{}])==false){return false;}s.sort(function(y,x){if(p[y.action]>p[x.action]){return 1;}else{if(p[y.action]<p[x.action]){return -1;
}else{return 0;}}});s.selectedBelongCode=this.controller.getBelongCode();this.assertSeletedChanged(s,function(){$ac$.set("selectedMainProdOfferInfoVO",$ac$.get("currentMainProdOfferInfoVO"));$ac$.set("prodOfferList",[$ac$.get("currentMainProdOfferInfoVO")]);
$ac$.set("selectedMemberProdOfferList",s);$ac$.set("subGroupProdInfo",$ac$.get("subGroupProdInfo"));$ac$.set("processId",$ac$.get("currentProcessId")||$ac$.get("processId"));w.controller.beginOrder(r);
},function(){j.navigatorManager.to("prodOfferAcceptPane")(function(){dojo.byId("function-navigator-root").style.display="block";});});if(this.controller.route("/checkInstance/doCheckOfferStandardForChgNextStep",[])===false){return false;
}}},onMainProdOfferCheck:function(m){},onAddMemeberProdOffer:function(v){var o=BusCard.path.contextPath+"/common/images/button/reduce_button.png";var t=this.controller.route("/checkInstance/doMemeberProductCountCheck",[v]);
if(t===false){return false;}var p=j.DomHelper.findParentNode(v.currentTarget,function(y){return y.tagName.toUpperCase()=="TR";}),n=function(){var z=dojo.query(".member-oper-div",p)[0];if(z){var y=dojo.query(":checked",z);
return y[0];}}(),m=p.cloneNode(true);dojo.place(m,p,"after");dojo.attr(m,{prodInstId:"",prodOfferInstId:""});dojo.attr(dojo.query(".member-product-checkbox",m)[0],{disabled:false,checked:true});var w=dojo.query(".member-prodoffer-add-img",m)[0];
w.src=o;dojo.connect(w,"onclick",function(z){var y=j.DomHelper.findParentNode(z.currentTarget,function(A){return A.tagName.toUpperCase()=="TR";});y.parentNode.removeChild(y);});dojo.query(".member-status",m)[0].innerHTML="订购";
var s=dojo.query(".member-oper-div",m),r=dojo.query(".memeber-prodoffer-select",m)[0],x=dojo.query(".product-select",m)[0];if(s&&s.length>0){s[0].parentNode.removeChild(s[0]);}if(n){n.checked=true;}try{var q=$ac$.query("prodOfferList[*].offerProdRelaList[?(@.productId=="+x.value+")]")[0].relatedOfferList;
if(q){BusCard.$rs(r,dojo.map(q,function(y){return{id:y.prodOfferId,name:y.prodOfferName};}));}}catch(u){if(window.console&&window.console.warn){window.console.warn("are you ordering shared prodoffer?");
}}return m;},onDoChargeClick:function(o){var n=this;var m=dojo.global.$appContext$.get("_custOrderId_");if(n.isGotoPreInvoicePage(m)){if(opener&&opener.parent.top){opener.parent.top.top_page.MenuBar.activeTopMenuById("System84","842","842AF","custOrderId="+m);
if(!!unieap.getDialog()){unieap.getDialog().close();}else{window.close();}return;}if(parent.top){parent.top.top_page.MenuBar.activeTopMenuById("System84","842","842AF","custOrderId="+m);return;}}else{if(opener&&opener.parent.top){opener.parent.top.top_page.MenuBar.activeTopMenuById("System84","842","842AA","custOrderId="+m);
if(!!unieap.getDialog()){unieap.getDialog().close();}else{window.close();}return;}if(parent.top){parent.top.top_page.MenuBar.activeTopMenuById("System84","842","842AA","custOrderId="+m);return;}}},onAccessProductChange:function(m){var p=m.currentTarget;
var o=p.value;var q=dijit.getEnclosingWidget(p);var n=BusCard.jsonPath(q.prodOfferInfoVO,"$.offerProdRelaList[?(@.productId=="+o+")]")[0].relatedOfferList;BusCard.$rs(dojo.query(".memeber-prodoffer-select",q.domNode)[0],dojo.map(n,function(r){return{id:r.prodOfferId,name:r.prodOfferName};
}));},isGotoPreInvoicePage:function(p){var o=false;var s=BusCard.$remote("custOrderBasicInfoDAO").queryNormalTB({custOrderId:p})[0];var r=BusCard.$remote("offerItemInfoDAO").selectByProperties({custOrderId:p});
var n=dojo.every(r||[],function(u){return u.serviceOfferId!=j.ACTION_CD_CONST.PRODUCT_INSTALL;});var t="&ServiceKind=-1&apply_event=-1&infoId=217";var m=j.ServiceFactory.getService("url:businessAcceptAction.do?method=getCityBusinessParamValue"+t);
var q=i.load("AcceptWayCDConst").AcceptWayCDConst.TEN_THOUSAND_NUMBER;if(m&&m=="1"){if(s&&s.acceptWay==q&&n){o=true;}}return o;},doPrint:function(){var m=dojo.global.$appContext$.get("_custOrderId_");var n=BusCard.path.contextPath+"/printAction.do?method=doPrintInit&billKind=3&custOrderId="+m;
window.open(n,"orderPrint","height=700,width=1000,status=no,scrollbars=yes,toolbar=no,menubar=no,location=no,top=10,left=10");}});});
defineModule("orderaccept.prodofferaccept.check.ProdOfferNewCheck",["../util","orderaccept.prodofferaccept.ProductDateBuilder","orderaccept.common.dialog.MessageBox","orderaccept.common.js.ConstantsPool"],function(a,b,d,c){dojo.declare("orderaccept.prodofferaccept.check.ProdOfferNewCheck",[],{controller:null,constructor:function(e){this.controller=e;
},postscript:function(){},doGlobalBusAndRuleCheck:function(e){if(this.doCheck10000NbrAccept(e)==false){return false;}if(this.doCheckBatchDevice(e)==false){return false;}return true;},checkCollectProdOffer:function(j,f,i){var e=false;
if(f==1){var h=a.ServiceFactory.getService("url:prodOfferSaleAjaxAction.do?method=getPersonalCollectProdOffer&prodOfferType="+f+"&mainProdOfferId="+i);if(h){var g=dojo.filter(h||[],function(k){return j==k.prodOfferId;
});if(g.length>0){if(g[0].workNo==-1||g[0].workNo=="-1"){return -1;}else{return true;}}}}else{var h=a.ServiceFactory.getService("url:prodOfferSaleAjaxAction.do?method=getPersonalCollectSubProdOffer&prodOfferType="+f+"&mainProdOfferId="+i);
if(h){var g=dojo.filter(h||[],function(k){return j==k.prodOfferId;});if(g.length>0){if(g[0].workNo==-1||g[0].workNo=="-1"){return -1;}else{return true;}}}}return e;},checkCollectPromotion:function(h,g){var f=false;
var e=a.ServiceFactory.getService("url:prodOfferSaleAjaxAction.do?method=getPersonalCollectPromotion&prodOfferType="+g);if(e){return dojo.some(e,function(i){return h==i.prodOfferId;});}return f;},checkBeforeChooseSubProdOffer:function(f){var m=f.prodOfferInfoVO,e=f.allProdBasicTrList,l=f.chooseNumberList,n=f.subProdOfferCartDataProvider,j=n.subProdOfferOrderGrid.domNode,o=this,h=f.subBindingData;
if(this.doCheckByProdType(m)){return true;}if(e.length==0){var k=dojo.filter(h,function(p){var q=p.rowIndex;return p.subProdOfferInfo.prodOfferId==m.prodOfferId&&!dojo.query(".subProdOfferDetail-"+q,j)[0].childNodes[0].checked;
});if(k.length>0){var i=k[0].rowIndex;dojo.query(".subProdOfferDetail-"+i,j)[0].childNodes[0].checked=true;o.doCheckedSubProdOffer({rowIndex:k[0].rowIndex,subProdOfferCartDataProvider:n});return false;
}if(dojo.some(h,function(p){return p.subProdOfferInfo.prodOfferId==m.prodOfferId;})){d.alert({busiCode:"08410122",infoList:[m.prodOfferName]});return false;}return true;}if(e.length>0&&l.length==0){var g="";
dojo.forEach(e,function(q){var p=dojo.attr(q,"viewId");g+="【"+dojo.query(".serviceId-"+p,q)[0].value+"】,";});d.alert({busiCode:"08410123",infoList:[m.prodOfferName,g]});return false;}if(l.length==1){var k=dojo.filter(h,function(p){var q=p.rowIndex;
return p.subProdOfferInfo.prodOfferId==m.prodOfferId&&!dojo.query(".subProdOfferDetail-"+q,j)[0].childNodes[0].checked;});if(k.length>0){var i=k[0].rowIndex;dojo.query(".subProdOfferDetail-"+i,j)[0].childNodes[0].checked=true;
n.dealRaiseXDSLSpeed(k[0].subProdOfferInfo,k[0].showData.chooseNumberObj,true,k[0]);o.doCheckedSubProdOffer({rowIndex:k[0].rowIndex,subProdOfferCartDataProvider:n});return false;}if(dojo.some(h,function(p){return p.subProdOfferInfo.prodOfferId==m.prodOfferId;
})){d.alert({busiCode:"08410122",infoList:[m.prodOfferName]});return false;}}return true;},doCheckIfBigGroup:function(h){var e=h.groupId;var g=h.cityCode;var f=BusCard.$remote("groupInfoBO").getIfBigGroup(g,e);
if(f>0){return true;}return false;},doCheckByRateSpeed:function(g,f){var e=a.ProdOfferHelper.getRaiseSpeedObj(g);if(e==null){return false;}else{var i=f.uniqueId;if(!!prodOfferAcceptLoader.rateAttrMap[i]){var h=dojo.some(prodOfferAcceptLoader.rateAttrMap[i]||[],function(j){return j.operKind==1;
});if(h){d.alert({busiCode:"08410124",infoList:[g.prodOfferName]});return true;}}else{return false;}}return false;},doCheckByProdType:function(f){var e=f.offerProdRelaList;if(e&&e.length==0){return false;
}var h="&productId="+e[0].productInfoVO.productId;var g=a.ServiceFactory.getService("url:prodOfferSaleAjaxAction.do?method=ifCanInitMore"+h);if(g==1){return true;}return false;},doCheckBeforeShowPromotionDetail:function(l){var t=false;
var m=l.currentPromotionId;var q=l.currentPromotionDetail;var w=l.checkedPromotionList;var v=l.targetProdOfferDetailList;var j=l.bindingData;var r=l.salesPromotionOrderGrid;var x=a.ServiceFactory.getService("url:prodOfferSaleAjaxAction.do?method=getPromotionGroupInfo&currentPromotionId"+m);
for(var z in w||[]){if(!w.hasOwnProperty(z)){continue;}var e=w[z];var f=a.ProdOfferHelper.getSalesPromotionDetail(e);var k="&currentPromotionId="+m+"&otherPromotionId="+e;var h=a.ServiceFactory.getService("url:prodOfferSaleAjaxAction.do?method=getPromotionRel"+k);
dojo.forEach(h||[],function(A){if(A.relationTypeCD==a.PRODOFFERTYPE.EX_TYPE){var i=dojo.filter(j,function(B){return B.promotionInfo.promotionId==e;});d.confirm({title:"\u4e92\u65a5\u5173\u7cfb\u786e\u8ba4",busiCode:"08410150",infoList:[q.promotionName,f.promotionName,q.promotionName,f.promotionName],onComplete:function(B){return function(C){if(C){if(C){dojo.forEach(B,function(D){dojo.query(".promotionNameDetail-"+D.rowIndex)[0].childNodes[0].checked=false;
dojo.query(".promotionStatus-"+D.rowIndex)[0].innerHTML="\u672a\u8ba2\u8d2d";});t=false;}else{t=true;}}};}(i),isClose:false},dojo.byId("PromotionCart"));}});var p=a.ServiceFactory.getService("url:prodOfferSaleAjaxAction.do?method=getPromotionGroupInfo&otherPromotionId"+e);
if(x){var o=x.groupName;var g=x.prodOfferGroupRelVO;dojo.forEach(g||[],function(A){if(A.relationTypeCD==a.PRODOFFERTYPE.EX_TYPE&&A.groupZID==p.prodOfferGroupId){var i=dojo.filter(j,function(B){return B.promotionInfo.promotionId==e;
});d.confirm({title:"\u5206\u7ec4\u5173\u7cfb\u4e92\u65a5\u786e\u8ba4",busiCode:"08410151",infoList:[q.promotionName,o,f.promotionName,p.prodOfferGroupVO.groupName,q.promotionName,f.promotionName],onComplete:function(B){return function(C){if(C){dojo.forEach(B,function(D){dojo.query(".promotionNameDetail-"+D.rowIndex)[0].childNodes[0].checked=false;
dojo.query(".promotionStatus-"+D.rowIndex)[0].innerHTML="\u672a\u8ba2\u8d2d";});t=false;}else{t=true;}};}(i),isClose:false},dojo.byId("PromotionCart"));}});}}if(v&&v.length>0){for(var s=0;s<v.length;s++){var u=v[s];
var n=u.feeType;var y=q.ifCos;if(y==1&&n!=2100){d.alert({busiCode:"08410127",infoList:[q.promotionName]});return true;}if(y==0&&n==2100){d.alert({busiCode:"08410128",infoList:[q.promotionName]});return true;
}}}t=this.doCheckPromotionGroupCount(j,r,q);return t;},doCheckPromotionGroupCount:function(k,n,o){var g={};var h=dojo.filter(k,function(p){var q=p.rowIndex;return dojo.query(".promotionNameDetail-"+q,n.domNode)[0].childNodes[0].checked&&p.showData.promotionInfo.promotionId!=o.promotionId;
});dojo.forEach(h||[],function(r){var q=r.showData.promotionInfo;var s=q.proodOfferInfo.prodOfferGroupVO;if(s){var p=g[s.prodGroupID]&&typeof(g[s.prodGroupID])!="undefined"?g[s.prodGroupID]:0;g[s.prodGroupID]=p+1;
}});var e=o.proodOfferInfo.prodOfferGroupVO;var j=e.prodGroupID;var m=e.groupName;var f=e.maxSelectable;var i=o.promotionName;if(g[j]&&(g[j]+1)>f){var l="";dojo.forEach(h||[],function(p){var q=p.showData.promotionInfo.proodOfferInfo.prodOfferGroupVO;
if(q&&q.prodGroupID==j){l+=p.showData.promotionInfo.promotionName+",";}});if(l!=""){l=l.substring(0,l.length-1);}d.alert({busiCode:"08410205",infoList:[i,m,f,l,f]},dojo.byId("PromotionCart"));return true;
}return false;},doCheckBeforeCommit:function(f,e){f.checkedProdOfferGridData=dojo.filter(f.allSubProdOfferCartData||[],function(g){return g.prodOfferPageInfo.checkBoxValue;});if(!this.doCheckProdOfferGroup(f,e)){return false;
}if(!this.doCheckOfferRelation(f,e)){return false;}if(!this.doCheckIfExistProdOfSubOffer(f)){return false;}if(!this.doCheckOfferAttrInfo(f)){return false;}if(!this.doCheckProdAttrInfo(f)){return false;
}if(!this.doCheckAssure(f)){return false;}if(!this.doCheckProdRole(f)){return false;}if(!this.doCheckRoamProd(f)){return false;}if(!this.doCheckIfCanOrderGrp()){return false;}return true;},checkIfHasUseNumber:function(e){var f=dojo.filter(e||[],function(g){return g.showData.chooseNumberObj==null;
});if(f&&f.length>0){if(f[0].prodOfferInst==null){d.alert({busiCode:"08410237",infoList:[f[0].subProdOfferInfo.prodOfferName,f[0].subProdOfferInfo.prodOfferId]});}else{d.alert({busiCode:"08410233",infoList:[f[0].subProdOfferInfo.prodOfferName,f[0].subProdOfferInfo.prodOfferId,f[0].prodOfferInst.prodOfferInstId]});
}return false;}return true;},doCheckIfCanOrderGrp:function(){var f=$ac$.selectedMemberProdOfferList;var g=$ac$.get("currentMainProdOfferInfoVO");if(!g){return true;}var l=g.prodOfferId;var e=a.ProdOfferHelper.getProdOfferDetail(l).ifGrp;
var k=true;if(e=="1"){var h=dojo.global.$appContext$.get("requestParam");var j=h.customerData.cityCode;var i=h.customerData.custId;dojo.forEach(f,function(q){if(q.action!="new"){return;}var n=q.productId;
var m=BusCard.$remote("productToServiceDAO").queryById({productId:n});if(m.productType=="13"){var p=BusCard.$remote("prodInstCommonBO").queryNotInValidProdInst({productId:n,cityCode:j,ownerCustId:i});var o=c.load("ServiceOfferIDConst").ServiceOfferIDConst.PROD_NEW;
if(!p||p.length==0){p=BusCard.$remote("accessProdItemInfoDAO").selectByProperties({productId:n,cityCode:j,customerId:i,serviceOfferId:o});}if(!!p&&p.length>0){d.alert({message:"\u96c6\u56e2\u5ba2\u6237\u4e0d\u5141\u8bb8\u91cd\u590d\u8ba2\u8d2d\u76f8\u540c\u7684\u96c6\u56e2\u4ea7\u54c1"});
k=false;}}});}return k;},doCheckProdOfferGroup:function(h,j){var l="";if(j.contentPane){l=j.uniqueId||"";}var n=unieap.byId("subProdOfferTree"+l);n.expandNode(n.getRootNode().getChildren()[0]);var k=unieap.byId("subProdOfferTree"+l).getRootNode().getChildren()[0].getChildren();
for(var o in k){if(!k.hasOwnProperty(o)){continue;}var m=k[o];var i=m.item.data.prodOfferGroupVO;if(!i){continue;}var e=i.prodGroupID;var f=i.maxSelectable;var p=i.minSelectable;var s=i.groupName;var g=dojo.filter(h.checkedProdOfferGridData||[],function(t){return t.subProdOfferInfo.prodOfferGroupId==e;
});var r="";dojo.forEach(g||[],function(t){r+="["+t.subProdOfferInfo.prodOfferName+"]";});var q="销售品分组["+s+"]最多订购["+f+"]个,最少订购["+p+"],现在订购了["+g.length+"]个";if(r!=""){q+="已经订购了"+r;}if(g.length<p){d.alert({title:"\u63d0\u793a\u4fe1\u606f",message:q});
return false;}if(g.length>f){d.alert({title:"\u63d0\u793a\u4fe1\u606f",message:q});return false;}}return true;},doCheckIfExistProdOfSubOffer:function(h){var g=h.checkedProdOfferGridData;if(g!=null&&g.length>0){for(var j=0;
j<g.length;j++){var i=g[j];var f=i.relaProdPageInfoList;var e=dojo.some(f||[],function(l){return l.prodBasicInfo.checkedStatus;});if(!e){var k="请为销售品["+i.subProdOfferInfo.prodOfferName+"]选择产品再提交";d.alert({title:"\u63d0\u793a\u4fe1\u606f",message:k});
return false;}}}return true;},doCheckOfferRelation:function(f,e){if(!this.doCheckOfferExt(f,e)){return false;}if(!this.doCheckProdOfferDepend(f,e)){return false;}return true;},doCheckOfferExt:function(i,n){var m=i.checkedProdOfferGridData;
if(m!=null&&m.length>0){for(var f=0;f<m.length;f++){var j=m[f];var h=a.ProdOfferHelper.getProdOfferRelaList(j.subProdOfferInfo);if(h.length==0){continue;}var o=j.showData.chooseNumberObj;for(var e=0;e<h.length;
e++){if(e==a.AcceptCheckCount.checkCount){break;}var k=h[e];if(k.relationTypeCD==a.PRODOFFERTYPE.EX_TYPE&&k.prodOfferInfoVO.prodOfferType!=a.PRODOFFERTYPE.MAIN_OFFER_TYPE){var l;if(k.offerAId==j.subProdOfferInfo.prodOfferId){l=k.offerZId;
}else{l=k.offerAId;}}var g=BusCard.findAll(m,function(p){var q=j.showData.chooseNumberObj;return p.subProdOfferInfo.prodOfferId==l&&(o!=null&&q!=null?o.uniqueId==q.uniqueId:true);});if(g.length>0){d.confirm({title:"\u9009\u62e9\u6846",busiCode:"08410149",infoList:[j.subProdOfferInfo.prodOfferName,g[0].subProdOfferInfo.prodOfferName,j.subProdOfferInfo.prodOfferName,g[0].subProdOfferInfo.prodOfferName],onComplete:function(p,q){return function(s){var r=n.subProdOfferOrderGrid.domNode;
if(s){dojo.query(".subProdOfferDetail-"+p.rowIndex,r)[0].childNodes[0].checked=false;if(p.prodOfferInst!=null){n.updateCurrentProdOfferStyle(p,"prod-offer-del");}else{n.updateCurrentProdOfferStyle(p,"prod-offer-unorder");
}checkInstance.doUnCheckedSubProdOffer({rowIndex:p.rowIndex,subProdOfferCartDataProvider:n});}else{dojo.query(".subProdOfferDetail-"+q.rowIndex,r)[0].childNodes[0].checked=false;if(q.prodOfferInst!=null){n.updateCurrentProdOfferStyle(q,"prod-offer-del");
}else{n.updateCurrentProdOfferStyle(q,"prod-offer-unorder");}checkInstance.doUnCheckedSubProdOffer({rowIndex:q.rowIndex,subProdOfferCartDataProvider:n});}};}(g[0],j),iconCloseComplete:true},dojo.byId("subProdOfferCart"));
return false;}}}}return true;},doCheckProdOfferDepend:function(j,r){var o=j.checkedProdOfferGridData;var k=j.allSubProdOfferCartData;if(o!=null&&o.length>0){for(var h=0;h<o.length;h++){var l=o[h];var i=a.ProdOfferHelper.getProdOfferRelaList(l.subProdOfferInfo);
if(i.length==0){continue;}var s=l.showData.chooseNumberObj;for(var f=0;f<i.length;f++){if(f==a.AcceptCheckCount.checkCount){break;}var m=i[f];var e;if(m.relationTypeCD==a.PRODOFFERTYPE.DEPEND_TYPE&&m.selectable==1){e=m.offerZId;
var g=BusCard.findAll(k,function(p){var q=l.showData.chooseNumberObj;return p.subProdOfferInfo.prodOfferId==e&&(s!=null&&q!=null?s.uniqueId==q.uniqueId:true);});if(g.length==0){if(m.offerAId==l.subProdOfferInfo.prodOfferId&&m.relationTypeCD==a.PRODOFFERTYPE.DEPEND_TYPE&&m.prodOfferInfoVO.prodOfferType!=a.PRODOFFERTYPE.MAIN_OFFER_TYPE){var n=a.ProdOfferHelper.getProdOfferDetail(e);
d.confirm({title:"\u9009\u62e9\u6846",busiCode:"08410152",infoList:[l.subProdOfferInfo.prodOfferName,n.prodOfferName,n.prodOfferName,l.subProdOfferInfo.prodOfferName],onComplete:function(q,p){return function(u){var t=r.subProdOfferOrderGrid.domNode;
if(u){r.showOneSubProdOffer(p,q.showData.chooseNumberObj);}else{dojo.query(".subProdOfferDetail-"+q.rowIndex,t)[0].childNodes[0].checked=false;if(q.prodOfferInst!=null){r.updateCurrentProdOfferStyle(q,"prod-offer-del");
}else{r.updateCurrentProdOfferStyle(q,"prod-offer-unorder");}checkInstance.doUnCheckedSubProdOffer({rowIndex:q.rowIndex,subProdOfferCartDataProvider:r});}};}(l,n)},dojo.byId("subProdOfferCart"));return false;
}}else{if(g[0].prodOfferPageInfo.checkBoxValue){continue;}if(l.subProdOfferInfo.prodOfferType!=a.PRODOFFERTYPE.MAIN_OFFER_TYPE&&g[0].prodOfferType!=a.PRODOFFERTYPE.MAIN_OFFER_TYPE){d.confirm({title:"\u9009\u62e9\u6846",busiCode:"08410152",infoList:[l.subProdOfferInfo.prodOfferName,g[0].subProdOfferInfo.prodOfferName,g[0].subProdOfferInfo.prodOfferName,l.subProdOfferInfo.prodOfferName],onComplete:function(q,p){return function(u){var t=r.subProdOfferOrderGrid.domNode;
if(u){dojo.query(".subProdOfferDetail-"+p.rowIndex,t)[0].childNodes[0].checked=true;if(p.prodOfferInst!=null){r.updateCurrentProdOfferStyle(p,"prod-offer-change");}else{r.updateCurrentProdOfferStyle(p,"prod-offer-add");
}checkInstance.doCheckedSubProdOffer({rowIndex:p.rowIndex,subProdOfferCartDataProvider:r});}else{dojo.query(".subProdOfferDetail-"+q.rowIndex,t)[0].childNodes[0].checked=false;if(q.prodOfferInst!=null){r.updateCurrentProdOfferStyle(q,"prod-offer-del");
}else{r.updateCurrentProdOfferStyle(q,"prod-offer-unorder");}checkInstance.doUnCheckedSubProdOffer({rowIndex:q.rowIndex,subProdOfferCartDataProvider:r});}};}(l,g[0])},dojo.byId("subProdOfferCart"));return false;
}}}}}}return true;},doCheckRoamProd:function(g){var l=g.checkedProdOfferGridData,h=g.allSubProdOfferCartData,n=this,i="",e=a.RoamProdConst.InterRoamProdConst,k=a.RoamProdConst.InlandRoamProdConst,f=[],j=[],m=[];
dojo.forEach(l,function(p){if(p.showData.checkedOption=="checked"){var o=dojo.forEach(p.relaProdPageInfoList||[],function(q){var r=q.prodBasicInfo;Array.prototype.push.apply(f,dojo.filter(e,function(s){return !!r.checkedStatus&&s==r.productId;
}));});}});if(!!f&&f.length==0){dojo.forEach(h,function(p){if(!p.prodOfferInst){return;}var o=dojo.forEach(p.prodOfferInst.prodInstList||[],function(q){Array.prototype.push.apply(j,dojo.filter(e,function(r){return r==q.productId;
}));});});if(!!j&&j.length>0){dojo.forEach(l,function(p){if(p.showData.checkedOption=="checked"){var o=dojo.forEach(p.relaProdPageInfoList||[],function(q){var r=q.prodBasicInfo;Array.prototype.push.apply(m,dojo.filter(k,function(s){return !!r.checkedStatus&&s==r.productId;
}));});}});if(!!m&&m.length==0){d.alert({busiCode:"08410132"});return false;}}}return true;},doCheckProdOfferFavourNum:function(g){var f=g.checkedProdOfferGridData,h=this,e=BusCard.find(f,function(k){if(k.showData.prodOfferDetailFlag=="0"){return;
}var n=k.subProdOfferInfo;if(n.usageTypeList&&n.usageTypeList.length>0){var l=n.usageTypeList;for(var m=0,j=l.length;m<j;m++){if(l[m]=="1"||l[m]=="2"||l[m]=="126"){if(!!k.prodOfferInst&&!k.relaBusPageInfoList){return false;
}if(!k.relaBusPageInfoList||(!!k.relaBusPageInfoList&&k.relaBusPageInfoList.length==0)){return true;}}}}});if(e){d.alert({busiCode:"08410133",infoList:[e.subProdOfferInfo.prodOfferName]});return false;
}return true;},doCheckProdRole:function(f){var e=this.controller;checkedProdOfferGridData=f.checkedProdOfferGridData,roleInfo={},flag=true;BusCard.each(checkedProdOfferGridData,function(h){var g=e.route("/prodOfferDetailBuilder/filterRelaProdList",h);
dojo.forEach(g,function(i){if(!!i.roleInfoVO){if(!!roleInfo[i.roleInfoVO.roleCD]){roleInfo[i.roleInfoVO.roleCD].push(i);}else{roleInfo[i.roleInfoVO.roleCD]=[];roleInfo[i.roleInfoVO.roleCD].push(i);}}});
BusCard.each(roleInfo,function(i){var k=dojo.filter(i,function(n){return dojo.some(h.relaProdPageInfoList,function(o){return(n.productId==o.prodBasicInfo.productId)&&(o.prodBasicInfo.checkedStatus==true);
});});var l=i[0].roleInfoVO.roleNumMin,j=i[0].roleInfoVO.roleNumMax;if(k.length<l||k.length>j){var m=h.subProdOfferInfo.prodOfferName+"\n关联的产品\n";prodNameStr=[];dojo.forEach(i,function(n){prodNameStr.push(n.productInfoVO.productName);
});d.alert({busiCode:"08410134",infoList:[m,prodNameStr.toString(),l,j]});flag=false;return flag;}});return flag;});return flag;},doCheckResRela:function(g){var f=g.checkedProdOfferGridData,e=BusCard.find(f,function(i){var h=i.subProdOfferInfo.resRelaList;
return BusCard.exist(h||[],function(j){return j&&(j.mktResCd==20||j.mktResCd==42)&&!i.resRelaPageInfoList;});});if(e){d.alert({busiCode:"08410135",infoList:[e.subProdOfferInfo.prodOfferName]});return false;
}return true;},doCheckAssure:function(g){var f=g.checkedProdOfferGridData,e=BusCard.find(f,function(h){return h.subProdOfferInfo.prodOfferAssureDemandVO.length>0&&(!h.prodOfferInst||(!h.prodOfferInst.prodOfferInstAssureList||h.prodOfferInst.prodOfferInstAssureList.length==0))&&!h.prodOfferAssurePageInfoList;
});if(e){d.alert({busiCode:"08410136",infoList:[e.subProdOfferInfo.prodOfferName]});return false;}return true;},doCheckProductDepend:function(z,m){var j={};if($ac$.get("_allSubRegionServiceProdMap_")){j=$ac$.get("_allSubRegionServiceProdMap_");
}else{$ac$.set("_allSubRegionServiceProdMap_",j);}var n=m.uniqueId||"";$ac$.set("_serviceProdIdList_"+n,null);var o={};var v=z.checkedProdOfferGridData;var x=this;if(v!=null&&v.length>0){for(var s=0;s<v.length;
s++){var e=v[s];var y=e.relaProdPageInfoList;if(!y){continue;}if(y!=null&&y.length>0){for(var r=0;r<y.length;r++){var f=y[r];if(!f.prodBasicInfo.productId){continue;}if(!f.prodBasicInfo.checkedStatus){continue;
}var t=BusCard.find(a.ProdOfferHelper.getProductList(true,e.subProdOfferInfo),function(k){return k.productId==f.prodBasicInfo.productId;});if(e.showData.chooseNumberObj!=null){if(!!f.prodAttrInfo){if(j[e.showData.chooseNumberObj.uniqueId]){j[e.showData.chooseNumberObj.uniqueId].push(f);
}else{j[e.showData.chooseNumberObj.uniqueId]=[];j[e.showData.chooseNumberObj.uniqueId].push(f);}}}o[f.prodBasicInfo.productId]={prodOfferName:e.subProdOfferInfo.prodOfferName,productName:t.productInfoVO.productName};
var h=t.productInfoVO;var g=h.prodRelaList;if(g.length==0){continue;}for(var w=0;w<g.length;w++){if(w==a.AcceptCheckCount.checkCount){break;}var i=g[w];if(i.relaType==a.PRODOFFERTYPE.DEPEND_TYPE){var u=i.prodB;
if(!x.doGetProdDependByProdId(z,u)){var l=BusCard.$remote("innerInterfaceBO").getProductName(u);d.alert({busiCode:"08410137",infoList:[h.productName,l,l]});return false;}}}}}}}$ac$.set("_serviceProdIdList_"+n,o);
$ac$.set("_allSubRegionServiceProdMap_",j);return true;},doGetProdDependByProdId:function(j,h){var i=j.checkedProdOfferGridData;for(var e=0;e<i.length;e++){var k=i[e];var f=k.relaProdPageInfoList;if(!f){continue;
}if(f!=null&&f.length>0){for(var g=0;g<f.length;g++){var l=f[g];if(parseInt(h)==l.prodBasicInfo.productId){return true;}}}}return false;},doCheckProductEx:function(A){var x=A.checkedProdOfferGridData;endLoopFlag=true;
if(x!=null&&x.length>0){for(var u=0;u<x.length;u++){var A=x[u];var z=A.relaProdPageInfoList;if(!z){continue;}if(z!=null&&z.length>0){for(var s=0;s<z.length;s++){var h=z[s];if(!h.prodBasicInfo.productId){continue;
}if(!h.prodBasicInfo.checkedStatus){continue;}var v=BusCard.find(a.ProdOfferHelper.getProductList(true,A.subProdOfferInfo),function(k){return k.productId==h.prodBasicInfo.productId;});var j=v.productInfoVO;
var i=j.prodRelaList;if(i.length==0){continue;}for(var y=0;y<i.length;y++){if(y==a.AcceptCheckCount.checkCount){break;}var l=i[y];if(l.relaType==a.PRODOFFERTYPE.EX_TYPE){var m=null;if(v.productId==l.prodB){m=l.prodA;
}else{m=l.prodB;}for(var n=0;n<x.length;n++){var e=x[n];var g=e.relaProdPageInfoList;if(!g){continue;}if(g!=null&&g.length>0){for(var o=0;o<g.length;o++){var r=g[o];var f=BusCard.find(a.ProdOfferHelper.getProductList(true,e.subProdOfferInfo),function(k){return k.productId==r.prodBasicInfo.productId;
});if(parseInt(m)==r.prodBasicInfo.productId){d.alert({busiCode:"08410138",infoList:[A.subProdOfferInfo.prodOfferName,j.productName,e.subProdOfferInfo.prodOfferName,f.productInfoVO.productName]});return false;
}}}}}}}}}}return true;},doCheckProductRelation:function(f,e){if(!this.doCheckProductDepend(f,e)){return false;}if(!this.doCheckProductEx(f)){return false;}return true;},doCheckProdAttrInfo:function(g){var f=g.checkedProdOfferGridData,i=this,h="",e=BusCard.find(f,function(k){if(k.showData.prodOfferDetailFlag=="0"){return;
}var j=dojo.filter(k.subProdOfferInfo.offerProdRelaList||[],function(l){return dojo.some(k.relaProdPageInfoList||[],function(m){if(m.prodBasicInfo.productId==l.productId&&l.productInfoVO.prodFuncType!="101"&&m.prodBasicInfo.checkedStatus==true&&!i.doCheckIfHasAttr(m.prodAttrInfo)&&a.AttrUtil.checkedIfNeedShow(l.productInfoVO.attrList)){if(i.doCheckRoamProdForChg(m)){return false;
}return true;}});});if(j.length>0){dojo.forEach(j,function(l){h+="【"+l.productInfoVO.productName+"】";});return true;}});if(e){d.alert({busiCode:"08410139",infoList:[e.subProdOfferInfo.prodOfferName,h]});
return false;}return true;},doCheckRoamProdForChg:function(e){if(!!e.prodBasicInfo){if(!!e.prodBasicInfo.prodInstInfo){if(e.prodBasicInfo.productId==c.load("RoamProdIdConst").RoamProdIdConst.ROAM_PRODUCT_ID_A||e.prodBasicInfo.productId==c.load("RoamProdIdConst").RoamProdIdConst.ROAM_PRODUCT_ID_B||e.prodBasicInfo.productId==c.load("RoamProdIdConst").RoamProdIdConst.ROAM_PRODUCT_ID_C||e.prodBasicInfo.productId==c.load("RoamProdIdConst").RoamProdIdConst.ROAM_PRODUCT_ID_D){return true;
}}}return false;},doCheckOfferAttrInfo:function(g){var f=g.checkedProdOfferGridData,h=this,e=BusCard.find(f,function(i){if(i.showData.prodOfferDetailFlag=="0"){return;}return !h.doCheckProdOfferAttr(i);
});if(e){d.alert({busiCode:"08410140",infoList:[e.subProdOfferInfo.prodOfferName]});return false;}return true;},doCheckProdOfferAttr:function(e){var f=this;if(a.AttrUtil.checkedIfNeedShow(e.subProdOfferInfo.attrList)&&!f.doCheckIfHasAttr(e.offerAttrPageInfoList)){return false;
}return true;},doCheckIfHasAttr:function(e){for(var f in e){return true;}return false;},checkPromotionPageInfoBeforeCommit:function(i){var f=true;var j=this;var g=i.checkBindingData;var e=j.controller;
BusCard.each(g,function(m){if(!j.checkPromotionAttrInfo(m)){f=false;return false;}if(!j.checkPromotionResRelaInfo(m)){f=false;return false;}var l=m.showData.promotionInfo;if(l.promotionType==c.load("PromotionTypeConst").PromotionTypeConst.TRANS_MONTH_PROMOTION){if(!j.checkPromotionItemValueByBill(m)){f=false;
return false;}}});if(!f){return false;}if(g&&g.length>0){var h=c.load("PromotionTypeConst").PromotionTypeConst.SUBSIDY_PROMOTION;var k=dojo.some(g,function(l){return l.showData.promotionInfo.promotionType!=h;
});if(j.isOcsPayModeMethod()&&k){alert("OCS用户不能订购非补贴卷类促销政策");j.uncheckedPromotionInfo(e,"");f=false;}if(j.isMoreOnSameTarget(g)){f=false;}if(j.rentContinueCheck(g,e)){f=false;}if(j.checkGroupCoupon(g,e)){f=false;
}}return f;},isOcsPayModeMethod:function(){var g=false;var k=dojo.query("tr[uniqueId]",this.controller.mainProdOfferWidget.domNode);if(k&&k.length>0){for(var f=0;f<k.length;f++){var m=k[f];var h=dojo.attr(m,"uniqueId");
var j="serviceCardWidget_"+h;var e=unieap.byId(j);var n=false;var o=false;if(e.busCardInstance.$("paymentModeCd")){var l=e.busCardInstance.$("paymentModeCd").value;if(l==c.load("PaymentModeConst").PaymentModeConst.PREPAID){n=true;
}}if(e.getModel().cardParam.userId==0){o=true;}if(n&&o){g=true;break;}}}return g;},isMoreOnSameTarget:function(m){var f=[];var o=[];var e=c.load("PromotionTypeConst").PromotionTypeConst;dojo.forEach(m||[],function(k){var j=k.showData.promotionInfo;
var A=j.promotionTargetObjectList;var y=dojo.some(A||[],function(C){return C.targetObjectType==2;});var i=j.promotionType;if(y&&(i==e.DEVICE_RENT||i==e.SUBSIDY_PROMOTION||i==e.TELCHARGE_COUPON)){var z=k.promotionPageInfo.uniqueid;
var B=dojo.some(f||[],function(C){return C==z;});if(!B){f.push(z);}var x={checkData:k};o.push(x);}});for(var p=0;p<f.length;p++){var u=f[p];var v=dojo.filter(o||[],function(i){return i.checkData.promotionPageInfo.uniqueid==u;
});if(v&&v.length>1){for(var n=0;n<v.length;n++){var q=v[n];for(var l=0;l<v.length;l++){if(l!=n){var h=v[l];var s=a.DateHelper.getDateFromString(q.checkData.promotionPageInfo.endDate,1);var g=a.DateHelper.getDateFromString(h.checkData.promotionPageInfo.startDate,1);
if(dojo.date.compare(g,s)<0){var t=q.checkData.showData.promotionInfo.promotionName;var r=h.checkData.showData.promotionInfo.promotionName;var w="促销【"+t+"】与促销【"+r+"】作用对象相同且【"+t+"】结束时间大于【"+r+"】开始时间,不能同时订购";
alert(w);return true;}}}}}}return false;},rentContinueCheck:function(l,y){var C=this;var p=c.load("PromotionTypeConst").PromotionTypeConst;var q=c.load("PromotionCommonConst").PromotionCommonConst;if(l&&l.length>0){for(var D=0;
D<l.length;D++){var s=l[D];var r=s.showData.promotionInfo;var B=r.promotionType;var o=s.promotionPageInfo.uniqueid;var w=unieap.byId("serviceCardWidget_"+o);var j=w.getModel().cardParam.userId;if(B==p.DEVICE_RENT||B==p.TELCHARGE_COUPON){if(j&&j!="null"&&j!=0){var n="&userId="+j;
var E=a.ServiceFactory.getService("url:businessAcceptAction.do?method=getValidPromotionInst"+n);if(E){var x=E.objectType;var v=E.objectInstance;var h=true;var u="2037-1-1 00:00:00";var k="";if(x=="inst"){var g=v.salesPromotionItemInstVOList;
h=dojo.some(g||[],function(i){return i.itemAttrId==q.CONSUME_KIND_CD&&i.attrValue==2;});u=a.DateHelper.getDateFromString(v.expDate);k=v.promotionType;}else{if(x=="temp"){var z=v.offerInstAttrTemplist;h=dojo.some(z||[],function(i){return i.attrId==q.CONSUME_KIND_CD&&i.attrValue==2;
});u=a.DateHelper.getDateFromString(v.expDate);k=v.promotionType;}}if(k==p.SUBSIDY_PROMOTION){alert("作用对象已存在有效补贴券，不能再次订购租机或话费补贴类政策");C.uncheckedPromotionInfo(y,"rent");return true;}else{if(!h){alert("作用对象已存在有效租机或话费补贴类政策且协议消费方式为非协议消费期，不能再次订购租机或话费补贴类政策");
C.uncheckedPromotionInfo(y,"rent");return true;}var f="&ServiceKind=-1&apply_event=-1&infoId=233";var t=a.ServiceFactory.getService("url:businessAcceptAction.do?method=getCityBusinessParamValue"+f);if(t){var m=a.DateHelper.getDateFromString($ac$.requestParam.today);
m.setMonth(m.getMonth()+parseInt(t));if(dojo.date.compare(m,u)<0){alert("当前时间距有效租机或话费补贴失效时间大于"+t+"个月，不能再次订购租机或话费补贴类政策");C.uncheckedPromotionInfo(y,"rent");return true;}}}}var A=a.ServiceFactory.getService("url:businessAcceptAction.do?method=getReservePromotion"+n);
if(A){if(parseInt(A)>=1){alert("作用对象已存在预约状态租机或话费补贴，不能再订购租机或话费补贴类政策");C.uncheckedPromotionInfo(y,"rent");return true;}}}}else{if(B==p.SUBSIDY_PROMOTION){if(j&&j!="null"&&j!=0){var n="&userId="+j;var e=a.ServiceFactory.getService("url:businessAcceptAction.do?method=getPromotionInvalidDate"+n);
if(e){alert("作用对象已存在有效租机、话费补贴或补贴券政策，不能再次订购补贴券");C.uncheckedPromotionInfo(y,"subsidy");return true;}}}}}}return false;},checkGroupCoupon:function(g,j){var o=this;if(g&&g.length>0){for(var h=0;h<g.length;
h++){var e=g[h];var k=e.promotionPageInfo.uniqueid;var f=unieap.byId("serviceCardWidget_"+k);var l=f.busCardInstance.$("serviceId").value;if(l&&l!="null"){var n="&serviceId="+l;var m=a.ServiceFactory.getService("url:businessAcceptAction.do?method=doCheckGroupCoupon"+n);
if(m&&m==1){alert("业务号码【"+l+"】已兑换了集团礼券，不能订购促销政策");o.uncheckedPromotionInfo(j,"all");return true;}}}}return false;},uncheckedPromotionInfo:function(e,f){var i=e.salesPromotionOrderGrid;var h=i.ds.getRawData();
var g=c.load("PromotionTypeConst").PromotionTypeConst;if(f=="rent"){dojo.filter(h||[],function(m){var q=m.rowIndex;var l=m.showData.promotionInfo;var p=m.showData.promotionInstInfo;if(l&&(l.promotionType==g.DEVICE_RENT||l.promotionType==g.TELCHARGE_COUPON)&&!p){dojo.query(".promotionNameDetail-"+q,i.domNode)[0].childNodes[0].checked=false;
var o=e.promotionDetailBuilder;if(o){var j=o.prodOfferDetailWidgetList[""+q];if(j.resRelaBuilder){var k=j.resRelaBuilder.resourceCardList;if(k){var n=k[0].busCardInstance;if(n){n.$("deviceNo").value="";
dojo.forEach(dojo.global.$appContext$.deviceNoList||[],function(r){if(r.rowIndex==q){r.deviceNo="";}});}}}}m.resRelaPageDataList=[];}});}else{if(f=="subsidy"){dojo.filter(h||[],function(k){var m=k.rowIndex;
var j=k.showData.promotionInfo;var l=k.showData.promotionInstInfo;if(j&&j.promotionType==g.SUBSIDY_PROMOTION&&!l){dojo.query(".promotionNameDetail-"+m,i.domNode)[0].childNodes[0].checked=false;}});}else{if(f=="all"){dojo.filter(h||[],function(k){var m=k.rowIndex;
var j=k.showData.promotionInfo;var l=k.showData.promotionInstInfo;if(!l){dojo.query(".promotionNameDetail-"+m,i.domNode)[0].childNodes[0].checked=false;}});}else{dojo.filter(h||[],function(k){var l=k.rowIndex;
var j=k.showData.promotionInfo;if(j&&j.promotionType!=g.SUBSIDY_PROMOTION){dojo.query(".promotionNameDetail-"+l,i.domNode)[0].childNodes[0].checked=false;}});}}}},checkPromotionAttrInfo:function(f){var j=true;
var h=f.showData.promotionInfo;var m=dojo.filter(h.salesPromotionItemList||[],function(i){return i.ifNecessary==1;});var n=f.promotionItemsPageInfoList;for(var g=0;g<m.length;g++){var k=m[g];var l=k.attrSpec;
var e=dojo.some(n||[],function(i){return !i[l.attrCd];});if(e){d.alert({busiCode:"08410141",infoList:[h.promotionName]});j=false;break;}}return j;},checkPromotionItemValueByBill:function(f){var l=f.showData.promotionInfo.promotionId;
var m=f.promotionItemsPageInfoList;var j=c.load("PromotionCommonConst").PromotionCommonConst;var i=[];for(var k in m){var h={};if(k==j.CAPITAL_SUM){h.attrName="payFee";h.value=m[k];}else{if(k==j.PRESENT_FEE_CD){h.attrName="presentFee";
h.value=m[k];}else{if(k==j.DELAY_MONTHS_CD){h.attrName="delayMonths";h.value=m[k];}else{if(k==j.ACTIVE_FEE_CD){h.attrName="activeFee";h.value=m[k];}else{if(k==j.UNIT_FEE_CD){h.attrName="unitFee";h.value=m[k];
}else{if(k==j.PRESENT_DELAY_MONTHS_CD){h.attrName="presentDelayMomths";h.value=m[k];}}}}}}if(h.attrName){i.push(h);}}var g="promotionId="+l+"&itemList="+dojo.toJson(i);var e=executeRequest("orderDetailAction","doCheckCrmTransfer",g);
if(e==1){return true;}else{alert(e);return false;}},checkPromotionResRelaInfo:function(h){var g=h.showData.promotionInfo;var k=h.resRelaPageDataList;var i=g.proodOfferInfo.resRelaList||[];var e=false;for(var j in i){var f=i[j];
if(f&&(f.mktResCd==20||f.mktResCd==21)){if(k.length>0){e=dojo.some(k||[],function(l){return l.mktResInstId=="-1";});}else{e=true;}}if(f&&f.mktResCd==36){e=dojo.some(k||[],function(l){return l.mktGiftResInstId=="-1";
});}if(e){break;}}if(e){d.alert({busiCode:"08410142",infoList:[g.promotionName]});return false;}return true;},doCheckPayRelationValidNew:function(i){try{var g=i.orderAcceptInfoList[0],f=this.controller,h=g.accountRelaList||[],j=dojo.filter(BusCard.jsonPath(g,"$.prodOfferAcceptInfoList[*].accessProdAcceptInfoList[*]]")||[],function(e){return(e.operKind==1)&&e.ifNeedCreateProdInst!="0";
});dojo.forEach(h,function(l){var e=dojo.some(j,function(m){var n=m;return n.serviceId==l.serviceId&&n.productId==l.productId;});if(!e){d.alert({busiCode:"08410143",infoList:[l.serviceId]});throw new Error("");
}});dojo.forEach(j,function(e){var m=e;var l=dojo.some(h,function(n){return n.serviceId==m.serviceId&&n.productId==m.productId;});if(!l){d.alert({busiCode:"08410144",infoList:[m.serviceId]});f.route("/self/openProdOfferAcceptPane",[["payRelationPane"]]);
throw new Error("");}});}catch(k){return false;}},doCheckedSubProdOffer:function(C){var l=C.subProdOfferCartDataProvider;var f=l.getSubGridBindingData(),m=C.rowIndex,p=this.controller,w=this,z=l.subProdOfferOrderGrid.domNode,r=dojo.filter(f,function(E){return E.rowIndex==m;
})[0],A=r.subProdOfferInfo,g=r.prodOfferInst,s=a.ProdOfferHelper.getProdOfferRelaList(A);if(g!=null){l.updateCurrentProdOfferStyle(r,"prod-offer-change");}else{l.updateCurrentProdOfferStyle(r,"prod-offer-add");
}if(w.doCheckProdOfferReserve(A,l,r,true)){return false;}if(!w.doCheckProdOfferGroupCount(C)){return false;}if(!w.doCheckProdOfferGroupExclusion(C)){return false;}var D=dojo.filter(s||[],function(E){return E.relationTypeCD==a.PRODOFFERTYPE.EX_TYPE&&E.prodOfferInfoVO.prodOfferType!=a.PRODOFFERTYPE.MAIN_OFFER_TYPE;
});if(D.length>0){var t=dojo.filter(f,function(E){return dojo.some(D,function(F){return(E.subProdOfferInfo.prodOfferId==F.offerAId&&F.offerZId==A.prodOfferId)||(E.subProdOfferInfo.prodOfferId==F.offerZId&&F.offerAId==A.prodOfferId);
});});if(t.length>0){var k=dojo.filter(t||[],function(E){return dojo.query(".subProdOfferDetail-"+E.rowIndex,z)[0].childNodes[0].checked;});if(k.length>0){dojo.forEach(k,function(E){dojo.query(".subProdOfferDetail-"+E.rowIndex,z)[0].childNodes[0].checked=false;
if(E.prodOfferInst!=null){l.updateCurrentProdOfferStyle(E,"prod-offer-del");}else{l.updateCurrentProdOfferStyle(E,"prod-offer-unorder");}w.doUnCheckedSubProdOffer({rowIndex:E.rowIndex,subProdOfferCartDataProvider:l});
});}}}var B=[];var e=[];dojo.forEach(s||[],function(E){if(E.relationTypeCD==a.PRODOFFERTYPE.DEPEND_TYPE&&E.offerAId==A.prodOfferId&&E.prodOfferInfoVO.prodOfferType!=a.PRODOFFERTYPE.MAIN_OFFER_TYPE){if(E.selectable==1){B.push(E);
}else{e.push(E);}}});var i=null;var y=[];if($ac$.currentMainProdOfferInfoVO.bindType==2){i=l.contentPane.prodOfferInfoVO.prodOfferId;}else{i=$ac$.currentMainProdOfferInfoVO.prodOfferId;}if($ac$.get("_allowProdOfferIds_"+i)){y=$ac$.get("_allowProdOfferIds_"+i);
}else{var h=l.uniqueId||"";var j="prodOfferId="+i+"&accProdListStr="+(w.controller.getAccProdIdList(h)||"")+"&method=getSubProdOfferInfoByName";y=a.ServiceFactory.getService("url:shoppingCartAction.do?"+j);
$ac$.set("_allowProdOfferIds_"+i,y);}if(!this.doCheckIfExistAllowOffers(y,B,A)){dojo.query(".subProdOfferDetail-"+m,z)[0].childNodes[0].checked=false;if(f[m].prodOfferInst!=null){l.updateCurrentProdOfferStyle(r,"prod-offer-del");
}else{l.updateCurrentProdOfferStyle(r,"prod-offer-unorder");}return false;}var x=[];var u=[];dojo.forEach(e||[],function(E){var F=dojo.some(y||[],function(G){return G.prodOfferId==E.offerZId;});if(F){x.push(E);
}else{u.push(E);}});var v="";dojo.forEach(u,function(E){v+="["+E.prodOfferInfoVO.prodOfferName+"]";});if(B.length>0||x.length>0){var n=[];var o=[];B=B.concat(x);dojo.forEach(B,function(F){var E=dojo.some(f,function(G){return F.offerZId==G.subProdOfferInfo.prodOfferId&&G.showData.chooseNumberObj!=null?r.showData.chooseNumberObj.uniqueId==G.showData.chooseNumberObj.uniqueId:G.showData.chooseNumberObj==null;
});if(E){n.push(F);}else{o.push(F);}});if(n.length==0){if(v!=""){d.alert({busiCode:"08410208",infoList:[v]});}dojo.forEach(B,function(E){var F=a.ProdOfferHelper.getProdOfferDetail(E.offerZId);var G=a.ProdOfferHelper.createProdOfferRowData(F);
if(r.showData.chooseNumberObj!=null){G.showData.chooseNumberObj=r.showData.chooseNumberObj;}else{G.showData.chooseNumberObj=null;}l.addOneRow(G);w.doCheckedSubProdOffer({rowIndex:G.rowIndex,subProdOfferCartDataProvider:l});
});}else{if(o.length==0){if(v!=""){d.alert({busiCode:"08410208",infoList:[v]});}var q=dojo.filter(f,function(E){return dojo.query(".subProdOfferDetail-"+E.rowIndex,z)[0].childNodes[0].checked==false&&dojo.some(n||[],function(F){return F.offerZId==E.subProdOfferInfo.prodOfferId;
})&&r.showData.chooseNumberObj!=null?r.showData.chooseNumberObj.uniqueId==E.showData.chooseNumberObj.uniqueId:E.showData.chooseNumberObj==null;});if(q.length>0){dojo.forEach(q,function(E){dojo.query(".subProdOfferDetail-"+E.rowIndex,z)[0].childNodes[0].checked=true;
if(E.prodOfferInst!=null){l.updateCurrentProdOfferStyle(E,"prod-offer-change");}else{l.updateCurrentProdOfferStyle(E,"prod-offer-add");}w.doCheckedSubProdOffer({rowIndex:E.rowIndex,subProdOfferCartDataProvider:l});
});}}else{if(v!=""){d.alert({busiCode:"08410208",infoList:[v]});}var q=dojo.filter(f,function(E){return dojo.query(".subProdOfferDetail-"+E.rowIndex,z)[0].childNodes[0].checked==false&&dojo.some(n||[],function(F){return F.offerZId==E.subProdOfferInfo.prodOfferId;
})&&r.showData.chooseNumberObj!=null?r.showData.chooseNumberObj.uniqueId==E.showData.chooseNumberObj.uniqueId:E.showData.chooseNumberObj==null;});if(q.length>0){dojo.forEach(q,function(E){dojo.query(".subProdOfferDetail-"+E.rowIndex,z)[0].childNodes[0].checked=true;
if(E.prodOfferInst!=null){l.updateCurrentProdOfferStyle(E,"prod-offer-change");}else{l.updateCurrentProdOfferStyle(E,"prod-offer-add");}w.doCheckedSubProdOffer({rowIndex:E.rowIndex,subProdOfferCartDataProvider:l});
});}dojo.forEach(o||[],function(E){var F=a.ProdOfferHelper.getProdOfferDetail(E.offerZId);var G=a.ProdOfferHelper.createProdOfferRowData(F);if(r.showData.chooseNumberObj!=null){G.showData.chooseNumberObj=r.showData.chooseNumberObj;
}else{G.showData.chooseNumberObj=null;}l.addOneRow(G);w.doCheckedSubProdOffer({rowIndex:G.rowIndex,subProdOfferCartDataProvider:l});});}}}},doCheckIfExistAllowOffers:function(i,h,f){var e=dojo.filter(h||[],function(j){return !dojo.some(i,function(k){return k.prodOfferId==j.offerZId;
});});if(e.length>0){var g="";dojo.forEach(e||[],function(j){g+="["+j.prodOfferInfoVO.prodOfferName+"]";});d.alert({busiCode:"08410209",infoList:[f.prodOfferName,g,f.prodOfferName]});return false;}return true;
},getAllDependOffer:function(h,e,g){var f=this;dojo.forEach(h,function(i){var j=dojo.filter(e||[],function(k){return k.relationTypeCD==a.PRODOFFERTYPE.DEPEND_TYPE&&k.offerAId==i.offerZId&&k.prodOfferInfoVO.prodOfferType!=a.PRODOFFERTYPE.MAIN_OFFER_TYPE&&k.selectable==1;
});if(j.length>0){dojo.forEach(j,function(k){g.push(k);});f.getAllDependOffer(j,e,g);}});return g;},getIfReserveSubProdOffer:function(e){if(a.ProdOfferHelper.getIfReserveSubProdOffer(e.prodOfferInst)){return false;
}return true;},doUnCheckedSubProdOffer:function(k){var q=k.subProdOfferCartDataProvider;var m=q.getSubGridBindingData(),o=k.rowIndex,l=this.controller,t=this,h=[],r="",f=q.subProdOfferOrderGrid.domNode,n=true,s=dojo.filter(m,function(u){return u.rowIndex==o;
})[0],p=s.subProdOfferInfo,g=s.prodOfferInst,i=a.ProdOfferHelper.getProdOfferRelaList(p);if(t.doCheckSelectable(p,q.uniqueId)){d.alert({busiCode:"08410145",infoList:[p.prodOfferName]});dojo.query(".subProdOfferDetail-"+o,f)[0].childNodes[0].checked=true;
if(g!=null){q.updateCurrentProdOfferStyle(s,"prod-offer-change");}else{q.updateCurrentProdOfferStyle(s,"prod-offer-add");}return;}if(g!=null){q.updateCurrentProdOfferStyle(s,"prod-offer-del");}else{q.updateCurrentProdOfferStyle(s,"prod-offer-unorder");
}var h=[];var e="";var j={cancelProdOfferBindList:h,cancelProdOfferInfo:p,subProdOfferCartDataProvider:q,cancelTips:e};t.computationDependProdOfferForCancel(j);e=j.cancelTips;if(h.length>0){dojo.forEach(h,function(u){dojo.query(".subProdOfferDetail-"+u.rowIndex,f)[0].childNodes[0].checked=false;
if(u.prodOfferInst!=null){q.updateCurrentProdOfferStyle(u,"prod-offer-del");}else{q.updateCurrentProdOfferStyle(u,"prod-offer-unorder");}t.doUnCheckedSubProdOffer({rowIndex:u.rowIndex,subProdOfferCartDataProvider:q});
});}t.doUnCheckedRelation(k);if(!!$ac$.get("currentOperDelView")){$ac$.set("currentOperDelView",false);}},doUnCheckedRelation:function(j){var p=j.subProdOfferCartDataProvider;var l=p.getSubGridBindingData(),n=j.rowIndex,k=this.controller,t=this,g=[],r="",e=p.subProdOfferOrderGrid.domNode,m=true,s=dojo.filter(l,function(u){return u.rowIndex==n;
})[0],o=s.subProdOfferInfo,f=s.prodOfferInst,h=a.ProdOfferHelper.getProdOfferRelaList(o);var i=[];dojo.forEach(h||[],function(u){if(u.selectable!=1&&u.relationTypeCD==a.PRODOFFERTYPE.DEPEND_TYPE&&u.offerAId==o.prodOfferId&&u.prodOfferInfoVO.prodOfferType!=a.PRODOFFERTYPE.MAIN_OFFER_TYPE){i.push(u.offerZId);
}});var q=dojo.filter(l||[],function(u){return dojo.some(i||[],function(v){return u.subProdOfferInfo.prodOfferId==v;});});if(q.length>0){dojo.forEach(q,function(u){if(dojo.query(".subProdOfferDetail-"+u.rowIndex,e)[0].childNodes[0].checked){dojo.query(".subProdOfferDetail-"+u.rowIndex,e)[0].childNodes[0].checked=false;
if(u.prodOfferInst!=null){p.updateCurrentProdOfferStyle(u,"prod-offer-del");}else{p.updateCurrentProdOfferStyle(u,"prod-offer-unorder");}t.doUnCheckedSubProdOffer({rowIndex:u.rowIndex,subProdOfferCartDataProvider:p});
}});}},doCheckSelectable:function(h,k){if(!dojo.global.$appContext$.get("prodOfferList"+k)){return false;}var e=null;var j=null;var f=$ac$.selectedMainProdOfferInfoVO;if(f.bindType==2){var i=a.ProdOfferHelper.getMainProdOffer(dojo.global.$appContext$.get("prodOfferList"+k))[0];
e=i.prodOfferRelaList;j=i.prodOfferId;}else{j=f.prodOfferId;var g=a.ServiceFactory.getService("url:orderDetailAction.do?method=getProdOfferRelaListByMainProdOfferId",null,{method:"post",content:{prodOfferId:f.prodOfferId}});
e=g;}return dojo.some(e||[],function(l){return l.offerAId==j&&l.offerZId==h.prodOfferId&&l.selectDefault==1&&l.selectable==1;});},doCheckProdOfferGroupCount:function(i){var q=i.subProdOfferCartDataProvider;
var l=q.getSubGridBindingData(),m=i.rowIndex,k=this.controller,t=this,f=q.subProdOfferOrderGrid.domNode,u=dojo.filter(l,function(v){return v.rowIndex==m;})[0],p=u.subProdOfferInfo,h=u.prodOfferInst;if(p.prodOfferGroupVO){var j=p.prodOfferGroupVO;
var g=j.maxSelectable;var o=j.minSelectable;var n=j.prodGroupID;var e=dojo.filter(l||[],function(w){var v=w.subProdOfferInfo;if(!!v.prodOfferGroupVO){var x=v.prodOfferGroupVO.prodGroupID;return x==n&&w.rowIndex!=m&&dojo.query(".subProdOfferDetail-"+w.rowIndex,f)[0].childNodes[0].checked;
}return false;});if(e.length<g){return true;}else{if(e.length==g){var s="";dojo.forEach(e||[],function(v){s+="["+v.subProdOfferInfo.prodOfferName+"]";});var r="销售品分组["+j.groupName+"]中最大可以选择["+g+"],最少可以选择["+o+"],已经选择了"+s+",请确认";
d.alert({title:"\u63d0\u793a\u4fe1\u606f",message:r});dojo.query(".subProdOfferDetail-"+u.rowIndex,f)[0].childNodes[0].checked=false;if(h!=null){q.updateCurrentProdOfferStyle(u,"prod-offer-del");}else{q.updateCurrentProdOfferStyle(u,"prod-offer-unorder");
}t.doUnCheckedSubProdOffer({rowIndex:u.rowIndex,subProdOfferCartDataProvider:q});return false;}}}},doCheckProdOfferGroupExclusion:function(x){var i=x.subProdOfferCartDataProvider;var e=i.getSubGridBindingData(),l=x.rowIndex,m=this.controller,u=this,v=i.subProdOfferOrderGrid.domNode,o=dojo.filter(e,function(p){return p.rowIndex==l;
})[0],w=o.subProdOfferInfo,f=o.prodOfferInst,j=[];if(w.prodOfferGroupVO&&w.prodOfferGroupVO.prodOfferGroupRelVO){j=w.prodOfferGroupVO.prodOfferGroupRelVO;if(j.length==0){return true;}}else{return true;
}for(var r in e){var g=e[r].rowIndex;var h=e[r].subProdOfferInfo,k="";if(h&&h.prodOfferGroupId){k=h.prodOfferGroupId;}else{continue;}for(var n in j){var t=j[n];if(t.groupZID==k&&t.relationTypeCD==a.PRODOFFERTYPE.EX_TYPE){if(dojo.query(".subProdOfferDetail-"+g)[0].childNodes[0].checked){var s="销售品["+w.prodOfferName+"]与销售品["+h.prodOfferName+"]分组互斥,请确认";
d.alert({title:"\u63d0\u793a\u4fe1\u606f",message:s,onComplete:function(){}});dojo.query(".subProdOfferDetail-"+o.rowIndex,v)[0].childNodes[0].checked=false;if(f!=null){i.updateCurrentProdOfferStyle(o,"prod-offer-del");
}else{i.updateCurrentProdOfferStyle(o,"prod-offer-unorder");}u.doUnCheckedSubProdOffer({rowIndex:o.rowIndex,subProdOfferCartDataProvider:i});return false;}}}}return true;},doMemeberProductCountCheck:function(f){var e=a.DomHelper.findParentNode(f.currentTarget,function(m){return m.tagName.toUpperCase()=="TR";
}),i=dojo.attr(e,"productId"),l=dojo.attr(e,"maxCount"),j=dojo.attr(e,"productName"),k=dojo.query("TR[productId="+i+"]",e.parentNode),g=k.length,h=dojo.filter(k,function(q){var p=dojo.query(".member-oper-div",q)[0],n=dojo.query(".member-product-checkbox",q)[0];
if(!n.checked){return true;}if(p){var m=dojo.query(".member-offer-split",p)[0],o=dojo.query(".member-offer-quit",p)[0];return(m&&dojo.hasClass(m,"action-selected"))||(o&&dojo.hasClass(o,"action-selected"));
}});g-=h.length;if(g>=l){d.alert({busiCode:"08410146",infoList:[l,j]});return false;}},checkIfPortSpeedReserve:function(j){var i=j.prodOfferInst;if(j.prodOfferInst==null){return false;}var h=i.effDate;
var f=i.expDate;var e="2037-01-01 00:00:00";var g=$ac$.requestParam.today;if(a.DateHelper.compareDateValue(a.DateHelper.format(h),g)||(a.DateHelper.compareDateValue(e,a.DateHelper.format(f))&&!!i.oldExpDate)){if(a.ProdOfferHelper.getRaiseSpeedObj(j.subProdOfferInfo)==null){return false;
}else{d.alert({title:"\u63d0\u793a\u4fe1\u606f",message:"当前["+j.subProdOfferInfo.prodOfferName+"]可选包影响预约生效的产品属性[端口速率]变更，不允许取消!"});return true;}}return false;},doCheckMemberProdOfferSelect:function(g){var i=g.widget;
var j=g.selectedMemberProdOfferList;var h=$ac$.get("currentMainProdOfferInfoVO");var m=$ac$.get("currentMainProdOfferInfoVO").prodOfferId;var n=dojo.filter(j,function(e){return e.action=="new"||e.action=="change"||e.action=="nochange"||!e.action;
});var p=dojo.map(n,function(e){return parseInt(""+e.productId);});var k=dojo.map(n,function(e){return parseInt(""+e.prodOfferId);});if(h.bindType!=2){k=[];}var f=-1;try{f=parseInt(""+this.controller.getBelongCode());
f=f||-1;}catch(l){}var o=a.ServiceFactory.getService("url:orderDetailAction.do?method=checkOrderedOfferProdRelation",null,{method:"post",content:{commonRegionId:f,interfaceType:1,prodOfferId:m,offerList:k,productList:p}});
if(o&&o.result=="1"){d.alert({busiCode:"08410147",infoList:[o.message]});return false;}else{return true;}},computationDependProdOfferForCancel:function(k){var l=k.cancelProdOfferBindList;var f=k.cancelProdOfferInfo;
var e=k.subProdOfferCartDataProvider;var j=e.getSubGridBindingData();var g=e.subProdOfferOrderGrid.domNode;var h=this;var i=[];dojo.forEach(j,function(n){var o=n.subProdOfferInfo.prodOfferId,m=a.ProdOfferHelper.getProdOfferRelaList(n.subProdOfferInfo);
dojo.forEach(m,function(q){if(q.relationTypeCD==a.PRODOFFERTYPE.DEPEND_TYPE&&f.prodOfferId==q.offerZId&&n.subProdOfferInfo.prodOfferId==q.offerAId&&q.selectable==1&&dojo.query(".subProdOfferDetail-"+n.rowIndex,g)[0].childNodes[0].checked){var p=dojo.some(l,function(r){return n.rowIndex==r.rowIndex;
});if(!p){i.push(n);l.push(n);}return false;}});});if(i.length==0){return;}k.cancelTips+=h.concatProdOfferNameStr(i,f);dojo.forEach(i,function(m){k.cancelProdOfferInfo=m.subProdOfferInfo;h.computationDependProdOfferForCancel(k);
});},concatProdOfferNameStr:function(g,e){var f="";dojo.forEach(g,function(h){f+="【"+h.subProdOfferInfo.prodOfferName+"】";});return"销售品"+f+"依赖销售品【"+e.prodOfferName+"】,退订销售品【"+e.prodOfferName+"】,会导致"+f+"退订,";
},doChekOldUserServiceReserve:function(g,h){var i="prodOfferInstId="+g+"&method=doCheckIfReserve";var f=a.ServiceFactory.getService("url:orderDetailAction.do?"+i);if(f=="1"){var e="号码["+h+"]有预约生效的主销售品变更,不允许选择该号码";
d.alert({busiCode:"08410147",infoList:[e]});return false;}return true;},doCheckMainProdOfferReserve:function(o,n){var p=this;var j=n.uniqueId||"";if(!!$ac$.get("reserveMain"+j)){var e=null;if(n.contentPane){e=n.contentPane.prodOfferInfoVO;
}else{e=$ac$.selectedMainProdOfferInfoVO;}var l="当前销售品["+e.prodOfferName+"]有预约生效的主销售品变更,不允许增加或变更可选包销售品";d.alert({busiCode:"08410147",infoList:[l]});return false;}else{if(n.contentPane){var k=$ac$.selectedMemberProdOfferList;
var f=dojo.filter(k||[],function(q){return q.uniqueId==n.uniqueId;});if(!!f[0]){if(!!f[0].offerInstVO){if(f[0].offerInstVO.prodOfferId==f[0].prodOfferId){var m=n.contentPane.offerInstVO.prodOfferInstId;
var e=n.contentPane.prodOfferInfoVO;var i="prodOfferInstId="+m+"&method=doCheckIfReserve";var g=a.ServiceFactory.getService("url:orderDetailAction.do?"+i);if(g=="1"){$ac$.set("reserveMain"+provider.uniqueId,true);
var l="当前销售品["+e.prodOfferName+"]有预约生效的主销售品变更,不允许增加或变更可选包销售品";d.alert({busiCode:"08410147",infoList:[l]});return false;}}}}}else{if(!!$ac$.mainProdOfferInstVO){if($ac$.selectedMainProdOfferInfoVO.prodOfferId==$ac$.mainProdOfferInstVO.prodOfferId){var h=$ac$.mainProdOfferInstVO.prodOfferInstId;
var i="prodOfferInstId="+h+"&method=doCheckIfReserve";var g=a.ServiceFactory.getService("url:orderDetailAction.do?"+i);if(g=="1"){$ac$.set("reserveMain",true);var l="当前销售品["+$ac$.selectedMainProdOfferInfoVO.prodOfferName+"]有预约生效的主销售品变更,不允许增加或变更可选包销售品";
d.alert({busiCode:"08410147",infoList:[l]});return false;}}}}}return true;},doCheckProdOfferReserve:function(g,j,h,e){if(!!$ac$.get("currentOperDelView")){return false;}if(h.prodOfferInst!=null){return false;
}var i=this;if(!i.doCheckMainProdOfferReserve(g,j)){var f=j.subProdOfferOrderGrid.domNode;if(e){dojo.query(".subProdOfferDetail-"+h.rowIndex,f)[0].childNodes[0].checked=false;if(h.prodOfferInst!=null){j.updateCurrentProdOfferStyle(h,"prod-offer-del");
}else{j.updateCurrentProdOfferStyle(h,"prod-offer-unorder");}j.dealRaiseXDSLSpeed(h.subProdOfferInfo,h.showData.chooseNumberObj,false,h);}else{dojo.query(".subProdOfferDetail-"+h.rowIndex,f)[0].childNodes[0].checked=true;
if(h.prodOfferInst!=null){j.updateCurrentProdOfferStyle(h,"prod-offer-change");}else{j.updateCurrentProdOfferStyle(h,"prod-offer-add");}j.dealRaiseXDSLSpeed(h.subProdOfferInfo,h.showData.chooseNumberObj,true,h);
}return true;}return false;},doCheckSubGroupProdOffer:function(){var p=this;var h=dojo.global.$appContext$.get("requestParam");var l=h.customerData.custId;SubGroupProdId=c.load("SubGroupProdIdConst").SubGroupProdIdConst;
var m=$ac$.get("currentMainProdOfferInfoVO");var j=m.offerProdRelaList;var k=false;dojo.forEach(j,function(q){var r=q.productInfoVO.productId;if(r==SubGroupProdId.IVPN_SUB_GROUP_PRODID||r==SubGroupProdId.ECP_SUB_GROUP_PRODID){k=true;
return true;}});if(k){var g="&custId="+l+"&subGrpProdOfferId="+m.prodOfferId;var n=a.ServiceFactory.getService("url:prodOfferSaleAjaxAction.do?method=getProductRelByGRPOfferList"+g);if(n!=""&&n!=undefined){$ac$.set("subGroupProdInfo",n);
var f;dojo.forEach(n.prodRelaList,function(q){if(q.relaType=="100800"){f=q.prodA;return true;}});if(f!="903"){var e="&relProductId="+f+"&custId="+l+"&productId="+n.productId;var o=a.ServiceFactory.getService("url:orderDetailAction.do?method=checkSubGroupCount"+e);
var i=o.split("~");if(i[0]==-1){d.alert({title:"错误信息",message:i[1]});return false;}else{if(i[1]>=i[2]){d.alert({busiCode:"08410190",infoList:[i[2]]});return false;}}}return true;}d.alert({busiCode:"08410055"});
return false;}return true;},doCheck10000NbrAccept:function(h){var i=BusCard.jsonPath(h,"$.orderAcceptInfoList[*].prodOfferAcceptInfoList[?(@.operKind==2||@.operKind==3)]");if(i&&i.length>0){var e=prodOfferAcceptLoader.orderInfoCardWidget.busCardInstance.$("acceptWay"),g=dojo.filter(dojo._toArray(e.options),function(f){return(/10000\u53f7\u53d7\u7406/.test(f.text));
});if((g&&g.length>0)&&(e.value==g[0].value)){d.alert({busiCode:"08410210",infoList:[g[0].text]});return false;}}return true;},doCheckBatchDevice:function(f){var e=f.custOrderBasicAcceptInfoVO.batchFlag;
if(e=="1"){return !dojo.some(f.orderAcceptInfoList||[],function(g){return dojo.some(g.salesPromotionAcceptInfoList||[],function(h){if(!!h&&!!h.deviceRentBusTempList&&!!h.deviceRentBusTempList.length>0){d.alert({title:"\u63d0\u793a\u4fe1\u606f",message:"\u6279\u91cf\u65b0\u88c5\u4e0d\u80fd\u529e\u7406\u79df\u673a\u4e0e\u8bdd\u8d39\u8865\u8d34\u4e1a\u52a1"});
return true;}});});}return true;},doCheckProdRelation:function(f,h){var j=f.productInfo.productInfoVO,g=f.prodOfferName,p=f.serviceId,l=this,i="",e=1,t=c.load("ProdRelaTypeConst").ProdRelaTypeConst.MUTEX,k=c.load("ProdRelaTypeConst").ProdRelaTypeConst.DEPEND;
var u=(!!p?"业务号码【"+p+"】下的":"");u+=(!!g?"可选包【"+g+"】中的":"");u+=(!!j.productName?"产品【"+j.productName+"】":"");for(var q in j.prodRelaList){if(!j.prodRelaList.hasOwnProperty(q)){continue;}var m=j.prodRelaList[q];
if(m.relaType==k){if((m.prodA==j.productId&&!h[""+m.prodB])){var o=BusCard.$remote("innerInterfaceBO").getProductName(m.prodB);i+=u+"与【"+o+"】产品存在依赖关系,需订购【"+o+"】产品.";e=0;break;}}else{if(m.relaType==t){if((m.prodA==j.productId&&!!h[""+m.prodB])||(m.prodB==j.productId&&!!h[""+m.prodA])){var s=h[""+m.prodB]||h[""+m.prodA];
var n=s.productInfo.productInfoVO;if(n.productId==j.productId){s=h[""+m.prodA]||h[""+m.prodB];n=s.productInfo.productInfoVO;}var r=(!!s.serviceId?"业务号码【"+s.serviceId+"】下的":"");r+=(!!s.prodOfferName?"可选包【"+s.prodOfferName+"】中的":"");
r+=(!!n.productName?"产品【"+n.productName+"】":"");if(n.ifSelectAble=="1"){i+=u+"与"+r+"存在互斥关系,且【"+n.productName+"】为必选产品,需退订"+u+".";}else{i+=u+"与可选包【"+s.prodOfferName+"】下的【"+n.productName+"】产品存在互斥关系,需退其中一产品.";
}e=0;break;}}}}if(e==0){d.alert({busiCode:"08410207",infoList:[i.substring(0,i.length-1)]});}return{flag:e,warnInfo:i.substring(0,i.length-1)};},doCheckPayModeMethod:function(){var e=dojo.query("tr[uniqueId]",this.controller.mainProdOfferWidget.domNode);
var f=[];dojo.forEach(e||[],function(h){var j=dojo.attr(h,"uniqueId");var i="serviceCardWidget_"+j;var g=unieap.byId(i);if(g.busCardInstance.$("paymentModeCd")){f.push(g.busCardInstance.$("paymentModeCd").value);
}});if(f.length<=1){return false;}if(dojo.some(f,function(g){return g==c.load("PaymentModeConst").PaymentModeConst.PREPAID;})){d.alert({busiCode:"08410211"});return true;}return false;},doCheckPasswordMethod:function(){if(!!jsCommon){var i=dojo.query("tr[uniqueId]",this.controller.mainProdOfferWidget.domNode);
var k=null;var o=null;var j=null;var m=null;var n=dojo.map(i||[],function(q){var s=dojo.attr(q,"uniqueId");var r="serviceCardWidget_"+s;var p=unieap.byId(r);if(!k){k=dojo.query(".mainProdServiceInfo-"+q.getAttribute("viewId"))[0].parentNode.parentNode;
}if(!o){o=a.DomHelper.getParentWidget(q,"unieap.layout.TitlePane");}return{cardInst:p.busCardInstance,password:p.busCardInstance.$("password"),serviceId:p.busCardInstance.$("serviceId")};});var g="";var l=true;
var h=1;dojo.forEach(n,function(p){if(!!jsCommon.checkEasyPassword&&!!p.password&&!!p.serviceId){if(jsCommon.checkEasyPassword(p.password,true)==false){if(!j){m=p.cardInst;j=p.password;}g+="["+p.serviceId.value+"]";
if(h%3==0){g+="\n";}else{g+=",";}}}h++;});h=n.length;if(g!=""){if(!!confirm("如下业务号码的密码过于简单,是否修改?\n"+g.substring(0,g.length-1))){if(!!o&&o.open==false){o.toggle();}if(!!k){var e=/hidden\-elem/.test(k.className);
if(!!e){dojo.toggleClass(k,"hidden-elem");}}var f=j.getAttribute("groupId")||j.groupId;if(!!m&&f&&f!="0"){if(m.getTabPanel()){m.getTabPanel().active(f);}}if(!!j){j.focus();}l=false;}}}return l;},doCheckIfMainAuxiliaryCard:function(){var f=$ac$.mainProdOfferInstVO;
var e=f.offerInstRelaList;if(dojo.some(e||[],function(g){return g.roleCd==a.MainAuxiliaryCardRoleCDS.MainCardRoleCd;})&&dojo.some(e||[],function(g){return g.roleCd==a.MainAuxiliaryCardRoleCDS.AuxiliaryCardRoleCd;
})){return true;}return false;},doCheckSameProdOfAttr:function(o,m){var i=[];var h=m;for(var r in o){if(!o.hasOwnProperty(r)){continue;}var g=o[r];if(!g.prodBasicInfo.checkedStatus){continue;}if(g.prodAttrInfo==null){continue;
}if(this.doCheckSubOfferInitMore(g.prodBasicInfo.productId)){continue;}var k=g.uniqueId;var l=h[k];if(!l||l.length==0){continue;}i.push(g.prodBasicInfo.productId);if(!this.doGetServiceProdAttrObjSameProdId(l,g)){return false;
}}for(var f in h){var n=h[f];for(var e=0;e<n.length;e++){var j=n[e];if(dojo.some(i||[],function(p){return p==j.prodBasicInfo.productId;})){continue;}if(this.doCheckSubOfferInitMore(j.prodBasicInfo.productId)){continue;
}if(!this.doGetServiceProdAttrObjSameProdId(n,j)){return false;}}}return true;},doGetServiceProdAttrObjSameProdId:function(f,i){var h=[];dojo.forEach(f||[],function(m){if(m.prodBasicInfo.productId==i.prodBasicInfo.productId){h.push(m);
}});if(h.length==0){return true;}var g={};for(var j in i.prodAttrInfo){g[j]=[i.prodAttrInfo[j]];dojo.forEach(h||[],function(m){g[j].push(m.prodAttrInfo[j]);});if(g[j].uniq().length>1){var l=a.ServiceFactory.getService("url:prodOfferSaleAjaxAction.do?method=getProdAttrInfo&attrCd="+j);
var e="";if(!!i.productInfoVO){e="功能产品["+i.productInfoVO.productName+"]下的";}var k=e+"产品属性["+l.attrName+"]对应的属性值不一致，请重新填写";d.alert({busiCode:"08410207",infoList:[k]});return false;}}return true;},doCheckSubOfferInitMore:function(e){var g="&productId="+e;
var f=a.ServiceFactory.getService("url:prodOfferSaleAjaxAction.do?method=ifCanInitMore"+g);if(f==1){return true;}return false;},doCheckIfCanChange:function(m,g,j){var l=null;var k=BusCard.$remote("prodInstCommFacadeBO").getValidOfferStandardInstInfo({prodOfferInstId:g});
if(k.length==0){return true;}if(m.bindType==2||m.bindType==1){l=BusCard.find($ac$["prodOfferList"+j]||[],function(n){return n.prodOfferType==1;});}else{l=m;}var f=l.offerAgreementVO;if(f!=null&&f.length>0){for(var e=0;
e<f.length;e++){var h=f[e];if(h.templetId=="2"||h.templetId==2){return true;}}}var i="不能由宽带标准化套餐变更为普通周价销售品";d.alert({busiCode:"08410147",infoList:[i]});return false;},doCheckProductRestFee:function(o,q,j,g,f){var v=BusCard.$remote("prodInstCommFacadeBO").getValidOfferStandardInstInfo({prodOfferInstId:q});
if(v.length==0){return true;}var i=dojo.global.$appContext$.requestParam.customerData.cityCode;var h="&cityCode="+i;var r=a.ServiceFactory.getService("url:prodOfferSaleAjaxAction.do?method=getSwitch8093"+h);
if(!!r&&(r==0||r=="0")){return true;}var u=null;var p=null;var t=null;var m=null;if(v&&v.length>0){var x=dojo.map(v,function(A){return A.expDate;});u=x.max();var n=a.ProdOfferHelper.getAgreementOfferDateObj(u);
var z=n.beginDate;var w=z.split(" ");var l=w[0].split("-");var k=parseInt(l[0],10);var y=parseInt(l[1],10);var s=parseInt(l[2],10);var z=k+y+s;var i=dojo.global.$appContext$.requestParam.customerData.cityCode;
var h="&cityCode="+i+"&userId="+g+"&newBeginDate="+z;p=a.ServiceFactory.getService("url:prodOfferSaleAjaxAction.do?method=checkAgreementFee"+h);}else{return true;}if(o.bindType==2||o.bindType==1){m=BusCard.find($ac$["prodOfferList"+j]||[],function(A){return A.prodOfferType==1;
});t=a.ProdOfferHelper.getOfferStandardFee(m);}else{m=o;t=a.ProdOfferHelper.getOfferStandardFee(o);}if(!a.ProdOfferHelper.ifAgreementpRrodOffer(m,1)){return true;}if(t>p){var e="业务号码["+f+"]的账户余额("+p+")小于销售品的["+m.prodOfferName+"]包周期费用("+t+"),请到账务页面缴费后再进行办理！";
d.alert({busiCode:"08410147",infoList:[e]});return true;}return true;},doCheckOfferStandardForChgNextStep:function(){var h=null;checkInstance=this;var f=$ac$.get("selectedMemberProdOfferList");var g=dojo.filter(f||[],function(k){return !!k.offerInstVO&&k.offerInstVO.offerStandardInstList&&k.offerInstVO.offerStandardInstList.length>0&&k.offerInstVO.prodOfferId!=k.prodOfferId;
});if(g.length>0){var i=dojo.global.$appContext$.requestParam.customerData.cityCode;var j="&cityCode="+i;var e=a.ServiceFactory.getService("url:prodOfferSaleAjaxAction.do?method=getSwitch8093"+j);if(!!e&&(e==1||e=="1")){var h=dojo.filter(dojo.map(g||[],function(k){return checkInstance.getOfferStandardTipStr(k);
})||[],function(k){return k!="";});if(h.length>0){d.alert({busiCode:"08410147",infoList:[h.join(",")+",请到账务页面缴费后再进行办理！"]});}return true;}return true;}return true;},getOfferStandardTipStr:function(i){try{var k=null;
var p=null;var t=null;var u=i.offerInstVO.offerStandardInstList;if(u&&u.length>0){var l=dojo.map(u,function(e){return e.expDate;});var h=a.ProdOfferHelper.getAgreementOfferDateObj(l.max());var m=h.beginDate;
var f=m.split(" ");var g=f[0].split("-");var q=parseInt(g[0],10);var o=parseInt(g[1],10);var r=parseInt(g[2],10);var m=q+o+r;var s=dojo.global.$appContext$.requestParam.customerData.cityCode;var j="&cityCode="+s+"&userId="+i.prodInstVO.prodInstId+"&newBeginDate="+m;
k=a.ServiceFactory.getService("url:prodOfferSaleAjaxAction.do?method=checkAgreementFee"+j);}if($ac$.selectedMainProdOfferInfoVO.bindType==2||$ac$.selectedMainProdOfferInfoVO.bindType==1){t=a.ProdOfferHelper.getProdOfferDetail(i.prodOfferId);
}else{t=$ac$.selectedMainProdOfferInfoVO;}if(!a.ProdOfferHelper.ifAgreementpRrodOffer(t,1)){return"";}p=a.ProdOfferHelper.getOfferStandardFee(t);if(k<p){return"业务号码["+i.prodInstVO.accNbr+"]的账户余额("+k+")小于销售品的["+t.prodOfferName+"]包周期费用("+p+")";
}}catch(n){}return"";},doChekIfCanOrderRoamProd:function(f){var g=[];dojo.forEach(f.orderAcceptInfoList||[],function(h){dojo.forEach(h.prodOfferAcceptInfoList||[],function(i){dojo.forEach(i.serviceProdAcceptInfoList||[],function(j){if(j.operKind==1&&(j.productId==c.load("RoamProdIdConst").RoamProdIdConst.ROAM_PRODUCT_ID_A||j.productId==c.load("RoamProdIdConst").RoamProdIdConst.ROAM_PRODUCT_ID_B||j.productId==c.load("RoamProdIdConst").RoamProdIdConst.ROAM_PRODUCT_ID_C||j.productId==c.load("RoamProdIdConst").RoamProdIdConst.ROAM_PRODUCT_ID_D)){g.push(j);
}});});});if(g.length>0){var e=BusCard.doPost(BusCard.path.contextPath+"/orderDetailAction.do?method=doChekIfCanOrderRoamProd",f);if(e&&e.flag==-1){d.alert({busiCode:"08410147",infoList:[e.message]});return false;
}else{return true;}}return true;},checkOrderedOfferProdRelationByPPM:function(q,g){var n=q.prodOfferAcceptInfoVO;var i=g.prodOfferAcceptInfoList||[];var j=[];var s=[];var m={};var h="";a.ProdOfferOrderCounter.reset();
dojo.forEach(i,function(u){var e="";if(u.operKind!=3){j.push(parseInt(""+u.prodOfferId));}dojo.forEach(u.accessProdAcceptInfoList||[],function(v){if(v.operKind!=3){s.push(parseInt(""+v.productId));if(e==""){e+=v.productId;
}else{e+=","+v.productId;}if(u.prodOfferType==1){if(h==""){h+=v.productId;}else{h+=","+v.productId;}}}});dojo.forEach(u.serviceProdAcceptInfoList||[],function(v){if(v.operKind!=3){s.push(parseInt(""+v.productId));
if(e==""){e+=v.productId;}else{e+=","+v.productId;}}});});var o="";j.push(parseInt(""+n.prodOfferId));dojo.forEach(n.accessProdAcceptInfoList||[],function(e){if(e.operKind!=3){s.push(parseInt(""+e.productId));
if(o==""){o+=e.productId;}else{o+=","+e.productId;}}});dojo.forEach(n.serviceProdAcceptInfoList||[],function(e){if(e.operKind!=3){s.push(parseInt(""+e.productId));if(o==""){o+=e.productId;}else{o+=","+e.productId;
}}});if(n.bindType==2){m[n.prodOfferId]=h;}else{m[n.prodOfferId]=o;}if(n.bindType==2){dojo.forEach(i,function(x){if(x.parentProdOfferInstId==n.prodOfferInstId&&x.operKind!=3){var e=a.ProdOfferOrderCounter.get(x.prodOfferId);
var u="";var w="";var v="";dojo.forEach(x.accessProdAcceptInfoList||[],function(y){if(y.operKind!=3){if(w==""){w+=y.productId;}else{w+=","+y.productId;}if(v==""){v+=y.productId;}else{v+=","+y.productId;
}}});dojo.forEach(x.serviceProdAcceptInfoList||[],function(y){if(y.operKind!=3){if(w==""){w+=y.productId;}else{w+=","+y.productId;}if(v==""){v+=y.productId;}else{v+=","+y.productId;}}});dojo.forEach(i,function(y){if(y.parentProdOfferInstId==x.prodOfferInstId&&y.operKind!=3){if(u==""){u+=y.prodOfferId;
}else{u+=","+y.prodOfferId;}dojo.forEach(y.accessProdAcceptInfoList||[],function(z){if(z.operKind!=3){if(w==""){w+=z.productId;}else{w+=","+z.productId;}}});dojo.forEach(y.serviceProdAcceptInfoList||[],function(z){if(z.operKind!=3){if(w==""){w+=z.productId;
}else{w+=","+z.productId;}}});}});m[x.prodOfferId+"_"+e+"_offer"]=u;m[x.prodOfferId+"_"+e+"_product"]=w;m[x.prodOfferId+"_"+e]=v;if(x.uniqueId!=null&&x.uniqueId!=""){m[x.uniqueId]=x.prodOfferId+"_"+e+"_offer";
}}});}else{var p="";var l="";dojo.forEach(i,function(e){if(e.operKind!=3){if(p==""){p+=e.prodOfferId;}else{p+=","+e.prodOfferId;}}dojo.forEach(e.accessProdAcceptInfoList||[],function(u){if(u.operKind!=3){if(l==""){l+=u.productId;
}else{l+=","+u.productId;}}});dojo.forEach(e.serviceProdAcceptInfoList||[],function(u){if(u.operKind!=3){if(l==""){l+=u.productId;}else{l+=","+u.productId;}}});});dojo.forEach(n.accessProdAcceptInfoList||[],function(e){if(e.operKind!=3){if(l==""){l+=e.productId;
}else{l+=","+e.productId;}}});dojo.forEach(n.serviceProdAcceptInfoList||[],function(e){if(e.operKind!=3){if(l==""){l+=e.productId;}else{l+=","+e.productId;}}});m[n.prodOfferId+"_"+1+"_offer"]=p;m[n.prodOfferId+"_"+1+"_product"]=l;
}var f=-1;try{f=parseInt(""+this.controller.getBelongCode());f=f||-1;}catch(k){}var t=this;var r=a.ServiceFactory.getService("url:orderDetailAction.do?method=checkOrderedOfferProdRelation",null,{method:"post",content:{commonRegionId:f,interfaceType:2,prodOfferId:n.prodOfferId,offerList:j,productList:s,otherParamMap:m}});
if(r&&r.result=="1"){if(r.roleDefaultOfferIds==""||r.roleDefaultOfferIds==null){d.alert({busiCode:"08410147",infoList:[r.message]});return false;}else{MessageBox.confirm({title:"\u9009\u62e9\u6846",message:r.message,onComplete:function(e){return function(u){t.orderCheckResult(e);
};}(r),iconCloseComplete:true},dojo.byId("subProdOfferCart"));return false;}}else{return true;}},checkIfReserveCancelSpeedOffer:function(k,g,l){var j=[];dojo.forEach(l||[],function(n){j=j.concat(dojo.filter(n.subProdOfferPageData||[],function(o){return o.prodOfferInst!=null&&a.ProdOfferHelper.getRaiseSpeedObj(o.subProdOfferInfo)!=null&&!o.prodOfferPageInfo.checkBoxValue;
}));});if(j.length==0){return true;}var h=[];var f=true;var i=null;h.push(k.prodOfferAcceptInfoVO);h=h.concat(g.prodOfferAcceptInfoList||[]);if(h.length==0){return true;}for(var e=0;e<h.length;e++){var m=h[e];
if(m.prodOfferType==1&&m.accessProdAcceptInfoList!=null&&m.accessProdAcceptInfoList.length>0){BusCard.each(m.accessProdAcceptInfoList||[],function(s){var n=dojo.filter(s.prodInstAttrList||[],function(y){return dojo.some(a.SpeedAttrArray||[],function(z){return z==y.attrId+"";
});});if(n.length==0){return;}var p=dojo.filter(h||[],function(y){return y.parentProdOfferInstId==m.prodOfferInstId&&dojo.some(j||[],function(z){return z.subProdOfferInfo.prodOfferId==y.prodOfferId;})&&y.operKind==3;
});if(p&&p.length>0){var w=p[0];var r=n[0].attrValue;var o=w.prodOfferInstId;if(a.DateHelper.compareDateValue(a.DateHelper.format(w.expDate),$ac$.requestParam.today)){var t=s.userId;var v=null;var q=$ac$.selectedMemberProdOfferList;
var u=dojo.filter(q||[],function(y){return y.prodInstId==t;});if(u&&u.length>0){v=u[0].uniqueId;}if(dojo.global.$appContext$.get("dealObjectAttrList"+v)&&dojo.global.$appContext$.get("dealObjectAttrList"+v)[0]){if(dojo.global.$appContext$.get("dealObjectAttrList"+v)[0].oldAttrValue!=r){f=false;
var x=BusCard.$remote("innerInterfaceBO").getAttrValueInfo({attrId:dojo.global.$appContext$.get("dealObjectAttrList"+v)[0].attrId,attrValue:dojo.global.$appContext$.get("dealObjectAttrList"+v)[0].oldAttrValue});
i="预约退订销售品["+w.prodOfferName+"]不允许再次变更速率,请修改为升速前的值["+x.attrValueName+"],再进行提交！";return false;}}}}});if(!f){d.alert({message:i});return false;}}}return true;},orderCheckResult:function(p){var q=this;var i=p.roleDefaultOfferIds;
i=dojo.fromJson(i);for(var n in i){if(!i.hasOwnProperty(n)){continue;}var k=i[n];var j=k.split(",");var m=null;var g=prodOfferAcceptLoader.multipleSubProdOfferHandler.subProdOfferOrderProviderMap;if(n==0||n=="0"){m=g.subProdOfferTreeContainer;
}else{m=g["subProdOfferTreeContainer"+n];}var h=m.getSubGridBindingData(),e=m.subProdOfferOrderGrid.domNode;var f=[];var o=[];dojo.forEach(j||[],function(s){if(s==""){return;}var r=dojo.some(h,function(t){return s==t.subProdOfferInfo.prodOfferId;
});if(r){f.push(s);}else{o.push(s);}});if(f.length==0){dojo.forEach(f,function(u){var s=a.ProdOfferHelper.getProdOfferDetail(u);var t=a.ProdOfferHelper.createProdOfferRowData(s);var r=m.doGetChooseNumList(s);
if(r.chooseNumberList.length>0){t.showData.chooseNumberObj=r.chooseNumberList[0];}else{t.showData.chooseNumberObj=null;}m.addOneRow(t);q.doCheckedSubProdOffer({rowIndex:t.rowIndex,subProdOfferCartDataProvider:m});
});}else{if(o.length==0){var l=dojo.filter(h,function(r){return dojo.query(".subProdOfferDetail-"+r.rowIndex,e)[0].childNodes[0].checked==false&&dojo.some(f||[],function(s){return s==r.subProdOfferInfo.prodOfferId;
});});if(l.length>0){dojo.forEach(l,function(r){dojo.query(".subProdOfferDetail-"+r.rowIndex,e)[0].childNodes[0].checked=true;if(r.prodOfferInst!=null){m.updateCurrentProdOfferStyle(r,"prod-offer-change");
}else{m.updateCurrentProdOfferStyle(r,"prod-offer-add");}q.doCheckedSubProdOffer({rowIndex:r.rowIndex,subProdOfferCartDataProvider:m});});}}else{var l=dojo.filter(h,function(r){return dojo.query(".subProdOfferDetail-"+r.rowIndex,e)[0].childNodes[0].checked==false&&dojo.some(f||[],function(s){return s==r.subProdOfferInfo.prodOfferId;
});});if(l.length>0){dojo.forEach(l,function(r){dojo.query(".subProdOfferDetail-"+r.rowIndex,e)[0].childNodes[0].checked=true;if(r.prodOfferInst!=null){m.updateCurrentProdOfferStyle(r,"prod-offer-change");
}else{m.updateCurrentProdOfferStyle(r,"prod-offer-add");}q.doCheckedSubProdOffer({rowIndex:r.rowIndex,subProdOfferCartDataProvider:m});});}dojo.forEach(notExistSubCartData||[],function(u){var s=a.ProdOfferHelper.getProdOfferDetail(u);
var t=a.ProdOfferHelper.createProdOfferRowData(s);var r=m.doGetChooseNumList(s);if(r.chooseNumberList.length>0){t.showData.chooseNumberObj=r.chooseNumberList[0];}else{t.showData.chooseNumberObj=null;}m.addOneRow(t);
q.doCheckedSubProdOffer({rowIndex:t.rowIndex,subProdOfferCartDataProvider:m});});}}}},pilotageCheck:function(g){var e=g.selectedMemberProdOfferList;var f=BusCard.$remote("validOrderActionBO").orderGroupAccProdValidate({attrCd:"00002",cityCode:BusCard.$session.cityCode,custId:$ac$.requestParam.customerData.custId,infoValue:e.length>0?e[0].productId:-1});
if(f&&f.code==-1){d.alert({message:f.message});return false;}return true;}});});
defineModule("orderaccept.prodofferaccept.data.SpecialDataHandler",["../util","../../common/js/ConstantsPool"],function(a,b){dojo.declare("orderaccept.prodofferaccept.data.SpecialDataHandler",[],{controller:null,dataHandleMethodMap:[],constructor:function(c){this.controller=c;
this.beanBuildFactory=new a.BeanBuildFactoryProvider().getInstance();},process:function(f){var c=this;var d;b.load(["ActionCDConst"]);this.preProcess();try{d=c.handleData(f);}catch(g){BusCard.showErrorStack(g);
this.postProcess();throw g;}this.postProcess();return d;},postProcess:function(){this.dataHandleMethodMap=[];dojo.global.$appContext$.deleteProperty(this.controller.dataBuilder.USER_ID_KEY);},handleData:function(e){var c=this;
for(var f=0;f<this.dataHandleMethodMap.length;f++){var d=this.dataHandleMethodMap[f];if(dojo.isFunction(d)){dojo.hitch(c,d,e)();}}return e;},preProcess:function(){var c=this;this.dataHandleMethodMap.push(c.rateAttrHandle);
this.dataHandleMethodMap.push(c.groupUserHandle);this.dataHandleMethodMap.push(c.setUserTypeDate);this.dataHandleMethodMap.push(c.setPortSpeedDate);this.dataHandleMethodMap.push(c.getGrpAccessProdListForSubGrp);
this.dataHandleMethodMap.push(c.dealOfferStandardEffDate);this.dataHandleMethodMap.push(c.dealVirtualNumRes);this.dataHandleMethodMap.push(c.setRateEffectDate);this.dataHandleMethodMap.push(c.setCyclePriceAttrCdDate);
this.dataHandleMethodMap.push(c.createShoppingCartData);this.dataHandleMethodMap.push(c.filterAttrIfTemp);},buildDealObjectVO:function(c){return this.beanBuildFactory.getDealObjectVO(c);},buildDealObjectAttrVO:function(c){return this.beanBuildFactory.getDealObjectAttrVO(c);
},buildProdResInstRelaVO:function(c){return this.beanBuildFactory.getProdResInstRelaVO(c);},buildGroupUserInfoTmpVO:function(c){return this.beanBuildFactory.getGroupUserInfoTmpVO(c);},buildShoppingCartAcceptVO:function(c){return this.beanBuildFactory.getShoppingCartAcceptVO(c);
},filterAttrIfTemp:function(c){dojo.forEach(c.orderAcceptInfoList||[],function(d){dojo.forEach(d.prodOfferAcceptInfoList||[],function(f){var e=dojo.filter(f.offerInstAttrList||[],function(g){return g.isTemp==1;
});f.offerInstAttrList=e;dojo.forEach(f.accessProdAcceptInfoList||[],function(g){var h=dojo.filter(g.prodInstAttrList||[],function(i){return i.isTemp==1;});g.prodInstAttrList=h;});dojo.forEach(f.serviceProdAcceptInfoList||[],function(g){var h=dojo.filter(g.prodInstAttrList||[],function(i){return i.isTemp==1;
});g.prodInstAttrList=h;});});});},rateAttrHandle:function(j){var o=this;var h=prodOfferAcceptLoader.rateAttrMap;if(h=="undefined"||h==undefined){return;}for(var e in h){var l=e;var f=h[e];var d=dojo.filter(f||[],function(p){return p.operKind==1;
});var g=dojo.map(d||[],function(q){var t={};var r={};var p=[];dojo.mixin(t,q);var s=o.buildDealObjectVO(t);dojo.mixin(r,q);var u=o.buildDealObjectAttrVO(r);p.push(r);s.dealObjectAttrList=p;return s;});
var n=this.controller.dataBuilder.USER_ID_KEY;var k=dojo.global.$appContext$.get(n)["userId@uniqueId_"+l];var c=a.ProdOfferHelper.getMainProdOffer(dojo.global.$appContext$.get("prodOfferList"))[0];var m=dojo.filter(j.orderAcceptInfoList[0].prodOfferAcceptInfoList||[],function(q){if(c.bindType==2){var p=a.ProdOfferHelper.getMainProdOffer(dojo.global.$appContext$.get("prodOfferList"+e))[0];
return q.prodOfferId==p.prodOfferId;}else{return q.prodOfferId==c.prodOfferId;}})[0];var i=BusCard.jsonPath(m.accessProdAcceptInfoList||[],"$[?(@.userId=="+k+")]")[0];i.dealObjectList=g;}},groupUserHandle:function(e){var d=this;
var c=d.getAccessProdList(e);dojo.forEach(c,function(g){var f=g.userId;var h={};if(!!g&&!!g.groupId&&g.groupId!=""&&g.operKind=="1"){h.groupId=g.groupId;h.ifValid="1";h.serviceId=g.serviceId;h.serviceKind=g.serviceKind;
g.groupUserInfoTmpVO=d.buildGroupUserInfoTmpVO(h);}});},getAccessProdList:function(d){var c=[];dojo.forEach(d.orderAcceptInfoList,function(e){dojo.forEach(e.prodOfferAcceptInfoList,function(f){if(f.prodOfferType==a.PRODOFFERTYPE.MAIN_OFFER_TYPE){Array.prototype.push.apply(c,dojo.filter(f.accessProdAcceptInfoList||[],function(g){return g.prodFuncType==b.load("ProductFuncTypeConst").ProductFuncTypeConst.ACCESS;
}));}});});return c;},setUserTypeDate:function(c){var d=this;dojo.forEach(c.orderAcceptInfoList||[],function(e){dojo.forEach(e.prodOfferAcceptInfoList||[],function(f){if(f.prodOfferType==1&&f.accessProdAcceptInfoList!=null&&f.accessProdAcceptInfoList.length>0){dojo.forEach(f.accessProdAcceptInfoList||[],function(g){var i=dojo.filter(g.prodInstAttrList||[],function(j){return j.attrId==a.SpecAttrCdConst.userTypeAttrCd;
});if(i.length==0){return;}if(g.operKind==2){var h=dojo.filter($ac$.selectedMemberProdOfferList||[],function(j){return j.prodInstId==g.prodInstId;});if(h.length==0){return;}if(i[0].operKind!=1&&($ac$.processId=="single2single"||h[0].action=="change"||(h[0].action=="split"&&h[0].offerInstVO.prodOfferId!=h[0].prodOfferId))){i[0].effDate=f.effDate;
}else{i[0].effDate=dojo.global.$appContext$.requestParam.today;}}});}});});},doCheckIfMainChg:function(e){var g=this.controller.dataBuilder.USER_ID_KEY;var f=false;var d=$ac$.selectedMemberProdOfferList;
var c=dojo.filter(d||[],function(h){return dojo.global.$appContext$.get(g)["userId@uniqueId_"+h.uniqueId]==e;});if(c.length>0){if(!!c[0]){if(!!c[0].offerInstVO){if(c[0].offerInstVO.prodOfferId!=c[0].prodOfferId){f=true;
}}}}return f;},setCyclePriceAttrCdDate:function(c){var d=this;dojo.forEach(c.orderAcceptInfoList||[],function(e){dojo.forEach(e.prodOfferAcceptInfoList||[],function(f){if(f.prodOfferType==1&&f.offerInstAttrList!=null&&f.offerInstAttrList.length>0){dojo.forEach(f.offerInstAttrList,function(h){if(h.attrCd==a.SpecAttrCdConst.cyclePriceAttrCd||h.attrId==a.SpecAttrCdConst.cyclePriceAttrCd){var g=dojo.filter(f.offerInstAttrList||[],function(i){return i.attrCd==a.SpecAttrCdConst.cyclePriceDateAttrCd||i.attrId==a.SpecAttrCdConst.cyclePriceDateAttrCd;
});if(g&&g.length>0){if(g[0].attrValue==1){h.effDate=dojo.global.$appContext$.requestParam.today;}else{if(g[0].attrValue==2){h.effDate=a.DateHelper.formatDate(a.DateHelper.getFirstDayAfterPeriod());}}}}});
}});});},setAccessTypeDate:function(c){var d=this;dojo.forEach(c.orderAcceptInfoList||[],function(e){dojo.forEach(e.prodOfferAcceptInfoList||[],function(f){if(f.prodOfferType==1&&f.accessProdAcceptInfoList!=null&&f.accessProdAcceptInfoList.length>0){dojo.forEach(f.accessProdAcceptInfoList||[],function(g){var j=dojo.filter(g.prodInstAttrList||[],function(k){return k.attrId==a.SpecAttrCdConst.accessTypeAttrCd;
});if(g.operKind==2&&(g.serviceOfferId!=a.ACTION_CD_CONST.PRODUCT_CHANGE_ACCEPT)){if(j.length==0){return;}var i=j[0];var h=g.userId;if(d.doCheckIfMainChg(h)){i.effDate=a.DateHelper.formatDate(a.DateHelper.getFirstDayAfterPeriod());
i.expDate="2037-01-01 00:00:00";}}else{if(j.length>0){j[0].effDate=dojo.global.$appContext$.requestParam.today;j[0].expDate="2037-01-01 00:00:00";}}});}});});},setRateEffectDate:function(c){var d=this;
dojo.forEach(c.orderAcceptInfoList||[],function(e){dojo.forEach(e.prodOfferAcceptInfoList||[],function(f){if(f.prodOfferType==1&&f.accessProdAcceptInfoList!=null&&f.accessProdAcceptInfoList.length>0){dojo.forEach(f.accessProdAcceptInfoList||[],function(p){var i=dojo.filter(p.prodInstAttrList||[],function(t){return dojo.some(a.SpeedAttrArray||[],function(u){return u==t.attrId+"";
});});if(i.length==0){return;}if(p.operKind==2){var n=dojo.filter(p.prodInstAttrList||[],function(t){return t.attrId==a.SpecAttrCdConst.rateEffectDate;});if(n.length==0){return;}if(!!n[0].attrValue){var m=dojo.global.$appContext$.requestParam.today;
var g=m.split(" ");var j=g[0].split("-");var r=parseInt(j[0],10);var q=parseInt(j[1],10)-1;var l=parseInt(j[2],10);var k=n[0].attrValue.split("-");var o=parseInt(k[0],10);var h=parseInt(k[1],10)-1;var s=parseInt(k[2],10);
if(o==r&&h==q&&s==l){i[0].effDate=m;}else{i[0].effDate=n[0].attrValue+" 00:00:00";}}}});}});});},setPortSpeedDate:function(c){var d=this;dojo.forEach(c.orderAcceptInfoList||[],function(e){dojo.forEach(e.prodOfferAcceptInfoList||[],function(f){if(f.prodOfferType==1&&f.accessProdAcceptInfoList!=null&&f.accessProdAcceptInfoList.length>0){dojo.forEach(f.accessProdAcceptInfoList||[],function(g){var i=dojo.filter(g.prodInstAttrList||[],function(j){return dojo.some(a.SpeedAttrArray||[],function(k){return k==j.attrId+"";
});});if(i.length==0){return;}if(g.operKind==2){var h=dojo.filter($ac$.selectedMemberProdOfferList||[],function(j){return j.prodInstId==g.prodInstId;});if(h.length==0){return;}if((!!h[0].offerInstVO)&&h[0].offerInstVO.prodOfferId!=h[0].prodOfferId){i[0].effDate=f.effDate;
d.setPortSpeedEffDateBySubOfferForChg(f,e.prodOfferAcceptInfoList,i[0],g,g.prodInstAttrList);}else{i[0].effDate=dojo.global.$appContext$.requestParam.today;d.setPortSpeedEffDateBySubOfferForChg(f,e.prodOfferAcceptInfoList,i[0],g,g.prodInstAttrList);
}}else{if(g.operKind==1){i[0].effDate=f.effDate;d.setPortSpeedEffDateBySubOffer(f,e.prodOfferAcceptInfoList,i[0],g,e.salesPromotionAcceptInfoList);}}});}});});},setPortSpeedEffDateBySubOffer:function(i,k,e,j,g){var h=prodOfferAcceptLoader.rateAttrMap;
if(h=="undefined"||h==undefined){return;}for(var c in h){var l=c;var n=this.controller.dataBuilder.USER_ID_KEY;if(dojo.global.$appContext$.get(n)["userId@uniqueId_"+l]==j.prodInstId){var d=h[c];var m=dojo.filter(d||[],function(p){return e.attrValue==p.attrValue;
});if(m.length>0){var f=dojo.filter(k||[],function(p){return p.parentProdOfferInstId==i.prodOfferInstId&&p.prodOfferId==m[0].prodOfferId;});if(f.length>0){e.effDate=f[0].effDate;return;}else{var o=dojo.filter(g||[],function(p){return p.promotionId==m[0].prodOfferId;
});if(o.length>0){e.effDate=o[0].effDate;return;}}}}}},setPortSpeedEffDateBySubOfferForChg:function(h,j,e,i,q){var g=prodOfferAcceptLoader.rateAttrMap;if(g=="undefined"||g==undefined){return;}for(var c in g){var k=c;
var o=this.controller.dataBuilder.USER_ID_KEY;if(dojo.global.$appContext$.get(o)["userId@uniqueId_"+k]==i.prodInstId){var d=g[c];if(d.length==1&&d[0].operKind==1){var m=dojo.filter(d||[],function(p){return e.attrValue==p.attrValue;
});if(m.length>0){var f=dojo.filter(j||[],function(p){return p.parentProdOfferInstId==h.prodOfferInstId&&p.prodOfferId==m[0].prodOfferId;});if(f.length>0){e.effDate=f[0].effDate;return;}else{var r=dojo.filter(salesPromotionAcceptInfoList||[],function(p){return p.promotionId==m[0].prodOfferId;
});if(r.length>0){e.effDate=r[0].effDate;}}}}else{if(d.length==1&&d[0].operKind==3){var m=dojo.filter(d||[],function(p){return e.attrValue==p.oldAttrValue;});if(m.length>0){var f=dojo.filter(j||[],function(p){return p.parentProdOfferInstId==h.prodOfferInstId&&p.prodOfferId==m[0].prodOfferId;
});if(f.length>0){e.expDate=f[0].expDate;return;}else{var r=dojo.filter(salesPromotionAcceptInfoList||[],function(p){return p.promotionId==m[0].prodOfferId;});if(r.length>0){e.effDate=r[0].expDate;}}}}else{if(d.length>1){for(var c=0;
c<q.length;c++){var n=q[c];if(n.attrId==e.attrId){q.splice(c,1);break;}}var l=dojo.map(d|[],function(s){var p=dojo.clone(e);if(s.operKind==3){var u=dojo.filter(j||[],function(v){return v.parentProdOfferInstId==h.prodOfferInstId&&v.prodOfferId==s.prodOfferId;
});if(u.length>0){p.oldAttrValue=s.attrValue;p.attrValue=s.oldAttrValue;p.effDate=u[0].expDate;}else{var t=dojo.filter(salesPromotionAcceptInfoList||[],function(v){return v.promotionId==s.prodOfferId;});
if(t.length>0){p.effDate=t[0].expDate;p.oldAttrValue=s.attrValue;p.attrValue=s.oldAttrValue;}}}else{if(s.operKind==1){var u=dojo.filter(j||[],function(v){return v.parentProdOfferInstId==h.prodOfferInstId&&v.prodOfferId==s.prodOfferId;
});if(u.length>0){p.effDate=u[0].effDate;p.oldAttrValue=s.oldAttrValue;p.attrValue=s.attrValue;}else{var t=dojo.filter(salesPromotionAcceptInfoList||[],function(v){return v.promotionId==s.prodOfferId;});
if(t.length>0){p.effDate=t[0].effDate;p.oldAttrValue=s.oldAttrValue;p.attrValue=s.attrValue;}}}}return p;});q=q.concat(l);}}}}}},getGrpAccessProdListForSubGrp:function(j){var h=this;var e=$ac$.get("subGroupProdInfo");
if(e){var g=dojo.global.$appContext$.get("requestParam");var i=g.customerData.custId;var f;dojo.forEach(e.prodRelaList,function(k){if(k.relaType=="100800"){f=k.prodA;return true;}});var d=h.doGroupProductInfoComputation(f,i,e);
var c=[];c.push(d);j.orderAcceptInfoList[0].accessProdAcceptInfoList=c;}},dealOfferStandardEffDate:function(d){var c=$ac$.selectedMemberProdOfferList;dojo.forEach(c||[],function(f){var e=f.offerInstVO;
if(e&&f.prodOfferId==e.prodOfferId){return false;}if(e&&e.offerStandardInstList&&e.offerStandardInstList.length>0){var g=BusCard.jsonPath(d.orderAcceptInfoList,"$[*].prodOfferAcceptInfoList[?(@.prodOfferInstId=="+e.prodOfferInstId+")]");
if(g){g[0].expDate=!!$ac$.get("offerStandardStartDate_"+e.prodOfferInstId)?$ac$.get("offerStandardStartDate_"+e.prodOfferInstId).beginDate:a.DateHelper.getStringFirstDayOFNextMonth();}var h=BusCard.jsonPath(d.orderAcceptInfoList,"$[*].prodOfferAcceptInfoList[?(@.prodOfferId=="+f.prodOfferId+")]");
if(h){h[0].effDate=!!$ac$.get("offerStandardStartDate_"+e.prodOfferInstId)?$ac$.get("offerStandardStartDate_"+e.prodOfferInstId).beginDate:a.DateHelper.getStringFirstDayOFNextMonth();dojo.forEach(h[0].offerInstAttrList||[],function(i){i.effDate=h[0].effDate;
});dojo.forEach(h[0].accessProdAcceptInfoList||[],function(i){i.effDate=h[0].effDate;dojo.forEach(i.prodInstAttrList||[],function(j){j.effDate=i.effDate;});});dojo.forEach(h[0].serviceProdAcceptInfoList||[],function(i){i.effDate=h[0].effDate;
dojo.forEach(i.prodInstAttrList||[],function(j){j.effDate=i.effDate;});});}}});},createShoppingCartData:function(d){var e=this;var c={};dojo.mixin(c,{cityCode:dojo.global.$appContext$.get("requestParam").customerData.cityCode,custId:dojo.global.$appContext$.get("requestParam").customerData.custId,acceptDesc:e.getAcceptDesc(),orderData:dojo.toJson(e.getCustOrderAcceptSnapshot())});
d.shoppingCartAcceptVO=e.buildShoppingCartAcceptVO(c);},getCustOrderAcceptSnapshot:function(){var j=$ac$.get("selectedMainProdOfferInfoVO"),e=$ac$.get("mainProdOfferInstVO"),i=$ac$.get("selectedMemberProdOfferList")||[],f=j.prodOfferId,h=(e||{}).prodOfferId,g=(e||{}).prodOfferInstId,c=$ac$.get("processId"),k=Object.prototype.toString,d=dojo.map(i,function(o){var n={};
for(var l in o){if(o.hasOwnProperty(l)){var m=k.call(o[l]);if(/Number/.test(m)||/Boolean/.test(m)||/String/.test(m)){n[l]=o[l];}}}return n;});return{newProdOfferId:f,oldProdOfferId:h,prodOfferInstId:g,processId:c,selectedMemberProdOfferList:d};
},getAcceptDesc:function(){var e="";var d="";var c=a.ACTION_CD_CONST;if(!!$ac$.requestParam.prodOfferInstId){var f=BusCard.jsonPath($ac$.userHasProdOfferMetaInfoList||[],"$[?(@.prodOfferId=="+$ac$.mainProdOfferInstVO.prodOfferId+")]");
if(f){d=f[0].prodOfferName;}}else{d=$ac$.selectedMainProdOfferInfoVO.prodOfferName;}var g=$ac$.requestParam.actionCD;switch(g){case c.PRODUCT_INSTALL:e="销售品订购-"+d;break;case c.PRODUCT_CHANGE:e="销售品变更-"+d;
break;case c.PRODUCT_CHANGE_MAIN:e="变更主销售品-"+d;break;case c.PRE_ACCEPT:e="预受理-"+d;break;case c.PRODOFFER_CANCEL_ACTION:e="销售品退订-"+d;break;case c.PROTOCOL_ACCEPT:e="协议转订单-"+d;break;case c.SHOPPING_CART_ACCEPT:e="购物车订购-"+d;
break;case c.PROD_ADD:e="加装-"+d;break;case c.PRE_ORDER_BACK:e="预登录返单-"+d;break;case c.PROD_INTERCHANGE:e="互换-"+d;break;case c.PROMOTION_CHANGE:e="促销政策变更-"+d;break;case c.MEMBER_OFFER_CHANGE:e="成员销售品变更-"+d;
break;case c.CHANGE_ACCEPT:e="换受理-"+d;break;case c.MEMBER_ORDER_GROUP_PRODUCT:e="成员订购集团产品-"+d;break;default:e="未知的订单类型";break;}return e;},dealVirtualNumRes:function(d){var c=prodOfferAcceptLoader.prodResRelaMap;
var g=this;for(var e in c){var f=c[e];if(!f.serviceId){continue;}dojo.forEach(d.orderAcceptInfoList||[],function(h){dojo.forEach(h.prodOfferAcceptInfoList||[],function(i){dojo.forEach(i.serviceProdAcceptInfoList||[],function(m){var k=BusCard.jsonPath(m.prodInstAttrList||[],"$[?(@.attrCd=="+a.SpecAttrCdConst.serviceIdAttrCd+")]");
if(!k){k=BusCard.jsonPath(m.prodInstAttrList||[],"$[?(@.attrCd=="+a.SpecAttrCdConst.oneCard2NumAttrCd+")]");}if(k.length>0){var l=k[0].attrValue;if(f.serviceId==l){var j={};dojo.mixin(j,f);m.prodResInstRelaList=[g.buildProdResInstRelaVO(j)];
}}});});});}},doGroupProductInfoComputation:function(f,i,h){var k=this;var d="&ownerCustId="+i+"&productId="+f;var j=a.ServiceFactory.getService("url:prodOfferSaleAjaxAction.do?method=getProdInstByPropertiesExceptSubService"+d);
var m;dojo.forEach(j,function(n){if(n.prodFuncType==101){m=n;return true;}});var e=new Date(m.beginRentTime);dojo.mixin(m,{serviceKind:12,operKind:2,ActionCD:b.ActionCDConst.PRODUCT_CHANGE,beginRentTime:m.beginRentTime});
var c={zorderItemId:-a.CommUtils.generateUniqueId(),orderRelType:14};var l=[];l.push(k.buildItemRelationVO(c));var g=k.buildAccessProdAcceptInfoVO(m);dojo.mixin(g,{itemRelationInfoList:l});return g;return null;
},buildItemRelationVO:function(c){var d=this;return d.controller.route("/dataBuilder/beanBuildFactory/getItemRelationVO",c);},buildAccessProdAcceptInfoVO:function(d){var c=this;return c.controller.route("/dataBuilder/beanBuildFactory/getAccessProdAcceptInfoVO",d);
}});});
defineModule("orderaccept.prodofferaccept.widget.batchnew.BatchNewWidget",["orderaccept.prodofferaccept.util","orderaccept.custom._BaseWidget","orderaccept.custom._BusCardTemplated","orderaccept.prodofferaccept.widget.budget.BudgetWidget"],function(util,_Widget,_Templated,BudgetWidget){dojo.declare("orderaccept.prodofferaccept.widget.batchnew.BatchNewWidget",[_Widget,_Templated],{templatePath:dojo.moduleUrl("orderaccept.prodofferaccept.widget.batchnew","template/batchNew.html"),widgetsInTemplate:true,postMixInProperties:function(){var columns=null;
if(this.checkHaveOMRight("841ABR")==true){columns=[{CODEVALUE:1,CODENAME:"同客户"},{CODEVALUE:0,CODENAME:"不同客户"}];}else{columns=[{CODEVALUE:0,CODENAME:"不同客户"}];}var relationGroup=new unieap.ds.DataStore("relation_group_store",columns);
dataCenter.addDataStore(relationGroup);this.inherited(arguments);},postCreate:function(){unieap.byId("relationGroup").setValue(0);var batchRegNo=dojo.global.$appContext$.get("_batchRegNo");var productId=dojo.global.$appContext$.get("_productId");
var serviceOfferId=dojo.global.$appContext$.get("_serviceOfferId");var _budgetGridContainer="<div  id='_budgetGridContainer'></div>";dojo.place(_budgetGridContainer,unieap.byId("budgetHeadPane").containerNode,"last");
var budgetAcceptInfo={batchBudget:1};var budgetComponent=new BudgetWidget({batchRegNo:batchRegNo,custOrderId:0,batchBudgetAcceptInfo:budgetAcceptInfo},dojo.query("[id=_budgetGridContainer]",unieap.byId("budgetHeadPane").containerNode)[0]);
var paneId="budgetHeadPane";var pane=unieap.byId(paneId);if(pane&&!pane.open){pane.toggle();}},checkHaveOMRight:function(menuId){try{var webPath=dojo.byId("webPath").value;if(menuId){var result=dojo._getText(webPath+"/orderDetailAction.do?method=checkHasOMRight&menuId="+menuId);
var resObj=eval("("+result+")");return(resObj.flag=="1");}else{return true;}}catch(e){return true;}}});});
defineModule("orderaccept.prodofferaccept.widget.commheader.AdvanceSearchWidget",["orderaccept.custom.TooltipDialog","orderaccept.prodofferaccept.util"],function(b,a){dojo.declare("orderaccept.prodofferaccept.widget.commheader.AdvanceSearchWidget",[b],{requestParam:null,constructor:function(){this.inherited(arguments);
},renderData:function(){var c=this;a.ServiceFactory.getService("url:prodOfferSaleAction.do?method=initProdOfferAdvanceSearch",function(){c.requestParam=arguments[0];BusCard.$rs(dojo.query("[id=prodbigkind]",c.containerNode)[0],c.requestParam.prodBigKindColl.list);
BusCard.$rs(dojo.query("[id=userType]",c.containerNode)[0],c.requestParam.userTypeColl.list);BusCard.$rs(dojo.query("[id=accessMode]",c.containerNode)[0],c.requestParam.accModeColl.list);BusCard.$rs(dojo.query("[id=bandwidth]",c.containerNode)[0],c.requestParam.bandWidthColl.list);
BusCard.$rs(dojo.query("[id=cycleYear]",c.containerNode)[0],c.requestParam.cycleYearColl.list);});},postscript:function(){this.inherited(arguments);var c=dojo.cache("orderaccept.prodofferaccept.widget.commheader","template/advanceQueryTpl.html");
dojo.place(c,this.containerNode,"first");this.renderData();this.enableEvtMsgPropagation(this.containerNode);}});});
defineModule("orderaccept.prodofferaccept.widget.manageaccnbrwidget.ManageAccNbrWidget",["orderaccept.custom.TooltipDialog","orderaccept.common.js.ConstantsPool"],function(b,a){dojo.declare("orderaccept.prodofferaccept.widget.manageaccnbrwidget.ManageAccNbrWidget",[b],{constructor:function(){this.inherited(arguments);
this.chooseNumberList=[];},postscript:function(){this.inherited(arguments);var n=this;dojo.require("orderaccept.prodofferaccept.util");var h=function(){return dojo.global.$appContext$.get("requestParam").customerData;
}();var k=h.custId;var m=h.cityCode;var r=[];var e=[];if(!dojo.global.$appContext$.get("pstnPlusCdmaNbrMap")){var j=a.load(["ServiceKindCDConst"]).ServiceKindCDConst.CDMA_SERVICE_KIND;var o=a.load(["ServiceKindCDConst"]).ServiceKindCDConst.PSTN_SERVICE_KIND;
var d=BusCard.$remote("accessProdItemInfoDAO").selectByProperties({customerId:k,serviceOfferId:301,serviceKind:o,cityCode:m});var f=BusCard.$remote("accessProdItemInfoDAO").selectByProperties({customerId:k,serviceOfferId:301,serviceKind:j,cityCode:m});
var l=BusCard.$remote("serviceRelationDAO").query({customerId:k,serviceKind:o,ifValid:1,cityCode:m});var p=BusCard.$remote("serviceRelationDAO").query({customerId:k,serviceKind:j,ifValid:1,cityCode:m});
Array.prototype.push.apply(r,d);Array.prototype.push.apply(r,f);Array.prototype.push.apply(e,l);Array.prototype.push.apply(e,p);var g={};g.tempNbrInfoList=r;g.instNbrInfoLit=e;dojo.global.$appContext$.set("pstnPlusCdmaNbrMap",g);
}else{r=dojo.global.$appContext$.get("pstnPlusCdmaNbrMap").tempNbrInfoList;e=dojo.global.$appContext$.get("pstnPlusCdmaNbrMap").instNbrInfoLit;}this.chooseNumberList=this.chooseNumberList.concat(r);this.chooseNumberList=this.chooseNumberList.concat(e);
this.chooseNumberList=this.chooseNumberList.concat(this.getCurrentNbrInfoList());this.filterNumList();var q="<div class='buscard-root' style='display:block'>										 <div class='buscard-legend'>											<span class='buscard-legend-img'></span>											<span class='buscard-legend-text' id='buscard-name'>管理账号选择</span>										 </div>										 <div class='buscard-content'> ";
var i=1;dojo.forEach(this.chooseNumberList,function(t){var s="";if(i%2==1){q+="<div class='buscard-row'>";}q+=" <span>										<input type='radio' class='manageAccNumBox' id='manageAccNumBox' "+s+"											name='manageAccNumBox' value='"+t.serviceId+"' userId='"+t.userId+"' 											serviceKind='"+t.serviceKind+"' serviceKindIndex='"+t.serviceKindIndex+"' 											uniqueId ='"+t.uniqueId+"' defaultNumber='"+t.serviceId+"' productId='"+t.productId+"' />:										<input type='text' disabled='disabled'  value='"+t.serviceId+"' /> 									</span>";
if(i%2==0){q+="</div>";}i++;});q+="</div></div>";dojo.place(q,this.containerNode,"last");var c="<div style='text-align:center;vertical-align:middle'><a href='javascript:void(0);' dojoAttachEvent='onclick:elementclick'			        		dojoAttachTopic='/manageAccNumBtn' toolTipId='"+this.id+"' style='text-align:center;vertical-align:middle;'>确定</a></div>";
dojo.place(c,this.containerNode,"last");this.enableEvtMsgPropagation(this.containerNode);},getCurrentNbrInfoList:function(){var d=[];try{if(!prodOfferAcceptLoader){return d;}}catch(f){return d;}if(prodOfferAcceptLoader.mainProdOfferWidget==null){return d;
}var c=dojo.query(".main-product-basic",prodOfferAcceptLoader.mainProdOfferWidget.domNode);dojo.forEach(c,function(g){var h={};var e=dojo.attr(g,"viewId");h.serviceId=dojo.query(".serviceId-"+e,g)[0].value;
h.uniqueId=dojo.attr(g,"uniqueId");h.serviceKind=dojo.attr(g,"serviceKind");h.serviceKindIndex=dojo.attr(g,"serviceKindIndex");h.productId=dojo.attr(g,"productId")||"-1",d.push(h);});return d;},filterNumList:function(){if(this.chooseNumberList.length==1){return;
}var c=[];dojo.forEach(this.chooseNumberList||[],function(d){if(!dojo.some(c||[],function(e){return e.serviceId==d.serviceId;})){c.push(d);}});this.chooseNumberList=c;}});});
defineModule("orderaccept.prodofferaccept.widget.shoppingcart.ShoppingCartWidget",["orderaccept.custom._BaseWidget","orderaccept.custom._BusCardTemplated","orderaccept.prodofferaccept.util","orderaccept.common.js.ConstantsPool"],function(d,c,a,b){dojo.declare("orderaccept.prodofferaccept.widget.shoppingcart.ShoppingCartWidget",[d,c],{templatePath:dojo.moduleUrl("orderaccept.prodofferaccept","widget/shoppingcart/template/shoppingCartTpl.html"),acceptProdOfferInfoVO:null,prodOfferInfoVO:null,globalConfig:{},postMixInProperties:function(){loadCssModule("orderaccept.prodofferaccept.widget.shoppingcart.resources.css.shoppingcart");
prodOfferAcceptLoader.updateCurrentProdOfferName($ac$.get("currentMainProdOfferInfoVO").prodOfferName);this._deleteInitPage();this.acceptProdOfferInfoVO=this.buildViewInitData();this._appendFunctionRadioName(this.acceptProdOfferInfoVO);
},_appendFunctionRadioName:function(e){dojo.forEach(e.groupedOfferProdRelaList||[],function(g){var f="functionRadio_"+a.CommUtils.generateUniqueId();g.functionRadioName=f;});},_deleteInitPage:function(){var e=dojo.byId("shoppingCartInitPage");
if(e){e.parentNode.removeChild(e);}},postCreate:function(){this.inherited(arguments);var f=dojo.query(".member-product-tr",this.domNode);this.selectDefaultProdOffer(f);dojo.forEach(f,function(j){var k=dojo.attr(j,"prodOfferInstId");
if(k){var g=($ac$.query("$.userHasProdOfferInfoList[?(@.prodOfferInstId=="+k+")]"))[0],h=dojo.query(".member-product-checkbox",j)[0],i=dojo.query(".memeber-prodoffer-select",j)[0];dojo.attr(h,{disabled:true,checked:true});
i.value=g.prodOfferId;}});var e=($ac$.get("currentProcessId")||$ac$.get("processId")||"")+"PostHandling";if(this[e]){this[e]();}this.enableTitle();},selectDefaultProdOffer:function(e){dojo.forEach(e,function(l){var k=dojo.query(".memeber-prodoffer-select",l)[0];
var i=dojo.attr(l,"productId");var h=$ac$.get("currentMainProdOfferInfoVO");var f=h.offerProdRelaList;var j=dojo.filter(f||[],function(n){return n.productInfoVO.productId==i;})[0];var g=j.relatedOfferList;
var m=dojo.filter(g||[],function(n){return n.selectDefault==1||n.selectDefault=="1";})[0];if(!!m){k.value=m.prodOfferId;}});},enableTitle:function(){var e=dojo.query(".memeber-prodoffer-select",this.domNode)||[];
var f=dojo.query(".product-select",this.domNode)||[];dojo.forEach([].concat(e).concat(f),function(g){a.DomHelper.enableTitle(g);});},independenceMemberChangePostHandling:function(){},independence2independencePostHandling:function(){var e=dojo.query(".member-product-tr",this.domNode),f=this;
dojo.forEach(e,function(l){var i=dojo.attr(l,"permitEnterComb");var j=dojo.attr(l,"prodInstId");var m=dojo.attr(l,"prodOfferInstId");var k=dojo.query(".member-offer-keep",l)[0];var h=dojo.query(".member_keep_text",l)[0];
var g=dojo.query(".member-offer-split",l)[0];if(!i&&(j||m)){k.parentNode.removeChild(k);h.parentNode.removeChild(h);dojo.addClass(g,"action-selected");g.checked=true;f._initSplitMemberProdOfferList(l);
}});},_initSplitMemberProdOfferList:function(n){var h=$ac$.get("userHasProdOfferInfoList"),g=dojo.attr(n,"prodOfferInstId"),i=dojo.attr(n,"productId"),q=dojo.attr(n,"prodInstId"),k=BusCard.jsonPath(h,"$[?(@.prodOfferInstId=="+g+")]")[0],e=BusCard.jsonPath($ac$.get("currentMainProdOfferInfoVO"),"offerProdRelaList[?(@.productId=="+i+")]")[0],p=dojo.query(".memeber-prodoffer-select",n)[0],l=k.prodOfferId,j=dojo.filter(k.prodInstList,function(r){return r.prodInstId==q;
})[0];var o="&prodOfferId="+l;var f=prodOfferAcceptLoader.route("url:orderDetailAction.do?method=doGetProdOfferByAccProductId&productId="+i+o);BusCard.$rs(p,dojo.map(f,function(r){return{id:r.prodOfferId,name:r.prodOfferName};
}));var m=dojo.some(f,function(r){return r.prodOfferId==k.prodOfferId;});if(m){p.value=k.prodOfferId;}},buildViewInitData:function(){var f=$ac$.get("requestParam").actionCD,e=a.ACTION_CD_CONST;switch(f){case e.PRODUCT_INSTALL:return this.onProductInstall();
break;case e.PRODUCT_CHANGE_MAIN:return this.onProductChangeMain();break;case e.PRODUCT_CHANGE:return this.onSubProdOfferChange();break;case e.MEMBER_OFFER_CHANGE:return this.onMemberChange();break;case e.PRODUCT_CHANGE_ACCEPT:return this.onProductChangeMain();
break;}},onProductInstall:function(){this.globalConfig.buttonName="下一步";var e=$ac$.get("currentMainProdOfferInfoVO");if(e.bindType==2){return this.onIndependenceProdOfferInstall();}else{return this.onSharedProdOfferInstall();
}},reComputeOfferProdRelaList:function(f){var e=f.offerProdRelaList,g=Array.prototype.concat;return g.apply([],dojo.map(e,function(i){var h=i.productInfoVO,j=h.prodCompDetailList||[],k=[];k.push(i);dojo.forEach(j,function(n){n.combProductId=i.productId;
if(false&&n.maxCount==n.minCount){var m={productId:n.productId,minCount:1,maxCount:1,ifDefault:1,combProductId:i.productId,productInfoVO:n};for(var l=0;l<n.minCount;l++){k.push(m);}}else{var m={productId:n.productId,minCount:n.minCount,maxCount:n.maxCount,ifDefault:"1",combProductId:i.productId,productInfoVO:n};
k.push(m);}});return k;}));},reConstructOldProdOfferInfoVO:function(h,f){var g=b.load(["ProductFuncTypeConst"]).ProductFuncTypeConst.ACCESS;if(h&&f&&f.length){var e=h.offerProdRelaList||[];dojo.forEach(f,function(i){var l=i.prodOfferId;
var n=i.prodInstList||[];var k=dojo.filter(n,function(o){return o.prodFuncType==g;})[0];if(k){var j=dojo.filter(e,function(o){return o.productId==k.productId;})[0];if(j){j.relatedOfferList=j.relatedOfferList||[];
var m=dojo.some(j.relatedOfferList,function(o){return o.prodOfferId==i.prodOfferId;});if(!m){j.relatedOfferList.push(a.ProdOfferHelper.loadAndSetProdOffer(i.prodOfferId,{interfaceType:1,permitCache:true,permitFromCache:true}));
}}}});}},reConstructNewProdOfferInfoVO:function(f){if(f){var e=f.offerProdRelaList||[];if(f.bindType==2){var g=[];dojo.forEach(e,function(h,j){var i=h.relatedOfferList||[];if(!i.length){g.push(j);}});g.sort(function(i,h){return i>h?-1:(i<h?1:0);
});dojo.forEach(g,function(h){e.splice(h,1);});}}},reConstructInstStructure:function(e){var i=e.prodInstList||[],h=b.load("ProductTypeConst").ProductTypeConst.COMPOSE,g=BusCard.jsonPath(i,"$[?(@.prodTypeCd=="+h+")]"),f=b.load(["ProductFuncTypeConst"]).ProductFuncTypeConst.ACCESS,j=[],k=Array.prototype.push;
if(g&&g.length){dojo.forEach(g,function(m){var n=BusCard.jsonPath(m,"$.prodInstList[?(@.prodFuncType=="+f+")]")||[];var l=dojo.filter(m.prodInstList||[],function(o){return !dojo.some(n,function(p){return p===o;
})||[];});m.prodInstList=l;k.apply(j,[m]);k.apply(j,n);});e.prodInstList=j;}},onSharedProdOfferInstall:function(){$ac$.set("currentProcessId","sharedProdOfferInstall");var k=$ac$.get("currentMainProdOfferInfoVO");
k.offerProdRelaList=this.reComputeOfferProdRelaList(k);var f=k.offerProdRelaList;var i=this.constructClonedProdOfferInfoVO(k);var h=[];var l={};dojo.forEach(f,function(m){var n=m.productInfoVO.productId;
if(!l[n]){l[n]=[];}l[n].push(m);});for(var j in l){if(l.hasOwnProperty(j)){var g=l[j][0];var e=l[j].length;while(e--){h.push({DISABLED:(false&&g.minCount>=1)?"DISABLED":"",CHECKED:g.ifDefault==1?"CHECKED":"",relatedOfferList:[i],productId:j,maxCount:g.maxCount,minCount:g.minCount,productName:g.productInfoVO.productName,ifSingle:i.bindType==0,offerProdRelaList:l[j],permitAdd:g.maxCount>1?true:false});
}}}i.groupedOfferProdRelaList=h;return i;},onIndependenceProdOfferInstall:function(){var l=this;$ac$.set("currentProcessId","independenceProdOfferInstall");var j=$ac$.get("currentMainProdOfferInfoVO");
this.reConstructNewProdOfferInfoVO(j);var e=j.offerProdRelaList;var h=this.constructClonedProdOfferInfoVO(j);var g=[];var k={};dojo.forEach(e,function(m){var n=m.productInfoVO.productId;if(!k[n]){k[n]=[];
}k[n].push(m);});for(var i in k){if(k.hasOwnProperty(i)){var f=k[i][0];g.push({relatedOfferList:l.sortByProdOfferName(f.relatedOfferList||[]),productId:i,maxCount:f.maxCount,productName:f.productInfoVO.productName,minCount:f.minCount,CHECKED:f.ifDefault==1?"CHECKED":"",permitAdd:f.maxCount>1?true:false,offerProdRelaList:k[i]});
}}h.groupedOfferProdRelaList=g;return h;},onSubProdOfferChange:function(){var e=this.onSharedMemberChange();$ac$.set("currentProcessId","subProdOfferChange");$ac$.set("processId","subProdOfferChange");
this.globalConfig.buttonName="下一步";this.globalConfig.promptText=",点击下一步按钮可以进行产品或可选包变更";return e;},onMemberChange:function(){var e=$ac$.get("currentMainProdOfferInfoVO");if(e.bindType==1){return this.onSharedMemberChange();
}else{return this.onIndependenceMemberChange();}},findOfferProdRelaVO:function(g,f){var e=g.offerProdRelaList||[];return BusCard.find(e,function(h){return h.productId==f;});},onSharedMemberChange:function(){$ac$.set("currentProcessId","sharedMemberChange");
$ac$.set("processId","sharedMemberChange");this.globalConfig.buttonName="下一步";this.globalConfig.promptText=",点击下一步按钮可以进行产品或可选包变更";var i=$ac$.get("currentMainProdOfferInfoVO"),g=$ac$.get("mainProdOfferInstVO");
i.offerProdRelaList=this.reComputeOfferProdRelaList(i);this.reConstructInstStructure(g);var n=this,j=this.constructClonedProdOfferInfoVO(i),f=b.load(["ProductFuncTypeConst"]).ProductFuncTypeConst.ACCESS,m=BusCard.jsonPath(g,"$.prodInstList[?(@.prodFuncType=="+f+")].productId"),h=this.filterNotOrderedOfferProdRelaList(m,i),k=dojo.map(h,function(o){return{relatedOfferList:[j],offerProdRelaList:[o],productId:o.productId};
}),l=g.prodInstList||[],e=dojo.map(l,function(o){var p=n.findOfferProdRelaVO(i,o.productId);return{relatedOfferList:[j],offerProdRelaList:[p],prodInstId:o.prodInstId,productId:o.productId,prodOfferInstId:g.prodOfferInstId,offerInstVO:g,ifDefault:1,maxCount:p.maxCount,minCount:p.minCount,productName:p.productInfoVO.productName,CHECKED:"CHECKED",DISABLED:"DISABLED",permitSplit:false,permitAdd:p.maxCount>1,memberStatus:n.buildMemberStatus(i,o)};
});j.groupedOfferProdRelaList=[].concat(e).concat(k);return j;},_getMemberProdOfferInstList:function(){var h=$ac$.get("requestParam"),k=h.prodOfferInstId,g=b.load("OfferInstRelaTypeConst").OfferInstRelaTypeConst.OFFER_COMB_MEMBER,f=$ac$.query("$.userHasProdOfferInfoList[?(@.prodOfferInstId=="+k+")]")[0],j=BusCard.jsonPath(f,"$.offerInstRelaList[?(@.relationTypeCd=="+g+")].relatedProdOfferInstId"),e="$.userHasProdOfferInfoList[?("+dojo.map(j,function(l){return" @.prodOfferInstId=="+l+"||";
}).join("")+"false)]",i=$ac$.query(e);return i;},_getOrderedAccessProdInstList:function(f){var e=b.load(["ProductFuncTypeConst"]).ProductFuncTypeConst.ACCESS,g=BusCard.jsonPath(f,"$[*].prodInstList[?(@.prodFuncType=="+e+")]");
return g;},onIndependenceMemberChange:function(){$ac$.set("currentProcessId","independenceMemberChange");$ac$.set("processId","independenceMemberChange");this.globalConfig.buttonName="下一步";this.globalConfig.promptText=",在下列表格中可以进行成员变更受理";
var h=$ac$.get("currentMainProdOfferInfoVO");var i=this.constructClonedProdOfferInfoVO(h),j=this,e=$ac$.get("userHasProdOfferInfoList"),m=this._getMemberProdOfferInstList();this.reConstructOldProdOfferInfoVO(h,m);
this.reConstructNewProdOfferInfoVO(h);var n=function(o){return dojo.filter(h.offerProdRelaList,function(p){return p.productId==o;})[0];},k=function(o){return dojo.filter(m,function(p){return p.prodInstList[0].productId==o;
});},g=dojo.map(m,function(s){var q={},p=s.prodInstList[0],o=n(p.productId);q.offerProdRelaList=[o];q.prodInstId=p.prodInstId;q.prodInstVO=p;q.productId=o.productInfoVO.productId;q.offerInstVO=s;q.prodOfferInstId=s.prodOfferInstId;
q.memberStatus=j.buildMemberStatus(s,o);q.ifDefault=1;q.productName=o.productInfoVO.productName;q.CHECKED="CHECKED";q.DISABLED="DISABLED";q.relatedOfferList=j.sortByProdOfferName(o.relatedOfferList||[]);
q.permitSplit=true;q.permitAdd=o.maxCount>1;q.maxCount=o.maxCount;q.minCount=o.minCount;return q;}),f=dojo.map(dojo.filter(h.offerProdRelaList,function(p){var o=k(p.productId);return !o||o.length==0;}),function(o){return{offerProdRelaList:[o],maxCount:o.maxCount,minCount:o.minCount,productName:o.productInfoVO.productName,productId:o.productInfoVO.productId,ifDefault:0,permitAdd:o.maxCount>1,relatedOfferList:j.sortByProdOfferName(o.relatedOfferList||[])};
}),l=[].concat(g,f);i.groupedOfferProdRelaList=l;return i;throw new Error("暂不支持");},onProductChangeMain:function(){return this[$ac$.get("currentProcessId")]();},single2single:function(){return this.single2comb.apply(this,arguments);
},getTargetProductId:function(h){var g=h.productId;var i=$ac$.get("requestParam").actionCD,e=a.ACTION_CD_CONST;switch(i){case e.PRODUCT_CHANGE_ACCEPT:var f=dojo.byId("changeParamList");if(f&&f.value){g=f.value;
}break;default:g=h.productId;break;}return g;},single2comb:function(){this.globalConfig.buttonName="下一步";this.globalConfig.promptText=",点击下一步进行主套餐变更操作";var h=$ac$.get("currentMainProdOfferInfoVO"),l=this,f=$ac$.get("mainProdOfferInstVO"),j=a.ProdOfferHelper.loadAndSetProdOffer(f.prodOfferId,{interfaceType:1}),i=f.prodInstList[0],m=i.prodInstId,g=BusCard.jsonPath(h,"$.offerProdRelaList[?(@.productId=="+this.getTargetProductId(i)+")]")[0],k=this.constructClonedProdOfferInfoVO(h),e=dojo.map(h.offerProdRelaList,function(p){var o=p.productInfoVO;
var n={maxCount:p.maxCount,minCount:p.minCount,productName:o.productName,productId:o.productId,ifDefault:1,permitAdd:p.maxCount>0,CHECKED:p.ifDefault==1?"CHECKED":"",DISABLED:(false&&p.minCount>0)?"DISABLED":"",relatedOfferList:[k],offerProdRelaList:[p]};
if(g.productId==p.productId){dojo.mixin(n,{CHECKED:"CHECKED",DISABLED:"DISABLED",prodOfferInstId:f.prodOfferInstId,prodInstId:m,prodInstVO:i,offerInstVO:f,memberStatus:l.buildMemberStatus(j,i)});}return n;
});k.groupedOfferProdRelaList=e;return k;},single2independence:function(){this.globalConfig.buttonName="下一步";this.globalConfig.promptText=",点击下一步进行主套餐变更操作";this.reConstructNewProdOfferInfoVO($ac$.get("currentMainProdOfferInfoVO"));
var i=$ac$.get("currentMainProdOfferInfoVO"),m=this,f=$ac$.get("mainProdOfferInstVO"),k=a.ProdOfferHelper.loadAndSetProdOffer(f.prodOfferId,{interfaceType:1}),j=f.prodInstList[0],h=j.productId,n=j.prodInstId,g=BusCard.jsonPath(i,"$.offerProdRelaList[?(@.productId=="+h+")]")[0],l=this.constructClonedProdOfferInfoVO(i),e=dojo.map(i.offerProdRelaList,function(q){var p=q.productInfoVO;
var o={maxCount:q.maxCount,minCount:q.minCount,productName:p.productName,productId:p.productId,ifDefault:1,permitAdd:q.maxCount>0,CHECKED:q.ifDefault==1?"CHECKED":"",DISABLED:(false&&q.minCount>0)?"DISABLED":"",relatedOfferList:m.sortByProdOfferName(q.relatedOfferList||[]),offerProdRelaList:[q]};
if(g.productId==q.productId){dojo.mixin(o,{CHECKED:"CHECKED",DISABLED:"DISABLED",permitEnterComb:"1",prodOfferInstId:f.prodOfferInstId,prodInstId:n,prodInstVO:j,offerInstVO:f,memberStatus:m.buildMemberStatus(k,j)});
}return o;});l.groupedOfferProdRelaList=e;return l;},independence2independence:function(){this.globalConfig.buttonName="下一步";this.globalConfig.promptText=",点击下一步进行主套餐变更操作";this.reConstructNewProdOfferInfoVO($ac$.get("currentMainProdOfferInfoVO"));
var i=$ac$.get("currentMainProdOfferInfoVO"),l=this,f=$ac$.get("mainProdOfferInstVO"),j=a.ProdOfferHelper.loadAndSetProdOffer(f.prodOfferId,{interfaceType:4,permitCache:true}),q=l._getMemberProdOfferInstList();
this.reConstructOldProdOfferInfoVO(j,q);var p=l._getOrderedAccessProdInstList(q),k=this.constructClonedProdOfferInfoVO(i),o=BusCard.jsonPath(p,"$[*].productId"),g=l.filterNotOrderedOfferProdRelaList(o,i),m=l.filterOrderdOfferRelaList(o,i),h=l.filterShouldSplitOrQuitOfferRelaList(o,i,j),e=[],n=Array.prototype.push;
n.apply(e,dojo.map(g,function(t){var s=t.productInfoVO,r={maxCount:t.maxCount,minCount:t.minCount,productName:s.productName,productId:s.productId,ifDefault:1,permitAdd:t.maxCount>0,CHECKED:t.ifDefault==1?"CHECKED":"",DISABLED:(false&&t.minCount>0)?"DISABLED":"",relatedOfferList:l.sortByProdOfferName(t.relatedOfferList||[]),offerProdRelaList:[t]};
return r;}));n.apply(e,dojo.map(q,function(u){var x=l._getOrderedAccessProdInstList([u])[0];var t=false;var w=x.productId;var y=dojo.filter(m,function(z){return z.productInfoVO.productId==w;})[0];var v=BusCard.jsonPath(j,"$.offerProdRelaList[?(@.productId=="+w+")]")[0];
if(!y){t=true;y=dojo.filter(h,function(z){return z.productInfoVO.productId==w;})[0];}var s=y.productInfoVO;var r={maxCount:y.maxCount,minCount:y.minCount,productName:s.productName,productId:s.productId,ifDefault:1,permitAdd:t?false:y.maxCount>0,CHECKED:y.ifDefault==1?"CHECKED":"",DISABLED:(false&&y.minCount>0)?"DISABLED":"",relatedOfferList:l.sortByProdOfferName(y.relatedOfferList||[]),offerProdRelaList:[y],CHECKED:"CHECKED",DISABLED:"DISABLED",permitSplit:true,permitEnterComb:t?"":"1",prodOfferInstId:u.prodOfferInstId,prodInstId:x.prodInstId,offerInstVO:u,prodInstVO:x,memberStatus:l.buildMemberStatus(u,v)};
return r;}));k.groupedOfferProdRelaList=e;return k;},comb2comb:function(){},constructClonedProdOfferInfoVO:function(f){var g={};for(var e in f){if(!(dojo.isArray(f[e])||dojo.isObject(f[e]))){g[e]=f[e];
}}return g;},buildMemberStatus:function(e,f){var g=BusCard.jsonPath(f,"$.relatedOfferList[?(@.prodOfferId=="+e.prodOfferId+")]")[0];var h="";if(g){h="已有/"+g.prodOfferName+"/"+e.prodInstList[0].accNbr;}else{h="已有/"+arguments[0].prodOfferName+"/"+arguments[1].accNbr;
}return h;},filterNotOrderedOfferProdRelaList:function(g,e){var f=this;return dojo.filter(e.offerProdRelaList,function(h){return dojo.every(g,function(i){return i!=h.productInfoVO.productId;});});},filterOrderdOfferRelaList:function(g,e){var f=this;
return dojo.filter(e.offerProdRelaList,function(h){return dojo.some(g,function(i){return i==h.productInfoVO.productId;});});},filterShouldSplitOrQuitOfferRelaList:function(h,f,e){var g=this;return dojo.filter(e.offerProdRelaList,function(j){var k=j.productInfoVO.productId;
var i=dojo.some(h,function(l){return k==l;});if(i){return dojo.every(f.offerProdRelaList,function(l){return l.productInfoVO.productId!=k;});}});},sortByProdOfferName:function(e){e.sort(function(g,f){return(g.prodOfferName).localeCompare(f.prodOfferName);
});return e;}});});
defineModule("orderaccept.prodofferaccept.loader.ProdOfferNewLoader",["../util","../../base/Controller","../widget/servicecard/ServiceCardWidget","../widget/resourcecard/ResourceCardWidget","../widget/serviceproduct/ServiceProductWidget","../widget/attrcard/ProductOfferAttrCardWidget","../widget/attrcard/ProductAttrCardWidget","../../custom/TooltipDialog","../formatter/FormatterProvider","../builder.prodofferdetail.MainProdOfferDetailBuilder","../widget/commcard/CommCardWidget","../builder/subprodoffergrid/SubProdOfferCartDataProvider","../OrderShowLoader","../formatter/PromotionFormatterProvider","../builder/promotiondetail/PromotionDetailBuilder","../builder/promotiongrid/PromotionCartDataProvider","orderaccept.common.dialog.MessageBox","../../custom/BusCardGrid","../widget/prodofferfavoritelist/personalPromotionCollectListWidget","unieap.layout.AccordionContainer","unieap.layout.AccordionPane","../widget/commheader/CommHeaderWidget","../widget/commheader/SubHeaderWidget","unieap.layout.BorderContainer","dojo.cache","../widget/commheader/PromotionHeaderWidget"],function(a,s,b,r,d,n,e,m,j,g,f,l,q,o,p,k,h,i,c){dojo.declare("orderaccept.prodofferaccept.loader.ProdOfferNewLoader",[s],{layoutTemplateUrl:dojo.moduleUrl("orderaccept.prodofferaccept","view/prodOfferNewLayout_new.html"),mainProdOfferWidgetClass:null,serviceCardWidgetMap:null,eventListenerRegistry:null,mainProdOfferId:null,behaviorInstance:null,checkInstance:null,dataBuilder:null,specDataBuilder:null,newSpecDataBuilder:null,productAttrCardWidgetClass:e,serviceProductWidgetClass:d,ProductOfferAttrCardWidgetClass:n,serviceCardWidgetClass:b,resourceCardWidgetClass:r,mainProdOfferWidget:null,mainProdOfferDetailWidget:null,payRelationWidgetClass:null,payRelationWidgetInstance:null,subProdOfferOrderGridClass:null,subProdOfferOrderGrid:null,searchSubListWidgetInstanceMap:{},personalSubCollectListWidgetInstanceMap:{},personalSubCollectMoreListWidgetInstanceMap:{},viaInfoCardWidget:null,orderInfoCardWidget:null,functionNavigatorWidget:null,functionNavigatorWidgetClass:null,prodOfferInfoTipsWidget:null,prodOfferInfoTipsWidgetClass:null,advanceSearchWidget:null,advanceSearchWidgetClass:null,collectTipsWidget:null,collectTipsWidgetClass:null,warmTipesWidget:null,warmTipesWidgetClass:null,prodOfferAcceptTipsWidget:null,prodOfferAcceptTipsWidgetClass:null,subProdOfferTree:null,orderShowLoader:null,batchNewWidget:null,batchNewWidgetClass:null,subProdOfferCartDataProvider:null,peddleProdOfferListWidgetClass:null,hotProdOfferListWidgetClass:null,personalCollectListWidgetClass:null,personalSubCollectListWidgetClass:null,salesPromotionOrderGridClass:null,salesPromotionOrderGrid:null,promotionDetailBuilder:null,promotionCartDataProvider:null,oldUserAddedHandler:null,multipleSubProdOfferHandler:null,ShoppingCartWidgetClass:null,shoppingCartWidgetInstance:null,comboServiceCardRequest:true,jsonpRequest:true,promotionSearchListWidgetInstance:null,subProdOfferContentTemplate:dojo.cache("orderaccept.prodofferaccept.view","subProdOfferContent.html"),personalCollectPromotionListWidgetClass:c,promotionContentTemplate:dojo.cache("orderaccept.prodofferaccept.view","promotionContent.html"),globalLifeCycleProperties:["prodOfferList","currentMainProdOfferInfoVO","selectedMainProdOfferInfoVO","selectedMemberProdOfferList","requestParam","userHasProdOfferInfoList","userHasProdOfferMetaInfoList","serviceOfferConfig","listenerRegistry","mainProdOfferInfoVO","DataManager","processId","currentProcessId","mainProdOfferInstVO","subGroupProdInfo","orderPromotionList"],constructor:function(t){this.requestParam=t;
this.mainProdOfferWidget=null;},postscript:function(){this.init();BusCard.removeCoverLayer();this.asynExecute(this._asynLoadSriptList(),dojo.hitch(this,"_asynCallback"));},_asynCallback:function(){var t=this;
t.registerClass();t.initOldUserAddedHandler();t.initBehavior();t.initCheck();t.initDataBuilder();t.initSpecialDataBuilder();t.renderProdOfferFavorite();t.renderPromotionLayout();t.renderPromotionOrderGrid();
t.renderPayRelation();t.initFunctionNavigatorWidget();t.initOrderInfoWidget();t.initViaInfoWidget();t.initGlobalHelper();t.initMultipleSubProdOfferHandler();t.initTipsWidgets();t.initAdvanceSearchWidget();
t.initWaitingBar();t.initOrderPreView();t.fireEvent("onload");},_asynLoadSriptList:function(){return["orderaccept.prodofferaccept.behavior.ProdOfferNewBehavior","orderaccept.prodofferaccept.data.ProdOfferNewDataBuilder","orderaccept.prodofferaccept.data.SpecialDataHandler","orderaccept.prodofferaccept.check.ProdOfferNewCheck","orderaccept.prodofferaccept.rule.ProdOfferNewRule","orderaccept.prodofferaccept.widget.payrelation.PayRelationWidget","orderaccept.custom.Grid","orderaccept.custom.BusCardGrid","orderaccept.prodofferaccept.widget.mainprodoffer.MainProdOfferFlatWidget","orderaccept.prodofferaccept.widget.prodofferfavoritelist.peddleProdOfferListWidget","orderaccept.prodofferaccept.widget.prodofferfavoritelist.hotProdOfferListWidget","orderaccept.prodofferaccept.widget.prodofferfavoritelist.personalCollectListWidget","orderaccept.prodofferaccept.widget.prodofferfavoritelist.personalSubCollectListWidget","orderaccept.prodofferaccept.widget.functionnavigator.FunctionNavigatorWidget","orderaccept.prodofferaccept.loader.OldUserAddedHandler","orderaccept.prodofferaccept.loader.MultipleSubProdOfferHandler","orderaccept.prodofferaccept.widget.messagetips.ProdOfferInfoTipsWidget","orderaccept.prodofferaccept.widget.messagetips.WarmTipsWidget","orderaccept.prodofferaccept.widget.manageaccnbrwidget.ManageAccNbrWidget","orderaccept.prodofferaccept.widget.messagetips.CollectTipsWidget","orderaccept.prodofferaccept.widget.messagetips.ProdOfferAcceptTipsWidget","orderaccept.prodofferaccept.widget.commheader.AdvanceSearchWidget","orderaccept.custom.popup","orderaccept.prodofferaccept.widget.batchnew.BatchNewWidget","orderaccept.prodofferaccept.widget.shoppingcart.ShoppingCartWidget"];
},init:function(){this.serviceCardWidgetMap={};this.captureEventRegistry();this.renderLayout();a.navigatorManager.to("mainProdOfferSelectPane")(function(){dojo.byId("function-navigator-root").style.display="none";
});this.renderBelongCode();this.renderMainProdOfferTree();},initWaitingBar:function(){this.waitingBarInstance=a.WaitingBar.getInstance();this.waitingBarInstance.initMe();},renderLayout:function(){var t=dojo.byId("prodoffer-accept-root");
t.innerHTML=dojo._getText(this.layoutTemplateUrl);dojo.parser.parse(t);this._doLayoutMend();this.addIconForQuickAccept();this.appendIntroInfoForMainProdOffer();this.updateCurrentProdOfferName("\u672a\u9009\u62e9\u9500\u552e\u54c1");
},appendIntroInfoForMainProdOffer:function(){var v=unieap.byId("shoppingCartPane");if(v){var y=v.titleText||v.titleNode;var u="<span id='currcentAcceptMainProdOfferWrapper' class='mainprodoffer-intro-wrapper'>[\u6b63\u5728\u53d7\u7406\u7684\u9500\u552e\u54c1\uff1a<span id = 'currcentAcceptMainProdOfferSpan' class='main-prodoffer-intro'></span>]</span>";
var t=document.createElement("div");var w=document.createDocumentFragment();t.innerHTML=u;var x=t.childNodes;dojo.forEach(dojo._toArray(x),function(z){w.appendChild(z);});t=null;y.appendChild(w);}},updateCurrentProdOfferName:function(t){var u=dojo.byId("currcentAcceptMainProdOfferSpan");
u&&(u.innerHTML=t);},renderSubProdOfferLayout:function(){unieap.byId("subProdOfferPane").destroyDescendants();unieap.byId("subProdOfferPane").containerNode.innerHTML=BusCard.Template.create(this.subProdOfferContentTemplate).apply({});
dojo.parser.parse(unieap.byId("subProdOfferPane").containerNode);this.renderSubProdOfferSearch();},renderSubProdOfferSearch:function(u){var u=u||"";var t=new orderaccept.prodofferaccept.widget.commheader.SubHeaderWidget({uniqueId:u});
dojo.place(t.domNode,unieap.byId("subProdOfferBorderPan"+u).containerNode,"first");},captureEventRegistry:function(){this.eventListenerRegistry={};dojo.mixin(this.eventListenerRegistry,dojo.global.$appContext$.get(this.declaredClass+".eventListenerRegistry"));
dojo.global.$appContext$.deleteProperty(this.declaredClass+".eventListenerRegistry");},registerClass:function(){var t=this;t.mainProdOfferWidgetClass=orderaccept.prodofferaccept.widget.mainprodoffer.MainProdOfferFlatWidget;
t.payRelationWidgetClass=orderaccept.prodofferaccept.widget.payrelation.PayRelationWidget;t.subProdOfferOrderGridClass=orderaccept.custom.BusCardGrid;t.peddleProdOfferListWidgetClass=orderaccept.prodofferaccept.widget.prodofferfavoritelist.peddleProdOfferListWidget;
t.personalCollectListWidgetClass=orderaccept.prodofferaccept.widget.prodofferfavoritelist.personalCollectListWidget;t.personalSubCollectListWidgetClass=orderaccept.prodofferaccept.widget.prodofferfavoritelist.personalSubCollectListWidget;
t.hotProdOfferListWidgetClass=orderaccept.prodofferaccept.widget.prodofferfavoritelist.hotProdOfferListWidget;t.functionNavigatorWidgetClass=orderaccept.prodofferaccept.widget.functionnavigator.FunctionNavigatorWidget;
t.salesPromotionOrderGridClass=orderaccept.custom.BusCardGrid;t.prodOfferInfoTipsWidgetClass=orderaccept.prodofferaccept.widget.messagetips.ProdOfferInfoTipsWidget;t.warmTipesWidgetClass=orderaccept.prodofferaccept.widget.messagetips.WarmTipsWidget;
t.prodOfferAcceptTipsWidgetClass=orderaccept.prodofferaccept.widget.messagetips.ProdOfferAcceptTipsWidget;t.collectTipsWidgetClass=orderaccept.prodofferaccept.widget.messagetips.CollectTipsWidget;t.manageAccNbrWidgetClass=orderaccept.prodofferaccept.widget.manageaccnbrwidget.ManageAccNbrWidget;
t.advanceSearchWidgetClass=orderaccept.prodofferaccept.widget.commheader.AdvanceSearchWidget;t.batchNewWidgetClass=orderaccept.prodofferaccept.widget.batchnew.BatchNewWidget;t.ShoppingCartWidgetClass=orderaccept.prodofferaccept.widget.shoppingcart.ShoppingCartWidget;
},initOldUserAddedHandler:function(){this.oldUserAddedHandler=new orderaccept.prodofferaccept.loader.OldUserAddedHandler(this);},initBehavior:function(){this.behaviorInstance=new orderaccept.prodofferaccept.behavior.ProdOfferNewBehavior(this);
},initCheck:function(){this.checkInstance=new orderaccept.prodofferaccept.check.ProdOfferNewCheck(this);},getBelongCode:function(){return dojo.byId("common-belongcode").value;},buildMainProdOfferTreeURL:function(){var t=dojo.global.$appContext$.get("requestParam"),u={custType:t.customerData.custType?t.customerData.custType:-1,custId:t.customerData.custId,cityCode:t.customerData.cityCode,belongCode:this.getBelongCode()};
return BusCard.path.contextPath+"/shoppingCartAction.do?method=doSaleworkTreeAllXml&"+BusCard.buildParam(u)+this.appendOfferFilterParameters();},buildSubProdOfferTreeURL:function(u,t){return BusCard.path.contextPath+"/orderDetailAction.do?method=getProdOfferTreeForNew&prodOfferId="+u+"&memOfferList="+this.getMemberProdOfferIds(t)+"&commonRegionId="+(this.getBelongCode()||"")+"&accProdListStr="+this.getAccProdIdList(t);
},getAccProdIdList:function(t){t=t||"";if(t==""){return dojo.toJson(dojo.map($ac$.selectedMemberProdOfferList||[],function(u){return u.productId;}));}else{return dojo.toJson(dojo.map(dojo.filter($ac$.selectedMemberProdOfferList||[],function(u){return u.uniqueId==t;
})||[],function(u){return u.productId;}));}},getMemberProdOfferIds:function(w){var u=dojo.filter($ac$.selectedMemberProdOfferList||[],function(x){return x.uniqueId==w;});if((!!u)&&u.length>0){if(u[0].action=="split"||u[0].action=="quit"){return dojo.toJson([u[0].offerInstVO.prodOfferId+""]);
}}var t=$ac$.selectedMemberProdOfferList;var v=dojo.filter(t||[],function(x){return x.action!="quit"&&x.action!="split";});return dojo.toJson(dojo.map(v||[],function(x){return x.prodOfferId;}));},buildPromotionTreeURL:function(t,v,u,w){return BusCard.path.contextPath+"/orderDetailAction.do?method=getSalesPromotion&prodOfferIdList="+dojo.toJson(t)+"&productIdList="+dojo.toJson(v)+"&belongCode="+u+"&mainProdOfferId="+w;
},renderMainProdOfferTree:function(){this.mainProdOfferTree=a.WidgetProvider.getMainProdOfferTree({url:this.buildMainProdOfferTreeURL()});var t=unieap.byId("mainProdOfferTreePane").containerNode;dojo.place(this.mainProdOfferTree.domNode,t,"last");
},renderMainProdOffer:function(v){var t=this;var u=unieap.byId("mainProdOfferPane").containerNode;this.removeAllServiceCardWidgets();if(this.mainProdOfferWidget){this.mainProdOfferWidget.destroyRecursive();
this.mainProdOfferWidget=null;}this.mainProdOfferWidget=new this.mainProdOfferWidgetClass({});dojo.place(this.mainProdOfferWidget.domNode,u,"first");t.renderMainProdOfferAttr(t.getMainProdOfferInfo());
},getMainProdOfferInfo:function(){return{prodOfferInfoVO:$ac$.get("selectedMainProdOfferInfoVO")||a.ProdOfferHelper.getMainProdOffer($ac$.get("prodOfferList"))[0],prodOfferInstVO:null};},getProdOfferList:function(x,w,v,t){var w=w||"";
var u=a.ServiceFactory.getService("url:orderDetailAction.do?method=doGetProdOfferList&prodOfferId="+x,t);if(!t){dojo.global.$appContext$.set("prodOfferList"+w,u);}},showSubProdOfferCart:function(t){t.showSelectDefaultProdOffer();
},renderMainProdOfferAttr:function(v){var t=this;this.mainProdOfferDetailData=null;if(this.mainProdOfferDetailWidget){this.mainProdOfferDetailWidget.destroyRecursive();}var u=new g(this);u.initProdOfferDetail({subProdOfferInfo:v.prodOfferInfoVO,prodOfferInst:v.prodOfferInstVO,config:$ac$.mainProdOfferInstVO!=null?$ac$.get("offerStandardStartDate_"+$ac$.mainProdOfferInstVO.prodOfferInstId):""});
this.mainProdOfferDetailWidget=u.prodOfferDetailWidgetList["main-"+v.prodOfferInfoVO.prodOfferId];},renderSubProdOffer:function(w){var y=w.mainProdOfferId,x=w.uniqueId||"",v=unieap.byId("subProdOfferTreeContainer"+x),t=this;
if(v.subProdOfferTree){v.subProdOfferTree.destroyRecursive();}v.subProdOfferTree=a.WidgetProvider.getSubProdOfferTree({id:"subProdOfferTree"+x,url:t.buildSubProdOfferTreeURL(y,x)});var u=!!unieap.byId("subProdOfferTreePane"+x)?unieap.byId("subProdOfferTreePane"+x).containerNode:dojo.byId("subProdOfferTreePane"+x);
dojo.place(v.subProdOfferTree.domNode,u,"first");t.personalSubProdOffer(3,y,x);},renderSubProdOfferOrderGrid:function(x){var y=!!x&&!!x.uniqueId?x.uniqueId:"";var w=unieap.byId("subProdOfferTreeContainer"+y);
var u=this;if(w.subProdOfferOrderGrid){w.subProdOfferOrderGrid.destroyRecursive();}var t=new BusCard.widget.grid.ColumnModel({metaData:u.getSubProdOfferColumns()});var v=new BusCard.widget.grid.DataSource([],t);
w.subProdOfferOrderGrid=new u.subProdOfferOrderGridClass({cm:t,ds:v},unieap.byId("subProdOfferCart"+y).containerNode);unieap.byId("subProdOfferCart"+y).paneNode.style.overflow="auto";},initSubProdOfferCartDataProvider:function(){this.subProdOfferCartDataProvider=new l(this);
},getSubProdOfferColumns:function(){var z=function(A,C){var B=this.getDataSource().getRawData()[C];B.rowIndex=C;return j.SubProdOfferHelper.createSubProdOfferDetail(C,B);};var x=function(A,C){var B=this.getDataSource().getRawData()[C];
return j.SubProdOfferHelper.createSubProdOfferStartDate(C,B);};var w=function(A,C){var B=this.getDataSource().getRawData()[C];return j.SubProdOfferHelper.createSubProdOfferEndDate(C,B);};var v=function(A,C){var B=this.getDataSource().getRawData()[C];
return j.SubProdOfferHelper.createSubProdOfferServiceIdList(C,B);};var y=function(A,C){var B=this.getDataSource().getRawData()[C];return j.SubProdOfferHelper.createSubProdOfferStatus(C,B);};var u=function(A,C){var B=this.getDataSource().getRawData()[C];
return j.SubProdOfferHelper.createSubProdOfferCollect(C,B);};var t=function(A,C){var B=this.getDataSource().getRawData()[C];return j.SubProdOfferHelper.createSubProdOfferDelView(C,B);};return cm=[{width:"28%",name:"prodOfferName",text:"可选销售品",render:z,cssClass:"tableHeader"},{width:"12%",name:"startDate",text:"开始时间",render:x,cssClass:"tableHeader"},{width:"12%",name:"endDate",text:"结束时间",render:w,cssClass:"tableHeader"},{width:"7%",name:"orderStatus",text:"订购状态",render:y,cssClass:"tableHeader"},{width:"20%",name:"serviceIdList",text:"使用号码",render:v,cssClass:"tableHeader"},{width:"6%",name:"prodOfferCollect",text:"收藏",render:u,cssClass:"tableHeader"},{width:"6%",name:"prodOfferDelView",text:"删除",render:t,cssClass:"tableHeader"}];
},initMultipleSubProdOfferHandler:function(){this.multipleSubProdOfferHandler=new orderaccept.prodofferaccept.loader.MultipleSubProdOfferHandler(this);},changeMainProdOffer:function(v){var t=this;var u=true;
u=t.orderGroupProductCheck(v);if(!u){return;}if(t.mainProdOfferId==v){h.alert({busiCode:"08410156"});return false;}else{this.mainProdOfferId=v;this.renderShoppingCart();}},prepareShoppingCartInitData:function(){return{prodOfferInfoVO:$ac$.get("currentMainProdOfferInfoVO")};
},renderShoppingCart:function(){var t=this;if(this.shoppingCartWidgetInstance){this.shoppingCartWidgetInstance.destroyRecursive();}this.route("spring:innerInterfaceBO/getProdOfferInfo",[{prodOfferId:t.mainProdOfferId,interfaceType:4,commonRegionId:t.getBelongCode()},function(u){$ac$.set("currentMainProdOfferInfoVO",u);
t.shoppingCartWidgetInstance=new t.ShoppingCartWidgetClass(t.prepareShoppingCartInitData());dojo.place(t.shoppingCartWidgetInstance.domNode,unieap.byId("shoppingCartPane").containerNode,"first");}]);},beginOrder:function(w){try{a.navigatorManager.to("prodOfferAcceptPane")(function(){dojo.byId("function-navigator-root").style.display="block";
});this.removeResourcesBinding();this.selectedProdOfferId=w;var t=this;t.renderMainProdOffer(w);t.openProdOfferAcceptPane();t.recoveryOrderInfo();var u=function(){t.multipleSubProdOfferHandler.doMultipleSubProdOfferFilter(w);
t.renderPromotionTree(w);t.reRenderingPromotionCart();t.closeMainProdOfferAcceptPane();};setTimeout(function(){t.addAllServiceCardWidgets(u);},1);}catch(v){BusCard.showErrorStack(v);this.clear();throw v;
}},recoveryOrderInfo:function(){var w=BusCard.jsonPath(dojo.global.$appContext$.get("userHasProdOfferInfoList")||[],"$[*].prodInstList[?(@.serviceRelationVO!=null)]");if(w&&w.length>0){var y=this.orderInfoCardWidget.busCardInstance.$("leaveWord");
if(y&&!!w[0].serviceRelationVO.note){y.value=w[0].serviceRelationVO.note;}}if(this.declaredClass=="orderaccept.prodofferaccept.loader.ProdOfferNewLoader"){var u=dojo.query(".main-product-basic",this.mainProdOfferWidget.domNode);
var v="0";if(!!u&&u.length>1){v="1";}else{if(!!u&&u.length==1){var x=dojo.attr(u[0],"serviceKind");if(x=="8"||x=="70"||x=="98"||x=="68"||x=="12"){v="1";}}}var t=this.orderInfoCardWidget;t=t&&t.busCardInstance;
if(!!t&&!!t.$("developerDealer")&&t.$("developerDealer").getAttribute("isnull")){this.orderInfoCardWidget.busCardInstance.$("developerDealer").setAttribute("isnull",v);var z=t.$("label_developerDealer");
if(!!z){var A=dojo.query(".formRequested",z)[0];if(v=="0"){if(!!A){A.style.display="";}else{dojo.place('<span class="formRequested">*</span>',dojo.query(".buscard-label",z)[0],"first");}}else{if(!!A){A.style.display="none";
}}}}}},reRenderingPromotionCart:function(){var t=this;if(t.promotionCartDataProvider){t.promotionCartDataProvider=null;}t.promotionCartDataProvider=new k(t);t.promotionCartDataProvider.showOrderedPromotion();
},closeMainProdOfferAcceptPane:function(){var t=unieap.byId("mainProdOfferSelectPane");t&&t.open&&t.toggle();},closePromotionAcceptPane:function(){var t=unieap.byId("promotionPane");if(t&&t.open){t.toggle();
}},clear:function(u){if(!u){if(this.mainProdOfferWidget){this.mainProdOfferWidget.destroyRecursive();this.mainProdOfferWidget=null;}if(this.mainProdOfferDetailWidget){this.mainProdOfferDetailWidget.destroyRecursive();
this.mainProdOfferDetailWidget=null;}this.mainProdOfferId=null;}var t=unieap.byId("subProdOfferPane");t.destroyDescendants();this.subProdOfferOrderGrid=null;this.subProdOfferTree=null;},removeResourcesBinding:function(){$ac$.empty(this.globalLifeCycleProperties);
$wmc$.empty();if(!!dojo.getObject("ordermgr.accept.compnew")){var t=dojo.getObject("ordermgr.accept.compnew");!!t._cdma_number_elem_list_?t._cdma_number_elem_list_=[]:null;!!t._pstn_number_elem_list_?t._pstn_number_elem_list_=[]:null;
!!t._xdsl_number_elem_list_?t._xdsl_number_elem_list_=[]:null;!!t._other_number_elem_list_?t._other_number_elem_list_=[]:null;!!t._coupon_no_list_?t._coupon_no_list_=[]:null;}},renderProdOfferFavorite:function(){var t=this;
t.standardCount=6;t.hotProdOffer();t.renderPeddleProdOffer();t.personalProdOffer();},renderPeddleProdOffer:function(){var t=this;var u="method=getPeddleProdList&belongCode="+t.getBelongCode()+"&custType="+t.requestParam.customerData.custType+t.appendOfferFilterParameters();
a.ServiceFactory.getService("url:prodOfferQueryAction.do?"+u,function(x){if(x&&(x.length>t.standardCount)){var w=Array.prototype.slice.apply(x);x=w.slice(0,t.standardCount);var v=w.slice(t.standardCount);
dojo.global.$appContext$.set("_morePeddleProdOfferList",v);}dojo.global.$appContext$.set("_peddleProdOfferList",x);if(t.peddleProdOfferListWidgetInstance){t.peddleProdOfferListWidgetInstance.destroyRecursive();
}t.peddleProdOfferListWidgetInstance=new t.peddleProdOfferListWidgetClass();dojo.place(t.peddleProdOfferListWidgetInstance.domNode,unieap.byId("peddleProdOfferResult").containerNode,"last");if(dojo.global.$appContext$.get("_morePeddleProdOfferList")){dojo.byId("peddleProdOfferMoreHref").style.display="block";
}});},hotProdOffer:function(){var t=this;var u="method=getHotProdList&belongCode="+this.getBelongCode()+"&cityCode="+t.requestParam.customerData.cityCode+this.appendOfferFilterParameters();a.ServiceFactory.getService("url:prodOfferQueryAction.do?"+u,function(w){if(w&&(w.length>t.standardCount)){var v=Array.prototype.slice.apply(w);
w=v.slice(0,t.standardCount);var x=v.slice(t.standardCount);dojo.global.$appContext$.set("_moreHotProdOfferList",x);}dojo.global.$appContext$.set("_hotProdOfferList",w);if(t.hotProdOfferListWidgetInstance){t.hotProdOfferListWidgetInstance.destroyRecursive();
}t.hotProdOfferListWidgetInstance=new t.hotProdOfferListWidgetClass();dojo.place(t.hotProdOfferListWidgetInstance.domNode,unieap.byId("hotProdOfferResult").containerNode,"last");if(dojo.global.$appContext$.get("_moreHotProdOfferList")){dojo.byId("hotProdMoreHref").style.display="block";
}});},personalProdOffer:function(u,w){var t=this;t.standardCount=ConstantsPool.load("OfferDisPlayCountConst").OfferDisPlayCountConst.MAINPRODOFFERCOUNT;var v="method=getPersonalCollectProdOffer&prodOfferType=1";
v+="&mainProdOfferId=0"+t.appendOfferFilterParameters();a.ServiceFactory.getService("url:prodOfferSaleAjaxAction.do?"+v,function(z){if(z&&(z.length>t.standardCount)){var y=Array.prototype.slice.apply(z);
z=y.slice(0,t.standardCount);var x=y.slice(t.standardCount);dojo.global.$appContext$.set("_morePersonalProdOfferList",x);}dojo.global.$appContext$.set("_personalProdOfferList",z);if(t.personalCollectListWidgetInstance){t.personalCollectListWidgetInstance.destroyRecursive();
}t.personalCollectListWidgetInstance=new t.personalCollectListWidgetClass();dojo.place(t.personalCollectListWidgetInstance.domNode,unieap.byId("personalCollectResult").containerNode,"last");if(dojo.global.$appContext$.get("_morePersonalProdOfferList")){dojo.byId("pcProdMoreHref").style.display="block";
}});},personalSubProdOffer:function(C,y,x){var B=this;B.standardSubCount=ConstantsPool.load("OfferDisPlayCountConst").OfferDisPlayCountConst.SUBPRODOFFERCOUNT;var A=[];if(!!$ac$.get("_allowProdOfferIds_"+y)){A=$ac$.get("_allowProdOfferIds_"+y);
}else{var v="prodOfferId="+y+"&accProdListStr="+(B.getAccProdIdList(x)||"")+"&method=getSubProdOfferInfoByName";A=a.ServiceFactory.getService("url:shoppingCartAction.do?"+v);$ac$.set("_allowProdOfferIds_"+y,A);
}if(!!$ac$.get("_allSubProdOffers_")){var t=[];var w=0;var u=false;BusCard.each($ac$.get("_allSubProdOffers_")||[],function(D){if(dojo.some(A||[],function(E){return E.prodOfferId==D.prodOfferId;})){w++;
if(w>B.standardSubCount){u=true;return false;}t.push(D);}});dojo.global.$appContext$.set("_personalSubProdOfferList"+x,t);if(B.personalSubCollectListWidgetInstanceMap[x]){B.personalSubCollectListWidgetInstanceMap[x].destroyRecursive();
}var z=new B.personalSubCollectListWidgetClass({uniqueId:x});B.personalSubCollectListWidgetInstanceMap[x]=z;dojo.place(z.domNode,unieap.byId("subProdOfferPersonalCollectResult"+x).containerNode,"last");
if(u){dojo.byId("pcSubProdMoreHref"+x).style.display="block";}}},dodealPersonalSubProdOffer:function(){},showMoreProdOffer:function(t){dojo.byId(t.name).style.display=(dojo.byId(t.name).style.display=="block")?"none":"block";
dojo.byId(t).innerHTML=(dojo.byId(t).text=="更多>>")?"隐藏<<":"更多>>";},openProdOfferAcceptPane:function(u){var t=u||["mainProdOfferPane","orderInfoPane"];dojo.forEach(t,function(v){var w=unieap.byId(v);if(w&&!w.open){w.toggle();
}});},renderBelongCode:function(){var t=this;BusCard.$rs(dojo.byId("common-belongcode"),this.requestParam.regionCodeColl.list);var u=dojo.some(t.requestParam.regionCodeColl.list||[],function(v){return v.id==BusCard.$session.areaId;
});if(u){dojo.byId("common-belongcode").value=BusCard.$session.areaId;}},addServiceCardWidget:function(v,D,I,z,w){var C=this,A=dojo.query("[uniqueId="+v+"]",this.mainProdOfferWidget.domNode)[0],x=A,K=this,D=D||function(){},v=dojo.attr(A,"uniqueId"),J=dojo.attr(A,"viewId"),u=C.getServiceOfferConfigVO(a.ACTION_CD_CONST.PRODUCT_INSTALL).serviceOfferId;
while(true){x=x.nextSibling;if(x&&(x.tagName||"").toUpperCase()=="TR"){break;}}var E=dojo.attr(A,"productId")||dojo.query("SELECT",A)[0].value,t=this.getBelongCode();var y={productId:E,uniqueId:v,serviceOfferId:u,cityCode:this.requestParam.customerData.cityCode,belongCode:t,regionId:t,userId:0,regionKind:4};
var G=D(A,y);if(z){return y;}var H="serviceCardWidget_"+v,F=new this.serviceCardWidgetClass({cardParam:y,metaData:{uniqueId:v,id:H},extendData:G||{}});this.serviceCardWidgetMap[H]=F;F.addCardCallback(function(){var L=K.addProdAttrCardWidget(F);
if(L){this.attrCardWidget=L;}});F.addCardCallback(function(){var M=C._findProperMemProdOfferByUniqueId(y.uniqueId);if(!M||M.action!="quit"){var L=K.addServiceProdCardWidget(F);if(L){this.serviceProductWidget=L;
}}});if(I){F.addCardCallback(I);}F.addCardCallback(function(){this.completeRequiredState();});F.renderCard(dojo.query(".mainProdServiceInfo-"+J,x)[0],"first",w);var B=new BusCard.messaging.Subscriber();
B.subscribe("/message/raiseSpeed"+v);B.subscribe("/message/raiseSpeedHandleByCancelOld"+v);B.subscribe("/message/decreaseSpeedHandleByCancelOld"+v);B.receive=function(M){var N=dojo.getObject("_temp.getObjectMap"+v,true);
if(!!N.rateRelSubProdOfferArray){N.rateRelSubProdOfferArray.push(M);}else{var L=[];L.push(M);N.rateRelSubProdOfferArray=L;}};},_findProperProdOfferByUniqueId:function(t){return $ac$.get("selectedMainProdOfferInfoVO");
},_findProperMemProdOfferByUniqueId:function(u){var t=$ac$.get("selectedMemberProdOfferList");return dojo.filter(t,function(v){return v.uniqueId==u;})[0];},_findProperProduct4AttrCardWidget:function(u,t,v){return a.ProdOfferHelper.getProductById(u,t);
},addProdAttrCardWidget:function(w,v){var z=this._findProperProdOfferByUniqueId(w.metaData.uniqueId);var y=w.getModel().cardParam.productId;var x=w.getModel().cardParam.serviceOfferId;var u=this._findProperProduct4AttrCardWidget(z,y,w.metaData.uniqueId);
var t=new this.productAttrCardWidgetClass(dojo.mixin({uniqueId:w.metaData.uniqueId,productId:y,serviceOfferId:x,productInfoVO:u,prodOfferInfoVO:z},w.getModel().extendData.attrCardBindingData||{}));if(t.needRendering){if(v){t.addCardCallback(v);
}t.busCardInstance.setParent(w.busCardInstance);t.renderCard(w.busCardInstance.dom.parentNode,"last");return t;}},addServiceProdCardWidget:function(u){var w=this._findProperMemProdOfferByUniqueId(u.metaData.uniqueId);
var v=u.getModel().cardParam.productId;var y="&prodOfferId="+w.prodOfferId+"&productId="+v;var x=a.ServiceFactory.getService("url:orderDetailAction.do?method=doGetServiceProdList"+y);if(!!x&&x.length>0){var t=new this.serviceProductWidgetClass({prodOfferInfoVO:w,productId:v,serviceProdList:x,serviceCardWidget:u,prodOfferInst:!!w.offerInstVO?w.offerInstVO:null});
u.serviceProductWidget=t;dojo.place(t.domNode,u.busCardInstance.dom.parentNode,"last");$ac$.set("serviceProdList-"+u.metaData.uniqueId,x);}},removeServiceCardWidget:function(v){var t=this.serviceCardWidgetMap["serviceCardWidget_"+v];
if(t){t.destroyRecursive();try{delete this.serviceCardWidgetMap["serviceCardWidget_"+v];}catch(u){}}},removeAllServiceCardWidgets:function(){for(var t in this.serviceCardWidgetMap){if(this.serviceCardWidgetMap[t].declaredClass){this.serviceCardWidgetMap[t].destroyRecursive();
try{delete this.serviceCardWidgetMap[t];}catch(u){}}}},generatorComboRequest:function(u){var t=dojo.query(".main-product-basic",this.mainProdOfferWidget.domNode),v=this,x={},w=dojo.map(t,function(A){var D=dojo.attr(A,"uniqueId");
var C="buscardCallback_"+D;dojo.global[C]=function(E){return v.addServiceCardWidget(D,null,null,false,E);};var B=v.addServiceCardWidget(D,null,null,true);var z=BusCard.toJson(B);var y={};y.jsonpCallback=C;
y.method="showBusCardPage";y.jsonData=z;return BusCard.path.initPath+"?"+BusCard.buildParam(y);});if(v.jsonpRequest){if(dojo.isIE){BusCard.ScriptLoader.load(w,function(){u=u||BusCard.util.emptyFunction;
u();},true);}else{BusCard.ScriptLoader.asynLoad(w,function(){u=u||BusCard.util.emptyFunction;u();},true);}}else{dojo.map(t,function(y){var z=dojo.attr(y,"uniqueId");return x[""+z]=v.addServiceCardWidget(z,null,null,true);
});BusCard.doPost(BusCard.path.initPath+"?method=comboRequest",x,true,function(B){for(var A in B){var z=0;var y=function(C){return function(){v.addServiceCardWidget(C,null,null,false,B[C]);};}(A);if(dojo.isIE){setTimeout(y,1000*(z++));
}else{y();}}u=u||BusCard.util.emptyFunction;u();});}},addAllServiceCardWidgets:function(u){if(this.comboServiceCardRequest){return this.generatorComboRequest(u);}var t=dojo.query(".main-product-basic",this.mainProdOfferWidget.domNode),v=this;
dojo.forEach(t,function(w){v.addServiceCardWidget(dojo.attr(w,"uniqueId"));});u=u||BusCard.util.emptyFunction;u();},getNewServiceInfoList:function(u){var z=this,x=[],z=this,C=z.getServiceOfferConfigVO(a.ACTION_CD_CONST.PRODUCT_INSTALL).serviceOfferId,F=z.getServiceOfferConfigVO(a.ACTION_CD_CONST.PRODUCT_CHANGE).serviceOfferId;
for(var G in this.serviceCardWidgetMap){var y=this.serviceCardWidgetMap[G],v=y.busCardInstance,D=v.$("serviceId"),E=v.getCardRelationInfo();if(!D){continue;}if(E.serviceOfferId==F){}if(function(){return !dojo.query("[uniqueId="+/_(.*?)$/.exec(G)[1]+"] .main-product-check",z.mainProdOfferWidget.domNode)[0].checked;
}()){continue;}if(!u&&D){var t=v.checkNotNull(D.parentNode);if(t===false){return false;}}var w=a.ProdOfferHelper.getProductById(dojo.global.$appContext$.get("prodOfferList"),E.productId);if(!w){var B=E.uniqueId;
if(B){var A=$ac$.get("prodOfferList"+B)||[];w=a.ProdOfferHelper.getProductById(A,E.productId);}if(!w){w=a.ServiceFactory.getService("url:orderDetailAction.do?method=getProductDetail&productId="+E.productId);
}}x.push(dojo.mixin(v.getData(null,null,true),{productName:w.productName,productId:E.productId,serviceId:D.value,netType:w.netType}));}return x;},renderPayRelationHandle:function(){var t=this;t.beginOrder&&(function(){var u=t.beginOrder;
t.beginOrder=function(){try{!this.payRelationWidgetInstance&&this.renderPayRelationHandle();}catch(v){h.alert({message:"\u521d\u59cb\u5316\u652f\u4ed8\u5173\u7cfb\u5931\u8d25"});}return u.apply(this,arguments);
};}());},renderPayRelation:function(){var u=unieap.byId("payRelationPane"),t=this;this.payRelationWidgetInstance=new this.payRelationWidgetClass({custInfo:dojo.global.$appContext$.get("requestParam").customerData,serviceInfoList:[],loader:t,widgetPane:u});
dojo.place(this.payRelationWidgetInstance.domNode,u.containerNode,"first");this.enableRefreshableForPayRelation();u.onExpand=function(){t.refreshPayRelationOnExpandPane();};},enableRefreshableForPayRelation:function(){var u=unieap.byId("payRelationPane").buttonContainerNode,v=BusCard.path.contextPath+"/common/images/icon/refresh_icon.png",t=this;
u.style.display="";u.innerHTML="<a style='vertical-align:top;color:#00577F' id='refresh-payRelation-href'><span>\u5237\u65b0</span><img src='"+v+"' style='width:16px;height:16px'/></a>";u.style.width="50px";
u.style.paddingTop="5px";dojo.connect(dojo.query("[id=refresh-payRelation-href]",u)[0],"onclick",function(w){w.preventDefault();return t.refreshPayRelation(false);});},refreshPayRelation:function(v){var t=this,u=t.getNewServiceInfoList(v);
if(u===false||!u||u.length==0){return false;}else{t.payRelationWidgetInstance.refreshServiceInfo(u,t.getNewServiceInfoList);}},refreshPayRelationOnExpandPane:function(){var t=this.payRelationWidgetInstance.isNeedInit();
if(t){this.refreshPayRelation(true);}},_orderInfoCallback:function(t){var u=t.getCustOrderId();if(!(u==""||u==null)){this.busCardInstance.renderDefaultValue(BusCard.$remote("custOrderBasicInfoDAO").queryNormalTB({custOrderId:u})[0]);
}},_viaInfoCallback:function(t){var u=t.getCustOrderId();if(!(u==""||u==null)){this.busCardInstance.renderDefaultValue(BusCard.$remote("custOrderBasicInfoDAO").queryNormalTB({custOrderId:u})[0]);}},initOrderInfoWidget:function(){this.orderInfoCardWidget=new f({cardParam:{productId:"-999",serviceOfferId:"-999"},metaData:{id:"orderInfoCardWidget"}});
var t=this;this.orderInfoCardWidget.addCardCallback(function(){this.busCardInstance.hiddenTitle();if($ac$.requestParam.actionCD!=a.ACTION_CD_CONST.PRODUCT_INSTALL){this.busCardInstance.$("batchFlag").style.display="none";
this.busCardInstance.$("label_batchFlag").style.display="none";}dojo.query(".buscard-root",this.busCardInstance.dom)[0].style.border="none";return t._orderInfoCallback.apply(this,[t]);});this.orderInfoCardWidget.renderCard(unieap.byId("orderInfoPane").containerNode,"first");
},initViaInfoWidget:function(){this.viaInfoCardWidget=new f({cardParam:{productId:"-111",serviceOfferId:"-100"},metaData:{id:"viaInfoCardWidget"}});var t=this;this.viaInfoCardWidget.addCardCallback(function(){this.busCardInstance.hiddenTitle();
dojo.query(".buscard-root",this.busCardInstance.dom)[0].style.border="none";return t._viaInfoCallback.apply(this,[t]);});this.viaInfoCardWidget.renderCard(unieap.byId("viaInfoPane").containerNode,"first");
},initDataBuilder:function(){this.dataBuilder=new orderaccept.prodofferaccept.data.ProdOfferNewDataBuilder(this);},initSpecialDataBuilder:function(){this.specDataBuilder=new orderaccept.prodofferaccept.data.SpecialDataHandler(this);
},initFunctionNavigatorWidget:function(){this.functionNavigatorWidget=new this.functionNavigatorWidgetClass();dojo.place(this.functionNavigatorWidget.domNode,dojo.byId("function-navigator-root"),"last");
},initTipsWidgets:function(){this.prodOfferInfoWidget=new this.prodOfferInfoTipsWidgetClass({id:"prodOfferInfoTips",noCloseBtn:true});this.warmTipesWidget=new this.warmTipesWidgetClass({id:"warmTips",noCloseBtn:true});
this.collectTipsWidget=new this.collectTipsWidgetClass({id:"collectTips",noCloseBtn:true});this.prodOfferAcceptTipsWidget=new this.prodOfferAcceptTipsWidgetClass({id:"acceptTips"});},initAdvanceSearchWidget:function(){this.renderAdvancedSearch();
this.advanceSearchWidget=new this.advanceSearchWidgetClass({id:"advanceSearchTip",noCloseBtn:false});},renderAdvancedSearch:function(){var u=unieap.byId("BorderPane").titleText;var t="<a href='javascript:void(0);' id='prodOfferAdvancedSearch' style='float:right;font-weight:normal' 												dojoAttachEvent='onclick:elementclick' dojoAttachTopic='/prodOfferOpenAdvanceSearch'>高级查询</a>										 <img id='prodOfferAdvancedSearchImg' name='prodOfferAdvancedSearchImg'	                						dojoAttachEvent = 'onclick:elementclick'	                						dojoAttachTopic = '/prodOfferOpenAdvanceSearch'											src='"+BusCard.path.contextPath+"/common/images/icon/search_button.png'											style='float:right;cursor: pointer; width: 15px; height: 15px;' /> ";
dojo.place(t,u,"last");var w=dojo.byId("prodOfferAdvancedSearch");var v=dojo.byId("prodOfferAdvancedSearchImg");dojo.connect(w,"onclick",function(){return dojo.publish("/prodOfferOpenAdvanceSearch/click",arguments);
});dojo.connect(v,"onclick",function(){return dojo.publish("/prodOfferOpenAdvanceSearch/click",arguments);});},initBatchNewWidget:function(){this.batchNewWidget=new this.batchNewWidgetClass();},_doLayoutMend:function(){var u=this;
var v=unieap.byId("BorderPane");if(v){v.containerNode.style.height="auto";dojo.connect(v,"resize",function(){this.containerNode.style.height="auto";});}var t=unieap.byId("promotionPane");if(t){t.promotionFirstRefresh=false;
dojo.connect(t,"onExpand",function(){if(!t.promotionFirstRefresh){u.renderPromotion(u.mainProdOfferId);t.promotionFirstRefresh=true;}});}},addIconForQuickAccept:function(){var v=unieap.byId("hotProdOfferResult"),w=unieap.byId("peddleProdOfferResult"),t=unieap.byId("personalCollectResult"),x=BusCard.path.contextPath,u={personalCollectResult:x+"/common/images/icon/favorites_icon.png",hotProdOfferResult:x+"/common/images/icon/hot_icon.png",peddleProdOfferResult:x+"/common/images/icon/recommend_icon.png"};
dojo.forEach(["hotProdOfferResult","peddleProdOfferResult","personalCollectResult"],function(y){var z=unieap.byId(y+"_button");if(z){z.titleNode.style.cursor="pointer";z.iconNode.style.verticalAlign="top";
z.iconNode.src=u[y];}});},initGlobalHelper:function(){var t=this;(function(){var v=document.createElement("span");v.style.styleFloat=v.style.cssFloat="right";v.innerHTML="<input type='button' class='userAccountButton'  style='margin-left:10px;cursor:pointer;' id='accNbr-Link' value='客户管理账号'> <span style='cursor:pointer;color:#2B2B2B' id='manageNbrInfo' style='margin-left:3px;'>[未选择管理账号]</span>&nbsp;";
unieap.byId("orderInfoPane").titleNode.appendChild(v);if($ac$.requestParam.actionCD==a.ACTION_CD_CONST.PRODUCT_INSTALL){var x=a.ProdOfferHelper.getManageAccNbrInfo();if(x==null){dojo.connect(dojo.byId("accNbr-Link"),"onclick",function(B){var A=new t.manageAccNbrWidgetClass();
orderaccept.custom.popup.open({widget:{popup:A,around:B.srcElement}});});var u=a.ProdOfferHelper.getManageAccNbrTemp(t.getCustOrderId());if(u!=null){var z=BusCard.Template.create("[<span name='accNbrResult' targetUniqueId='#{uniqueId}' value='#{serviceId}' serviceId='#{serviceId}' prodInstId ='#{prodInstId}' serviceKind='#{serviceKind}' serviceKindIndex='#{serviceKindIndex}'>#{serviceId}</span>]");
dojo.byId("manageNbrInfo").innerHTML=z.apply(u);}}else{var z=BusCard.Template.create("[<span name='accNbrResult' value='#{serviceId}' ifCreateAcc=1 serviceId='#{serviceId}' userId ='#{userId}'>#{serviceId}</span>]");
dojo.byId("manageNbrInfo").innerHTML=z.apply(x);}}else{dojo.query(".userAccountButton")[0].style.display="none";dojo.byId("manageNbrInfo").style.display="none";}var w=unieap.byId("mainProdOfferPane").buttonContainerNode;
w.style.display="";w.style.width="80px";w.style.paddingTop="5px";w.style.paddingRight="10px";w.innerHTML="<span style='cursor:pointer;' id='mainprodoffer-title'>温馨提示<img src='"+BusCard.path.contextPath+"/common/images/icon/information-balloon.png'/></span>";
dojo.connect(dojo.byId("mainprodoffer-title"),"onmouseover",function(B){var C=unieap.byId("warmTips");var A="<div class='buscard-row' >												单击【放大镜图标】选择已有号码，单击【销售品详情】设置销售品信息											</div>";dojo.query(".buscard-content",C.containerNode)[0].innerHTML=A;
orderaccept.custom.popup.open({widget:{popup:C,around:B.currentTarget}});});dojo.connect(dojo.byId("mainprodoffer-title"),"onmouseout",function(A){var B=unieap.byId("warmTips");orderaccept.custom.popup.close({widget:B});
});var y=unieap.byId("subProdOfferPane").buttonContainerNode;y.style.display="";y.style.width="135px";y.style.paddingTop="5px";y.style.paddingRight="10px";y.innerHTML="<span><span style='cursor:pointer;' id='subprodoffer-detail'>操作详情|</span><span style='cursor:pointer;' id='subprodoffer-title'>温馨提示<img src='"+BusCard.path.contextPath+"/common/images/icon/information-balloon.png'/></span><span>";
dojo.connect(dojo.byId("subprodoffer-detail"),"onclick",function(D){var H=[];var C=[];var J=[];var B=t.multipleSubProdOfferHandler.subProdOfferOrderProviderMap;for(var F in B){var I=B[F];var N=I.getSubGridBindingData();
var L=I.subProdOfferOrderGrid;dojo.forEach(N,function(O){var P=O.rowIndex;if((O.showData.prodOfferStyle=="prod-offer-add")&&dojo.query(".subProdOfferDetail-"+P,L.domNode)[0].childNodes[0].checked){H.push({prodOfferName:O.subProdOfferInfo.prodOfferName,prodOfferStyle:O.showData.prodOfferStyle});
}else{if(O.prodOfferInst!=null&&dojo.query(".subProdOfferDetail-"+P,L.domNode)[0].childNodes[0].checked){J.push({prodOfferName:O.subProdOfferInfo.prodOfferName,prodOfferStyle:O.showData.prodOfferStyle});
}else{if(O.prodOfferInst!=null&&!(dojo.query(".subProdOfferDetail-"+P,L.domNode)[0].childNodes[0].checked)){C.push({prodOfferName:O.subProdOfferInfo.prodOfferName,prodOfferStyle:O.showData.prodOfferStyle});
}}}});}var K=unieap.byId("acceptTips");var A="",E="",G="";dojo.forEach(H,function(P,O){A+="<span class='prod-offer-add' style='float:left'>【"+P.prodOfferName+"】</span>";});dojo.forEach(J,function(P,O){if(P.prodOfferStyle=="prod-offer-change"){E+="<div class='prod-offer-change' style='float:left'>【"+P.prodOfferName+"】</div>";
}else{if(P.prodOfferStyle=="prod-offer-reserve"){E+="<div class='prod-offer-reserve' style='float:left'>【"+P.prodOfferName+"】</div>";}}});dojo.forEach(C,function(P,O){if(P.prodOfferStyle=="prod-offer-del"){G+="<div class='prod-offer-del' style='float:left'>【"+P.prodOfferName+"】</div>";
}else{if(P.prodOfferStyle=="prod-offer-reserve"){G+="<div class='prod-offer-reserve' style='float:left'>【"+P.prodOfferName+"】</div>";}}});dojo.query("[id='prod-offer-add-count']",K.containerNode)[0].innerHTML=H.size();
dojo.query("[id='prod-offer-change-count']",K.containerNode)[0].innerHTML=J.size();dojo.query("[id='prod-offer-del-count']",K.containerNode)[0].innerHTML=C.size();var M=dojo.query("[id='prod-offer-add-detail']",K.containerNode)[0];
dojo.query("[id='prod-offer-add-detail']",K.containerNode)[0].innerHTML=A;dojo.query("[id='prod-offer-change-detail']",K.containerNode)[0].innerHTML=E;dojo.query("[id='prod-offer-del-detail']",K.containerNode)[0].innerHTML=G;
orderaccept.custom.popup.open({widget:{popup:K,around:D.currentTarget}});});dojo.connect(dojo.byId("subprodoffer-title"),"onmouseover",function(B){var C=unieap.byId("warmTips");var A="<div class='buscard-row' >												<span class='prod-offer-change'>&nbsp;&nbsp;&nbsp;</span>												<span>已有:用户已有的可选包</span>											</div>											<div class='buscard-row'>												<span class='prod-offer-del' >&nbsp;&nbsp;&nbsp;</span>												<span>退订:用户要退订的可选包</span>											</div>											<div class='buscard-row'>												<span class='prod-offer-reserve' >&nbsp;&nbsp;&nbsp;</span>												<span>预约:预约的可选包</span>											</div>											<div class='buscard-row'>												<span class='prod-offer-invalid' >&nbsp;&nbsp;&nbsp;</span>												<span>无效:无效的可选包</span>											</div>											<div class='buscard-row' >												<span class='prod-offer-add' >&nbsp;&nbsp;&nbsp;</span>												<span>订购:用户要订购的可选包</span>											</div>";
dojo.query(".buscard-content",C.containerNode)[0].innerHTML=A;orderaccept.custom.popup.open({widget:{popup:C,around:B.currentTarget}});});dojo.connect(dojo.byId("subprodoffer-title"),"onmouseout",function(A){var B=unieap.byId("warmTips");
orderaccept.custom.popup.close({widget:B});});}());dojo.connect(dojo.byId("display-all-href"),"onclick",function(u){u.preventDefault();t.expandAllPanes();});dojo.connect(dojo.byId("hidden-all-href"),"onclick",function(u){u.preventDefault();
t.hiddenAllPanes();});(function(){var u=unieap.byId("prodOfferAcceptPane");u&&dojo.style(u.titleNode,{color:"Orange",fontSize:"13px"});}());dojo.addOnUnload(function(u){if(!dojo.isIE){t.destroy();}});},expandAllPanes:function(){var u=["mainProdOfferPane","subProdOfferPane","promotionPane","viaInfoPane","orderInfoPane"],t=function(v){dojo.forEach(u,function(w){var x=unieap.byId(w);
if(x){if((v&&!x.open)||(!v&&x.open)){x.toggle();}}});};t(true);},hiddenAllPanes:function(){var u=["mainProdOfferPane","subProdOfferPane","promotionPane","payRelationPane","viaInfoPane","orderInfoPane"],t=function(v){dojo.forEach(u,function(w){var x=unieap.byId(w);
if(x){if((v&&!x.open)||(!v&&x.open)){x.toggle();}}});};t(false);},getServiceOfferConfigVO:function(w){var u="$serviceOfferConfig$";var t=$ac$.get(u);if(!t){t=BusCard.$remote("varServiceOfferConfigDAO").query({productId:-1});
$ac$.set(u,t);}var v=$ac$.query("$."+u+"[?(@.varValue=="+w+")]");return v?v[0]:null;},showOrderList:function(t){dojo.byId("prodoffer-accept-root").style.display="none";dojo.byId("order-show-root").style.display="";
if(this.orderShowLoader){this.orderShowLoader.destroy();}this.orderShowLoader=new q({custOrderId:t});this.functionNavigatorWidget.switchGroup(1);this.setFunctionNavigatorWidgetButton();},showBatchNewAccept:function(){var u=this;
dojo.byId("prodoffer-accept-root").style.display="none";dojo.byId("order-show-root").style.display="";try{if(this.orderShowLoader){this.orderShowLoader._clearDirtyEnv();var t=dojo.byId("budgetContainer");
if(t){if(t.destroyRecursive){t.destroyRecursive();}if(t.destroy){t.destroy();}}}}catch(v){}if(!this.batchNewWidget){this.initBatchNewWidget();dojo.place(u.batchNewWidget.domNode,dojo.byId("order-show-root"),"first");
}this.functionNavigatorWidget.switchGroup(2);this.setFunctionNavigatorWidgetButton();},setFunctionNavigatorWidgetButton:function(){if(!!dojo.global.$appContext$._budgetcomputeAmountFlag_&&dojo.global.$appContext$._budgetcomputeAmountFlag_){dojo.query(".commitOrderClass",this.functionNavigatorWidget.domNode)[0].disabled=false;
var t=dojo.query(".commitOrderClass",this.functionNavigatorWidget.domNode);if(!!t&&!!t[3]){var u=t[3];u.disabled=false;}}},destroy:function(){for(var t in this){if(this[t]&&(this[t].destroyRecursive||this[t].destroy)){(this[t].destroyRecursive||this[t].destroy).apply(this[t],arguments);
}try{if(this.hasOwnProperty(t)){delete this[t];}}catch(u){}}try{delete dojo.global.prodOfferAcceptLoader;}catch(u){}dijit.registry.every(function(w,v){try{w.destroyRecursive();dijit.registry.remove(v);
}catch(x){}});dojo.global.$appContext$.empty();dojo.global.$widgetModelContext$.empty();},findCustRecognitionHeadWin:function(){try{var u=window.opener.top.document.getElementById("subframe").contentWindow.unieap.byId("createTab").getChildren();
var t=dojo.filter(u,function(x){return x.menuId=="841AB";});if(t.length==0){return null;}var w=t[0]._if.contentWindow.document.frames.CustRecognitionContent;return w;}catch(v){return null;}},setCustOrderId2CustRecognitionPage:function(u){try{var t=this.findCustRecognitionHeadWin();
if(t){t.document.getElementById("custOrderId").value=""+u;}}catch(v){if(window.console&&window.console.warn){window.console.warn("Error when invoke ProdOfferNewLoader#setCustOrderId2CustRecognitionPage,"+v.message);
}}},resetShoppingCartCount:function(){var t=this.findCustRecognitionHeadWin();if(!!t){t.cust_Recognition_Head.showShoppingCartOrderCount();}},getCustOrderId:function(){var t=dojo.global.$appContext$.get("requestParam");
if(t.custOrderId){return t.custOrderId;}},renderPromotionTree:function(w){var u=unieap.byId("promotionPane").buttonContainerNode,v=BusCard.path.contextPath+"/common/images/icon/refresh_icon.png",t=this;
u.style.display="";u.innerHTML="<a style='vertical-align:top;color:#00577F' id='refresh-promotion-href'><span>\u5237\u65b0</span><img src='"+v+"' style='width:16px;height:16px'/></a>";u.style.width="50px";
u.style.paddingTop="5px";dojo.connect(dojo.query("[id=refresh-promotion-href]",u)[0],"onclick",function(x){x.preventDefault();t.renderPromotion(w);var y=$ac$.get("refreshPromotionWidget");if(y&&y.domNode.style.display==""){orderaccept.custom.popup.close({widget:y,notHandleData:true});
}});},renderPromotion:function(B){var D=this;var E=[];var w=[];var y=D.getProductIdsAndSubProdOfferIds();E=y.productIdList;w=y.subProdOfferIdList;var v=this.getBelongCode();if(this.promotionTree){this.promotionTree.destroyRecursive();
}this.promotionTree=a.WidgetProvider.getPromotionTree({id:"promotionTree",url:this.buildPromotionTreeURL(w,E,v,B)});var F=!!unieap.byId("PromotionTreePane")?unieap.byId("PromotionTreePane").containerNode:dojo.byId("PromotionTreePane");
dojo.place(this.promotionTree.domNode,F,"first");D.renderPersonalCollectPromotionList(13,w,E,B);this.promotionDetailBuilder=new p(this);var A=unieap.byId("promotionPane");if(A&&!A.open){A.promotionFirstRefresh=true;
A.toggle();}var u=this.salesPromotionOrderGrid;var C=[];var x=u.ds.getRawData();var t=dojo.filter(x||[],function(K){var H=false;var M=[];var J=K.showData.promotionInfo;var L=J.promotionTargetObjectList;
M=L.toArray();for(var I=0;I<M.length;I++){var G=M[I];if(G.targetObjectType==1){H=dojo.some(w||[],function(N){return G.targetObjectId==N.prodOfferId;});if(H){break;}}else{H=dojo.some(E||[],function(N){return G.targetObjectId==N;
});if(H){break;}}}if(!H){return K;}});dojo.forEach(t||[],function(G){u.remove(G.rowIndex);});var z=dojo.filter(x||[],function(G){return !dojo.some(t||[],function(H){return G.rowIndex==H.rowIndex;});});
dojo.forEach(z||[],function(H){D.createTargetObjectNum(H,B);if(H.showData.promotionInstInfo){var I=H.rowIndex;var G=dojo.query("[id=finishPage-"+I+"]",u.domNode)[0];if(G){G.style.display="";}}});},getProductIdsAndSubProdOfferIds:function(){var y=this.mainProdOfferId;
var C=a.ProdOfferHelper.getSelectProductIdList(this.mainProdOfferWidget.domNode);var w=[];var t=this.multipleSubProdOfferHandler.subProdOfferOrderProviderMap;for(var v in t){var x=t[v];var A=x.getSubGridBindingData();
var z=x.subProdOfferOrderGrid;var u=dojo.filter(A,function(D){var E=D.rowIndex;return dojo.query(".subProdOfferDetail-"+E,z.domNode)[0].childNodes[0].checked;});var B=dojo.map(u,function(D){return D.subProdOfferInfo.prodOfferId;
});Array.prototype.push.apply(w,B||[]);}w.push(parseInt(y));return{productIdList:C,subProdOfferIdList:w};},renderPromotionOrderGrid:function(){var u=this;if(u.salesPromotionOrderGrid){u.salesPromotionOrderGrid.destroyRecursive();
}var t=new BusCard.widget.grid.ColumnModel({metaData:u.getPromotionColumns()});var x=new BusCard.widget.grid.DataSource([],t);var w=!!unieap.byId("PromotionCart")?unieap.byId("PromotionCart").containerNode:dojo.byId("PromotionCart");
var v=u.salesPromotionOrderGrid=new u.salesPromotionOrderGridClass({cm:t,ds:x},w);u.promotionCartDataProvider=new k(u);},renderPromotionLayout:function(){var t=this;unieap.byId("promotionPane").destroyDescendants();
unieap.byId("promotionPane").containerNode.innerHTML=BusCard.Template.create(this.promotionContentTemplate).apply({});dojo.parser.parse(unieap.byId("promotionPane").containerNode);t.renderPromotionSearch();
},renderPromotionSearch:function(){var t=new orderaccept.prodofferaccept.widget.commheader.PromotionHeaderWidget();dojo.place(t.domNode,unieap.byId("promotionBorderPan").containerNode,"first");},renderPersonalCollectPromotionList:function(D,u,F,A){var B=this;
var v=ConstantsPool.load("OfferDisPlayCountConst").OfferDisPlayCountConst.MAINPRODOFFERCOUNT;var w="method=getPersonalCollectPromotion&prodOfferType="+D;var t=a.ServiceFactory.getService("url:prodOfferSaleAjaxAction.do?"+w);
var E="method=getSalesPromotionList&prodOfferIdList="+dojo.toJson(u)+"&productIdList="+dojo.toJson(F)+"&mainProdOfferId="+A;var C=a.ServiceFactory.getService("url:orderDetailAction.do?"+E);var x=a.ProdOfferHelper.getProdOfferDetail(A);
t=dojo.filter(t||[],function(H){var G=H.prodOfferId;return dojo.some(C||[],function(I){return I.nodeId>0&&I.nodeId==G;});});if(t&&(t.length>v)){var z=Array.prototype.slice.apply(t);t=z.slice(0,v);var y=z.slice(v);
dojo.global.$appContext$.set("_morePersonalPromotionList",y);}dojo.global.$appContext$.set("_personalPromotionList",t);if(B.personalCollectPromotionListWidgetInstance){B.personalCollectPromotionListWidgetInstance.destroyRecursive();
}B.personalCollectPromotionListWidgetInstance=new B.personalCollectPromotionListWidgetClass();dojo.place(B.personalCollectPromotionListWidgetInstance.domNode,unieap.byId("promotionPersonalCollectResult").containerNode,"last");
if(dojo.global.$appContext$.get("_morePersonalPromotionList")){dojo.byId("pcPromotionMoreHref").style.display="block";}},getPromotionColumns:function(){var w=function(A,C){var B=this.getDataSource().getRawData()[C];
B.rowIndex=C;return o.promotionFormatter.createPromotionNameDetail(C,B);};var v=function(A,C){var B=this.getDataSource().getRawData()[C];return o.promotionFormatter.createPromotionStartDate(C,B);};var t=function(A,C){var B=this.getDataSource().getRawData()[C];
return o.promotionFormatter.createPromotionEndDate(C,B);};var u=function(A,C){var B=this.getDataSource().getRawData()[C];return o.promotionFormatter.createPromotionTargetObject(C,B);};var z=function(A,C){var B=this.getDataSource().getRawData()[C];
B.rowIndex=C;return o.promotionFormatter.createPromotionStatus(C,B);};var y=function(A,C){var B=this.getDataSource().getRawData()[C];return o.promotionFormatter.createPromotionTargetNum(C,B);};var x=function(A,C){var B=this.getDataSource().getRawData()[C];
return o.promotionFormatter.createPromotonCollect(C,B);};return cm=[{width:"25%",name:"prodOfferName",text:"已选促销政策",render:w},{width:"18%",name:"startDate",text:"开始时间",render:v},{width:"18%",name:"endDate",text:"结束时间",render:t},{width:"11%",name:"orderStatus",text:"订购状态",render:z},{width:"10%",name:"effectType",text:"作用类型",render:u},{width:"25%",name:"effectTarget",text:"作用对象",render:y},{width:"6%",name:"promotionCollect",text:"促销收藏",render:x}];
},showSalesPromotionDetail:function(x){var D=this;var w=a.ProdOfferHelper.createSalesPromotionRowData(x);this.salesPromotionOrderGrid.add(w);var A=D.mainProdOfferId;var F=x.promotionTargetObjectList;var C=dojo.some(F||[],function(G){return G.targetObjectType=="1"&&G.targetObjectId==A;
});var v=a.ProdOfferHelper.isStandardProdOffer(A);if(C&&v){var E=dojo.query(".mainprodoffer-class",D.mainProdOfferWidget.domNode)[0];var z=dojo.trim(dojo.query(".startDate-class",E)[0].innerHTML);var B=w.rowIndex;
var y=dojo.query(".promotionStartDate-"+B,D.salesPromotionOrderGrid.domNode)[0];var u=a.DateHelper.getDateFromString(z);u.setDay(u.getDay()+1);var t=a.DateHelper.formatDate(u);dojo.query(".start_date_class",y)[0].innerHTML=t;
}D.createTargetObjectNum(w,D.mainProdOfferId);D.dealPromotionRaiseSpeedInfo(x,w,true);D.dealPromotionEndDate(x,w);},dealPromotionRaiseSpeedInfo:function(y,x,A){var C=x.rowIndex;var v=a.ProdOfferHelper.getPromotionRaiseSpeedObj(y);
if(v==null||!x.showData.accessProductList||x.showData.accessProductList==null){return;}var B=this.salesPromotionOrderGrid.domNode;var w=dojo.query(".promotionTargetNum-"+C,B)[0];var t=dojo.filter(w.childNodes||[],function(D){return D.checked==true;
});var z=t.length>0?t[0].getAttribute("targetUniqueid"):null;if(z){v.uniqueId=z;v.prodOfferId=y.proodOfferInfo.prodOfferId;v.rowData=x;var u=new BusCard.messaging.Publisher();if(A){x.rateFlag=z;u.publish("/message/raiseSpeed"+z,v);
}else{u.publish("/message/decreaseSpeed"+z,v);}}},dealPromotionEndDate:function(x,v){var D=this;var C=v.rowIndex;var u=0;var y=ConstantsPool.load("PromotionCommonConst").PromotionCommonConst.AGREEMENT_ATTR_CD;
var t=ConstantsPool.load("PromotionTypeConst").PromotionTypeConst;var F=x.promotionType;if(F==t.DEVICE_RENT||F==t.SUBSIDY_PROMOTION||F==t.TELCHARGE_COUPON){var w=x.salesPromotionItemList;var B=BusCard.find(w||[],function(H){return H.itemAttrId==ConstantsPool.load("PromotionCommonConst").PromotionCommonConst.CONSUME_KIND_CD;
});if(B){var z=B.attrValue;if(z==2){var G=BusCard.find(w||[],function(H){return H.itemAttrId==ConstantsPool.load("PromotionCommonConst").PromotionCommonConst.TRANSFER_KIND_CD;});if(G){var E=G.attrValue;
if(E==3||E==4){}}var A=BusCard.find(w||[],function(H){return H.itemAttrId==y;});if(A){u=A.attrValue;D.changePromotionEndDate(u,C);}}else{D.changePromotionEndDate(0,C);}}else{D.changePromotionEndDate(0,C);
}}else{D.changePromotionEndDate(0,C);dojo.mixin(v,{promotionStatusCd:"1000"});}},changePromotionEndDate:function(t,z){var u=dojo.query(".promotionStartDate-"+z,this.salesPromotionOrderGrid.domNode)[0];
var y=dojo.query(".promotionEndDate-"+z,this.salesPromotionOrderGrid.domNode)[0];var x="";if(t>0){var w=dojo.trim(dojo.query(".start_date_class",u)[0].innerHTML);var v=a.DateHelper.getDateFromString(w);
v.setMonth(v.getMonth()+parseInt(t));x=a.DateHelper.formatDate(v);}dojo.query(".end_date_class",y)[0].innerHTML=x;},changePromotionStartDate:function(w){var u=dojo.query(".promotionStartDate-"+w,this.salesPromotionOrderGrid.domNode)[0];
var v=dojo.trim(dojo.query(".start_date_class",u)[0].innerHTML);var t=a.DateHelper.getDateFromString(v);t.setMonth(t.getMonth()+1);t.setDate(1);t.setHours(0);t.setMinutes(0);t.setSeconds(0);dojo.query(".start_date_class",u)[0].innerHTML=a.DateHelper.formatDate(t);
},getCheckedPromotionList:function(){var w=this.salesPromotionOrderGrid;var v=w.ds.getRawData();var t=dojo.filter(v,function(x){var y=x.rowIndex;return dojo.query(".promotionNameDetail-"+y,w.domNode)[0].childNodes[0].checked;
});var u=dojo.map(t,function(x){return x.showData.promotionInfo.promotionId;});return u;},changePromotionCheckedStatus:function(w){var y=w.rowIndex,u=this.salesPromotionOrderGrid,v=dojo.query(".promotionNameDetail-"+y,u.domNode)[0].childNodes[0].checked,t="",x=true;
if(!v){t="\u672a\u8ba2\u8d2d";x=false;}else{t="\u8ba2\u8d2d";x=true;}dojo.query(".promotionNameDetail-"+y,u.domNode)[0].childNodes[0].checked=x;dojo.query(".promotionStatus-"+y,u.domNode)[0].innerHTML=t;
},createTargetObjectNum:function(G,A){var F=G.showData.promotionInfo.promotionId,I=G.showData.promotionInfo.promotionTargetObjectList,H=G.rowIndex;var t=dojo.filter(I,function(Q){return Q.targetObjectType==2;
});var O=dojo.filter(I,function(Q){return Q.targetObjectType==1;});if(t&&t.length>0){var B=0;var J=dojo.query(".main-product-basic",this.mainProdOfferWidget.domNode);var M=dojo.filter(J,function(R){var Q=dojo.attr(R,"productId")||dojo.query("SELECT",R)[0].value;
return dojo.some(t,function(S){return S.targetObjectId==Q&&dojo.query(".main-product-check",R)[0].checked;});});G.showData.accessProductList=M;var u=dojo.query(".promotionTargetNum-"+H)[0];var L=dojo.map(M,function(R){B++;
var Q=dojo.attr(R,"productId")||dojo.query("SELECT",R)[0].value;var S=dojo.attr(R,"serviceKindIndex")||"-1";var T=dojo.attr(R,"uniqueid");serviceKind=dojo.attr(R,"serviceKind")||"-1",viewId=dojo.attr(R,"viewId"),defaultNumber=dojo.query(".serviceId-"+viewId,R)[0].value,radioId="selected_targetNumber_"+serviceKind+"_"+S,labelId="selected_targetNumber_label_"+serviceKind+"_"+S,radioName="radio_"+H,radioboxElem=BusCard.$(radioId,u),labelElem=BusCard.$(labelId,u);
if(radioboxElem){labelElem.innerHTML=defaultNumber;}else{radioboxElem=document.createElement("INPUT");radioboxElem.type="radio";radioboxElem.value=defaultNumber;radioboxElem.id=radioId;radioboxElem.name=radioName;
labelElem=document.createElement("LABEL");labelElem.id=labelId;labelElem.innerHTML=defaultNumber;u.appendChild(radioboxElem);u.appendChild(labelElem);if(B<=1){radioboxElem.checked=true;}radioboxElem.serviceKindIndex=S;
radioboxElem.serviceKind=serviceKind;radioboxElem.rowIndex=H;radioboxElem.setAttribute("serviceKindIndex",S);radioboxElem.setAttribute("serviceKind",serviceKind);radioboxElem.setAttribute("rowIndex",H);
radioboxElem.setAttribute("productId",Q);radioboxElem.setAttribute("targetUniqueid",T);radioboxElem.setAttribute("dojoAttachEvent","onclick:elementclick");radioboxElem.setAttribute("dojoAttachTopic","/radioBoxTargetNumberChg");
}return{radioId:radioId,labelId:labelId};});dojo.forEach(u.getElementsByTagName("INPUT"),function(S){var R=dojo.some(L||[],function(T){return T.radioId==S.id;});if(!R){var Q=S.nextSibling;u.removeChild(S);
u.removeChild(Q);}});return;}var x=[];var E=this.multipleSubProdOfferHandler.subProdOfferOrderProviderMap;for(var K in E){var w=E[K];var C=w.uniqueid?w.uniqueid:"-1";var N=w.getSubGridBindingData();var v=w.subProdOfferOrderGrid;
var z=dojo.filter(N,function(Q){var R=Q.rowIndex;return dojo.query(".subProdOfferDetail-"+R,v.domNode)[0].childNodes[0].checked;});var P=dojo.map(z,function(Q){var S=Q.rowIndex;var R=C+"_"+S+"_"+Q.subProdOfferInfo.prodOfferId;
return R;});Array.prototype.push.apply(x,P||[]);}x.push("-1_-1_"+A);if(O&&O.length>0){var B=0;var y=dojo.filter(x||[],function(Q){var R=Q.split("_")[2];return dojo.some(O||[],function(S){return R==S.targetObjectId;
});});var u=dojo.query(".promotionTargetNum-"+H)[0];var D=dojo.map(y||[],function(T){B++;var V=T.split("_")[0];var Y=T.split("_")[1];var U=T.split("_")[2];var S=dojo.filer(O||[],function(aa){return U==aa.targetObjectId;
})[0].targetObjectName;var Z="selected_targetNumber_radio_"+U,Q="selected_targetNumber_label_"+U,R="radio_"+H,W=BusCard.$(Z,u),X=BusCard.$(Q,u);if(W){X=S;}else{W=document.createElement("INPUT");W.type="radio";
W.value=U;W.id=Z;W.name=R;X=document.createElement("LABEL");X.id=Q;X.innerHTML=S;u.appendChild(W);u.appendChild(X);if(B<=1){W.checked=true;}W.rowIndex=H;W.setAttribute("rowIndex",H);W.setAttribute("prodOfferId",T.targetObjectId);
W.setAttribute("targetUniqueid",V);W.setAttribute("targetRowIndex",Y);}return{radioId:Z,labelId:Q};});dojo.forEach(u.getElementsByTagName("INPUT"),function(S){var R=dojo.some(D||[],function(T){return T.radioId==S.id;
});if(!R){var Q=S.nextSibling;u.removeChild(S);u.removeChild(Q);}});}},initPromotionDetail:function(t){this.promotionDetailBuilder.initPromotionDetail(t);},getSubProdOfferPageData:function(){var t=this;
var y={};var z=this.salesPromotionOrderGrid.ds.getRawData();var v=this.salesPromotionOrderGrid.domNode;var u=dojo.filter(z,function(A){var C=A.rowIndex;var B=A.showData.promotionInstInfo;return dojo.query(".promotionNameDetail-"+C,v)[0].childNodes[0].checked&&!B;
});var w=false;BusCard.each(u,function(H){var G=H.rowIndex,R=H.showData.viewId,B=null,E=null,F=null,N=null;var C=t.promotionDetailBuilder.prodOfferDetailWidgetList[""+G];if(!C){var M=dojo.query("[rindex="+G+"]",t.salesPromotionOrderGrid.domNode)[0];
var P=dojo.query("[dojoAttachTopic=/promotionDetailLink]",M)[0];t.dispatchEvent(P,"click");C=t.promotionDetailBuilder.prodOfferDetailWidgetList[""+G];var A=dojo.query("[dojoAttachTopic=/promotionDetailBtn]",C.domNode)[0];
t.dispatchEvent(A,"click");if(!H.resRelaPageDataList){w=true;return false;}}var O=dojo.query(".promotionNameDetail-"+G,v)[0];var L=dojo.query(".promotionStartDate-"+G,v)[0];var S=dojo.query(".promotionStartDateStyle",L)[0];
var Q=dojo.query(".promotionEndDate-"+G,v)[0];var D=dojo.query(".promotionEndDateStyle",Q)[0];var K=dojo.query(".promotionTargetNum-"+G,v)[0];if(S&&S.style.display!="none"){if(dojo.query("[id='delayTime-"+R+"']",L)[0]){B=dojo.query("[id='delayTime-"+R+"']",L)[0].value;
}if(dojo.query("[id='delayUnit-"+R+"']",L)[0]){E=dojo.query("[id='delayUnit-"+R+"']",L)[0].value;}}if(D&&D.style.display!="none"){if(dojo.query("[id='validPeriod-"+R+"']",Q)[0]){F=dojo.query("[id='validPeriod-"+R+"']",Q)[0].value;
}if(dojo.query("[id='validType-"+R+"']",Q)[0]){N=dojo.query("[id='validType-"+R+"']",Q)[0].value;}}var J=dojo.filter(K.childNodes||[],function(T){return T.checked==true;});var I={delayTime:B,delayUnit:E,validPeriod:F,validType:N,promotionStatus:dojo.query(".promotionStatus-"+G,v)[0].innerHTML,serviceIdChecked:J.length>0?J[0].value:null,serviceKindIndex:J.length>0?J[0].getAttribute("serviceKindIndex"):null,serviceKind:J.length>0?J[0].getAttribute("serviceKind"):null,productId:J.length>0?J[0].getAttribute("productId"):null,startDate:dojo.trim(dojo.query(".start_date_class",L)[0].innerHTML),endDate:dojo.trim(dojo.query(".end_date_class",Q)[0].innerHTML),prodOfferId:J.length>0?J[0].getAttribute("prodOfferId"):null,uniqueid:J.length>0?J[0].getAttribute("targetUniqueid"):"-1"};
dojo.mixin(H,{promotionPageInfo:I});});if(w){return false;}var x={checkBindingData:u};if(!this.checkInstance.checkPromotionPageInfoBeforeCommit(x)){return false;}return u;},dispatchEvent:function(u,t){if(u&&t){if(BusCard.Browser.IE){var v=document.createEventObject();
u.fireEvent("on"+t,v);}else{var v=document.createEvent("Event");v.initEvent(t,true,true);u.dispatchEvent(v);}}},showOrderPreView:function(){var B=this;if(B.orderPreViewWidgetInstance){B.orderPreViewWidgetInstance.destroyRecursive();
}B.orderPreViewWidgetInstance=new orderaccept.prodofferaccept.widget.mainprodoffer.orderPreViewWidget();var Q=Array.prototype.push;var z=new BusCard.widget.grid.ColumnModel({metaData:this.getOrderShowColumns()});
var G=null;var K=B.mainProdOfferWidget.viewInitData.prodOfferViewData;var R="";if(K.prodOfferInfoVO.bindType!=2){var J="";for(var S in B.serviceCardWidgetMap){if(!B.serviceCardWidgetMap.hasOwnProperty(S)){continue;
}var D=B.serviceCardWidgetMap[S];if(D.attrCardWidget){var A=dojo.filter(a.SpeedAttrArray||[],function(T){return !!D.attrCardWidget.busCardInstance.$(T+"");})[0];if(!!A){J=D.attrCardWidget.busCardInstance.$(A+"").value;
R+=J!=""?"端口速率："+J:"";}}}var L="";if(B.mainProdOfferDetailWidget&&B.mainProdOfferDetailWidget.prodOfferAttrCard&&B.mainProdOfferDetailWidget.prodOfferAttrCard.busCardInstance){L=B.mainProdOfferDetailWidget.prodOfferAttrCard.busCardInstance.$("300003").value;
if(L){R+=" 周价："+L;}}if(R!=""){R=" 【"+R+"】";}}var C={prodOfferType:"主销售品",prodOfferName:K.prodOfferInfoVO.prodOfferName+R,startDate:a.ProdOfferHelper.getProdOfferStartDateStr(K,dojo.query(".startDate-class",prodOfferAcceptLoader.mainProdOfferWidget.domNode)),endDate:a.ProdOfferHelper.getProdOfferEndDateStr(K,dojo.query(".endDate-class",prodOfferAcceptLoader.mainProdOfferWidget.domNode)),actionName:K.actionName};
var t=dojo.query(".mainprodoffer-class-quit",B.mainProdOfferWidget.domNode);var y=dojo.map(t,function(U){var T=dojo.trim(dojo.query(".endDate-class",U)[0].innerHTML);return{prodOfferType:"主销售品",prodOfferName:dojo.trim(dojo.query(".prodOfferName-class",U)[0].innerHTML),startDate:dojo.trim(dojo.query(".startDate-class",U)[0].innerHTML),endDate:dojo.trim(dojo.query(".endDate-class",U)[0].innerHTML),actionName:dojo.trim(dojo.query(".actionName-class",U)[0].innerHTML)};
})||[];if(K.prodOfferInfoVO.bindType==2){var H=[];H.push(C);Q.apply(H,y);G=new BusCard.widget.grid.DataSource(H,z);var u=new i({cm:z,ds:G});dojo.place(u.domNode,B.orderPreViewWidgetInstance.domNode,"last");
for(var S in B.multipleSubProdOfferHandler.subProdOfferOrderProviderMap){if(!B.multipleSubProdOfferHandler.subProdOfferOrderProviderMap.hasOwnProperty(S)){continue;}var E=[];var D=B.multipleSubProdOfferHandler.subProdOfferOrderProviderMap[S];
var R="";var J="";var x="serviceCardWidget_"+D.uniqueId;var O=B.serviceCardWidgetMap[x];if(O.attrCardWidget){var A=dojo.filter(a.SpeedAttrArray||[],function(T){return !!O.attrCardWidget.busCardInstance.$(T+"");
})[0];if(!!A){J=O.attrCardWidget.busCardInstance.$(A+"").value;R+=J!=""?"端口速率："+J:"";}}var L="";if(D.prodOfferInfoWidget&&D.prodOfferInfoWidget.mainProdOfferDetailWidget&&D.prodOfferInfoWidget.mainProdOfferDetailWidget.prodOfferAttrCard&&D.prodOfferInfoWidget.mainProdOfferDetailWidget.prodOfferAttrCard.busCardInstance){L=D.prodOfferInfoWidget.mainProdOfferDetailWidget.prodOfferAttrCard.busCardInstance.$("300003").value;
R+=L!=""?" 周价："+L:"";}if(R!=""){R=" 【"+R+"】";}var I=D.prodOfferInfoWidget.viewInitData.prodOfferViewData;var P={prodOfferType:"成员主销售品",prodOfferName:I.prodOfferInfoVO.prodOfferName+R,startDate:a.ProdOfferHelper.getProdOfferStartDateStr(I,dojo.query(".startDate-class",D.prodOfferInfoWidget.domNode)),endDate:a.ProdOfferHelper.getProdOfferEndDateStr(I,dojo.query(".endDate-class",D.prodOfferInfoWidget.domNode)),actionName:I.actionName};
E.push(P);Q.apply(E,B.createSubOfferViewObj(D));G=new BusCard.widget.grid.DataSource(E,z);var u=new i({cm:z,ds:G});dojo.place(u.domNode,B.orderPreViewWidgetInstance.domNode,"last");}}else{var E=[];E.push(C);
Q.apply(E,y);var D=B.multipleSubProdOfferHandler.subProdOfferOrderProviderMap.subProdOfferTreeContainer;Q.apply(E,B.createSubOfferViewObj(D));G=new BusCard.widget.grid.DataSource(E,z);var u=new i({cm:z,ds:G});
dojo.place(u.domNode,B.orderPreViewWidgetInstance.domNode,"last");}var N=[];var w=B.salesPromotionOrderGrid.ds.getRawData();var v=B.salesPromotionOrderGrid.domNode;var F=dojo.filter(w,function(T){var U=T.rowIndex;
return dojo.query(".promotionNameDetail-"+U,v)[0].childNodes[0].checked;});dojo.forEach(F,function(U){var T={prodOfferType:"促销包",prodOfferName:U.showData.promotionName,startDate:U.showData.startDate,endDate:U.showData.endDate,actionName:U.showData.promotionStatus};
N.push(T);});if(N.length>0){G=new BusCard.widget.grid.DataSource(N,z);var u=new i({cm:z,ds:G});dojo.place(u.domNode,B.orderPreViewWidgetInstance.domNode,"last");}var M=a.WidgetHelper.createDialog({inner:B.orderPreViewWidgetInstance.domNode,title:"订单预览",height:"600",width:"800"});
M.show();},orderGroupProductCheck:function(z){var u=this;var w=dojo.global.$appContext$.get("requestParam");var y=BusCard.$remote("custBO").queryById({custId:w.customerData.custId});var v=y.groupFlag;if(!!v){if(v!="2"){var t=u.route("spring:innerInterfaceBO/getOfferProdRelaList101",[{prodOfferId:z}]);
if((!!t)&&t.length>0){var x=t[0].productInfoVO.netType;if(x=="12"){alert("\u975e\u96c6\u56e2\u5ba2\u6237\u4e0d\u5141\u8bb8\u8ba2\u8d2d\u96c6\u56e2\u9500\u552e\u54c1");return false;}}}}return true;},createSubOfferViewObj:function(u){var x=dojo.global.$appContext$.requestParam.today;
var E=[],w=[],z=[],t=[],v=Array.prototype.push;u.pageData=[];u.saveSubProdOfferViewData();for(var F in u.pageData){if(!u.pageData.hasOwnProperty(F)){continue;}var D=u.pageData[F];var B=dojo.filter(u.subProdOfferOrderGrid.getData(),function(H){return H.showData.prodOfferStyle!="prod-offer-invalid";
});if(!dojo.some(B,function(H){return F==H.showData.rowIndex;})){continue;}var y=dojo.some(u.subProdOfferOrderGrid.getData(),function(H){return H.prodOfferInst&&H.prodOfferInst.prodOfferId==D.prodOfferId;
});if(D.checkBoxValue){var A=y==true?2:1;}else{var A=y==true?3:4;}if(A!=4){var G=new orderaccept.prodofferaccept.ProductDateBuilder.NewMainProductDateBuilder({changeKind:A,delayUnit:D.delayUnit,delayTime:D.delayTime,validType:D.validType,validPeriod:D.validPeriod,today:x,beginDate:D.beginDate,endDate:D.endDate,delayUnorderUnit:D.delayUnorderUnit,delayUnorderTime:D.delayUnorderTime,ifChangeMainFlag:D.ifChangeMainFlag});
var C={prodOfferType:"可选包",prodOfferName:D.prodOfferName,startDate:G.getBeginDate(),endDate:G.getEndDate(),actionName:D.orderSatus};if(A==1){w.push(C);}else{if(A==2){z.push(C);}else{t.push(C);}}}}v.apply(E,w);
v.apply(E,z);v.apply(E,t);return E;},getOrderShowColumns:function(){return cm=[{cssStyle:"width:10%",name:"prodOfferType",text:"销售品类型",value:"prodOfferType"},{cssStyle:"width:30%",name:"prodOfferName",text:"销售品名称",value:"prodOfferName"},{cssStyle:"width:25%",name:"startDate",text:"生效时间",value:"startDate"},{cssStyle:"width:25%",name:"endDate",text:"失效时间",value:"endDate"},{cssStyle:"width:10%",name:"actionName",text:"操作类型",value:"actionName"}];
},getDebugDate:function(){var t=new Date().getTime();prodOfferAcceptLoader.specDataBuilder.process(prodOfferAcceptLoader.dataBuilder.process());var v=new Date().getTime();if(v-t>100){var u="\u4fdd\u5b58\u8ba2\u5355\u524d\u53f0\u6570\u636e\u6536\u96c6 cost time:"+(v-t);
if(console.log){console.log(/(\d+\:\d+\:\d+)/.exec(new Date().toString())[1]+">>"+u);}}},getDebugData:function(){unieap.debug(prodOfferAcceptLoader.specDataBuilder.process(prodOfferAcceptLoader.dataBuilder.process()));
},getDebugHelp:function(){unieap.debug({easyDebug:"&servicecardcc=0&dojomodulecc=0&attrcardcc=0--->>\u8c03\u7528\u975e\u538b\u7f29\u7684js",dateDebug:"&debugModule=1&servicecardcc=0&dojomodulecc=0&attrcardcc=0--->>\u8c03\u8bd5\u9875\u9762\u52a0\u8f7d\u65f6\u95f4",getDebugDate:"getDebugDate--->>\u4fdd\u5b58\u8ba2\u5355\u524d\u53f0\u6570\u636e\u6536\u96c6\u8017\u65f6",getDebugData:"getDebugData--->>\u4fdd\u5b58\u8ba2\u5355\u524d\u53f0\u6570\u636e\u6536\u96c6",getAllHref:window.location.href+"&servicecardcc=0&dojomodulecc=0&attrcardcc=0"});
},initOrderPreView:function(){this.orderPreViewWidgetInstance=new orderaccept.prodofferaccept.widget.mainprodoffer.orderPreViewWidget();},appendOfferFilterParameters:function(){return"";}});});
defineModule("orderaccept.prodofferaccept.check.ProdOfferChangeCommCheck",["../util","orderaccept.common.dialog.MessageBox"],function(a,b){dojo.declare("orderaccept.prodofferaccept.check.ProdOfferChangeCommCheck",[],{memberProdOfferChangeValidate:function(g){var e=$ac$.get("currentMainProdOfferInfoVO");
var c=$ac$.get("mainProdOfferInstVO");var i=$ac$.get("requestParam").customerData.custId;var k=c.cityCode;if(e.bindType!=2){return true;}var d=dojo.map(dojo.filter(g,function(m){return true;if(m.action=="split"||m.action=="change"||m.action=="nochange"||m.action=="quit"){return true||(m.prodOfferId!=m.offerInstVO.prodOfferId);
}else{return false;}}),function(m){var n={productId:m.productId,userId:m.prodInstVO?m.prodInstVO.prodInstId:null,serviceId:m.prodInstVO?m.prodInstVO.accNbr:null,prodOfferId:m.offerInstVO?m.offerInstVO.prodOfferId:null,newProdOfferId:m.prodOfferId,prodOfferInstId:m.offerInstVO?m.offerInstVO.prodOfferInstId:null,custId:i,cityCode:m.prodInstVO?m.prodInstVO.cityCode:k||null,actionCD:m.action,stateCD:m.prodInstVO?m.prodInstVO.stateCD:null};
return n;});if(d&&d.length){var h=dojo.some(d,function(n){if(n.actionCD=="split"){var o="menuId=841ABWA";var m=executeRequest("prodOfferSaleAjaxAction","InnetCheck",o);if(m!="1"){b.alert({message:"没有权限做组合拆分操作"});
return true;}if(n.stateCD=="129997"){var o="menuId=841ABWB";var m=executeRequest("prodOfferSaleAjaxAction","InnetCheck",o);if(m!="1"){b.alert({message:"没有权限做欠费组合拆分操作"});return true;}}}return false;});if(h){return false;
}var j=dojo.some(g,function(m){if(m.action=="change"||m.action=="split"){if(a.ProdOfferHelper.ifAgreementpRrodOffer(m.offerInstVO,2)){if(!a.ProdOfferHelper.ifAgreementpRrodOffer(m.prodOfferId,3)){b.alert({message:"不能由宽带标准化套餐变更为普通周价销售品"});
return true;}}}return false;});if(j){return false;}var f={prodOfferInstId:c.prodOfferInstId,prodOfferId:e.prodOfferId,actionCD:$ac$.get("requestParam").actionCD,custId:$ac$.get("requestParam").customerData.custId,cityCode:k,acceptCity:BusCard.$session.cityCode,offerChangeValidVOList:d};
var l=BusCard.doPost(BusCard.path.contextPath+"/orderDetailAction.do?method=memberProdOfferChangeValidate",f);if(l&&l.code!=null&&parseInt(l.code+"")<0){b.alert({message:l.message});return false;}}return true;
}});});
defineModule("orderaccept.prodofferaccept.rule.ProdOfferChgRule",[],function(){});
defineModule("orderaccept.prodofferaccept.widget.mainprodofferchange.MainProdOfferChangeWidget",["orderaccept.custom._BaseWidget","orderaccept.custom._BusCardTemplated","dijit._Container","orderaccept.prodofferaccept.util","orderaccept.prodofferaccept.widget.mainprodoffer.MainProdOfferFlatWidget"],function(e,d,c,a,b){dojo.declare("orderaccept.prodofferaccept.widget.mainprodofferchange.MainProdOfferChangeWidget",[b],{buildViewInitData:function(){var f=this.inherited(arguments);
var g=dojo.global.$appContext$.get("mainProdOfferInstVO");dojo.mixin(f.prodOfferViewData,{startDate:g.effDate,endDate:g.expDate,prodOfferInstId:g.prodOfferInstId});f.prodOfferViewData.actionName="\u53d8\u66f4";
f.prodOfferViewData.displayStartEndTime="hidden-elem";return{prodOfferViewData:f.prodOfferViewData,prodViewData:this.buildProductViewInitData(f.prodOfferViewData.prodOfferInfoVO,{key:"key"})};},buildProductViewInitData:function(i,g){var k=this,f=dojo.global.$appContext$.get("mainProdOfferInstVO"),l=$ac$.get("selectedMemberProdOfferList"),m=f.prodInstList,j=a.ProdOfferHelper.getProductTupleList(i),n=function(o){return dojo.filter(j,function(p){return p.offerProdRelaVO.productId==o;
})[0];},h=function(o){return dojo.filter(m,function(p){return p.prodInstId==o;})[0];};return dojo.map(l||[],function(r){var o=n(r.productId),q=k._buildEachProductViewData(i,o.offerProdRelaVO,o.roleInfoVO),p=h(r.prodInstId);
r.uniqueId=q.uniqueId;if(p&&!q.actionName){q.actionName="\u53d8\u66f4";}return dojo.mixin(q,{userId:r.prodInstId,prodInstId:r.prodInstId,serviceId:p?p.accNbr:q.serviceId,checkedOption:"CHECKED",disabledOption:"DISABLED"});
});},postCreate:function(){this.inherited(arguments);var f=dojo.query(".main-product-basic",this.domNode);dojo.forEach(dojo._toArray(f),function(k){var g=dojo.attr(k,"viewId"),i=dojo.attr(k,"userId"),m=dojo.attr(k,"uniqueId"),l=dojo.query(".serviceOperOld-"+g,k)[0],j=dojo.query(".serviceOperNew-"+g,k)[0],h=dojo.query("[name=serviceOper-"+g+"-"+m+"]",k);
if(i){l.checked=true;dojo.forEach(h,function(n){n.disabled=true;});}else{j.checked=true;}});},getPageData:function(){var f=this.inherited(arguments);if(f===false){return false;}else{var g=dojo.query(".mainprodoffer-class",this.domNode)[0].getAttribute("prodOfferInstId");
f.prodOfferPageInfo.prodOfferInstId=g;return f;}}});});
defineModule("orderaccept.prodofferaccept.behavior.ProdOfferChgBehavior",["../util","../widget/prodoffersearchlist/ProdOfferSearchListWidget","../widget/attrcard/ProductAttrCardWidget","../widget/subprodoffernum/SubProdOfferNumWidget","./ProdOfferNewBehavior","orderaccept.custom.popup"],function(a,b,c,d,e){dojo.declare("orderaccept.prodofferaccept.behavior.ProdOfferChgBehavior",[e],{postscript:function(){this.subscribe();
},subscribe:function(){this.inherited(arguments);},onSubProdOfferCheckBoxClick:function(f){this.inherited(arguments);this.confirmKeepProd(f);},onMainProdOfferConfirm:function(h){var f=this._getSelectedMemberInfoList(h),g=this;
this.assertSeletedChanged(f,function(){var i=$ac$.get("prodOfferList");$ac$.set("selectedMainProdOfferInfoVO",a.ProdOfferHelper.getMainProdOffer(i)[0]);$ac$.set("selectedMemberProdOfferList",f);g.controller.beginOrder();
},function(){a.navigatorManager.to("prodOfferAcceptPane")(function(){dojo.byId("function-navigator-root").style.display="block";unieap.byId("shoppingCartPane").domNode.style.display="none";});});},confirmKeepProd:function(f){},onPromotionChangeDetailClick:function(i){var h=this.controller,l=i.currentTarget.getAttribute("rowIndex"),k=i.currentTarget.getAttribute("id")+"_dropdown",j=dojo.query("DIV[id='"+k+"']")[0],g=i.currentTarget.getAttribute("value");
var f=h.promotionDetailBuilder.prodOfferDetailWidgetList[""+l];if(!f){h.initPromotionDetail(l);f=h.promotionDetailBuilder.prodOfferDetailWidgetList[""+l];}if(j&&j.style.display!="none"){orderaccept.custom.popup.close({widget:f});
}else{orderaccept.custom.popup.open({widget:{popup:f,around:i.currentTarget,onCancel:function(){orderaccept.custom.popup.close({widget:f});}}});}}});});
defineModule("orderaccept.prodofferaccept.check.ProdOfferChgCheck",["../util","./ProdOfferNewCheck"],function(a,b){dojo.declare("orderaccept.prodofferaccept.check.ProdOfferChgCheck",[b],{postscript:function(){}});
});
defineModule("orderaccept.prodofferaccept.data.ProdOfferChgDataBuilder",["../ProductDateBuilder","../util","../../common/js/ConstantsPool","./ProdOfferNewDataBuilder"],function(c,b,d,a){dojo.declare("orderaccept.prodofferaccept.data.ProdOfferChgDataBuilder",[a],{getCommInfo:function(){return{};
},doMainProdOfferAcceptInfoComputation:function(h){var g=dojo.global.$appContext$.get("mainProdOfferInstVO"),f=h.prodOfferPageData,e=$ac$.get("selectedMemberProdOfferList")&&$ac$.get("selectedMemberProdOfferList").isAllSplited;
if(g.prodOfferInstId==f.prodOfferPageInfo.prodOfferInstId){return dojo.mixin(this._cloneBasicProperty(g),{operKind:e?3:2,ActionCD:d.ActionCDConst.PRODUCT_CHANGE});}},generateVirtualUserId:function(e){var j=e.prodBasicInfo.userId?e.prodBasicInfo.userId:-b.CommUtils.generateUniqueId(),i=dojo.global.$appContext$.get(this.USER_ID_KEY)||{},h=e.prodBasicInfo.serviceKind,g=e.prodBasicInfo.serviceKindIndex;
if(h&&g!=null){i["userId@"+h+"_"+g]=j;}else{var f=e.prodBasicInfo.productId;if(typeof console!="undefined"){console.warn("serviceKind or serviceKindIndex can't found when set virtual userId for product:"+f);
}}i["userId@uniqueId_"+e.prodBasicInfo.uniqueId]=j;dojo.global.$appContext$.set(this.USER_ID_KEY,i);return j;},_cloneBasicProperty:function(e){if(!dojo.isObject(e)){return e;}else{if(BusCard.isObject(e)){var f={};
BusCard.each(e,function(g,j){var i=Object.prototype.toString,h=i.call(j);if(/String/i.test(h)||/Number/i.test(h)||/Boolean/i.test(h)){f[g]=j;}},true);return f;}else{return{};}}},_queryRelaProdInfoVO:function(f,e){if(arguments.length==2){var g=BusCard.jsonPath(f,"$.prodInstList[?(@.prodInstId=="+e+"]");
if(g){return g[0];}else{return null;}}else{if(arguments.length==1){var e=arguments[0],g=BusCard.jsonPath(dojo.global.$appContext$.get("userHasProdOfferInfoList"),"$[*].prodInstList[?(@.prodInstId=="+e+")]");
if(g){return g[0];}}}},doAccessProductAcceptInfoComputation:function(e){return this.inherited(arguments);},doProdAttrInfoListComputation:function(e,f,g){return this.inherited(arguments);},doComputationOfferStandardBusInfo:function(f,e){return null;
}});});
defineModule("orderaccept.prodofferaccept.loader.ProdOfferChangeLoader",["../util","./ProdOfferNewLoader","../widget/servicecard/ServiceCardWidget","../widget/attrcard/ProductAttrCardWidget","../widget/attrcard/ProductOfferAttrCardWidget","../../custom/TooltipDialog","../formatter.FormatterProvider","../builder/prodofferdetail/ProdOfferDetailBuilder","../widget/commcard/CommCardWidget","../builder/subprodoffergrid/SubProdOfferCartDataProvider","../OrderShowLoader","unieap.layout.AccordionContainer","unieap.layout.AccordionPane"],function(f,k,c,b,h,i,a,g,d,e,j){dojo.declare("orderaccept.prodofferaccept.loader.ProdOfferChangeLoader",[k],{layoutTemplateUrl:dojo.moduleUrl("orderaccept.prodofferaccept","view/prodOfferChgLayout_new.html"),prodOfferInstId:null,prodOfferData:null,ShoppingCartWidgetClass:null,shoppingCartWidgetInstance:null,renderBelongCode:function(){return false;
},renderMainProdOfferTree:function(){return false;},_asynCallback:function(){var l=this;l.mainProdOfferWidgetClass=orderaccept.prodofferaccept.widget.mainprodofferchange.MainProdOfferChangeWidget;l.payRelationWidgetClass=orderaccept.prodofferaccept.widget.payrelation.PayRelationWidget;
l.subProdOfferOrderGridClass=orderaccept.custom.BusCardGrid;l.personalSubCollectListWidgetClass=orderaccept.prodofferaccept.widget.prodofferfavoritelist.personalSubCollectListWidget;l.functionNavigatorWidgetClass=orderaccept.prodofferaccept.widget.functionnavigator.FunctionNavigatorWidget;
l.salesPromotionOrderGridClass=orderaccept.custom.BusCardGrid;l.prodOfferInfoTipsWidgetClass=orderaccept.prodofferaccept.widget.messagetips.ProdOfferInfoTipsWidget;l.warmTipesWidgetClass=orderaccept.prodofferaccept.widget.messagetips.WarmTipsWidget;
l.prodOfferAcceptTipsWidgetClass=orderaccept.prodofferaccept.widget.messagetips.ProdOfferAcceptTipsWidget;l.manageAccNbrWidgetClass=orderaccept.prodofferaccept.widget.manageaccnbrwidget.ManageAccNbrWidget;
l.collectTipsWidgetClass=orderaccept.prodofferaccept.widget.messagetips.CollectTipsWidget;l.ShoppingCartWidgetClass=orderaccept.prodofferaccept.widget.shoppingcart.ShoppingCartWidget;l.initOldUserAddedHandler();
l.initBehavior();l.initCheck();l.initDataBuilder();l.initSpecialDataBuilder();l.renderPayRelation();l.initFunctionNavigatorWidget();l.initOrderInfoWidget();l.initViaInfoWidget();l.initGlobalHelper();l.initTipsWidgets();
l.initMultipleSubProdOfferHandler();l.renderPromotionLayout();l.initProdOfferData();l.initWaitingBar();l.initOrderPreView();l.fireEvent("onload");},_asynLoadSriptList:function(){return["orderaccept.prodofferaccept.behavior.ProdOfferChgBehavior","orderaccept.prodofferaccept.data.ProdOfferChgDataBuilder","orderaccept.prodofferaccept.data.SpecialDataHandler","orderaccept.prodofferaccept.check.ProdOfferChgCheck","orderaccept.prodofferaccept.rule.ProdOfferChgRule","orderaccept.prodofferaccept.widget.payrelation.PayRelationWidget","orderaccept.custom.Grid","orderaccept.custom.BusCardGrid","orderaccept.prodofferaccept.widget.mainprodofferchange.MainProdOfferChangeWidget","orderaccept.prodofferaccept.widget.prodofferfavoritelist.personalSubCollectListWidget","orderaccept.prodofferaccept.widget.functionnavigator.FunctionNavigatorWidget","orderaccept.prodofferaccept.loader.OldUserAddedHandler","orderaccept.prodofferaccept.widget.messagetips.ProdOfferInfoTipsWidget","orderaccept.prodofferaccept.widget.messagetips.WarmTipsWidget","orderaccept.prodofferaccept.widget.messagetips.CollectTipsWidget","orderaccept.prodofferaccept.widget.manageaccnbrwidget.ManageAccNbrWidget","orderaccept.prodofferaccept.widget.messagetips.ProdOfferAcceptTipsWidget","orderaccept.prodofferaccept.loader.MultipleSubProdOfferHandler","orderaccept.prodofferaccept.widget.shoppingcart.ShoppingCartWidget"];
},getBelongCode:function(){return $ac$.query("$.userHasProdOfferInfoList[*].prodInstList[*].serviceRelationVO.belongCode")[0];},initBehavior:function(){this.behaviorInstance=new orderaccept.prodofferaccept.behavior.ProdOfferChgBehavior(this);
},initCheck:function(){this.checkInstance=new orderaccept.prodofferaccept.check.ProdOfferChgCheck(this);},postscript:function(){this.init();this.asynExecute(this._asynLoadSriptList(),dojo.hitch(this,"_asynCallback"));
},renderOrderedSubProdOffer:function(){var l=this;l.multipleSubProdOfferHandler.doMultipleSubProdOfferFilter(l.mainProdOfferId);},renderSalesPromotion:function(){var m=unieap.byId("promotionPane").buttonContainerNode,n=BusCard.path.contextPath+"/common/images/icon/refresh_icon.png",l=this;
m.style.display="";m.innerHTML="<a style='vertical-align:top;color:#00577F' id='refresh-promotion-href'><span>\u5237\u65b0</span><img src='"+n+"' style='width:16px;height:16px'/></a>";m.style.width="50px";
m.style.paddingTop="5px";dojo.connect(dojo.query("span",m)[0],"onclick",function(){l.renderPromotion(l.mainProdOfferId);});},initCustomerOrderData:function(){var m=this.requestParam.customerData.custId;
var l=f.ServiceFactory.getService("url:prodOfferSaleAjaxAction.do?method=getCustomerOrderInfo&custId="+m);dojo.global.$appContext$.set("reserveProdOfferList",l.reserveProdOfferList||[]);dojo.global.$appContext$.set("orderPromotionList",l.orderPromotionList||[]);
},buildSubProdOfferTreeURL:function(n,m){var n=n||this.mainProdOfferId;var l=[];dojo.forEach(dojo.global.$appContext$.get("userHasProdOfferInfoList"+m)||[],function(o){return l.push(o.prodOfferId);});return BusCard.path.contextPath+"/orderDetailAction.do?method=getProdOfferTreeForChg&prodOfferId="+n+"&userHasProdOfferIdList="+dojo.toJson(l)+"&memOfferList="+this.getMemberProdOfferIds(m)+"&commonRegionId="+(this.getBelongCode()||"")+"&accProdListStr="+this.getAccProdIdList(m);
},buildMainProdOfferView:function(){var m=this;if(this.mainProdOfferWidget){this.mainProdOfferWidget.destroyRecursive();}this.removeAllServiceCardWidgets();var o=unieap.byId("mainProdOfferPane").containerNode;
this.mainProdOfferWidget=new this.mainProdOfferWidgetClass({});dojo.place(this.mainProdOfferWidget.domNode,o,"first");var n=f.ProdOfferHelper.getMainProdOffer(dojo.global.$appContext$.get("prodOfferList"))[0];
var l=dojo.filter(dojo.global.$appContext$.get("userHasProdOfferInfoList"),function(p){return p.prodOfferId==n.prodOfferId;})[0];m.renderMainProdOfferAttr({prodOfferInfoVO:n,prodOfferInstVO:l});},initProdOfferData:function(){var l=this;
this.mainProdOfferId=this.requestParam.prodOfferId;this.prodOfferInstId=this.requestParam.prodOfferInstId;this.getProdOfferListData(this.mainProdOfferId,"",this.prodOfferInstId,function(n){if(n.flag&&n.flag=="-1"){orderaccept.common.dialog.MessageBox.alert({message:n.message});
BusCard.removeCoverLayer();return;}dojo.global.$appContext$.set("prodOfferList",n.prodOfferList);dojo.global.$appContext$.set("userHasProdOfferInfoList",n.userHasProdOfferInfoList);dojo.global.$appContext$.set("userHasProdOfferMetaInfoList",n.prodOfferList);
var m=f.ProdOfferHelper.getMainProdOffer(n.prodOfferList)[0];$ac$.set("selectedMainProdOfferInfoVO",m);$ac$.set("currentMainProdOfferInfoVO",m);f.ProdOfferInstProvider.getProdOfferDataForChg();l.renderShoppingCart();
BusCard.removeCoverLayer();});},renderShoppingCart:function(){this.shoppingCartWidgetInstance=new this.ShoppingCartWidgetClass();dojo.place(this.shoppingCartWidgetInstance.domNode,unieap.byId("shoppingCartPane").containerNode,"first");
},removeResourcesBinding:function(){},beginOrder:function(){f.navigatorManager.to("prodOfferAcceptPane")(function(){dojo.byId("function-navigator-root").style.display="block";unieap.byId("shoppingCartPane").domNode.style.display="none";
});var l=this;l.closeMainProdOfferAcceptPane();l.openProdOfferAcceptPane();l.buildMainProdOfferView();l.recoveryOrderInfo();var m=function(){l.renderOrderedSubProdOffer();l.initCustomerOrderData();l.renderPromotionOrderGrid();
l.renderSalesPromotion();l.promotionCartDataProvider.showOrderedPromotion();};l.addAllServiceCardWidgets(m);},getProdOfferListData:function(p,o,n,l){var o=o||"";var m=f.ServiceFactory.getService("url:orderDetailAction.do?method=doGetProdOfferListForChg&prodOfferId="+this.mainProdOfferId+"&prodOfferInstId="+this.prodOfferInstId,l);
if(!l){dojo.global.$appContext$.set("prodOfferList"+o,m.prodOfferList);dojo.global.$appContext$.set("userHasProdOfferInfoList"+o,m.userHasProdOfferInfoList);dojo.global.$appContext$.set("userHasProdOfferMetaInfoList"+o,m.prodOfferList);
f.ProdOfferInstProvider.getProdOfferDataForChg(o);}},showSubProdOfferCart:function(m){var l=$ac$.selectedMemberProdOfferList;var n=dojo.filter(l||[],function(o){return o.uniqueId==m.uniqueId;});if(n&&n.length>0){if(n[0].action=="new"){m.showSelectDefaultProdOffer();
return;}}m.showOrderedProdOffer();},buildSubProdOfferTreeView:function(){if(this.subProdOfferTree){this.subProdOfferTree.destroyRecursive();}this.subProdOfferTree=f.WidgetProvider.getSubProdOfferTree({id:"subProdOfferTree",url:this.buildSubProdOfferTreeURL()});
var l=!!unieap.byId("subProdOfferTreePane")?unieap.byId("subProdOfferTreePane").containerNode:dojo.byId("subProdOfferTreePane");dojo.place(this.subProdOfferTree.domNode,l,"first");},addServiceCardWidget:function(s,l){var p=l,m=this,o=m.getServiceOfferConfigVO(f.ACTION_CD_CONST.PRODUCT_INSTALL).serviceOfferId,q=m.getServiceOfferConfigVO(f.ACTION_CD_CONST.PRODUCT_CHANGE).serviceOfferId,n=m.getServiceOfferConfigVO(f.ACTION_CD_CONST.PRODOFFER_CANCEL_ACTION).serviceOfferId,l=function(v,t){dojo.require("orderaccept.common.js.ConstantsPool");
var u=orderaccept.common.js.ConstantsPool;t.userId=dojo.attr(v,"userId")||null;if(t.userId&&dojo.attr(v,"serviceId")){t.serviceId=dojo.attr(v,"serviceId");}t.pageAction=dojo.attr(v,"action")||null;if(t.pageAction=="quit"){t.serviceOfferId=n;
}else{if(t.userId&&t.serviceId){t.serviceOfferId=q;}else{t.serviceOfferId=o;}}if(t.userId){}if(p){p.apply(null,arguments);}},r=dojo._toArray(arguments);r[1]=l;return this.inherited(arguments,r);},addProdAttrCardWidget:function(m,l){var o=dojo._toArray(arguments),n=this.getServiceOfferConfigVO(f.ACTION_CD_CONST.PRODOFFER_CANCEL_ACTION).serviceOfferId,p=m.busCardInstance.getCardRelationInfo().serviceOfferId;
if(p==n){return false;}var l=function(){var q=this.busCardInstance,r=q.getParent().getCardRelationInfo().userId;if(r){var s=dojo.global.$appContext$.jsonPath("$.userHasProdOfferInfoList[*].prodInstList[?(@.prodInstId=="+r+")]");
if(s){var t={};dojo.forEach(s[0].prodInstAttrList||[],function(u){t[u.attrCd]=u.attrValue;});dojo.forEach(this.productInfoVO.attrList,function(v){if(!!t[v.attrCd]){var u=t[v.attrCd];if(!!v&&!isNaN(u)){if(v.valueUnit==f.AttrUnitConst.unitConst||v.valueUnit==f.AttrUnitConst.minuteConst){t[v.attrCd]=parseFloat(t[v.attrCd]+"")/100;
}}}});q.renderDefaultValue(t);}}};o[1]=l;return this.inherited(arguments,o);},initDataBuilder:function(){this.dataBuilder=new orderaccept.prodofferaccept.data.ProdOfferChgDataBuilder(this);}});});
defineModule("orderaccept.prodofferaccept.check.MemberProdOfferAcceptCheck",["../util","./ProdOfferChgCheck","./ProdOfferChangeCommCheck"],function(a,b,c){dojo.declare("orderaccept.prodofferaccept.check.MemberProdOfferAcceptCheck",[b,c],{postscript:function(){},doOrderBusCheck:function(j){var e=j.selectedMemberProdOfferList,f=this,i=dojo.filter(e||[],function(k){return k.action=="quit";
}),h=f.controller.getServiceOfferConfigVO(a.ACTION_CD_CONST.PRODOFFER_CANCEL_ACTION).serviceOfferId,d=dojo.map(i,function(l){var k={customerId:$ac$.requestParam.customerData.custId,productId:l.productId,serviceOfferId:h,cityCode:l.prodInstVO.cityCode,userId:l.prodInstVO.prodInstId,serviceId:l.prodInstVO.accNbr,ifProdOfferAccept:"1"};
return k;}),g=dojo.some(d,function(n){var o=BusCard.buildParam(n);var m=BusCard.path.contextPath+"/secondAcceptAjaxAction.do?method=doCheckOrderValid&"+o;var k=BusCard.doGet(m);var l=executeAjaxResult(k);
if(l===false){return true;}});if(g){return false;}else{g=dojo.some(d,function(o){var q=BusCard.buildParam(o);var n=BusCard.path.contextPath+"/secondAcceptAjaxAction.do?method=doCheckServiceWait&"+q;var l=BusCard.doGet(n);
var k=executeAjaxResult(l);if(k===false){return true;}var m="0";var p="0";if(k){if(window.confirm("\u5b58\u5728\u670d\u52a1\u4e92\u65a5\u53d7\u7406\u7b49\u5f85\u8ba2\u5355\uff0c\u8ba2\u5355\u7f16\u53f7\u4e3a"+k+",\u662f\u5426\u7ee7\u7eed?")){m="1";
p=k;}else{return true;}}});if(g){return false;}if(this.memberProdOfferChangeValidate(e)===false){return false;}return true;}},doCheckMemberProdOfferSelect:function(d){if(this.inherited(arguments)===false){return false;
}return this.doOrderBusCheck(d);}});});
defineModule("orderaccept.prodofferaccept.behavior.MemberProdOfferAcceptBehavior",["../util","./ProdOfferChgBehavior"],function(a,b){dojo.declare("orderaccept.prodofferaccept.behavior.MemberProdOfferAcceptBehavior",[b],{postscript:function(){this.subscribe();
},subscribe:function(){var c=this;this.inherited(arguments);this.handleRegistry.push(dojo.subscribe("/member-offer-keep/click",function(){c.onMemberProdOfferKeep(arguments[0]);}));this.handleRegistry.push(dojo.subscribe("/member-offer-split/click",function(){c.onMemberProdOfferSplit(arguments[0]);
}));this.handleRegistry.push(dojo.subscribe("/member-offer-quit/click",function(){c.onMemberProdOfferQuit(arguments[0]);}));},_clickAction:function(d){var e=d.currentTarget;var c=a.DomHelper.findParentNode(e,function(f){return f.tagName.toUpperCase()=="TD";
});dojo.forEach(dojo.query(".action-link",c),function(f){dojo.removeClass(f,"action-selected");});dojo.addClass(e,"action-selected");},onMemberProdOfferKeep:function(e){this._clickAction(e);var f=a.DomHelper.findParentNode(e.currentTarget,function(k){return k.tagName.toUpperCase()=="TR";
}),j=$ac$.get("userHasProdOfferInfoList"),i=dojo.attr(f,"prodOfferInstId"),g=dojo.attr(f,"productId"),c=BusCard.jsonPath(j,"$[?(@.prodOfferInstId=="+i+")]")[0],d=BusCard.jsonPath($ac$.get("currentMainProdOfferInfoVO"),"offerProdRelaList[?(@.productId=="+g+")]")[0],h=dojo.query(".memeber-prodoffer-select",f)[0];
BusCard.$rs(h,dojo.map(d.relatedOfferList,function(k){return{id:k.prodOfferId,name:k.prodOfferName};}));h.value=c.prodOfferId;},onMemberProdOfferSplit:function(k){this._clickAction(k);var j=a.DomHelper.findParentNode(k.currentTarget,function(m){return m.tagName.toUpperCase()=="TR";
}),f=$ac$.get("userHasProdOfferInfoList"),e=dojo.attr(j,"prodOfferInstId"),g=dojo.attr(j,"productId"),h=BusCard.jsonPath(f,"$[?(@.prodOfferInstId=="+e+")]")[0],c=BusCard.jsonPath($ac$.get("currentMainProdOfferInfoVO"),"offerProdRelaList[?(@.productId=="+g+")]")[0],l=dojo.query(".memeber-prodoffer-select",j)[0],d=prodOfferAcceptLoader.route("url:orderDetailAction.do?method=doGetProdOfferByAccProductId&productId="+g+"&prodOfferId="+h.prodOfferId);
if(this.controller.checkInstance.doCheckIfMainAuxiliaryCard()){d=this.filterCurrentProdOfferId(h,d);}d.sort(function(n,m){return(n.prodOfferName).localeCompare(m.prodOfferName);});BusCard.$rs(l,dojo.map(d,function(m){return{id:m.prodOfferId,name:m.prodOfferName};
}));var i=dojo.some(d,function(m){return m.prodOfferId==h.prodOfferId;});if(i){l.value=h.prodOfferId;}},filterCurrentProdOfferId:function(c,d){return dojo.filter(d,function(e){return e.prodOfferId!=c.prodOfferId;
});},onMemberProdOfferQuit:function(c){this._clickAction(c);},onMainProdOfferConfirm:function(f){var c=this._getSelectedMemberInfoList(f);if(this.checkMemberDataIntegrity(c)===false){return false;}var e=this.doCheckValidation(c),d=this;
if(e&&e.isAllSplited&&e.flag){c.isAllSplited=true;}else{if(e&&e.isAllSplited){return false;}else{if(!e){return false;}}}this.assertSeletedChanged(c,function(){$ac$.set("selectedMemberProdOfferList",c);
d.controller.beginOrder();},function(){a.navigatorManager.to("prodOfferAcceptPane")(function(){dojo.byId("function-navigator-root").style.display="block";unieap.byId("shoppingCartPane").domNode.style.display="none";
});});},doCheckValidation:function(e){var d=dojo.every(e,function(g){return g.action!="new"&&g.action!="change"&&g.action!="nochange";});if(d){var c=this.controller.checkInstance.doOrderBusCheck({selectedMemberProdOfferList:e});
if(c===false){return c;}var c=this.controller.checkInstance.memberProdOfferChangeValidate(e);if(c===false){return c;}var f=confirm("成员套餐全部拆分或退网,主套餐["+$ac$.get("currentMainProdOfferInfoVO").prodOfferName+"]将被退订,\n是否继续?");
return{isAllSplited:true,flag:!!f};}else{return this.controller.checkInstance.doCheckMemberProdOfferSelect({selectedMemberProdOfferList:e});}}});});
defineModule("orderaccept.prodofferaccept.widget.mainprodofferchange.MemberProdOfferChangeWidget",["orderaccept.custom._BaseWidget","orderaccept.custom._BusCardTemplated","dijit._Container","orderaccept.prodofferaccept.util","../mainprodoffer/MainProdOfferFlatWidget"],function(e,d,c,b,a){dojo.declare("orderaccept.prodofferaccept.widget.mainprodofferchange.MemberProdOfferChangeWidget",[a],{templatePath:dojo.moduleUrl("orderaccept.prodofferaccept.widget.mainprodoffer","template/mainProdOfferTpl.html"),buildViewInitData:function(){var f=this.inherited(arguments),g=!!$ac$.get("selectedMemberProdOfferList").isAllSplited,i=dojo.global.$appContext$.get("mainProdOfferInstVO"),h=b.ProdOfferHelper.getProductDateBuilder($ac$.get("currentMainProdOfferInfoVO"),{beginDate:i.effDate,endDate:i.expDate,changeKind:3});
dojo.mixin(f.prodOfferViewData,{startDate:i.effDate,endDate:g?h.getEndDate():i.expDate,prodOfferInstId:i.prodOfferInstId});f.prodOfferViewData.actionName=g?"\u9000\u8ba2":"\u53d8\u66f4";f.prodOfferViewData.displayStartEndTime="hidden-elem";
return{prodOfferViewData:f.prodOfferViewData,prodViewData:this.buildProductViewInitData(f.prodOfferViewData.prodOfferInfoVO,{key:"key"}),quitProdOfferInfoList:this.buildQuitProdOfferViewInitData()};},_buildEachQuitMainProdOfferView:function(f,n){if(f){var j=this,m=this.key,l=m+"-"+n.parentProdOfferId+n.prodOfferId,i="\u9000\u8ba2",k=b.ProdOfferHelper.getProductDateBuilder(n,{beginDate:f.effDate,endDate:f.expDate,changeKind:3}),g=f.effDate,h=k.getEndDate();
tpContext={prodOfferDetailFlag:"0",viewId:l,startDate:g,endDate:h,actionName:i,displayStartEndTime:"",prodOfferInfoVO:n,prodOfferInstId:f.prodOfferInstId};return{prodOfferViewData:tpContext};}},buildQuitProdOfferViewInitData:function(){var g=dojo.filter($ac$.query("$.selectedMemberProdOfferList[?(@.action=='split'||@.action=='quit'||@.action=='change')]"),function(h){return h.action=="quit"||(h.offerInstVO.prodOfferId!=h.prodOfferId);
}),f=this;if(g){return dojo.map(g,function(h){return f._buildEachQuitMainProdOfferView(h.offerInstVO,$ac$.query("$.prodOfferList[*].offerProdRelaList[?(@.productId=="+h.productId+")].relatedOfferList[?(@.prodOfferId=="+h.offerInstVO.prodOfferId+")]")[0]);
});}else{return[];}},buildMemberProdOfferInitData:function(h,i){var f=$ac$.get("selectedMemberProdOfferList"),g=this;if(f==null){return false;}else{var j=dojo.map(f,function(l){var q=l.prodOfferId,n=l.productId,m=l.action||"new",p=l.offerInstVO,r=g.actionNameMap[m];
switch(m){case"new":case"nochange":case"change":var s=dojo.filter(h.offerProdRelaList,function(v){return v.productInfoVO.productId==n;})[0],k=dojo.filter(s.relatedOfferList,function(v){return v.prodOfferId==q;
})[0],o=g._buildEachProductViewData(k,s,s.roleInfoVO);o.memberProdOfferView=g._buildMemberMainProdOfferView(k);break;case"split":var u=b.ProdOfferHelper.getProdOfferDetail(q,{interfaceType:4,permitCache:true,permitFromCache:true}),s=dojo.filter(u.offerProdRelaList,function(v){return v.productInfoVO.productId==n;
})[0],o=g._buildEachProductViewData(u,s,s.roleInfoVO);o.memberProdOfferView=g._buildMemberMainProdOfferView(u);break;case"quit":var s=dojo.filter(h.offerProdRelaList,function(v){return v.productInfoVO.productId==n;
})[0],k=dojo.filter(s.relatedOfferList,function(v){return v.prodOfferId==p.prodOfferId;})[0],o=g._buildEachProductViewData(k,s,s.roleInfoVO);o.memberProdOfferView=g._buildMemberMainProdOfferView(k);break;
}o.actionName=r;o.action=m;if(m!="new"){var t=p.prodInstList[0];o.serviceId=t.accNbr;o.userId=t.prodInstId;o.prodInstId=t.prodInstId;o.prodOfferInstId=p.prodOfferInstId;}l.uniqueId=o.uniqueId;return o;
});this._updateMemeberMainProdOfferStatus(j);return j;}},postCreate:function(){this.inherited(arguments);var f=dojo.query(".main-product-basic",this.domNode);dojo.forEach(dojo._toArray(f),function(k){var g=dojo.attr(k,"viewId"),i=dojo.attr(k,"prodInstId"),m=dojo.attr(k,"uniqueId"),l=dojo.query(".serviceOperOld-"+g,k)[0],j=dojo.query(".serviceOperNew-"+g,k)[0],h=dojo.query("[name=serviceOper-"+g+"-"+m+"]",k);
if(i){l.checked=true;dojo.forEach(h,function(n){n.disabled=true;});}else{j.checked=true;}});},getPageData:function(){var f=this.inherited(arguments);if(f===false){return false;}else{var g=dojo.query(".mainprodoffer-class",this.domNode)[0].getAttribute("prodOfferInstId");
f.prodOfferPageInfo.prodOfferInstId=g;return f;}}});});
defineModule("orderaccept.prodofferaccept.loader.MemberProdOfferAcceptLoader",["./ProdOfferChangeLoader","../util","orderaccept.common.js.ConstantsPool"],function(d,a,c){var b="orderaccept.prodofferaccept.loader.MemberProdOfferAcceptLoader";
dojo.declare(b,[d],{shoppingCardWidgetClass:null,shoppingCartWidgetInstance:null,mainProdOfferId:null,_asynLoadSriptList:function(){var h=this.inherited(arguments),f="orderaccept.prodofferaccept.widget.shoppingcart.ShoppingCartWidget",e="orderaccept.prodofferaccept.behavior.MemberProdOfferAcceptBehavior",g="orderaccept.prodofferaccept.check.MemberProdOfferAcceptCheck",i="orderaccept.prodofferaccept.widget.mainprodofferchange.MemberProdOfferChangeWidget",j="orderaccept.prodofferaccept.widget.mainprodofferchange.MainProdOfferChangeWidget";
h.unshift(j);h.push(f);h.push(e);h.push(g);h.push(i);return h;},initBehavior:function(){this.behaviorInstance=new orderaccept.prodofferaccept.behavior.MemberProdOfferAcceptBehavior(this);},initCheck:function(){this.checkInstance=new orderaccept.prodofferaccept.check.MemberProdOfferAcceptCheck(this);
},_asynCallback:function(){this.inherited(arguments);this.registerShoppingCardWidgetClass();this.registerMainProdOfferWidgetClass();this.asyncLoadData();},registerShoppingCardWidgetClass:function(){this.shoppingCardWidgetClass=orderaccept.prodofferaccept.widget.shoppingcart.ShoppingCartWidget;
},registerMainProdOfferWidgetClass:function(){this.mainProdOfferWidgetClass=orderaccept.prodofferaccept.widget.mainprodofferchange.MemberProdOfferChangeWidget;},asyncLoadData:function(){var g=$ac$.get("requestParam"),e=this,f=c.load("ItemRelationTypeConst").ItemRelationTypeConst.OFFER_COMB_MEMBER;
this.route("spring:prodOfferSaleDataBO/getUserProdOfferListByProdOfferInstId",[g.prodOfferInstId,null,function(h){$ac$.set("userHasProdOfferInfoList",h);var i=BusCard.jsonPath(h,"$[?(@.prodOfferInstId=="+g.prodOfferInstId+")]")[0];
e.setAcceptMainProdOfferId(i.prodOfferId);$ac$.set("mainProdOfferInstVO",i);e.route("spring:innerInterfaceBO/getProdOfferInfo",[{prodOfferId:i.prodOfferId,interfaceType:4,commonRegionId:i.commonRegionId||e.getBelongCode()},function(j){$ac$.set("currentMainProdOfferInfoVO",j);
$ac$.set("selectedMainProdOfferInfoVO",j);$ac$.set("prodOfferList",[j]);e.onDataReady();BusCard.removeCoverLayer();}]);}]);},setAcceptMainProdOfferId:function(e){this.mainProdOfferId=e;},onDataReady:function(){this.shoppingCartWidgetInstance=new this.shoppingCardWidgetClass();
dojo.place(this.shoppingCartWidgetInstance.domNode,unieap.byId("shoppingCartPane").containerNode,"first");},beginOrder:function(){a.navigatorManager.to("prodOfferAcceptPane")(function(){dojo.byId("function-navigator-root").style.display="block";
unieap.byId("shoppingCartPane").domNode.style.display="none";});return this[$ac$.get("processId")].apply(this,arguments);},sharedMemberChange:function(){this.mainProdOfferWidgetClass=orderaccept.prodofferaccept.widget.mainprodofferchange.MainProdOfferChangeWidget;
var f=$ac$.get("mainProdOfferInstVO"),h=f.prodOfferId,e=this,g=$ac$.get("userHasProdOfferInfoList");userHasProdOfferIdList=dojo.filter(dojo.map(g,function(i){return i.prodOfferId;}),function(i){return i!=h;
});e.closeMainProdOfferAcceptPane();e.openProdOfferAcceptPane();e.buildMainProdOfferView();e.recoveryOrderInfo();setTimeout(function(){a.ServiceFactory.getService("url:orderDetailAction.do?method=doGetUserHasSpecSubProdOfferList&prodOfferId="+h+"&commonRegionId="+(e.getBelongCode()||""),function(j){Array.prototype.push.apply($ac$.get("prodOfferList"),j||[]);
dojo.global.$appContext$.set("userHasProdOfferMetaInfoList",$ac$.get("prodOfferList"));a.ProdOfferInstProvider.getProdOfferDataForChg();var i=function(){e.renderOrderedSubProdOffer();e.initCustomerOrderData();
e.renderPromotionOrderGrid();e.renderSalesPromotion();e.promotionCartDataProvider.showOrderedPromotion();};e.addAllServiceCardWidgets(i);},{content:userHasProdOfferIdList,method:"post"});},1);},independenceMemberChange:function(){var e=this;
e.closeMainProdOfferAcceptPane();e.openProdOfferAcceptPane();e.buildMainProdOfferView();e.recoveryOrderInfo();setTimeout(function(){var f=function(){e.renderOrderedSubProdOffer();e.initCustomerOrderData();
e.renderPromotionOrderGrid();e.renderSalesPromotion();e.promotionCartDataProvider.showOrderedPromotion();};e.addAllServiceCardWidgets(f);},1);},initProdOfferData:function(){return false;},buildMainProdOfferView:function(){return this.inherited(arguments);
},getBelongCode:function(){return $ac$.query("$.userHasProdOfferInfoList[*].prodInstList[*].serviceRelationVO.belongCode")[0];}});});
