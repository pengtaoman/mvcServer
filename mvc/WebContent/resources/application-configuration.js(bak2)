/**
 * Created by pqmagic on 2015/12/7.
 */
// application-configuration.js

"use strict";
define(["angularAMD",
        "angular-route",
        "ui-bootstrap",
        "angular-sanitize",
        "blockUI",
        "ui-router",
        "ui-grid",
        "bootstrap",
        "jquery-ui-bootstrap"
    ],
    function (angularAMD) {
        console.log("##########  requirejs define begin  ################" + angularAMD);

        var app = angular.module("mainModule",
            ["ui.router", "blockUI", "ngSanitize", "ui.bootstrap"]);

        app.config(['$stateProvider','$urlRouterProvider','$locationProvider', function ($stateProvider, $urlRouterProvider, $locationProvider) {
            //for(var a in $locationProvider) {
            //    console.log(">> $locationProvider : " + a);
            //}
            //console.log(">> $locationProvider : " + $rootScope.$location);
            //$urlRouterProvider
            //    // 错误的路由重定向
            //    .when('/c?id', '/contacts/:id')
            //    .when('/user/:id', '/contacts/:id')
            //    .otherwise('/');
                //console.log("############# $location");
            var pathMap=["uiView_omemployeeemployee","uiView_omemployeedepartment","uiView_omemployeerel"];
            $stateProvider.state("main",
                angularAMD.route({
                    url: "",
                    params: {
                        foo: '!!!!!!!!!!!!!!default value of foo!!!!!!!!!!!',
                        bar: 'default value of bar'
                    },
                    views :{"uiView_welcome":{
                        templateUrl: function(params){
                            console.log("?????????????????????" + angular.toJson(params));
                            return '/myAngular/app/views/framework/'+'ddd'+'.html';
                        }
                    }},
                    resolve: {
                        load: ["$q", "$rootScope", "$location","blockUI","$timeout","$stateParams",
                            function ($q, $rootScope, $location,blockUI,$timeout,$stateParams) {
                                //blockUI.start("JUMP!!!....");
                                // blockUI.blockUIConfig.message=""
                                //console.log("##########  /CCC  ################" + $q);
                                var deferred = $q.defer();
                                require(["/myAngular/app/views/framework/controller/mainPage1.js"], function () {
                                    $rootScope.$apply(function () {
                                        deferred.resolve();
                                    });
                                });
                                //$timeout(function() {
                                //    blockUI.stop();
                                //}, 5000);
                                return deferred.promise;
                            }]
                    }
                })
            );
            angular.forEach(pathMap,function(pathMap){
                    console.log(";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;" + pathMap);
                    this.pp = pathMap;
            $stateProvider.state(pathMap,
                    angularAMD.route({
                        url: "/:package/:model/:func",
                        params: {
                            foo: 'default value of fooEEEEEEEEE',
                            bar: 'default value of barEEEEEEEEEE'
                        },
                        views :{pathMap : {
                            templateUrl: function(params){
                                console.log("?????????????????????" + angular.toJson(params));
                                return '/myAngular/app/views/om/employee/employee.html';
                            }
                        }},
                        resolve: {
                            load: ["$q", "$rootScope", "$location","blockUI","$timeout",
                                function ($q, $rootScope, $location,blockUI,$timeout) {
                                    //blockUI.start("JUMP!!!....");
                                    // blockUI.blockUIConfig.message=""
                                    //console.log("##########  /CCC  ################" + $q);
                                    var deferred = $q.defer();
                                    require(["/myAngular/app/views/framework/controller/mainPage1.js"], function () {
                                        $rootScope.$apply(function () {
                                            deferred.resolve();
                                        });
                                    });
                                    //$timeout(function() {
                                    //    blockUI.stop();
                                    //}, 5000);
                                    return deferred.promise;
                                }]
                        }
                    })
            );
                }
            )
        }]);
        app.run(['$rootScope', '$location', function($rootScope, $location) {
            $rootScope.$on('$stateChangeSuccess', function(evt, next, previous) {
                for (var a in next) {
                console.log("########## $routeChangeSuccess next :" + a);
                }
                console.log("##########  next.url :" + next.url);
                console.log("##########  previous.url :" + previous.url);
                console.log("##########  previous.params :" + angular.toJson(previous.params));
            });
        }]);
        // Bootstrap Angular when DOM is ready
        angularAMD.bootstrap(app);
        console.log("##########  angularAMD.bootstrap(app)  ################");
        app.controller("mainC",function($scope) {
            $scope.text0 = "asdfasdfsadfadsf111111111111----------------------";
        });

        app.controller("tabsController",
            function($scope, $compile, $rootScope) {

                $scope.createTab = function(id, label, pageUrl) {
                    //alert(contextPath);
                    var tabTemplate = "<li id='@{tabliid}'><a href='@{href}'>@{label} </a><span class='ui-icon ui-icon-close' style='float:right;cursor:pointer;'>Remove Tab</span></li>";

                    var tabs = $('#tabsTitle').tabs();
                    tabs.on( "click",'span.ui-icon-close', function() {
                        var panelId = $( this ).closest( "li" ).attr( "aria-controls" );
                        $( "#" + panelId ).remove();
                        $( this ).closest( "li" ).remove();
                        tabs.tabs( "refresh" );
                        //if (tabs.tabs( 'length' ) == 0) {
                        //    createTab('hellotdf',"欢迎----alalasdfasdfasdfasdfsd");
                        //    tabs.tabs('select' , 0);
                        //}
                    });
                    if (!document.getElementById("tabdiv_" + id)) {
                        var li = $( tabTemplate.replace( /@\{tabliid\}/g, "tabli_" + id ).replace( /@\{href\}/g, "#tabdiv_" + id ).replace( /@\{label\}/g, label ) );
                        tabs.find( ".ui-tabs-nav" ).append( li );
                       var newDirective = angular.element("<div id='"+id+"' ui-view='uiView_"+id+"'></div>");
                        tabs.append( "<div id='tabdiv_" + id + "' style='height:100%;padding:0px;'>"
                            +"</div>" );
                        $("#tabdiv_" + id).append(newDirective);
                        $compile(tabs)($scope);
                       //  console.log(newDirective);
                        tabs.tabs( "refresh" );
                        tabs.tabs('select' , "#tabdiv_"+id);
                    } else {
                        tabs.tabs( "refresh" );
                        tabs.tabs('select' , "#tabdiv_"+id);
                    }
                }
                //tabs.tabs('option', 'fx', { opacity: 'toggle' });
                $scope.createTab('welcome',"&#x6B22;&#x8FCE;");


            });



        app.controller("uitabController",
            function($scope, $compile) {

            });
        return app;
    });

